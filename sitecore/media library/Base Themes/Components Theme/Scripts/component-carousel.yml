---
ID: "99c67b35-5802-44ef-a959-2ed64c09ca10"
Parent: "02f3f9cf-6e2b-49c8-be56-9701c0316569"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Base Themes/Components Theme/Scripts/component-carousel"
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/99C67B35580244EFA9592ED64C09CA10.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  Value: LyoqDQogKiBYQUNvbnRleHQNCiAqDQogKiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzIG1vZHVsZS4NCiAqDQogKiBFeHBvc2VzIHJlZ2lzdGVyIChzZWxlY3Rvciwgb3B0aW9ucykgbWV0aG9kIHRoYXQgaW5pdGlhbGl6ZXMgQ2Fyb3VzZWwNCiAqIGZvciBlYWNoIGVsZW1lbnQgdGhhdCBtYXRjaGVzIHRoZSBwcm92aWRlZCBzZWxlY3Rvciwgd2l0aCBpdHMgZ2l2ZW4gb3B0aW9ucy4NCiAqIEVsZW1lbnQgdXNlZCBhcyBhIGNhcm91c2VsIG11c3QgY29udGFpbiBhIDx1bCBjbGFzcz0ic2xpZGVzIj4gdGFnLg0KICogVGhhdCB0YWcgbXVzdCBiZSBmaWxsZWQgd2l0aCA8bGk+IGVsZW1lbnRzLiBFYWNoIDxsaT4gZWxlbWVudCB3aWxsIGJlIGNvbnNpZGVyZWQgYXMgYSBzbGlkZS4NCiAqIEZvciBtb3JlIGRldGFpbHMgcmVhZCB0aGUgZG9jdW1lbnRhdGlvbiBvZiB0aGUgcmVnaXN0ZXIoc2VsZWN0b3IsIG9wdGlvbnMpIG1ldGhvZC4NCiAqDQogKiBAcmVxdWlyZXMgalF1ZXJ5IEphdmFTY3JpcHQgTGlicmFyeSB2MS40LjQgb3IgaGlnaGVyDQogKi8NCi8qIGdsb2JhbCBIYW1tZXI6dHJ1ZSAqLw0KWEEuY29tcG9uZW50LmNhcm91c2VscyA9IChmdW5jdGlvbigkKSB7DQogICAgdmFyIHB1YiA9IHt9LA0KICAgICAgICBOYXZpZ2F0aW9uQnVpbGRlciA9IG51bGwsDQogICAgICAgIFNsaWRlckluaXRpYWxpemVyID0gbnVsbDsNCg0KICAgIC8qKg0KICAgICAqIFRpbWVyIGNsYXNzIHNhdmVzIHRpbWUgc3RhbXAgYW5kIGNvdW50cyB0aW1lIGRpZmZlcmVuY2UgYmV0d2Vlbg0KICAgICAqIGN1cnJlbnQgdGltZSAodXBkYXRlKCkgbWV0aG9kKSBhbmQgc2F2ZWQgdGltZSBzdGFtcC4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBUaW1lcigpIHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFRpbWUgZGlmZmVyZW5jZSBiZXR3ZWVuIGxhc3QgdXBkYXRlKCkgY2FsbCBhbmQgbGFzdCBzZXQoKSBjYWxsDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgVGltZXINCiAgICAgICAgICovDQogICAgICAgIHRoaXMuZWxhcHNlZCA9IDA7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUaW1lIHN0YW1wDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgVGltZXINCiAgICAgICAgICovDQogICAgICAgIHRoaXMuc3RhbXAgPSBudWxsOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqICBDb3VudHMgdGltZSBkaWZmZXJlbmNlIGJldHdlZW4gY3VycmVudCB0aW1lIGFuZCBzYXZlZCB0aW1lIHN0YW1wDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVyDQogICAgICovDQogICAgVGltZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBpZiAodGhpcy5zdGFtcCAhPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhpcy5lbGFwc2VkICs9IHRoaXMubmV3U3RhbXAoKSAtIHRoaXMuc3RhbXA7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogIFNhdmVzIG5ldyB0aW1lIHN0YW1wDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVyDQogICAgICovDQogICAgVGltZXIucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB0aGlzLnN0YW1wID0gdGhpcy5uZXdTdGFtcCgpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiAgQ291bnRzIHRpbWUgZGlmZmVyZW5jZSBiZXR3ZWVuIGN1cnJlbnQgdGltZSBhbmQgc2F2ZWQgdGltZSBzdGFtcA0KICAgICAqDQogICAgICogQG1lbWJlciBUaW1lcg0KICAgICAqIEByZXR1cm4gc3RhbXAgb2YgYSBjdXJyZW50IHRpbWUNCiAgICAgKiBAdHlwZSBOdW1iZXINCiAgICAgKi8NCiAgICBUaW1lci5wcm90b3R5cGUubmV3U3RhbXAgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCkudmFsdWVPZigpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiAgUmVzZXRzIGVsYXBzZWQgdGltZS4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVGltZXINCiAgICAgKi8NCiAgICBUaW1lci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy5lbGFwc2VkID0gMDsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEVuZCBvZiBUaW1lciBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogVGltZUluZGljYXRvciBjbGFzcyBleHRlbmRzIFRpbWVyIGNsYXNzDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICogQHBhcmFtIHtPYmplY3R9ICQgICAgIGEgalF1ZXJ5IG9iamVjdA0KICAgICAqIEBwYXJhbSB7WEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5WaWV3fSB2aWV3ICBhIHRpbWUgaW5kaWNhdG9yIHZpZXcuDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVvdXQgICBhIHZpZXcgdGltZW91dA0KICAgICAqIEBiYXNlIFRpbWVyDQogICAgICovDQogICAgZnVuY3Rpb24gVGltZUluZGljYXRvcigkLCB2aWV3LCB0aW1lb3V0KSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBBIHRpbWUgaW5kaWNhdG9yIHZpZXcuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgVGltZXJJbmRpY2F0b3INCiAgICAgICAgICovDQogICAgICAgIHRoaXMudmlldyA9IHZpZXc7DQoNCiAgICAgICAgdGhpcy52aWV3LmluaXQodGltZW91dCk7DQogICAgfQ0KICAgIFRpbWVJbmRpY2F0b3IucHJvdG90eXBlID0gbmV3IFRpbWVyKCk7DQogICAgVGltZUluZGljYXRvci5jb25zdHJ1Y3RvciA9IFRpbWVyOw0KDQogICAgLyoqDQogICAgICogUGxheXMgdGhlIGF0dGFjaGVkIHZpZXcuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVySW5kaWNhdG9yDQogICAgICovDQogICAgVGltZUluZGljYXRvci5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB0aGlzLnZpZXcucGxheSgpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBQYXVzZXMgdGhlIGF0dGFjaGVkIHZpZXcuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVySW5kaWNhdG9yDQogICAgICovDQogICAgVGltZUluZGljYXRvci5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy52aWV3LnBhdXNlKCk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFJlc2V0cyBlbGFwc2VkIHRpbWUgYW5kIHJlc2V0cyB0aGUgYXR0YWNoZWQgdmlldy4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVGltZXJJbmRpY2F0b3INCiAgICAgKi8NCiAgICBUaW1lSW5kaWNhdG9yLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBUaW1lci5wcm90b3R5cGUucmVzZXQuY2FsbCh0aGlzKTsNCiAgICAgICAgdGhpcy52aWV3LnJlc2V0KCk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENvdW50cyB0aW1lIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRpbWUgYW5kIHNhdmVkIHRpbWUgc3RhbXANCiAgICAgKiBhbmQgdXBkYXRlcyB0aGUgYXR0YWNoZWQgdmlldw0KICAgICAqDQogICAgICogQG1lbWJlciBUaW1lckluZGljYXRvcg0KICAgICAqLw0KICAgIFRpbWVJbmRpY2F0b3IucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBUaW1lci5wcm90b3R5cGUudXBkYXRlLmNhbGwodGhpcyk7DQogICAgICAgIHRoaXMudmlldy51cGRhdGUodGhpcy5lbGFwc2VkKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBUaW1lSW5kaWNhdG9yIGNsYXNzDQogICAgICovDQoNCiAgICAvKioNCiAgICAgKiBOYXZpZ2F0aW9uQnVpbGRlciBvYmplY3QgY3JlYXRlcyBuYXZpZ2F0aW9uIGl0ZW1zDQogICAgICovDQogICAgTmF2aWdhdGlvbkJ1aWxkZXIgPSAoZnVuY3Rpb24oJCkgew0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVJdGVtKHNldHRpbmdzKSB7DQogICAgICAgICAgICB2YXIgdGV4dCA9IHNldHRpbmdzLnRleHQsDQogICAgICAgICAgICAgICAgJG5hdkl0ZW0gPSBudWxsOw0KDQogICAgICAgICAgICBzZXR0aW5ncy50ZXh0ID0gJyc7DQogICAgICAgICAgICBzZXR0aW5ncy5ocmVmID0gJyMnOw0KDQogICAgICAgICAgICAkbmF2SXRlbSA9ICQoJzxhPicsIHNldHRpbmdzKTsNCiAgICAgICAgICAgICQoJzxzcGFuPicsIHsNCiAgICAgICAgICAgICAgICAndGV4dCc6IHRleHQNCiAgICAgICAgICAgIH0pLmFwcGVuZFRvKCRuYXZJdGVtKTsNCg0KICAgICAgICAgICAgcmV0dXJuICRuYXZJdGVtOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogUmV0dXJucyB0aGUgZWxlbWVudChzKSB0aGF0IG1hdGNoIHRoZSBwcm92aWRlZCBzZWxlY3RvciBvciBudWxsDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHNlbGVjdG9yIGEgc2VsZWN0b3IgdXNlZCBmb3Igc2VhcmNoaW5nDQogICAgICAgICAgICAgKiBAcmV0dXJuIGEgalF1ZXJ5IG9iamVjdCBjb250YWluaW5nIGVsZW1lbnQocykgdGhhdCBtYXRjaCB0aGUgcHJvdmlkZWQgc2VsZWN0b3Igb3IgbnVsbCBpZiB0aGVyZSBpcyBubyBlbGVtZW50IG1hdGNoDQogICAgICAgICAgICAgKiBAdHlwZSBPYmplY3QNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgZ2V0RWxlbWVudDogZnVuY3Rpb24oc2VsZWN0b3IpIHsNCiAgICAgICAgICAgICAgICB2YXIgJGVsZW1lbnQgPSAkKHNlbGVjdG9yKTsNCg0KICAgICAgICAgICAgICAgIGlmICgkZWxlbWVudC5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQgPSBudWxsOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHJldHVybiAkZWxlbWVudDsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIENyZWF0ZXMgbmF2aWdhdGlvbiBpdGVtcyBhbmQgYXBwZW5kcyB0aGVtIHRvICRjb250YWluZXIuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9ICRjb250YWluZXIgICBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciAoalF1ZXJ5IG9iamVjdCkNCiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBsYWJlbCAgIG5hdmlnYXRpb24gaXRlbXMgbGFiZWwgdGVtcGxhdGUNCiAgICAgICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb3VudCAgICBudW1iZXIgb2YgbmF2aWdhdGlvbiBpdGVtcyB0byBjcmVhdGUNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgY3JlYXRlSXRlbXM6IGZ1bmN0aW9uKCRjb250YWluZXIsIGxhYmVsLCBjb3VudCkgew0KICAgICAgICAgICAgICAgIHZhciBpLA0KICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuID0gLyNce2luZGV4XH0vZywNCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M7DQoNCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0JzogbGFiZWwucmVwbGFjZShwYXR0ZXJuLCBpICsgMSkNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlSXRlbShzZXR0aW5ncykuYXBwZW5kVG8oJGNvbnRhaW5lcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogQ3JlYXRlcyBvciBzZWxlY3RzICdwcmV2aW91cycvJ25leHQnIG5hdmlnYXRpb24gaXRlbS4NCiAgICAgICAgICAgICAqIE1vZGUgb2YgYWN0aW9uIGRlcGVuZHMgb24gc2V0dGluZ3Mgb2JqZWN0Og0KICAgICAgICAgICAgICogdmFyIHNldHRpbmdzID0gew0KICAgICAgICAgICAgICogICAgIGlzQ29udGFpbmVyOiBCb29sZWFuIHZhbHVlLA0KICAgICAgICAgICAgICogICAgIGxhYmVsOiBTdHJpbmcgdmFsdWUsDQogICAgICAgICAgICAgKiAgICAgc2VsZWN0b3I6IFN0cmluZyB2YWx1ZSwNCiAgICAgICAgICAgICAqICAgICBtZXRob2Q6IFN0cmluZyB2YWx1ZQ0KICAgICAgICAgICAgICogfTsNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBJZiBzZXR0aW5ncy5zZWxlY3RvciA9PT0gbnVsbCBvciBpZiBzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbCBhbmQgc2V0dGluZ3MuaXNDb250YWluZXIgPT0gdHJ1ZQ0KICAgICAgICAgICAgICogbmF2aWdhdGlvbiBpdGVtIGlzIGNyZWF0ZWQgYW5kIGF0dGFjaGVkIHRvICRlbGVtZW50LmZpcnN0KCkgKHVzaW5nIHNldHRpbmdzLm1ldGhvZCkuDQogICAgICAgICAgICAgKiBJZiBzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbCBhbmQgc2V0dGluZ3MuaXNDb250YWluZXIgPT0gZmFsc2UNCiAgICAgICAgICAgICAqICRlbGVtZW50LmZpcnN0KCkgaXMgc2VsZWN0ZWQgYXMgbmF2aWdhdGlvbiBpdGVtDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIHNldHRpbmdzIG9mIG5hdmlnYXRpb24gaXRlbQ0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGl0ZW1TZXR0aW5ncyAgIGh0bWwgYXR0cmlidXRlcyBvZiBuYXZpZ2F0aW9uIGl0ZW0NCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkZWxlbWVudCAgICBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciAoalF1ZXJ5IG9iamVjdCkNCiAgICAgICAgICAgICAqIEByZXR1cm4gVGhlICdwcmV2Jy8nbmV4dCcgbmF2aWdhdGlvbiBpdGVtDQogICAgICAgICAgICAgKiBAdHlwZSBPYmplY3QNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgY3JlYXRlUHJldk5leHRJdGVtOiBmdW5jdGlvbihzZXR0aW5ncywgaXRlbVNldHRpbmdzLCAkZWxlbWVudCkgew0KICAgICAgICAgICAgICAgIHZhciAkaXRlbSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgIGlzU2VsZWN0b3JFeGlzdHMgPSBzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbDsNCg0KDQogICAgICAgICAgICAgICAgaWYgKGlzU2VsZWN0b3JFeGlzdHMpIHsNCiAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQgPSB0aGlzLmdldEVsZW1lbnQoc2V0dGluZ3Muc2VsZWN0b3IpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmICgkZWxlbWVudCAhPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MuaXNDb250YWluZXIgfHwgIWlzU2VsZWN0b3JFeGlzdHMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtID0gY3JlYXRlSXRlbSgkLmV4dGVuZCh7fSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0Jzogc2V0dGluZ3MubGFiZWwNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGl0ZW1TZXR0aW5ncykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgKCRlbGVtZW50LmZpcnN0KCkpW3NldHRpbmdzLm1ldGhvZF0oJGl0ZW0pOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW0gPSAkZWxlbWVudC5maXJzdCgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuICRpdGVtOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgIH0oJCkpOw0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBOYXZpZ2F0aW9uQnVpbGRlciBvYmplY3QNCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIE5hdmlnYXRpb24gY2xhc3MgdGhhdCBjb250YWlucyBuYXZpZ2F0aW9uIGl0ZW1zLg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIE5hdmlnYXRpb24oJCwgJHdyYXBwZXIsIG9wdGlvbnMpIHsNCiAgICAgICAgdmFyIGRlZmF1bHRzID0gew0KICAgICAgICAgICAgICAgICdpc0VuYWJsZWQnOiB0cnVlLA0KICAgICAgICAgICAgICAgICdoYXNQcmV2TmV4dEl0ZW1zJzogdHJ1ZSwNCiAgICAgICAgICAgICAgICAnaXRlbSc6IHsNCiAgICAgICAgICAgICAgICAgICAgJ2xhYmVsJzogJyN7aW5kZXh9JywNCiAgICAgICAgICAgICAgICAgICAgJ3NlbGVjdG9yJzogbnVsbA0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgJ3ByZXZJdGVtJzogew0KICAgICAgICAgICAgICAgICAgICAnbGFiZWwnOiAnPCcsDQogICAgICAgICAgICAgICAgICAgICdzZWxlY3Rvcic6IG51bGwsDQogICAgICAgICAgICAgICAgICAgICdpc0NvbnRhaW5lcic6IGZhbHNlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAnbmV4dEl0ZW0nOiB7DQogICAgICAgICAgICAgICAgICAgICdsYWJlbCc6ICc+JywNCiAgICAgICAgICAgICAgICAgICAgJ3NlbGVjdG9yJzogbnVsbCwNCiAgICAgICAgICAgICAgICAgICAgJ2lzQ29udGFpbmVyJzogZmFsc2UNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICdzbGlkZXNDb3VudCc6IDANCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBzZXR0aW5ncyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0cywgb3B0aW9ucyk7DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIGpRdWVyeSBvYmplY3QNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiQgPSAkOw0KICAgICAgICAvKioNCiAgICAgICAgICogTmF2aWdhdGlvbiBpdGVtcyAob25lIGZvciBlYWNoIHNsaWRlIGlmIG5hdmlnYXRpb24gaXMgZW5hYmxlZCkuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy4kaXRlbXMgPSAkKCk7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBOYXZpZ2F0aW9uICduZXh0JyBpdGVtIChpZiBwcmV2L25leHQgaXRlbXMgYXJlIGVuYWJsZWQpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJG5leHRJdGVtID0gJCgpOw0KICAgICAgICAvKioNCiAgICAgICAgICogTmF2aWdhdGlvbiAncHJldmlvdXMnIGl0ZW0gKGlmIHByZXYvbmV4dCBpdGVtcyBhcmUgZW5hYmxlZCkuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy4kcHJldkl0ZW0gPSAkKCk7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBTZWxlY3RlZCBpdGVtIChvbmUgZnJvbSB0aGlzLiRpdGVtcyBvciBudWxsKS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiRzZWxlY3RlZEl0ZW0gPSBudWxsOw0KDQogICAgICAgIC8vaW5pdGlhbGl6YXRpb24NCiAgICAgICAgaWYgKHNldHRpbmdzLmlzRW5hYmxlZCkgew0KICAgICAgICAgICAgdmFyIHNlbGYgPSB0aGlzOw0KICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBzZWxmLnByZXBhcmVJdGVtcyhzZXR0aW5ncy5pdGVtLCBzZXR0aW5ncy5zbGlkZXNDb3VudCwgJHdyYXBwZXIpOw0KICAgICAgICAgICAgICAgIC8vc2VsZWN0IGZpcnN0IGl0ZW0gb24gaW5pdA0KICAgICAgICAgICAgICAgIHNlbGYuc2VsZWN0SXRlbSgwKQ0KICAgICAgICAgICAgfSwgMTAwMCk7DQoNCiAgICAgICAgICAgICR3cmFwcGVyLmZpbmQoJy5uYXYnKS50cmlnZ2VyKCduYXZpZ2F0aW9uLWNyZWF0ZWQnLCB0aGlzKTsNCg0KDQogICAgICAgIH0NCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDU1MgY2xhc3MgdXNlZCB0byBtYXJrIHNlbGVjdGVkIGl0ZW0uDQogICAgICoNCiAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgKi8NCiAgICBOYXZpZ2F0aW9uLnByb3RvdHlwZS5zZWxlY3RlZEl0ZW1DbGFzcyA9ICdhY3RpdmUnOw0KDQogICAgLyoqDQogICAgICogTWFyayBuYXZpZ2F0aW9uIGl0ZW0gd2l0aCBnaXZlbiBpbmRleCBhcyBzZWxlY3RlZC4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleCAgICAgaW5kZXggb2YgbmF2aWdhdGlvbiBpdGVtDQogICAgICovDQogICAgTmF2aWdhdGlvbi5wcm90b3R5cGUuc2VsZWN0SXRlbSA9IGZ1bmN0aW9uIChpbmRleCkgew0KICAgICAgICBpZiAodGhpcy4kc2VsZWN0ZWRJdGVtICE9PSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLiRzZWxlY3RlZEl0ZW0ucmVtb3ZlQ2xhc3ModGhpcy5zZWxlY3RlZEl0ZW1DbGFzcyk7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy4kc2VsZWN0ZWRJdGVtID0gdGhpcy4kaXRlbXMuZXEoaW5kZXgpLmFkZENsYXNzKHRoaXMuc2VsZWN0ZWRJdGVtQ2xhc3MpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBDcmVhdGVzIG9yIHNlbGVjdHMgbmF2aWdhdGlvbiBpdGVtcyBjb250YWluZXIgYW5kIGZpbGxzIGl0IHdpdGggbmF2aWdhdGlvbiBpdGVtcy4NCiAgICAgKiBJZiBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciBpcyBub3QgZW1wdHksIGNoaWxkIGVsZW1lbnRzIGFyZSBhZG9wdGVkIGFzIG5hdmlnYXRpb24gaXRlbXMuDQogICAgICogTW9kZSBvZiBhY3Rpb24gZGVwZW5kcyBvbiBzZXR0aW5ncyBvYmplY3Q6DQogICAgICogdmFyIHNldHRpbmdzID0gew0KICAgICAqICAgICAnbGFiZWwnOiAnI3tpbmRleH0nLA0KICAgICAqICAgICAnc2VsZWN0b3InOiBudWxsDQogICAgICogfTsNCiAgICAgKiBJZiBzZXR0aW5ncy5zZWxlY3RvciA9PT0gbnVsbCBuYXZpZ2F0aW9uIGl0ZW0gY29udGFpbmVyIGlzIGNyZWF0ZWQuDQogICAgICogSWYgc2V0dGluZ3Muc2VsZWN0b3IgIT09IG51bGwgZWxlbWVudCB0aGF0IG1hdGNoIHNldHRpbmdzLnNlbGVjdG9yIGlzIGFkYXB0ZWQgYXMgbmF2aWdhZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lci4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBzZXR0aW5ncyBvZiBuYXZpZ2F0aW9uIGl0ZW1zDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IGNvdW50ICAgbnVtYmVyIG9mIG5hdmlnYXRpb24gaXRlbXMNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gJHdyYXBwZXIgICAgd3JhcHBlciBvZiBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciAoalF1ZXJ5IG9iamVjdCkNCiAgICAgKiBAcmV0dXJuIFRoZSBjb250YWluZXIgZmlsbGVkIHdpdGggbmF2aWdhdGlvbiBpdGVtcy4NCiAgICAgKiBAdHlwZSBPYmplY3QNCiAgICAgKi8NCiAgICBOYXZpZ2F0aW9uLnByb3RvdHlwZS5wcmVwYXJlSXRlbXMgPSBmdW5jdGlvbihzZXR0aW5ncywgY291bnQsICR3cmFwcGVyKSB7DQogICAgICAgIHZhciAkY29udGFpbmVyID0gbnVsbDsNCg0KICAgICAgICBpZiAoc2V0dGluZ3Muc2VsZWN0b3IgIT09IG51bGwpIHsNCiAgICAgICAgICAgICRjb250YWluZXIgPSBOYXZpZ2F0aW9uQnVpbGRlci5nZXRFbGVtZW50KHNldHRpbmdzLnNlbGVjdG9yKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRjb250YWluZXIgPSAkKCc8ZGl2Lz4nLCB7DQogICAgICAgICAgICAgICAgJ2NsYXNzJzogJ25hdicNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgJGNvbnRhaW5lci5hcHBlbmRUbygkd3JhcHBlcik7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoJGNvbnRhaW5lciAhPT0gbnVsbCkgew0KICAgICAgICAgICAgaWYgKCRjb250YWluZXIuY2hpbGRyZW4oKS5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICBOYXZpZ2F0aW9uQnVpbGRlci5jcmVhdGVJdGVtcygkY29udGFpbmVyLCBzZXR0aW5ncy5sYWJlbCwgY291bnQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy4kaXRlbXMgPSAkY29udGFpbmVyLmNoaWxkcmVuKCkuc2xpY2UoMCwgY291bnQpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICRjb250YWluZXI7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgb3Igc2VsZWN0cyBuYXZpZ2F0aW9uICdwcmV2aW91cycgYW5kICduZXh0JyBuYXZpZ2F0aW9uIGl0ZW1zIChAc2VlIE5hdmlnYXRpb25CdWlsZGVyLmNyZWF0ZVByZXZOZXh0SXRlbSgpKS4NCiAgICAgKiBJZiBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciBpcyBub3QgZW1wdHksIGNoaWxkIGVsZW1lbnRzIGFyZSBhZG9wdGVkIGFzIG5hdmlnYXRpb24gaXRlbXMuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3Mgc2V0dGluZ3Mgb2YgbmF2aWdhdGlvbg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkY29udGFpbmVyICAgIG5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIChqUXVlcnkgb2JqZWN0KQ0KICAgICAqLw0KICAgIE5hdmlnYXRpb24ucHJvdG90eXBlLnByZXBhcmVQcmV2TmV4dEl0ZW1zID0gZnVuY3Rpb24oc2V0dGluZ3MsICRjb250YWluZXIpIHsNCiAgICAgICAgdmFyICRpdGVtOw0KDQogICAgICAgIHNldHRpbmdzLnByZXZJdGVtLm1ldGhvZCA9ICdwcmVwZW5kJzsNCiAgICAgICAgJGl0ZW0gPSBOYXZpZ2F0aW9uQnVpbGRlci5jcmVhdGVQcmV2TmV4dEl0ZW0oc2V0dGluZ3MucHJldkl0ZW0sIHsNCiAgICAgICAgICAgICdjbGFzcyc6ICdwcmV2Jw0KICAgICAgICB9LCAkY29udGFpbmVyKTsNCiAgICAgICAgdGhpcy4kcHJldkl0ZW0gPSAoJGl0ZW0gPT09IG51bGwpID8gdGhpcy4kcHJldkl0ZW0gOiAkaXRlbTsNCg0KICAgICAgICBzZXR0aW5ncy5uZXh0SXRlbS5tZXRob2QgPSAnYXBwZW5kJzsNCiAgICAgICAgJGl0ZW0gPSBOYXZpZ2F0aW9uQnVpbGRlci5jcmVhdGVQcmV2TmV4dEl0ZW0oc2V0dGluZ3MubmV4dEl0ZW0sIHsNCiAgICAgICAgICAgICdjbGFzcyc6ICduZXh0Jw0KICAgICAgICB9LCAkY29udGFpbmVyKTsNCiAgICAgICAgdGhpcy4kbmV4dEl0ZW0gPSAoJGl0ZW0gPT09IG51bGwpID8gdGhpcy4kbmV4dEl0ZW0gOiAkaXRlbTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBOYXZpZ2F0aW9uIGNsYXNzDQogICAgICovDQoNCiAgICAvKioNCiAgICAgKiBTbGlkZXJDb250ZXh0IGNsYXNzIGlzIGJpbmRlZCB0byBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQ0KICAgICAqIGFuZCBjb250YWlucyBpdHMgcHJvcGVydGllcy4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBTbGlkZXJDb250ZXh0KCkgew0KICAgICAgICAvKioNCiAgICAgICAgICogRmxhZyB0aGF0IGRldGVybWluZXMgaWYgc2xpZGUgY2FuIG9yIGNhbm5vdCBiZSBjaGFuZ2VkIChmb3IgdXNlciByZXF1ZXN0KQ0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuY2FuQ2hhbmdlU2xpZGUgPSB0cnVlOw0KICAgICAgICAvKioNCiAgICAgICAgICogRGVmYXVsdCBTbGlkZXIgc2V0dGluZyBvYmplY3QgKEBzZWUgU2xpZGVyKQ0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuZGVmYXVsdHMgPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogTmF2aWdhdGlvbiBvYmplY3QgKEBzZWUgTmF2aWdhdGlvbikNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLm5hdmlnYXRpb24gPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogU2xpZGVyIG9iamVjdCB0aGF0IHRoaXMgY29udGV4dCBpcyBhdHRhY2hlZCB0by4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLm93bmVyID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEZsYWcgdGhhdCBkZXRlcm1pbmVzIGlmIGNoYW5nZSBvZiBhIHNsaWRlIGNhbiBvciBjYW4gbm90IGJlIHNjaGVkdWxlZC4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnByZXZlbnRTY2hlZHVsaW5nID0gZmFsc2U7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBTbGlkZXIgc2V0dGluZyBvYmplY3QNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnNldHRpbmdzID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEluc3RhbmNlIG9mIFRpbWVyIGNsYXNzIChAc2VlIFRpbWVyKSB0aGF0IGlzIHVzZWQgdG8gc3RvcmUgaG93IG11Y2gNCiAgICAgICAgICogdGltZSBpcyBsZWZ0IHRvIGNoYW5nZSB0aGUgc2xpZGUuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5zbGlkZVRpbWVyID0gbmV3IFRpbWVyKCk7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbnN0YW5jZSBvZiBUaW1lSW5kaWNhdG9yIGNsYXNzIChAc2VlIFRpbWVJbmRpY2F0b3IpDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy50aW1lSW5kaWNhdG9yID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFRpbWVycyBhcnJheS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnRpbWVycyA9IFtdOw0KICAgICAgICAvKioNCiAgICAgICAgICogTGFzdCB0aW1lb3V0IGlkZW50aWZpZXIuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy50aW1lb3V0SWQgPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogVHJhbnNpdGlvbiAoQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zLlRyYW5zaXRpb24pIHVzZWQgd2hpbGUgY2hhbmdpbmcgc2xpZGVzDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy50cmFuc2l0aW9uID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFRyYW5zaXRpb24gc2V0dGluZ3Mgb2JqZWN0IChAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvblNldHRpbmdzKQ0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMudHJhbnNpdGlvblNldHRpbmdzID0gbmV3IFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvblNldHRpbmdzKCk7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBqUXVlcnkgb2JqZWN0IHRoYXQgY29udGFpbnMgYWxsIHNsaWRlcw0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJHNsaWRlcyA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBqUXVlcnkgb2JqZWN0IHRoYXQgY29udGFpbnMgdGhlIGVsZW1lbnQgdGhhdCB3cmFwcyBzbGlkZXMNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiR3cmFwcGVyID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFJlZmVyZW5jZSB0byBtZXRob2QgdGhhdCBzaG91bGQgY2hhbmdlIGN1cnJlbnQgc2xpZGUNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmNoYW5nZUN1cnJlbnRTbGlkZSA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBSZWZlcmVuY2UgdG8gbWV0aG9kIHRoYXQgc2hvdWxkIHJldHVybiBqUXVlcnkgb2JqZWN0IHdpdGggY3VycmVudCBzbGlkZQ0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuZ2V0Q3VycmVudFNsaWRlID0gbnVsbDsNCg0KICAgICAgICB0aGlzLnRpbWVycy5wdXNoKHRoaXMuc2xpZGVUaW1lcik7DQogICAgfQ0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBTbGlkZXJDb250ZXh0IGNsYXNzDQogICAgICovDQoNCiAgICAvKioNCiAgICAgKiBTbGlkZXIgY2xhc3MgbWFuYWdlcyBjaGFuZ2luZyBvZiBzbGlkZXMuDQogICAgICoNCiAgICAgKiBPcHRpb25zIG9iamVjdDoNCiAgICAgKiB7DQogICAgICogICAgICduYXZpZ2F0aW9uJzogT2JqZWN0IHZhbHVlLCAvL25hdmlnYXRpb24gc2V0dGluZ3Mgb2JqZWN0DQogICAgICogICAgICd0aW1lb3V0JzogTnVtYmVyIHZhbHVlLCAvL3RpbWUgYmV0d2VlbiBzbGlkZXMgY2hhbmdpbmcNCiAgICAgKiAgICAgJ3RyYW5zaXRpb24nOiBTdHJpbmcgdmFsdWUsIC8vbmFtZSBvZiB0cmFuc2l0aW9uIGNsYXNzIChAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvbikNCiAgICAgKiAgICAgJ2lzUGF1c2VFbmFibGVkJzogQm9vbGVhbiB2YWx1ZSwgLy9mbGFnIHRoYXQgZGV0ZXJtaW5lcyBpZiBwYXVzZSBmZWF0dXJlIGlzIGVuYWJsZWQNCiAgICAgKiAgICAgJ3RpbWVJbmRpY2F0b3InOiB7DQogICAgICogICAgICAgICAnaXNFbmFibGVkJzogQm9vbGVhbiB2YWx1ZSwgLy9mbGFnIHRoYXQgZGV0ZXJtaW5lcyBpZiB0aW1lIGluZGljYXRvciBpcyBlbmFibGVkDQogICAgICogICAgICAgICAnc2VsZWN0b3InOiBTdHJpbmcgdmFsdWUsIC8vc2VsZWN0b3Igb2YgdGltZSBpbmRpY2F0b3IgaHRtbCBlbGVtZW50DQogICAgICogICAgICAgICAndmlldyc6IFN0cmluZyB2YWx1ZSwgLy9uYW1lIG9mIHZpZXcgY2xhc3MgKEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5WaWV3DQogICAgICogICAgICAgICAnb3B0aW9ucyc6IE9iamVjdCB2YWx1ZSAvL29iamVjdCB3aXRoIG9wdGlvbnMgdGhhdCB3aWxsIGJlIHBhc3NlZCB0byBhIHRpbWUgaW5kaWNhdG9yIHZpZXcNCiAgICAgKiAgICAgfQ0KICAgICAqIH0NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKiBAcGFyYW0ge09iamVjdH0gJCAgICAgdGhlIGpRdWVyeSBvYmplY3QNCiAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICAgaW5zdGFuY2Ugb2YgU2xpZGVyQ29udGV4dCBjbGFzczsgbXVzdCBiZSBzZXBhcmF0ZSBmb3IgZWFjaCBpbnN0YW5jZSAoQHNlZSBTbGlkZXJDb250ZXh0KQ0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zICAgIFNsaWRlciBvcHRpb25zIG9iamVjdA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFNsaWRlcigkLCBjb250ZXh0LCBvcHRpb25zKSB7DQogICAgICAgIHZhciBkZWZhdWx0cyA9IHsNCiAgICAgICAgICAgICduYXZpZ2F0aW9uJzoge30sDQogICAgICAgICAgICAndGltZW91dCc6IDEwMDAwLA0KICAgICAgICAgICAgJ3RyYW5zaXRpb24nOiAnQmFzaWNUcmFuc2l0aW9uJywNCiAgICAgICAgICAgICdpc1BhdXNlRW5hYmxlZCc6IHRydWUsDQogICAgICAgICAgICAndGltZUluZGljYXRvcic6IHsNCiAgICAgICAgICAgICAgICAnaXNFbmFibGVkJzogZmFsc2UsDQogICAgICAgICAgICAgICAgJ3NlbGVjdG9yJzogbnVsbCwNCiAgICAgICAgICAgICAgICAndmlldyc6ICdWaWV3JywNCiAgICAgICAgICAgICAgICAnb3B0aW9ucyc6IHt9DQogICAgICAgICAgICB9DQogICAgICAgIH07DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEluc3RhbmNlIG9mIFNsaWRlckNvbnRleHQgY2xhc3MgKEBzZWUgU2xpZGVyQ29udGV4dCkNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0Ow0KDQogICAgICAgIGNvbnRleHQub3duZXIgPSB0aGlzOw0KICAgICAgICBjb250ZXh0LmRlZmF1bHRzID0gZGVmYXVsdHM7DQogICAgICAgIGNvbnRleHQuc2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIG9wdGlvbnMpOw0KICAgICAgICBjb250ZXh0LnRyYW5zaXRpb25TZXR0aW5ncy4kc2xpZGVzID0gY29udGV4dC4kc2xpZGVzOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEV4ZWN1dGVzIG1ldGhvZCB3aXRoIGdpdmVuIG1ldGhvZE5hbWUgb24gZWFjaCBUaW1lciBpbiBjb250ZXh0LnRpbWVycyAoQHNlZSBUaW1lcikNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgU2xpZGVyDQogICAgICogQHBhcmFtIHtTdHJpbmd9IG1ldGhvZE5hbWUgICBuYW1lIG9mIGEgbWV0aG9kIHRoYXQgd2lsbCBiZSBleGVjdXRlZCBvbiB0aW1lcnMNCiAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICAgY3VycmVudCBjb250ZXh0DQogICAgICovDQogICAgU2xpZGVyLnByb3RvdHlwZS5leGVjdXRlT25UaW1lcnMgPSBmdW5jdGlvbihtZXRob2ROYW1lLCBjb250ZXh0KSB7DQogICAgICAgIHZhciBpID0gbnVsbCwNCiAgICAgICAgICAgIHRpbWVyID0gbnVsbCwNCiAgICAgICAgICAgIHRpbWVycyA9IGNvbnRleHQudGltZXJzOw0KDQogICAgICAgIGZvciAoaSA9IDA7IGkgPCB0aW1lcnMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHRpbWVyID0gdGltZXJzW2ldOw0KICAgICAgICAgICAgaWYgKHR5cGVvZih0aW1lclttZXRob2ROYW1lXSkgPT09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgICAgICAgICB0aW1lclttZXRob2ROYW1lXSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIERlc2NoZWR1bGVzIGNoYW5nZSBvZiBhIHNsaWRlLCBieSBjbGVhcmluZyB0aW1lb3V0IHByZXZpb3VzbHkgc2V0IGJ5IHNldFRpbWVvdXQoKSBmdW5jdGlvbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgU2xpZGVyDQogICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGN1cnJlbnQgY29udGV4dA0KICAgICAqLw0KICAgIFNsaWRlci5wcm90b3R5cGUuZGVzY2hlZHVsZVNsaWRlID0gZnVuY3Rpb24oY29udGV4dCkgew0KICAgICAgICBpZiAoY29udGV4dC50aW1lb3V0SWQgIT09IG51bGwpIHsNCiAgICAgICAgICAgIGNsZWFyVGltZW91dChjb250ZXh0LnRpbWVvdXRJZCk7DQogICAgICAgICAgICBjb250ZXh0LnRpbWVvdXRJZCA9IG51bGw7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogU2NoZWR1bGVzIGNoYW5nZSBvZiBhIHNsaWRlLCBieSBzZXR0aW5nIHRpbWVvdXQgKHVzaW5nIHNldFRpbWVvdXQoKSBmdW5jdGlvbikgaWYgaXQgY2FuLg0KICAgICAqIElmIGNhbm5vdCwgaXQgdHJpZXMgYWdhaW4gYWZ0ZXIgc2hvcnQgcGVyaW9kIG9mIHRpbWUuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgICBjdXJyZW50IGNvbnRleHQNCiAgICAgKi8NCiAgICBTbGlkZXIucHJvdG90eXBlLnNjaGVkdWxlU2xpZGUgPSBmdW5jdGlvbihjb250ZXh0KSB7DQogICAgICAgIHZhciBvd25lciA9IGNvbnRleHQub3duZXI7DQoNCiAgICAgICAgb3duZXIuZGVzY2hlZHVsZVNsaWRlKGNvbnRleHQpOw0KDQogICAgICAgIGlmICghY29udGV4dC5wcmV2ZW50U2NoZWR1bGluZyAmJiBjb250ZXh0LiRzbGlkZXMubGVuZ3RoID4gMSkgew0KICAgICAgICAgICAgb3duZXIuZXhlY3V0ZU9uVGltZXJzKCdzZXQnLCBjb250ZXh0KTsNCg0KICAgICAgICAgICAgaWYgKGNvbnRleHQuY2FuQ2hhbmdlU2xpZGUpIHsNCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC50aW1lSW5kaWNhdG9yICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQudGltZUluZGljYXRvci5wbGF5KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbnRleHQudGltZW91dElkID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgb3duZXIuY2hhbmdlQ3VycmVudFNsaWRlQnkoMSwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgfSwgY29udGV4dC5zZXR0aW5ncy50aW1lb3V0IC0gY29udGV4dC5zbGlkZVRpbWVyLmVsYXBzZWQpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBvd25lci5zY2hlZHVsZVNsaWRlKGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIH0sIDEwMCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQ2hhbmdlcyBjdXJyZW50IHNsaWRlIGJ5IG9mZnNldCBwZXJmb3JtaW5nIGNvbnRleHQudHJhbnNpdGlvbg0KICAgICAqIEFueSBvZmZzZXQgdmFsdWUgaXMgc2F2ZSAoaWYgaXQgaXMgYW4gaW50ZWdlcikuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBvZmZzZXQgICAgdGhlIG9mZnNldCB0byBhbiBpbmRleCBvZiBhIG5ldyBzbGlkZQ0KICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgICBjdXJyZW50IGNvbnRleHQNCiAgICAgKi8NCiAgICBTbGlkZXIucHJvdG90eXBlLmNoYW5nZUN1cnJlbnRTbGlkZUJ5ID0gZnVuY3Rpb24ob2Zmc2V0LCBjb250ZXh0KSB7DQogICAgICAgIHZhciBzZXR0aW5ncyA9IGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzLA0KICAgICAgICAgICAgJGN1cnJlbnRTbGlkZSA9IGNvbnRleHQuZ2V0Q3VycmVudFNsaWRlKCksDQogICAgICAgICAgICAkc2xpZGVzID0gY29udGV4dC4kc2xpZGVzOw0KDQogICAgICAgIGlmICgob2Zmc2V0ICUgJHNsaWRlcy5sZW5ndGgpICE9PSAwKSB7DQogICAgICAgICAgICBjb250ZXh0LmNhbkNoYW5nZVNsaWRlID0gZmFsc2U7DQoNCiAgICAgICAgICAgIHNldHRpbmdzLm9mZnNldCA9IG9mZnNldDsNCiAgICAgICAgICAgIHNldHRpbmdzLiRjdXJyZW50U2xpZGUgPSAkY3VycmVudFNsaWRlOw0KICAgICAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZSA9ICRzbGlkZXMuZXEoKCRjdXJyZW50U2xpZGUuaW5kZXgoKSArIG9mZnNldCkgJSAkc2xpZGVzLmxlbmd0aCk7DQoNCiAgICAgICAgICAgIGNvbnRleHQuY2hhbmdlQ3VycmVudFNsaWRlKHNldHRpbmdzLiRuZXh0U2xpZGUpOw0KICAgICAgICAgICAgY29udGV4dC50cmFuc2l0aW9uLnBlcmZvcm0oY29udGV4dC50cmFuc2l0aW9uU2V0dGluZ3MsIG9mZnNldCk7DQogICAgICAgICAgICBjb250ZXh0Lm93bmVyLmV4ZWN1dGVPblRpbWVycygncmVzZXQnLCBjb250ZXh0KTsNCiAgICAgICAgfQ0KDQoNCiAgICAgICAgdmFyICRjYXJvdXNlbCA9ICQoY29udGV4dC4kd3JhcHBlcikucGFyZW50cygiLmNhcm91c2VsIik7DQogICAgICAgICRjYXJvdXNlbC50cmlnZ2VyKCJzbGlkZS1jaGFuZ2VkIik7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFN0YXJ0cyBhdXRvbWF0aWMgc2xpZGUgY2hhbmdpbmcNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgU2xpZGVyDQogICAgICovDQogICAgU2xpZGVyLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy5leGVjdXRlT25UaW1lcnMoJ3Jlc2V0JywgdGhpcy5jb250ZXh0KTsNCiAgICAgICAgdGhpcy5zY2hlZHVsZVNsaWRlKHRoaXMuY29udGV4dCk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENhbmNlbCB0aGUgZGVmYXVsdCBhY3Rpb24gb2YgZXZlbnQgYW5kIGNoYW5nZXMgc2xpZGVzIG1hbnVhbGx5Lg0KICAgICAqDQogICAgICogQG1lbWJlciBTbGlkZXINCiAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgICAgIHRoZSBldmVudA0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBvZmZzZXQgICAgdGhlIG9mZnNldCB0byBhbiBpbmRleCBvZiBhIG5ldyBzbGlkZQ0KICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgICBjdXJyZW50IGNvbnRleHQNCiAgICAgKi8NCiAgICBTbGlkZXIucHJvdG90eXBlLm9uQ2hhbmdlQ3VycmVudFNsaWRlID0gZnVuY3Rpb24oZXZlbnQsIG9mZnNldCwgY29udGV4dCkgew0KICAgICAgICB2YXIgb3duZXIgPSBjb250ZXh0Lm93bmVyOw0KDQogICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIGlmIChjb250ZXh0LmNhbkNoYW5nZVNsaWRlKSB7DQogICAgICAgICAgICBvd25lci5kZXNjaGVkdWxlU2xpZGUoY29udGV4dCk7DQogICAgICAgICAgICBvd25lci5jaGFuZ2VDdXJyZW50U2xpZGVCeShvZmZzZXQsIGNvbnRleHQpOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFNlbGVjdHMgbmF2aWdhdGlvbiBpdGVtIHdpdGggZ2l2ZW4gaW5kZXguDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBpbmRleCAgICAgdGhlIGluZGV4IG9mIG5hdmlnYXRpb24gaXRlbQ0KICAgICAqLw0KICAgIFNsaWRlci5wcm90b3R5cGUuc2VsZWN0TmF2aWdhdGlvbkl0ZW0gPSBmdW5jdGlvbihpbmRleCkgew0KICAgICAgICB0aGlzLmNvbnRleHQubmF2aWdhdGlvbi5zZWxlY3RJdGVtKGluZGV4KTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBTbGlkZXIgY2xhc3MNCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIFNsaWRlckluaXRpYWxpemVyIG9iamVjdCBzZXRzIHVwIGluc3RhbmNlcyBvZiBTbGlkZXIgY2xhc3MNCiAgICAgKi8NCiAgICBTbGlkZXJJbml0aWFsaXplciA9IChmdW5jdGlvbigkKSB7DQogICAgICAgIHZhciBESVJFQ1RJT04gPSB7DQogICAgICAgICAgICBQUkVWOiAtMSwNCiAgICAgICAgICAgIE5FWFQ6IDENCiAgICAgICAgfTsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQXR0YWNoZXMgZXZlbnRzIHRvIG5hdmlnYXRpb24gaXRlbXMuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgIGEgY29udGV4dCBvZiBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQ0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gYXR0YWNoTmF2aWdhdGlvbkV2ZW50cyhjb250ZXh0KSB7DQogICAgICAgICAgICB2YXIgb3duZXIgPSBjb250ZXh0Lm93bmVyLA0KICAgICAgICAgICAgICAgICRuYXZMaW5rcyA9IGNvbnRleHQuJHdyYXBwZXIuZmluZCgiLm5hdi1pdGVtcyIpLA0KICAgICAgICAgICAgICAgICRwcmV2SXRlbVR4dCA9IGNvbnRleHQuJHdyYXBwZXIuZmluZCgnLnByZXYtdGV4dCcpLA0KICAgICAgICAgICAgICAgICRuZXh0SXRlbVR4dCA9IGNvbnRleHQuJHdyYXBwZXIuZmluZCgnLm5leHQtdGV4dCcpLA0KICAgICAgICAgICAgICAgICRjYXJvdXNlbCA9IGNvbnRleHQuJHdyYXBwZXIucGFyZW50cygiLmNhcm91c2VsIik7DQoNCiAgICAgICAgICAgIGNvbnRleHQubmF2aWdhdGlvbi4kaXRlbXMuZWFjaChmdW5jdGlvbiAoaW5kZXgpIHsNCiAgICAgICAgICAgICAgICB2YXIgJHNsaWRlID0gY29udGV4dC4kc2xpZGVzLmVxKGluZGV4KTsNCg0KICAgICAgICAgICAgICAgICQodGhpcykuY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgICAgIG93bmVyLm9uQ2hhbmdlQ3VycmVudFNsaWRlKGV2ZW50LCAkc2xpZGUuaW5kZXgoKSAtIGNvbnRleHQuZ2V0Q3VycmVudFNsaWRlKCkuaW5kZXgoKSwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgJHByZXZJdGVtVHh0LmNsaWNrKGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgICAgICAgICAgIHN3aXRjaFNsaWRlKGV2ZW50LCBjb250ZXh0LCBESVJFQ1RJT04uUFJFVik7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgJG5leHRJdGVtVHh0LmNsaWNrKGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgICAgICAgICAgIHN3aXRjaFNsaWRlKGV2ZW50LCBjb250ZXh0LCBESVJFQ1RJT04uTkVYVCk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgY29udGV4dC5uYXZpZ2F0aW9uLiRwcmV2SXRlbS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2hTbGlkZShldmVudCwgY29udGV4dCwgRElSRUNUSU9OLlBSRVYpOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGNvbnRleHQubmF2aWdhdGlvbi4kbmV4dEl0ZW0uY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgc3dpdGNoU2xpZGUoZXZlbnQsIGNvbnRleHQsIERJUkVDVElPTi5ORVhUKTsNCiAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAkbmF2TGlua3Mub24oImtleWRvd24iLCBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKGV2ZW50LmtleUNvZGUpIHsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNzogLy9MZXRmIGFycm93DQogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2hTbGlkZShldmVudCwgY29udGV4dCwgRElSRUNUSU9OLlBSRVYpOw0KICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5maW5kKCIuYWN0aXZlIikuZm9jdXMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIDM5OiAvL1JpZ2h0IGFycm93DQogICAgICAgICAgICAgICAgICAgICAgICBzd2l0Y2hTbGlkZShldmVudCwgY29udGV4dCwgRElSRUNUSU9OLk5FWFQpOw0KICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5maW5kKCIuYWN0aXZlIikuZm9jdXMoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICBjYXNlIDEzOiAvL0VudGVyDQogICAgICAgICAgICAgICAgICAgICAgICBmb2N1c0ZpcnN0Rm9jdXNhYmxlRWxlbWVudChvd25lci5jb250ZXh0LmdldEN1cnJlbnRTbGlkZSgpKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgJGNhcm91c2VsLm9uKCJzbGlkZS1jaGFuZ2VkIiwgZnVuY3Rpb24oZXZlbnQpew0KICAgICAgICAgICAgICAgIHZhciAkYWN0aXZlTGluayA9ICRuYXZMaW5rcy5maW5kKCIuYWN0aXZlIik7DQogICAgICAgICAgICAgICAgJGFjdGl2ZUxpbmsuYXR0cigndGFiaW5kZXgnLCAnMCcpOw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmKCRuYXZMaW5rcy5maW5kKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpLmxlbmd0aCl7DQogICAgICAgICAgICAgICAgICAgICRhY3RpdmVMaW5rLmZvY3VzKHsgcHJldmVudFNjcm9sbDogdHJ1ZSB9KTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAkbmF2TGlua3MuZmluZCgiPmRpdiIpLm5vdCgnLmFjdGl2ZScpLmF0dHIoJ3RhYmluZGV4JywgJy0xJyk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBTd2l0Y2hlcyBzbGlkZXMgYmFjayBhbmQgZm9yZXdhcmQNCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQgICAgICAgICAgICAgIGFuIGV2ZW50IHRoYXQgY2F1c2VkIHN3aXRjaCBzbGlkZSBhY3Rpb24NCiAgICAgICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGEgY29udGV4dCBvZiBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQ0KICAgICAgICAgKiBAcGFyYW0ge251bWJlcn0gZGlyZWN0aW9uICAgICAgICAgc3dpdGNoIHNsaWRlIGRpcmVjdGlvbi4gLTEgLSBzd2l0Y2ggdG8gcHJldiBzbGlkZS4gMSAtIHN3aXRjaCB0byB0aGUgbmV4dCBzbGlkZQ0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gc3dpdGNoU2xpZGUoZXZlbnQsIGNvbnRleHQsIGRpcmVjdGlvbikgew0KICAgICAgICAgICAgdmFyIG93bmVyID0gY29udGV4dC5vd25lciwNCiAgICAgICAgICAgICAgICBuYXZMaW5rcyQgPSBjb250ZXh0LiR3cmFwcGVyLmZpbmQoIi5uYXYtaXRlbXMiKTsNCg0KICAgICAgICAgICAgbmF2TGlua3MkLmZpbmQoIi5hY3RpdmUiKS5hdHRyKCd0YWJpbmRleCcsICctMScpOw0KICAgICAgICAgICAgb3duZXIub25DaGFuZ2VDdXJyZW50U2xpZGUoZXZlbnQsIGRpcmVjdGlvbiwgY29udGV4dCk7DQogICAgICAgICAgICBuYXZMaW5rcyQuZmluZCgiLmFjdGl2ZSIpLmF0dHIoJ3RhYmluZGV4JywgJzAnKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBGb2N1cyB0aGUgZmlyc3QgZm9jdXNhYmxlIGVsZW1lbnQgaW5zaWRlIGNvbnRhaW5lci4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtDb250YWluZXJ9IGNvbnRhaW5lciAgYSBjb250YWluZXIgZWxlbWVudCB3aGVyZSB0aGUgZmlyc3QgZm9jdXNhYmxlIGVsZW1lbnQgd2lsbCBiZSBmb2N1c2VkDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBmb2N1c0ZpcnN0Rm9jdXNhYmxlRWxlbWVudChjb250YWluZXIpIHsNCiAgICAgICAgICAgIHZhciBmb2N1c2FibGVFbGVtZW50c1N0cmluZyA9ICdhW2hyZWZdLCBhcmVhW2hyZWZdLCBpbnB1dDpub3QoW2Rpc2FibGVkXSksIHNlbGVjdDpub3QoW2Rpc2FibGVkXSksIHRleHRhcmVhOm5vdChbZGlzYWJsZWRdKSwgYnV0dG9uOm5vdChbZGlzYWJsZWRdKSwgaWZyYW1lLCBvYmplY3QsIGVtYmVkLCBbdGFiaW5kZXg9IjAiXSwgW2NvbnRlbnRlZGl0YWJsZV0nOw0KDQogICAgICAgICAgICAvLyBGaW5kcyBhbGwgZm9jdXNhYmxlIGNoaWxkcmVuDQogICAgICAgICAgICB2YXIgZm9jdXNhYmxlRWxlbWVudHMgPSBjb250YWluZXIuZmluZChmb2N1c2FibGVFbGVtZW50c1N0cmluZyk7DQoNCiAgICAgICAgICAgIC8vIElmIHRoZXJlIGFyZSBmb2N1c2FibGUgZWxlbWVudHMgLSBzZWxlY3QgdGhlIGZpcnN0IG9uZS4NCiAgICAgICAgICAgIGlmIChmb2N1c2FibGVFbGVtZW50cy5sZW5ndGggIT09IDApIHsNCiAgICAgICAgICAgICAgICB2YXIgZmlyc3RUYWJTdG9wID0gZm9jdXNhYmxlRWxlbWVudHNbMF07DQoNCiAgICAgICAgICAgICAgICAvLyBGb2N1cyBmaXJzdA0KICAgICAgICAgICAgICAgIGZpcnN0VGFiU3RvcC5mb2N1cygpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEF0dGFjaGVzIHBhdXNlIGV2ZW50IHRvIG5hdmlnYXRpb24gd3JhcHBlci4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgYSBjb250ZXh0IG9mIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBhdHRhY2hQYXVzZUV2ZW50KGNvbnRleHQpIHsNCiAgICAgICAgICAgIHZhciBvd25lciA9IGNvbnRleHQub3duZXIsDQogICAgICAgICAgICAgICAgJGVsZW1lbnQgPSBjb250ZXh0LiR3cmFwcGVyLA0KICAgICAgICAgICAgICAgICRuYXZMaW5rcyA9ICRlbGVtZW50LmZpbmQoIi5uYXYgYSIpOw0KDQogICAgICAgICAgICB2YXIgY2FsbGJhY2tNb3VzZWVudGVyID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgY29udGV4dC5wcmV2ZW50U2NoZWR1bGluZyA9IHRydWU7DQogICAgICAgICAgICAgICAgb3duZXIuZGVzY2hlZHVsZVNsaWRlKGNvbnRleHQpOw0KDQogICAgICAgICAgICAgICAgb3duZXIuZXhlY3V0ZU9uVGltZXJzKCd1cGRhdGUnLCBjb250ZXh0KTsNCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC50aW1lSW5kaWNhdG9yICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQudGltZUluZGljYXRvci5wYXVzZSgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJGVsZW1lbnQubW91c2VlbnRlcihjYWxsYmFja01vdXNlZW50ZXIpOw0KICAgICAgICAgICAgJG5hdkxpbmtzLm9uKCJmb2N1cyIsIGNhbGxiYWNrTW91c2VlbnRlcik7DQoNCiAgICAgICAgICAgIHZhciBjYWxsYmFja01vdXNlTGVhdmUgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBjb250ZXh0LnByZXZlbnRTY2hlZHVsaW5nID0gZmFsc2U7DQogICAgICAgICAgICAgICAgb3duZXIuc2NoZWR1bGVTbGlkZShjb250ZXh0KTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJGVsZW1lbnQubW91c2VsZWF2ZShjYWxsYmFja01vdXNlTGVhdmUpOw0KICAgICAgICAgICAgJG5hdkxpbmtzLm9uKCJibHVyIiwgY2FsbGJhY2tNb3VzZUxlYXZlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDcmVhdGVzIHRpbWUgaW5kaWNhdG9yIHZpZXcNCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgYSBjb250ZXh0IG9mIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVJbmRpY2F0b3IoY29udGV4dCkgew0KICAgICAgICAgICAgdmFyIHNldHRpbmdzID0gY29udGV4dC5zZXR0aW5ncywNCiAgICAgICAgICAgICAgICB0aW1lSW5kaWNhdG9yID0gbnVsbCwNCiAgICAgICAgICAgICAgICBWaWV3Q29uc3RydWN0b3IgPSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzW3NldHRpbmdzLnRpbWVJbmRpY2F0b3Iudmlld10sDQogICAgICAgICAgICAgICAgdmlldyA9IG51bGw7DQoNCiAgICAgICAgICAgIGlmIChWaWV3Q29uc3RydWN0b3IgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICB2aWV3ID0gbmV3IFZpZXdDb25zdHJ1Y3RvcihzZXR0aW5ncy50aW1lSW5kaWNhdG9yLnNlbGVjdG9yLCBzZXR0aW5ncy50aW1lSW5kaWNhdG9yLm9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIHRpbWVJbmRpY2F0b3IgPSBuZXcgVGltZUluZGljYXRvcigkLCB2aWV3LCBzZXR0aW5ncy50aW1lb3V0KTsNCiAgICAgICAgICAgICAgICBjb250ZXh0LnRpbWVJbmRpY2F0b3IgPSB0aW1lSW5kaWNhdG9yOw0KICAgICAgICAgICAgICAgIGNvbnRleHQudGltZXJzLnB1c2godGltZUluZGljYXRvcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogQXR0YWNoZXMgZXZlbnRzIHRvIG5hdmlnYXRpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgIGEgY29udGV4dCBvZiBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQ0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gaW5pdGlhbGl6ZU5hdmlnYXRpb24oY29udGV4dCkgew0KICAgICAgICAgICAgY29udGV4dC5zZXR0aW5ncy5uYXZpZ2F0aW9uLnNsaWRlc0NvdW50ID0gY29udGV4dC4kc2xpZGVzLmxlbmd0aDsNCiAgICAgICAgICAgIGNvbnRleHQubmF2aWdhdGlvbiA9IG5ldyBOYXZpZ2F0aW9uKCQsIGNvbnRleHQuJHdyYXBwZXIsIGNvbnRleHQuc2V0dGluZ3MubmF2aWdhdGlvbik7DQoNCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgYXR0YWNoTmF2aWdhdGlvbkV2ZW50cyhjb250ZXh0KTsNCiAgICAgICAgICAgIH0sIDEwMDApOw0KDQoNCiAgICAgICAgICAgIGlmIChjb250ZXh0LnNldHRpbmdzLmlzUGF1c2VFbmFibGVkKSB7DQogICAgICAgICAgICAgICAgYXR0YWNoUGF1c2VFdmVudChjb250ZXh0KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbml0aWFsaXplcyB0cmFuc2l0aW9uIGZvciBhIGdpdmVuIGNvbnRleHQuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgIGEgY29udGV4dCBvZiBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQ0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gaW5pdGlhbGl6ZVRyYW5zaXRpb24oY29udGV4dCkgew0KICAgICAgICAgICAgdmFyIFRyYW5zaXRpb25Db25zdHJ1Y3RvciA9IG51bGwsDQogICAgICAgICAgICAgICAgb3duZXIgPSBjb250ZXh0Lm93bmVyOw0KDQogICAgICAgICAgICBjb250ZXh0LnRyYW5zaXRpb25TZXR0aW5ncy5jYWxsYmFjayA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGNvbnRleHQuY2FuQ2hhbmdlU2xpZGUgPSB0cnVlOw0KDQogICAgICAgICAgICAgICAgaWYgKGNvbnRleHQucHJldmVudFNjaGVkdWxpbmcpIHsNCiAgICAgICAgICAgICAgICAgICAgb3duZXIuZXhlY3V0ZU9uVGltZXJzKCdyZXNldCcsIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIG93bmVyLnNjaGVkdWxlU2xpZGUoY29udGV4dCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgVHJhbnNpdGlvbkNvbnN0cnVjdG9yID0gWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9uc1tjb250ZXh0LnNldHRpbmdzLnRyYW5zaXRpb25dOw0KICAgICAgICAgICAgaWYgKChUcmFuc2l0aW9uQ29uc3RydWN0b3IgPT09IG51bGwpIHx8IChUcmFuc2l0aW9uQ29uc3RydWN0b3IgPT09IHVuZGVmaW5lZCkpIHsNCiAgICAgICAgICAgICAgICBUcmFuc2l0aW9uQ29uc3RydWN0b3IgPSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zW2NvbnRleHQuZGVmYXVsdHMudHJhbnNpdGlvbl07DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjb250ZXh0LnRyYW5zaXRpb24gPSBuZXcgVHJhbnNpdGlvbkNvbnN0cnVjdG9yKCk7DQogICAgICAgICAgICBjb250ZXh0LnRyYW5zaXRpb24uaW5pdChjb250ZXh0LnRyYW5zaXRpb25TZXR0aW5ncyk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBJbml0aWFsaXplcyBTbGlkZXIgb2JqZWN0IHdpdGggYSBnaXZlbiBjb250ZXh0Lg0KICAgICAgICAgICAgICoNCiAgICAgICAgICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgIGEgY29udGV4dCBvZiBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQ0KICAgICAgICAgICAgICovDQogICAgICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbihjb250ZXh0KSB7DQogICAgICAgICAgICAgICAgaW5pdGlhbGl6ZU5hdmlnYXRpb24oY29udGV4dCk7DQogICAgICAgICAgICAgICAgaW5pdGlhbGl6ZVRyYW5zaXRpb24oY29udGV4dCk7DQoNCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5zZXR0aW5ncy50aW1lSW5kaWNhdG9yLmlzRW5hYmxlZCkgew0KICAgICAgICAgICAgICAgICAgICBjcmVhdGVJbmRpY2F0b3IoY29udGV4dCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgIH0oJCkpOw0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBTbGlkZXJJbml0aWFsaXplcg0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogQ2Fyb3VzZWwgY2xhc3MgZGlzcGxheXMgb25lIHNsaWRlIChzb21lIGNvbnRlbnQpIGF0IHRoZSB0aW1lLg0KICAgICAqIEl0cyBiZWhhdmlvciBkZXBlbmRzIG9uIHNldHRpbmdzIChwYXNzZWQgdG8gaW5pdCgpIG1ldGhvZCkuDQogICAgICogRm9yIG1vcmUgZGV0YWlscyBAc2VlIFNsaWRlciwgQHNlZSBTbGlkZXJJbml0aWFsaXplciwgQHNlZSBOYXZpZ2F0aW9uLA0KICAgICAqIEBzZWUgTmF2aWdhdGlvbkJ1aWxkZXIsIEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5UcmFuc2l0aW9uLA0KICAgICAqIEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5WaWV3DQogICAgICoNCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBDYXJvdXNlbCgpIHsNCiAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzOw0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbnN0YW5jZSBvZiBhIFNsaWRlciBjbGFzcyAoQHNlZSBTbGlkZXIpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnNsaWRlciA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBEaXNwbGF5ZWQgc2xpZGUgKGpRdWVyeSBvYmplY3QpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiRjdXJyZW50U2xpZGUgPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogQWxsIHNsaWRlcyAoalF1ZXJ5IG9iamVjdCkuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgQ2Fyb3VzZWwNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJHNsaWRlcyA9IG51bGw7DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENoYW5nZXMgY3VycmVudCBzbGlkZSB0byBhICRuZXdTbGlkZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBDYXJvdXNlbA0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gJG5ld1NsaWRlICB0aGUgbmV3IHNsaWRlIChqUXVlcnkpIG9iamVjdC4NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuY2hhbmdlQ3VycmVudFNsaWRlID0gZnVuY3Rpb24oJG5ld1NsaWRlKSB7DQogICAgICAgICAgICBjb250ZXh0LiRjdXJyZW50U2xpZGUgPSAkbmV3U2xpZGU7DQogICAgICAgICAgICBjb250ZXh0LnNsaWRlci5zZWxlY3ROYXZpZ2F0aW9uSXRlbSgkbmV3U2xpZGUuaW5kZXgoKSk7DQogICAgICAgIH07DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIFJldHVybnMgY3VycmVudCBzbGlkZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBDYXJvdXNlbA0KICAgICAgICAgKiBAcmV0dXJuIGN1cnJlbnQgc2xpZGUgKGpRdWVyeSkgb2JqZWN0Lg0KICAgICAgICAgKiBAdHlwZSBPYmplY3QNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuZ2V0Q3VycmVudFNsaWRlID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICByZXR1cm4gY29udGV4dC4kY3VycmVudFNsaWRlOw0KICAgICAgICB9Ow0KDQogICAgICAgIHRoaXMuZGF0YSA9IHt9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlc2V0cyB0aGUgY2Fyb3VzZWwuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICovDQogICAgQ2Fyb3VzZWwucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHRoaXMuJHNsaWRlcy5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgJCh0aGlzKS5oaWRlKCk7DQogICAgICAgIH0pOw0KDQogICAgICAgIHRoaXMuY2hhbmdlQ3VycmVudFNsaWRlKHRoaXMuJHNsaWRlcy5maXJzdCgpKTsNCiAgICAgICAgdGhpcy4kY3VycmVudFNsaWRlLnNob3coKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogSW5pdGlhbGl6ZXMgdGhlIGNhcm91c2VsLg0KICAgICAqIFdyYXBzIGNhcm91c2VsIGNvbnRlbnQgd2l0aCA8ZGl2IGNsYXNzPSJ3cmFwcGVyIiAvPiBlbGVtZW50LA0KICAgICAqIHNlbGVjdHMgc2xpZGVzICg8bGkgLz4gZWxlbWVudHMpIGZyb20gPHVsIGNsYXNzPSJzbGlkZXMiIC8+IGVsZW1lbnQsDQogICAgICogaW5pdGlhbGl6ZXMgU2xpZGVyIGNsYXNzIGluc3RhbmNlLCByZXNldHMgdGhlIGNhcm91c2VsLCBhbmQgc3RhcnRzIGF1dG9tYXRpYyBzbGlkZXMgY2hhbmdpbmcuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICogQHBhcmFtIHtPYmplY3R9ICRjb250YWluZXIgICAgIGpRdWVyeSBvYmplY3Qgd2l0aCBhIG1haW4gaHRtbCBlbGVtZW50IG9mIHRoZSBjYXJvdXNlbA0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zICAgICBjYXJvdXNlbCBvcHRpb25zIG9iamVjdA0KICAgICAqLw0KICAgIENhcm91c2VsLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oJGNvbnRhaW5lciwgb3B0aW9ucykgew0KICAgICAgICB2YXIgJHdyYXBwZXIgPSAkKCc8ZGl2Lz4nLCB7DQogICAgICAgICAgICAgICAgJ2NsYXNzJzogJ3dyYXBwZXInDQogICAgICAgICAgICB9KSwNCiAgICAgICAgICAgIHNsaWRlckNvbnRleHQgPSBudWxsOw0KDQogICAgICAgICR3cmFwcGVyLmFwcGVuZCgkY29udGFpbmVyLmNoaWxkcmVuKCkuZGV0YWNoKCkpOw0KICAgICAgICAkY29udGFpbmVyLmFwcGVuZCgkd3JhcHBlcik7DQogICAgICAgIHRoaXMuJHNsaWRlcyA9ICRjb250YWluZXIuZmluZCgnLnNsaWRlcyBsaS5zbGlkZScpOw0KDQogICAgICAgIHNsaWRlckNvbnRleHQgPSBuZXcgU2xpZGVyQ29udGV4dCgpOw0KICAgICAgICBzbGlkZXJDb250ZXh0LmNoYW5nZUN1cnJlbnRTbGlkZSA9IHRoaXMuY2hhbmdlQ3VycmVudFNsaWRlOw0KICAgICAgICBzbGlkZXJDb250ZXh0LmdldEN1cnJlbnRTbGlkZSA9IHRoaXMuZ2V0Q3VycmVudFNsaWRlOw0KICAgICAgICBzbGlkZXJDb250ZXh0LiRzbGlkZXMgPSB0aGlzLiRzbGlkZXM7DQogICAgICAgIHNsaWRlckNvbnRleHQuJHdyYXBwZXIgPSAkd3JhcHBlcjsNCg0KICAgICAgICB0aGlzLnNsaWRlciA9IG5ldyBTbGlkZXIoJCwgc2xpZGVyQ29udGV4dCwgb3B0aW9ucyk7DQogICAgICAgIFNsaWRlckluaXRpYWxpemVyLmluaXRpYWxpemUoc2xpZGVyQ29udGV4dCk7DQoNCiAgICAgICAgdGhpcy5yZXNldCgpOw0KICAgICAgICB0aGlzLnNsaWRlci5ydW4oKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBDYXJvdXNlbCBjbGFzcw0KICAgICAqLw0KICAgDQoNCiAgICAvKiBDYXJvdXNlbCB0b3VjaCBzdXBwb3J0ICovDQogICAgQ2Fyb3VzZWwucHJvdG90eXBlLnN3aXBlU2xpZGUgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdmFyIHNlbGYgPSB0aGlzLA0KICAgICAgICAgICAgJHdyYXBwZXIgPSB0aGlzLnNsaWRlci5jb250ZXh0LiR3cmFwcGVyLA0KICAgICAgICAgICAgaGFtbWVyID0gbmV3IEhhbW1lcigkd3JhcHBlclswXSk7DQogICAgICAgIGhhbW1lci5nZXQoJ3BhbicpLnNldCh7IGRpcmVjdGlvbjogSGFtbWVyLkRJUkVDVElPTl9IT1JJWk9OVEFMIH0pOw0KDQogICAgICAgIGhhbW1lci5vbigic3dpcGVsZWZ0IiwgZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgc2VsZi5zbGlkZXIuY29udGV4dC5vd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShlLCAxLCBzZWxmLnNsaWRlci5jb250ZXh0KTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgaGFtbWVyLm9uKCJzd2lwZXJpZ2h0IiwgZnVuY3Rpb24oZSkgew0KICAgICAgICAgICAgc2VsZi5zbGlkZXIuY29udGV4dC5vd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShlLCAtMSwgc2VsZi5zbGlkZXIuY29udGV4dCk7DQogICAgICAgIH0pOw0KICAgIH07DQogICAgDQogICAgQ2Fyb3VzZWwucHJvdG90eXBlLm1heFNsaWRlSW5mb0hlaWdodCA9IGZ1bmN0aW9uKCl7DQogICAgICAgIHZhciBtYXhIZWlnaHQgPSAwLA0KICAgICAgICAgICAgc2xpZGVJbmZvID0gdGhpcy4kc2xpZGVzWzBdICYmIHRoaXMuJHNsaWRlc1swXS5xdWVyeVNlbGVjdG9yKCcuc2xpZGUtaW5mbycpOw0KDQogICAgICAgIGlmIChzbGlkZUluZm8pew0KICAgICAgICAgICAgbWF4SGVpZ2h0ID0gc2xpZGVJbmZvLm9mZnNldEhlaWdodDsNCiAgICAgICAgfTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB0aGlzLiRzbGlkZXMubGVuZ3RoOyBpKyspew0KICAgICAgICAgICAgdmFyIHNsaWRlSW5mbyA9IHRoaXMuJHNsaWRlc1tpXS5xdWVyeVNlbGVjdG9yKCcuc2xpZGUtaW5mbycpDQoNCiAgICAgICAgICAgIGlmICghc2xpZGVJbmZvKSB7DQogICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHZhciBjdXJyU2xpZGVJbmZvSGVpZ2h0ID0gc2xpZGVJbmZvLm9mZnNldEhlaWdodA0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAobWF4SGVpZ2h0IDxjdXJyU2xpZGVJbmZvSGVpZ2h0ICl7DQogICAgICAgICAgICAgICAgbWF4SGVpZ2h0ID0gY3VyclNsaWRlSW5mb0hlaWdodDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gbWF4SGVpZ2h0Ow0KICAgIH0NCg0KICAgIENhcm91c2VsLnByb3RvdHlwZS5yZXNpemVXcmFwcGVyID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB2YXIgc2xpZGVJbmZvSGVpZ2h0ID0gdGhpcy5tYXhTbGlkZUluZm9IZWlnaHQoKSwNCiAgICAgICAgICAgICAgICB3cmFwcGVyID0gdGhpcy5zbGlkZXIuY29udGV4dC4kd3JhcHBlcjsNCiAgICAgICAgICAgIHdyYXBwZXIuZmluZCgnLnNsaWRlLWluZm8nKS5jc3Moew0KICAgICAgICAgICAgICAgICdtaW4taGVpZ2h0Jzogc2xpZGVJbmZvSGVpZ2h0DQogICAgICAgICAgICB9KTsNCiAgICAgICAgDQogICAgfTsNCg0KICAgIHB1Yi5pbml0SW5zdGFuY2UgPSBmdW5jdGlvbihjb21wb25lbnQpew0KICAgICAgICAgICAgICB2YXIgcHJvcGVydGllcyA9IGNvbXBvbmVudC5kYXRhKCJwcm9wZXJ0aWVzIiksDQogICAgICAgICAgICAgICAgY29tcG9uZW50ID0gY29tcG9uZW50LmZpbmQoIi5jYXJvdXNlbC1pbm5lciIpLA0KICAgICAgICAgICAgICAgIGlkID0gY29tcG9uZW50LmF0dHIoImRhdGEtaWQiKSwNCiAgICAgICAgICAgICAgICBzZWxmID0gY29tcG9uZW50LmVxKDApLA0KICAgICAgICAgICAgICAgIHF1ZXJ5U2xpZGVJbmRleCA9IHBhcnNlSW50KFhBLnF1ZXJ5U3RyaW5nLmdldFF1ZXJ5UGFyYW0oY29tcG9uZW50LmNsb3Nlc3QoJy5jb21wb25lbnQuY2Fyb3VzZWwnKS5hdHRyKCJpZCIpIHx8ICJjYXJvdXNlbCIpKSwNCiAgICAgICAgICAgICAgICB2YWxpZFF1ZXJ5UGFyYW0gPSB0eXBlb2YgcXVlcnlTbGlkZUluZGV4ICE9PSAidW5kZWZpbmVkIiAmJiAhaXNOYU4ocXVlcnlTbGlkZUluZGV4KSAmJiBxdWVyeVNsaWRlSW5kZXggPCBjb21wb25lbnQuZmluZCgiLnN4YS1udW1iZXJzIikubGVuZ3RoLA0KICAgICAgICAgICAgICAgIGNvbnRleHQsIHNldHRpbmdzLCAkY3VycmVudFNsaWRlLCAkc2xpZGVzOw0KDQogICAgICAgICAgICBpZiAocHJvcGVydGllcykgew0KICAgICAgICAgICAgICAgIGlmICghcHJvcGVydGllcy5uYXZpZ2F0aW9uKSB7DQogICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXMubmF2aWdhdGlvbiA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW06IHt9LA0KICAgICAgICAgICAgICAgICAgICAgICAgcHJldkl0ZW06IHt9LA0KICAgICAgICAgICAgICAgICAgICAgICAgbmV4dEl0ZW06IHt9LA0KICAgICAgICAgICAgICAgICAgICAgICAgaXNFbmFibGVkOiB2YWxpZFF1ZXJ5UGFyYW0gPyBmYWxzZTogdHJ1ZQ0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLm5hdmlnYXRpb24uaXRlbS5zZWxlY3RvciA9ICJbZGF0YS1pZD0nIiArIGlkICsgIiddIC5uYXYtaXRlbXMiOyAvL3Byb3BlcnRpZXMubmF2aWdhdGlvbi5pdGVtLnNlbGVjdG9yOw0KICAgICAgICAgICAgICAgIHByb3BlcnRpZXMubmF2aWdhdGlvbi5wcmV2SXRlbS5zZWxlY3RvciA9ICIjIiArIGlkICsgIiAubmF2IjsNCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLm5hdmlnYXRpb24ubmV4dEl0ZW0uc2VsZWN0b3IgPSAiIyIgKyBpZCArICIgLm5hdiI7DQoNCiAgICAgICAgICAgICAgICB2YXIgY2Fyb3VzZWwgPSBuZXcgQ2Fyb3VzZWwoJCk7DQogICAgICAgICAgICAgICAgY2Fyb3VzZWwuaW5pdChjb21wb25lbnQsIHByb3BlcnRpZXMpOw0KDQogICAgICAgICAgICAgICAgJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgIGNhcm91c2VsLnJlc2l6ZVdyYXBwZXIoKTsNCiAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgIGlmICh2YWxpZFF1ZXJ5UGFyYW0pIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dCA9IGNhcm91c2VsLnNsaWRlci5jb250ZXh0LA0KICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzLA0KICAgICAgICAgICAgICAgICAgICAkY3VycmVudFNsaWRlID0gY29udGV4dC5nZXRDdXJyZW50U2xpZGUoKSwNCiAgICAgICAgICAgICAgICAgICAgJHNsaWRlcyA9IGNvbnRleHQuJHNsaWRlczsNCg0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmNhbkNoYW5nZVNsaWRlID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLiRjdXJyZW50U2xpZGUgPSAkY3VycmVudFNsaWRlOw0KICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlID0gJCgkc2xpZGVzW3F1ZXJ5U2xpZGVJbmRleF0pOw0KDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuY2hhbmdlQ3VycmVudFNsaWRlKHNldHRpbmdzLiRuZXh0U2xpZGUpOw0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnRyYW5zaXRpb24ucGVyZm9ybShjb250ZXh0LnRyYW5zaXRpb25TZXR0aW5ncyk7DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQub3duZXIuZXhlY3V0ZU9uVGltZXJzKCdyZXNldCcsIGNvbnRleHQpOw0KDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQubmF2aWdhdGlvbi5wcmVwYXJlSXRlbXMocHJvcGVydGllcy5uYXZpZ2F0aW9uLml0ZW0sICRzbGlkZXMubGVuZ3RoLCAkKGNvbnRleHQuJHdyYXBwZXIpKTsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5uYXZpZ2F0aW9uLnNlbGVjdEl0ZW0ocXVlcnlTbGlkZUluZGV4KTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjYXJvdXNlbC5zd2lwZVNsaWRlKCk7ICAgDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgIH0NCg0KDQogICAgcHViLmluaXQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICQoIi5jYXJvdXNlbDpub3QoLmluaXRpYWxpemVkKSIpLmVhY2goZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcHViLmluaXRJbnN0YW5jZSgkKHRoaXMpKQ0KDQogICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCJpbml0aWFsaXplZCIpOw0KICAgICAgICB9KTsNCiAgICB9Ow0KDQogICAgcmV0dXJuIHB1YjsNCn0oalF1ZXJ5KSk7DQovKioNCiAqIGVuZCBvZiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzIG1vZHVsZS4NCiAqLw0KDQoNClhBLnJlZ2lzdGVyKCJjYXJvdXNlbHMiLCBYQS5jb21wb25lbnQuY2Fyb3VzZWxzKTsNCg0KDQoNClhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMgPSAoZnVuY3Rpb24oKSB7DQogICAgdmFyIHB1YiA9IHt9Ow0KDQogICAgLyoqDQogICAgICogVHJhbnNpdGlvblNldHRpbmdzIGNsYXNzIGNvbnRhaW5zIGRhdGEgbmVlZGVkIGZvciBjaGFuZ2luZyBzbGlkZXMNCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBUcmFuc2l0aW9uU2V0dGluZ3MoKSB7fQ0KICAgIC8qKg0KICAgICAqIEN1cnJlbnQgc2xpZGUgKGN1cnJlbnRseSBkaXNwbGF5ZWQpIGpRdWVyeSBvYmplY3QNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvblNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvblNldHRpbmdzLnByb3RvdHlwZS4kY3VycmVudFNsaWRlID0gbnVsbDsNCiAgICAvKioNCiAgICAgKiBOZXh0IHNsaWRlIGpRdWVyeSBvYmplY3QNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvblNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvblNldHRpbmdzLnByb3RvdHlwZS4kbmV4dFNsaWRlID0gbnVsbDsNCiAgICAvKioNCiAgICAgKiBBbGwgc2xpZGVzIChqUXVlcnkgb2JqZWN0KQ0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uU2V0dGluZ3MNCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uU2V0dGluZ3MucHJvdG90eXBlLiRzbGlkZXMgPSBudWxsOw0KICAgIC8qKg0KICAgICAqIE9mZnNldCBiZXR3ZWVuICRjdXJyZW50U2xpZGUgYW5kICRuZXh0U2xpZGUNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvblNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvblNldHRpbmdzLnByb3RvdHlwZS5vZmZzZXQgPSAwOw0KICAgIC8qKg0KICAgICAqIENhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgbXVzdCBiZSBjYWxsZWQgYWZ0ZXIgYW5pbWF0aW9uLg0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uU2V0dGluZ3MNCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uU2V0dGluZ3MucHJvdG90eXBlLmNhbGxiYWNrID0gbnVsbDsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgVHJhbnNpdGlvblNldHRpbmdzIGNsYXNzDQogICAgICovDQogICAgcHViLlRyYW5zaXRpb25TZXR0aW5ncyA9IFRyYW5zaXRpb25TZXR0aW5nczsNCg0KICAgIC8qKg0KICAgICAqIFRyYW5zaXRpb24gY2xhc3MgaXMgYSBiYXNlIGNsYXNzIG9mIGFsbCB0cmFuc2l0aW9ucy4NCiAgICAgKg0KICAgICAqIEltcG9ydGFudDogc2V0dGluZ3MuY2FsbGJhY2soKSAoQHNlZSBUcmFuc2l0aW9uU2V0dGluZ3MpIGhhdmUgdG8gYmUgY2FsbGVkIGF0IHRoZSBlbmQgb2YgZXhlY3V0aW9uIHRoZSBwZXJmb3JtKCkgbWV0aG9kLg0KICAgICAqDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gVHJhbnNpdGlvbigpIHt9DQogICAgVHJhbnNpdGlvbi5wcm90b3R5cGUgPSBuZXcgVHJhbnNpdGlvbigpOw0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIGEgdHJhbnNpdGlvbiB3aXRoIGdpdmVuIHNldHRpbmdzIChAc2VlIFRyYW5zaXRpb25TZXR0aW5ncykuDQogICAgICogDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uDQogICAgICogQHBhcmFtIHtUcmFuc2l0aW9uU2V0dGluZ3N9IHNldHRpbmdzICB0cmFuc2l0aW9uIHNldHRpbmdzDQogICAgICovDQogICAgLyogZXNsaW50LWRpc2FibGUgKi8NCiAgICBUcmFuc2l0aW9uLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oc2V0dGluZ3MpIHsNCiAgICAgICAgLy9pbXBsZW1lbnRhdGlvbiB1c2luZyBzZXR0aW5ncw0KICAgIH07DQogICAgLyogZXNsaW50LWVuYWJsZSAqLw0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYSBmYWN0b3IgYXNzb2NpYXRlZCB3aXRoIHNldHRpbmdzLm9mZnNldCAoQHNlZSBUcmFuc2l0aW9uU2V0dGluZ3MpIHRoYXQNCiAgICAgKiBjYW4gYmUgdXNlZnVsbCBmb3Igc29tZSBhbmltYXRpb25zLg0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uDQogICAgICogQHBhcmFtIHtUcmFuc2l0aW9uU2V0dGluZ3N9IHNldHRpbmdzICB0cmFuc2l0aW9uIHNldHRpbmdzDQogICAgICogQHJldHVybiBUaGUgZmFjdG9yOyAxIGlmIG9mZnNldCBpcyBoaWdoZXIgdGhhbiAwLCAtMSBvdGhlcndpc2UNCiAgICAgKiBAdHlwZSBOdW1iZXINCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uLnByb3RvdHlwZS5mYWN0b3IgPSBmdW5jdGlvbihzZXR0aW5ncykgew0KICAgICAgICByZXR1cm4gKHNldHRpbmdzLm9mZnNldCA+IDApID8gMSA6IC0xOw0KICAgIH07DQogICAgLyoqDQogICAgICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIHVzZWQgYnkgY2Fyb3VzZWxzIHRvIGNoYW5nZSBzbGlkZXMuDQogICAgICoNCiAgICAgKiBJbXBvcnRhbnQ6IHNldHRpbmdzLmNhbGxiYWNrKCkgKEBzZWUgVHJhbnNpdGlvblNldHRpbmdzKSBoYXZlIHRvIGJlIGNhbGxlZCBhdCB0aGUgZW5kIG9mIHRoaXMgbWV0aG9kIGV4ZWN1dGlvbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvbg0KICAgICAqIEBwYXJhbSB7VHJhbnNpdGlvblNldHRpbmdzfSBzZXR0aW5ncyAgdHJhbnNpdGlvbiBzZXR0aW5ncw0KICAgICAqLw0KICAgIFRyYW5zaXRpb24ucHJvdG90eXBlLnBlcmZvcm0gPSBmdW5jdGlvbihzZXR0aW5ncykgew0KICAgICAgICBzZXR0aW5ncy5jYWxsYmFjaygpOw0KICAgIH07DQogICAgLyoqDQogICAgICogRW5kIG9mIFRyYW5zaXRpb24gY2xhc3MNCiAgICAgKi8NCiAgICBwdWIuVHJhbnNpdGlvbiA9IFRyYW5zaXRpb247DQoNCiAgICAvKioNCiAgICAgKiBCYXNpY1RyYW5zaXRpb24gY2xhc3MgY2hhbmdlcyBzbGlkZXMgd2l0aG91dCBhbnkgYW5pbWF0aW9uLg0KICAgICAqIERvIG5vdCByZW1vdmUgdGhpcyBjbGFzcywgYmVjYXVzZSBjYXJvdXNlbHMgdXNlIGl0IGJ5IGRlZmF1bHQsDQogICAgICogaWYgcmVxdWVzdGVkIHRyYW5zaXRpb24gY2Fubm90IGJlIGZvdW5kLg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIEJhc2ljVHJhbnNpdGlvbigpIHt9DQogICAgQmFzaWNUcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7DQogICAgQmFzaWNUcmFuc2l0aW9uLmNvbnN0cnVjdG9yID0gQmFzaWNUcmFuc2l0aW9uOw0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgQmFzaWNUcmFuc2l0aW9uDQogICAgICovDQogICAgQmFzaWNUcmFuc2l0aW9uLnByb3RvdHlwZS5wZXJmb3JtID0gZnVuY3Rpb24oc2V0dGluZ3MpIHsNCiAgICAgICAgc2V0dGluZ3MuJGN1cnJlbnRTbGlkZS5oaWRlKCk7DQogICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuc2hvdygpOw0KDQogICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBFbmQgb2YgQmFzaWNUcmFuc2l0aW9uIGNsYXNzDQogICAgICovDQogICAgcHViLkJhc2ljVHJhbnNpdGlvbiA9IEJhc2ljVHJhbnNpdGlvbjsNCg0KICAgIC8qKg0KICAgICAqIEZhZGVJblRyYW5zaXRpb24gY2xhc3MgY2hhbmdlcyBzbGlkZXMgYnkgZmFkaW5nIGluIG5ldyBzbGlkZS4NCiAgICAgKiBUaGlzIGNsYXNzIGNhbiBiZSByZW1vdmVkIGlmIGVmZmVjdCBpcyBub3QgdXNlZC4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBGYWRlSW5UcmFuc2l0aW9uKCkge30NCiAgICBGYWRlSW5UcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7DQogICAgRmFkZUluVHJhbnNpdGlvbi5jb25zdHJ1Y3RvciA9IEZhZGVJblRyYW5zaXRpb247DQogICAgLyoqDQogICAgICogQG1lbWJlciBGYWRlSW5UcmFuc2l0aW9uDQogICAgICovDQogICAgRmFkZUluVHJhbnNpdGlvbi5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAvKnNldHRpbmdzLiRzbGlkZXMuY3NzKHsNCiAgICAgICAgICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsDQogICAgICAgICAndG9wJzogJzBweCcsDQogICAgICAgICAnbGVmdCc6ICcwcHgnDQogICAgICAgICB9KTsqLw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBGYWRlSW5UcmFuc2l0aW9uDQogICAgICovDQogICAgRmFkZUluVHJhbnNpdGlvbi5wcm90b3R5cGUucGVyZm9ybSA9IGZ1bmN0aW9uKHNldHRpbmdzKSB7DQogICAgICAgIHZhciB6SW5kZXhBdHRyaWIgPSAnei1pbmRleCcsDQogICAgICAgICAgICAkcGFyZW50ID0gc2V0dGluZ3MuJHNsaWRlcy5wYXJlbnQoKSwNCiAgICAgICAgICAgICRuZXh0U2xpZGUgPSBzZXR0aW5ncy4kbmV4dFNsaWRlOw0KDQogICAgICAgICRwYXJlbnQuY3NzKHpJbmRleEF0dHJpYiwgMCk7DQogICAgICAgICRuZXh0U2xpZGUuY3NzKHpJbmRleEF0dHJpYiwgMSk7DQogICAgICAgIHNldHRpbmdzLiRzbGlkZXMuY3NzKHsNCiAgICAgICAgICAgICdwb3NpdGlvbic6ICdyZWxhdGl2ZScNCiAgICAgICAgfSk7DQoNCiAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5jc3Moew0KICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJywNCiAgICAgICAgICAgICd0b3AnOiAnMCcsDQogICAgICAgICAgICAnYm90dG9tJzogJzAnLA0KICAgICAgICAgICAgJ2xlZnQnOiAnMCcsDQogICAgICAgICAgICAncmlnaHQnOiAnMCcNCiAgICAgICAgfSk7DQoNCg0KICAgICAgICAkbmV4dFNsaWRlLmZhZGVJbihmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHNldHRpbmdzLiRjdXJyZW50U2xpZGUuaGlkZSgpOw0KDQogICAgICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7DQogICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ3JlbGF0aXZlJywNCiAgICAgICAgICAgICAgICAnbGVmdCc6ICcwJywNCiAgICAgICAgICAgICAgICAndHJhbnNmb3JtJzogJ25vbmUnDQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgJG5leHRTbGlkZS5jc3MoekluZGV4QXR0cmliLCAnJyk7DQogICAgICAgICAgICAkcGFyZW50LmNzcyh6SW5kZXhBdHRyaWIsICcnKTsNCg0KICAgICAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soKTsNCiAgICAgICAgfSk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBFbmQgb2YgRmFkZUluVHJhbnNpdGlvbiBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5GYWRlSW5UcmFuc2l0aW9uID0gRmFkZUluVHJhbnNpdGlvbjsNCg0KICAgIC8qKg0KICAgICAqIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbiBjbGFzcyBjaGFuZ2VzIHNsaWRlcyBieSBzbGlkaW5nIHRoZW0gaG9yaXpvbnRhbGx5Lg0KICAgICAqIFRoaXMgY2xhc3MgY2FuIGJlIHJlbW92ZWQgaWYgZWZmZWN0IGlzIG5vdCB1c2VkLg0KICAgICAqIElmIG9mZnNldCAoZGlmZmVyZW5jZSBiZXR3ZWVuIGluZGV4IG9mIGN1cnJlbnRseSBkaXNwbGF5ZWQgc2xpZGUgYW5kIGluZGV4IG9mIHNsaWRlIHRoYXQgd2lsbCBiZSBzaG93bikNCiAgICAgKiBpcyBncmVhdGVyIHRoYW4gMCwgc2xpZGVzIGFyZSBzbGlkaW5nIHRvIHRoZSBsZWZ0LiBPdGhlcndpc2UgKG9mZnNldCBpcyBsb3dlciB0aGFuIDApLCBzbGlkZXMgYXJlIHNsaWRpbmcNCiAgICAgKiB0byB0aGUgcmlnaHQuDQogICAgICogV2hlbiBzbGlkZSBjaGFuZ2UgaXMgcmFpc2VkIGF1dG9tYXRpY2FsbHksIHNsaWRlcyBhcmUgYWx3YXlzIHNsaWRpbmcgdG8gcmlnaHQgKG9mZnNldCA9PSAxKS4NCiAgICAgKiBJZiB1c2VyIHJhaXNlcyBzbGlkZXMgY2hhbmdlLCBzbGlkZXMgYXJlIHNsaWRpbmc6DQogICAgICogLSB0byBsZWZ0LCBpZiBvZmZzZXQgaXMgZ3JlYXRlciB0aGFuIDAgKHNsaWRlIHdpdGggaGlnaGVyIGluZGV4IHdpbGwgYmUgc2hvd24gb3IgdXNlciBjbGlja3MgJ25leHQnIG5hdmlnYXRpb24gaXRlbSksDQogICAgICogLSB0byByaWdodCwgaWYgb2Zmc2V0IGlzIGxvd2VyIHRoYW4gMCAoc2xpZGUgd2l0aCBsb3dlciBpbmRleCB3aWxsIGJlIHNob3duIG9yIHVzZXIgY2xpY2tzICdwcmV2JyBuYXZpZ2F0aW9uIGl0ZW0pLg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbigpIHt9DQogICAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7DQogICAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLmNvbnN0cnVjdG9yID0gU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uOw0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uDQogICAgICovDQogICAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLnByb3RvdHlwZS5vbkFuaW1hdGlvbkNvbXBsZXRlID0gZnVuY3Rpb24oc2V0dGluZ3MsICRwYXJlbnQpIHsNCiAgICAgICAgc2V0dGluZ3MuJGN1cnJlbnRTbGlkZS5oaWRlKCk7DQogICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsNCiAgICAgICAgICAgICd0b3AnOiAnJywNCiAgICAgICAgICAgICdib3R0b20nOiAnJywNCiAgICAgICAgICAgICdsZWZ0JzogJycsDQogICAgICAgICAgICAncG9zaXRpb24nOiAnJywNCiAgICAgICAgICAgICd3aWR0aCc6ICcnDQogICAgICAgIH0pOw0KDQogICAgICAgICRwYXJlbnQuY3NzKHsNCiAgICAgICAgICAgICdsZWZ0JzogJycNCiAgICAgICAgfSk7DQoNCiAgICAgICAgJHBhcmVudC5jc3MoJ21hcmdpbi1sZWZ0JywgJycpOw0KDQogICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbg0KICAgICAqLw0KICAgIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbi5wcm90b3R5cGUucGVyZm9ybSA9IGZ1bmN0aW9uIChzZXR0aW5ncywgb2Zmc2V0KSB7DQogICAgICAgIHZhciBmYWN0b3IgPSB0aGlzLmZhY3RvcihzZXR0aW5ncyksDQogICAgICAgICAgICBvbkFuaW1hdGlvbkNvbXBsZXRlID0gdGhpcy5vbkFuaW1hdGlvbkNvbXBsZXRlLA0KICAgICAgICAgICAgd2lkdGggPSBzZXR0aW5ncy4kY3VycmVudFNsaWRlLndpZHRoKCksDQogICAgICAgICAgICAkcGFyZW50ID0gc2V0dGluZ3MuJHNsaWRlcy5wYXJlbnQoKTsNCg0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7DQogICAgICAgICAgICAndG9wJzogJzAnLA0KICAgICAgICAgICAgJ2JvdHRvbSc6ICcwJywNCiAgICAgICAgICAgICdsZWZ0JzogJzEwMCUnLA0KICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJywNCiAgICAgICAgICAgICd3aWR0aCc6ICcxMDAlJw0KICAgICAgICB9KTsNCiAgICAgICAgaWYgKG9mZnNldCA+IDApIHsNCiAgICAgICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsNCiAgICAgICAgICAgICAgICAnbGVmdCc6ICcxMDAlJywNCiAgICAgICAgICAgIH0pDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7DQogICAgICAgICAgICAgICAgJ2xlZnQnOiAnLTEwMCUnLA0KICAgICAgICAgICAgfSkNCiAgICAgICAgfQ0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLnNob3coKTsNCiAgICAgICAgJHBhcmVudC5hbmltYXRlKHsNCiAgICAgICAgICAgICdsZWZ0JzogLWZhY3RvciAqIHdpZHRoICsgJ3B4JywNCiAgICAgICAgfSwgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICBvbkFuaW1hdGlvbkNvbXBsZXRlKHNldHRpbmdzLCAkcGFyZW50KTsNCiAgICAgICAgfSk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBFbmQgb2YgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uIGNsYXNzDQogICAgICovDQogICAgcHViLlNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbiA9IFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbjsNCg0KICAgIC8qKg0KICAgICAqIFNsaWRlVmVydGljYWxseVRyYW5zaXRpb24gY2xhc3MgY2hhbmdlcyBzbGlkZXMgYnkgc2xpZGluZyB0aGVtIHZlcnRpY2FsbHkuDQogICAgICogVGhpcyBjbGFzcyBjYW4gYmUgcmVtb3ZlZCBpZiB0aGlzIGVmZmVjdCBpcyBub3QgdXNlZC4NCiAgICAgKiBJZiBvZmZzZXQgKGRpZmZlcmVuY2UgYmV0d2VlbiBpbmRleCBvZiBjdXJyZW50bHkgZGlzcGxheWVkIHNsaWRlIGFuZCBpbmRleCBvZiBuZXh0IHNsaWRlKQ0KICAgICAqIGlzIGdyZWF0ZXIgdGhhbiAwLCBzbGlkZXMgYXJlIHNsaWRpbmcgZnJvbSB1cCB0byBkb3duLiBPdGhlcndpc2UgKG9mZnNldCBpcyBsb3dlciB0aGFuIDApLCBzbGlkZXMgYXJlIHNsaWRpbmcNCiAgICAgKiBmcm9tIGRvd24gdG8gdXAuDQogICAgICogV2hlbiBzbGlkZSBjaGFuZ2UgaXMgcmFpc2VkIGF1dG9tYXRpY2FsbHksIHNsaWRlcyBhcmUgYWx3YXlzIHNsaWRpbmcgZnJvbSB1cCB0byBkb3duIChvZmZzZXQgPT0gMSkuDQogICAgICogSWYgdXNlciByYWlzZXMgc2xpZGVzIGNoYW5nZSwgc2xpZGVzIGFyZSBzbGlkaW5nOg0KICAgICAqIC0gZnJvbSB1cCB0byBkb3duLCBpZiBvZmZzZXQgaXMgZ3JlYXRlciB0aGFuIDAgKHNsaWRlIHdpdGggaGlnaGVyIGluZGV4IHdpbGwgYmUgc2hvd24gb3IgdXNlciBjbGlja3MgJ25leHQnIG5hdmlnYXRpb24gaXRlbSksDQogICAgICogLSBmcm9tIGRvd24gdG8gdXAsIGlmIG9mZnNldCBpcyBsb3dlciB0aGFuIDAgKHNsaWRlIHdpdGggbG93ZXIgaW5kZXggd2lsbCBiZSBzaG93biBvciB1c2VyIGNsaWNrcyAncHJldicgbmF2aWdhdGlvbiBpdGVtKS4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uKCkge30NCiAgICBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7DQogICAgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbi5jb25zdHJ1Y3RvciA9IFNsaWRlVmVydGljYWxseVRyYW5zaXRpb247DQogICAgLyoqDQogICAgICogQG1lbWJlciBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uDQogICAgICovDQogICAgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbi5wcm90b3R5cGUub25BbmltYXRpb25Db21wbGV0ZSA9IGZ1bmN0aW9uKHNldHRpbmdzLCAkcGFyZW50KSB7DQogICAgICAgIHNldHRpbmdzLiRjdXJyZW50U2xpZGUuaGlkZSgpOw0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7DQogICAgICAgICAgICAndG9wJzogJycsDQogICAgICAgICAgICAnYm90dG9tJzogJycsDQogICAgICAgICAgICAnbGVmdCc6ICcnLA0KICAgICAgICAgICAgJ3JpZ2h0JzogJycsDQogICAgICAgICAgICAncG9zaXRpb24nOiAnJywNCiAgICAgICAgICAgICd3aWR0aCc6ICcnDQogICAgICAgIH0pOw0KDQoJCSRwYXJlbnQuY3NzKCd0b3AnLCAnJyk7DQogICAgICAgICRwYXJlbnQuY3NzKCdtYXJnaW4tdG9wJywgJycpOw0KDQogICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFNsaWRlVmVydGljYWxseVRyYW5zaXRpb24NCiAgICAgKi8NCiAgICBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uLnByb3RvdHlwZS5wZXJmb3JtID0gZnVuY3Rpb24gKHNldHRpbmdzLCBvZmZzZXQpIHsNCiAgICAgICAgdmFyIGZhY3RvciA9IHRoaXMuZmFjdG9yKHNldHRpbmdzKSwNCiAgICAgICAgICAgIG9uQW5pbWF0aW9uQ29tcGxldGUgPSB0aGlzLm9uQW5pbWF0aW9uQ29tcGxldGUsDQogICAgICAgICAgICBoZWlnaHQgPSBzZXR0aW5ncy4kY3VycmVudFNsaWRlLmhlaWdodCgpLA0KICAgICAgICAgICAgJHBhcmVudCA9IHNldHRpbmdzLiRzbGlkZXMucGFyZW50KCk7DQoNCiAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5jc3Moew0KICAgICAgICAgICAgJ2xlZnQnOiAnMCcsDQogICAgICAgICAgICAncmlnaHQnOiAnMCcsDQogICAgICAgICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLA0KICAgICAgICAgICAgJ3dpZHRoJzogJzEwMCUnDQogICAgICAgIH0pOw0KICAgICAgICBpZiAob2Zmc2V0ID4gMCkgew0KICAgICAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5jc3Moew0KICAgICAgICAgICAgICAgICd0b3AnOiAnLTEwMCUnLA0KICAgICAgICAgICAgICAgICdib3R0b20nOiAnMTAwJScsDQogICAgICAgICAgICB9KQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5jc3Moew0KICAgICAgICAgICAgICAgICd0b3AnOiAnMTAwJScsDQogICAgICAgICAgICAgICAgJ2JvdHRvbSc6ICctMTAwJScsDQogICAgICAgICAgICB9KQ0KICAgICAgICB9DQogICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuc2hvdygpOw0KDQogICAgICAgICRwYXJlbnQuYW5pbWF0ZSh7DQogICAgICAgICAgICAndG9wJzogZmFjdG9yICogaGVpZ2h0DQogICAgICAgIH0sIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgb25BbmltYXRpb25Db21wbGV0ZShzZXR0aW5ncywgJHBhcmVudCk7DQogICAgICAgIH0pOw0KDQogICAgfTsNCiAgICAvKioNCiAgICAgKiBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uIGNsYXNzDQogICAgICovDQogICAgcHViLlNsaWRlVmVydGljYWxseVRyYW5zaXRpb24gPSBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uOw0KDQogICAgcmV0dXJuIHB1YjsNCn0oalF1ZXJ5KSk7DQovKioNCiAqIGVuZCBvZiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zIG1vZHVsZS4NCiAqLw0KDQovKioNCiAqIFhBQ29udGV4dA0KICoNCiAqIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MgbW9kdWxlLg0KICoNCiAqIEV4cG9zZXMgVmlldyBjbGFzcywgd2hpY2ggaXMgYSBiYXNlIGNsYXNzIG9mIGFsbCAndGltZSBpbmRpY2F0b3InIHZpZXdzIHVzZWQgYnkgY2Fyb3VzZWxzIChAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMsIEBzZWUgVmlldykuDQogKiBBbHNvIGV4cG9zZXMgaW1wbGVtZW50YXRpb24gb2YgdGhlc2UgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3czoNCiAqIC0gUHJvZ3Jlc3NCYXJWaWV3IC0gc2hvd3MgdGhlIHByb2dyZXNzIG9mIHRpbWUgd2l0aCBhIHByb2dyZXNzIGJhciwNCiAqIC0gUm90YXRvclZpZXcgLSBzaG93cyB0aGUgcHJvZ3Jlc3Mgb2YgdGltZSB3aXRoIHRoZSBmaWxsaW5nIHVwIHJpbmcuDQogKiBDYXJvdXNlbCB0YWtlcyB0aGUgY2xhc3MgY29uc3RydWN0b3IgYnkgbmFtZSBmcm9tIHRoaXMgbW9kdWxlIChpdCBpcyBnaXZlbiBpbiBvcHRpb25zIG9iamVjdCBvZiBjYXJvdXNlbDsgQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzKS4NCiAqIElmIHRoZXJlIGlzIGEgbmVlZCB0byBpbXBsZW1lbnQgdGhlIG5ldyAndGltZSBpbmRpY2F0b3InIHZpZXcsIGNyZWF0ZSBhIG5ldyBjbGFzcw0KICogYnkgaW5oZXJpdGluZyBmcm9tIFZpZXcgY2xhc3MgYW5kIGFkZCBpdCB0byB0aGlzIG1vZHVsZS4gRHVyaW5nIGltcGxlbWVudGF0aW9uIG9mIGEgbmV3ICd0aW1lIGluZGljYXRvcicNCiAqIHZpZXcgdGhlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yc1ZpZXcuVG9vbHMgbmFtZXNwYWNlLiBJdCBjb250YWluczoNCiAqIC0gaXNDc3NTdXBwb3J0ZWQocHJvcHMpIGZ1bmN0aW9uLCB3aGljaCBjaGVja3MgaWYgYW55IG9mIENTUyBwcm9wZXJ0aWVzIGlzIHN1cHBvcnRlZCAocHJvcHMgLSBhcnJheSBvZiBwcm9wZXJ0aWVzKSwNCiAqIC0gaXNUcmFuc2Zvcm1TdXBwb3J0ZWQoKSBmdW5jdGlvbiwgd2hpY2ggY2hlY2tzIGlmIENTUyAzICd0cmFuc2Zvcm0nIGlzIHN1cHBvcnRlZC4NCiAqDQogKiBFeGFtcGxlIHZpZXcgaW1wbGVtZW50YXRpb24gKG9wYWNpdHkgaW5jcmVhc2VzIHdpdGggYSBwcm9ncmVzcyBvZiB0aGUgdGltZSk6DQogKiAoZnVuY3Rpb24oKSB7DQogKiAgICAgdmFyIFZpZXcgPSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzLlZpZXc7DQogKg0KICogICAgIGZ1bmN0aW9uIFNhbXBsZVZpZXcgKHNlbGVjdG9yLCBvcHRpb25zKSB7DQogKiAgICAgICAgIC8vYmFzZSBjb25zdHJ1Y3RvciBoYXZlIHRvIGJlIGNhbGxlZA0KICogICAgICAgICBWaWV3LmNhbGwodGhpcywgc2VsZWN0b3IpOw0KICogICAgIH0NCiAqDQogKiAgICAgU2FtcGxlVmlldy5wcm90b3R5cGUgPSBuZXcgVmlldygpOw0KICogICAgIFNhbXBsZVZpZXcuY29uc3RydWN0b3IgPSBTYW1wbGVWaWV3Ow0KICoNCiAqICAgICBTYW1wbGVWaWV3LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKHRpbWVvdXQpIHsNCiAqICAgICAgICAgLy9iYXNlIG1ldGhvZCBoYXZlIHRvIGJlIGNhbGxlZA0KICogICAgICAgICBWaWV3LnByb3RvdHlwZS5pbml0LmNhbGwodGhpcywgdGltZW91dCk7DQogKg0KICogICAgICAgICAvL2luaXRpYWxpemF0aW9uIGNvZGUgLSBub3QgbmVlZGVkIGluIHRoaXMgZXhhbXBsZQ0KICogICAgIH07DQogKg0KICogICAgIFNhbXBsZVZpZXcucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgew0KICogICAgICAgICAvL2Jhc2UgbWV0aG9kIGhhdmUgdG8gYmUgY2FsbGVkDQogKiAgICAgICAgIFZpZXcucHJvdG90eXBlLnJlc2V0LmNhbGwodGhpcyk7DQogKg0KICogICAgICAgICAvL3Jlc2V0aW5nICd0aW1lIGluZGljYXRvcicgdmlldw0KICogICAgICAgICB0aGlzLiRpbmRpY2F0b3Iuc3RvcCh0cnVlKTsNCiAqICAgICAgICAgdGhpcy4kaW5kaWNhdG9yLmNzcygnb3BhY2l0eScsIDApOw0KICogICAgIH07DQogKg0KICogICAgIFNhbXBsZVZpZXcucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24gKCkgew0KICogICAgICAgICAvL3N0b3BpbmcgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3IGFuaW1hdGlvbg0KICogICAgICAgICB0aGlzLiRpbmRpY2F0b3Iuc3RvcCh0cnVlKTsNCiAqICAgICB9Ow0KICoNCiAqICAgICBTYW1wbGVWaWV3LnByb3RvdHlwZS5wbGF5ID0gZnVuY3Rpb24gKCkgew0KICogICAgICAgICAvL3N0YXJ0aW5nL3Jlc3VtaW5nICd0aW1lIGluZGljYXRvcicgdmlldyBhbmltYXRpb24NCiAqICAgICAgICAgdGhpcy4kaW5kaWNhdG9yLmFuaW1hdGUoew0KICogICAgICAgICAgICAgJ29wYWNpdHknOiAxDQogKiAgICAgICAgIH0sIHRoaXMudGltZW91dCAtIHRoaXMudGltZUVsYXBzZWQsICdsaW5lYXInKTsNCiAqICAgICB9Ow0KICoNCiAqICAgICBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzLlNhbXBsZVZpZXcgPSBTYW1wbGVWaWV3Ow0KICogfSgpKTsNCiAqDQogKi8NClhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MgPSAoZnVuY3Rpb24oJCkgew0KICAgIHZhciBwdWIgPSB7fSwNCiAgICAgICAgc3VwcG9ydEVsZW1lbnRTdHlsZSA9IG51bGw7DQoNCiAgICAvKioNCiAgICAgKiBDaGVja3MgaWYgdGhlIENTUyBwcm9wZXJ0aWVzIGFyZSBzdXBwb3J0ZWQuDQogICAgICoNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBwcm9wcyAgICAgYXJyYXkgb2YgcHJvcGVydGllcyB0byBiZSBjaGVja2VkDQogICAgICogQHJldHVybiB0cnVlIGlmIGFueSBvZiBDU1MgcHJvcGVydGllcyBpcyBzdXBwb3J0ZWQsIGZhbHNlIG90aGVyd2lzZQ0KICAgICAqIEB0eXBlIEJvb2xlYW4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc0Nzc1N1cHBvcnRlZChwcm9wcykgew0KICAgICAgICB2YXIgaSwNCiAgICAgICAgICAgIGlzU3VwcG9ydGVkID0gZmFsc2U7DQoNCiAgICAgICAgaWYgKHN1cHBvcnRFbGVtZW50U3R5bGUgPT09IG51bGwpIHsNCiAgICAgICAgICAgIHN1cHBvcnRFbGVtZW50U3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdXBwb3J0RWxlbWVudCcpLnN0eWxlOw0KICAgICAgICB9DQoNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBpZiAoc3VwcG9ydEVsZW1lbnRTdHlsZVtwcm9wc1tpXV0gIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIGlzU3VwcG9ydGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBpc1N1cHBvcnRlZDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGVja3MgaWYgQ1NTIDMgJ3RyYW5zZm9ybScgaXMgc3VwcG9ydGVkLg0KICAgICAqDQogICAgICogQHJldHVybiB0cnVlIGlmIENTUyAzICd0cmFuc2Zvcm0nIGlzIHN1cHBvcnRlZCwgZmFsc2Ugb3RoZXJ3aXNlDQogICAgICogQHR5cGUgQm9vbGVhbg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGlzVHJhbnNmb3JtU3VwcG9ydGVkKCkgew0KICAgICAgICByZXR1cm4gaXNDc3NTdXBwb3J0ZWQoWyd0cmFuc2Zvcm1Qcm9wZXJ0eScsICdXZWJraXRUcmFuc2Zvcm0nLCAnTW96VHJhbnNmb3JtJywgJ09UcmFuc2Zvcm0nLCAnbXNUcmFuc2Zvcm0nXSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5Ub29scyBuYW1lc3BhY2UNCiAgICAgKg0KICAgICBUaGlzIG5hbWVzcGFjZSBjYW4gYmUgcmVtb3ZlZCBpZiBSb3RhdG9yVmlldyBjbGFzcyBpcyBub3QgdXNlZCAoQHNlZSBSb3RhdG9yVmlldykNCiAgICAgKi8NCiAgICBwdWIuVG9vbHMgPSB7fTsNCiAgICBwdWIuVG9vbHMuaXNDc3NTdXBwb3J0ZWQgPSBpc0Nzc1N1cHBvcnRlZDsNCiAgICBwdWIuVG9vbHMuaXNUcmFuc2Zvcm1TdXBwb3J0ZWQgPSBpc1RyYW5zZm9ybVN1cHBvcnRlZDsNCiAgICAvKioNCiAgICAgKiBFbmQgb2YgbmFtZXNwYWNlDQogICAgICovDQoNCiAgICAvKioNCiAgICAgKiBWaWV3IGNsYXNzIGlzIGEgYmFzZSBjbGFzcyBvZiBhbGwgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3cw0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzZWxlY3RvciBhIHNlbGVjdG9yIHVzZWQgZm9yIHNlYXJjaGluZw0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zICAgVmlldyBvcHRpb25zIG9iamVjdA0KICAgICAqLw0KICAgIC8qIGVzbGludC1kaXNhYmxlICovDQogICAgZnVuY3Rpb24gVmlldyhzZWxlY3Rvciwgb3B0aW9ucykgew0KICAgICAgICAvKioNCiAgICAgICAgICogQSBqUXVlcnkgb2JqZWN0IGNvbnRhaW5pbmcgZWxlbWVudCB0aGF0IHdpbGwgYmUgYW5pbWF0ZWQgdG8gc2hvdyB0aW1lIHByb2dyZXNzLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFZpZXcNCiAgICAgICAgICovDQoNCiAgICAgICAgdGhpcy4kaW5kaWNhdG9yID0gJChzZWxlY3Rvcik7DQogICAgfQ0KICAgIC8qIGVzbGludC1lbmFibGUgKi8NCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyB0aGUgdmlldy4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVmlld2lvbg0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSB0aW1lb3V0ICAgYSB0aW1lb3V0IHRvIHRoZSBlbmQgb2Ygd2hvbGUgaW5kaWNhdG9yIGFuaW1hdGlvbg0KICAgICAqLw0KICAgIFZpZXcucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbih0aW1lb3V0KSB7DQogICAgICAgIHRoaXMudGltZUVsYXBzZWQgPSAwOw0KICAgICAgICB0aGlzLnRpbWVvdXQgPSB0aW1lb3V0Ow0KICAgIH07DQogICAgLyoqDQogICAgICogUmVzZXRzIHRoZSB2aWV3DQogICAgICoNCiAgICAgKiBAbWVtYmVyIFZpZXcNCiAgICAgKi8NCiAgICBWaWV3LnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB0aGlzLnRpbWVFbGFwc2VkID0gMDsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIFN0YXJ0cy9SZW5ld3MgdGhlIHZpZXcgYW5pbWF0aW9uLg0KICAgICAqDQogICAgICogQG1lbWJlciBWaWV3DQogICAgICovDQogICAgVmlldy5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKCkge307DQogICAgLyoqDQogICAgICogUGF1c2VzIHRoZSB2aWV3IGFuaW1hdGlvbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVmlldw0KICAgICAqLw0KICAgIFZpZXcucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24oKSB7fTsNCiAgICAvKioNCiAgICAgKiBVcGRhdGVzIHRoZSB0aW1lIHRoYXQgZWxhcHNlZCBzaW5jZSBhbmltYXRpb24gYmVnYW4uDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFZpZXcNCiAgICAgKi8NCiAgICBWaWV3LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbih0aW1lRWxhcHNlZCkgew0KICAgICAgICB0aGlzLnRpbWVFbGFwc2VkID0gdGltZUVsYXBzZWQ7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgVmlldyBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5WaWV3ID0gVmlldzsNCg0KICAgIC8qKg0KICAgICAqIFByb2dyZXNzQmFyVmlldyBjbGFzcyBwcm92aWRlcyBhIGxvZ2ljIGZvciBhbmltYXRlIGEgJ3RpbWUgaW5kaWNhdG9yJywNCiAgICAgKiB0aGF0IGxvb2tzIGxpa2UgcHJvZ3Jlc3MgYmFyLg0KICAgICAqDQogICAgICogT3B0aW9ucyBvYmplY3Q6DQogICAgICogew0KICAgICAqICAgICAnb3BhY2l0eSc6IE51bWJlciB2YWx1ZSAvL2JldHdlZW4gMCBhbmQgMTsgZGVmYXVsdCBpcyAwLjgNCiAgICAgKiB9DQogICAgICoNCiAgICAgKiBUaGlzIGNsYXNzIGNhbiBiZSByZW1vdmVkIGlmIHRoaXMga2luZCBvZiB2aWV3IGlzIG5vdCB1c2VkLg0KICAgICAqDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICogQHBhcmFtIHtTdHJpbmd9IHNlbGVjdG9yIGEgc2VsZWN0b3IgdXNlZCBmb3Igc2VhcmNoaW5nDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgICBWaWV3IG9wdGlvbnMgb2JqZWN0DQogICAgICovDQogICAgZnVuY3Rpb24gUHJvZ3Jlc3NCYXJWaWV3KHNlbGVjdG9yLCBvcHRpb25zKSB7DQogICAgICAgIFZpZXcuY2FsbCh0aGlzLCBzZWxlY3Rvcik7DQoNCiAgICAgICAgdmFyIGRlZmF1bHRzID0gew0KICAgICAgICAgICAgJ29wYWNpdHknOiAwLjgNCiAgICAgICAgfTsNCg0KICAgICAgICB0aGlzLnNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBvcHRpb25zKTsNCg0KICAgICAgICB0aGlzLiRjb250YWluZXIgPSB0aGlzLiRpbmRpY2F0b3I7DQogICAgICAgIHRoaXMuJGluZGljYXRvciA9IHRoaXMuJGluZGljYXRvci5maW5kKCdkaXYnKTsNCiAgICB9DQogICAgUHJvZ3Jlc3NCYXJWaWV3LnByb3RvdHlwZSA9IG5ldyBWaWV3KCk7DQogICAgUHJvZ3Jlc3NCYXJWaWV3LmNvbnN0cnVjdG9yID0gUHJvZ3Jlc3NCYXJWaWV3Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUHJvZ3Jlc3NCYXJWaWV3DQogICAgICovDQogICAgUHJvZ3Jlc3NCYXJWaWV3LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24odGltZW91dCkgew0KICAgICAgICBWaWV3LnByb3RvdHlwZS5pbml0LmNhbGwodGhpcywgdGltZW91dCk7DQoNCiAgICAgICAgdmFyIG9wYWNpdHkgPSB0aGlzLnNldHRpbmdzLm9wYWNpdHk7DQogICAgICAgIHRoaXMuJGNvbnRhaW5lci5jc3MoJ29wYWNpdHknLCBvcGFjaXR5KTsNCiAgICAgICAgdGhpcy4kaW5kaWNhdG9yLmNzcygnb3BhY2l0eScsIG9wYWNpdHkpOw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBQcm9ncmVzc0JhclZpZXcNCiAgICAgKi8NCiAgICBQcm9ncmVzc0JhclZpZXcucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIFZpZXcucHJvdG90eXBlLnJlc2V0LmNhbGwodGhpcyk7DQoNCiAgICAgICAgdGhpcy4kaW5kaWNhdG9yLnN0b3AodHJ1ZSk7DQogICAgICAgIHRoaXMuJGluZGljYXRvci5jc3MoJ3dpZHRoJywgJzBweCcpOw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBQcm9ncmVzc0JhclZpZXcNCiAgICAgKi8NCiAgICBQcm9ncmVzc0JhclZpZXcucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHRoaXMuJGluZGljYXRvci5zdG9wKHRydWUpOw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBQcm9ncmVzc0JhclZpZXcNCiAgICAgKi8NCiAgICBQcm9ncmVzc0JhclZpZXcucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy4kaW5kaWNhdG9yLmFuaW1hdGUoew0KICAgICAgICAgICAgJ3dpZHRoJzogJzEwMCUnDQogICAgICAgIH0sIHRoaXMudGltZW91dCAtIHRoaXMudGltZUVsYXBzZWQsICdsaW5lYXInKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBQcm9ncmVzc0JhclZpZXcgY2xhc3MNCiAgICAgKi8NCiAgICBwdWIuUHJvZ3Jlc3NCYXJWaWV3ID0gUHJvZ3Jlc3NCYXJWaWV3Ow0KDQogICAgLyoqDQogICAgICogUm90YXRvclZpZXcgY2xhc3MgcHJvdmlkZXMgYSBsb2dpYyBmb3IgYW5pbWF0ZSBhICd0aW1lIGluZGljYXRvcicsDQogICAgICogdGhhdCBzaG93cyB0aGUgcHJvZ3Jlc3Mgb2YgdGltZSB3aXRoIHRoZSBmaWxsaW5nIHVwIHJpbmcNCiAgICAgKg0KICAgICAqIE9wdGlvbnMgb2JqZWN0Og0KICAgICAqIHsNCiAgICAgKiAgICAgJ29wYWNpdHknOiBOdW1iZXIgdmFsdWUgLy9iZXR3ZWVuIDAgYW5kIDE7IGRlZmF1bHQgaXMgMC41DQogICAgICogfQ0KICAgICAqDQogICAgICogVGhpcyBjbGFzcyBjYW4gYmUgcmVtb3ZlZCBpZiB0aGlzIGtpbmQgb2YgdmlldyBpcyBub3QgdXNlZC4NCiAgICAgKg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzZWxlY3RvciBhIHNlbGVjdG9yIHVzZWQgZm9yIHNlYXJjaGluZw0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zICAgVmlldyBvcHRpb25zIG9iamVjdA0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFJvdGF0b3JWaWV3KHNlbGVjdG9yLCBvcHRpb25zKSB7DQogICAgICAgIFZpZXcuY2FsbCh0aGlzLCBzZWxlY3Rvcik7DQoNCiAgICAgICAgdmFyIGRlZmF1bHRzID0gew0KICAgICAgICAgICAgJ29wYWNpdHknOiAwLjUNCiAgICAgICAgfTsNCg0KICAgICAgICB0aGlzLnNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBvcHRpb25zKTsNCiAgICAgICAgdGhpcy4kbWFzayA9IHRoaXMuJGluZGljYXRvci5maW5kKCdzcGFuLm1hc2snKS5maXJzdCgpOw0KICAgICAgICB0aGlzLiRyb3RhdG9yID0gdGhpcy4kaW5kaWNhdG9yLmZpbmQoJ3NwYW4ucm90YXRvcicpLmZpcnN0KCk7DQoNCiAgICAgICAgZnVuY3Rpb24gcm90YXRlQ3NzKGRlZykgew0KICAgICAgICAgICAgdmFyIHZhbHVlID0gJ3JvdGF0ZSgnICsgZGVnICsgJ2RlZyknOw0KDQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICctd2Via2l0LXRyYW5zZm9ybSc6IHZhbHVlLA0KICAgICAgICAgICAgICAgICctbW96LXRyYW5zZm9ybSc6IHZhbHVlLA0KICAgICAgICAgICAgICAgICctby10cmFuc2Zvcm0nOiB2YWx1ZSwNCiAgICAgICAgICAgICAgICAnLW1zLXRyYW5zZm9ybSc6IHZhbHVlLA0KICAgICAgICAgICAgICAgICd0cmFuc2Zvcm0nOiB2YWx1ZQ0KICAgICAgICAgICAgfTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIGFuaW1hdGVSb3RhdG9yKCRyb3RhdG9yLCBvcHRpb25zKSB7DQogICAgICAgICAgICB2YXIgZGVmYXVsdHMgPSB7DQogICAgICAgICAgICAgICAgICAgICdmb250U2l6ZSc6ICcxODBweCcsDQogICAgICAgICAgICAgICAgICAgICdhbmltYXRlT3B0aW9ucyc6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICdzdGVwJzogZnVuY3Rpb24obm93KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHJvdGF0b3IuY3NzKHJvdGF0ZUNzcyhub3cpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAnZWFzaW5nJzogJ2xpbmVhcicNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgc2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIG9wdGlvbnMpOw0KDQogICAgICAgICAgICAkcm90YXRvci5hbmltYXRlKHsNCiAgICAgICAgICAgICAgICAgICAgJ2ZvbnQtc2l6ZSc6IHNldHRpbmdzLmZvbnRTaXplDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBzZXR0aW5ncy5hbmltYXRlT3B0aW9ucyk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBwaGFzZVR3b0FuaW1hdGlvbigkbWFzaywgJHJvdGF0b3IsIGR1cmF0aW9uKSB7DQogICAgICAgICAgICAkcm90YXRvci5hZGRDbGFzcygnaGFsZicpOw0KICAgICAgICAgICAgJG1hc2suYWRkQ2xhc3MoJ2hhbGYnKTsNCg0KICAgICAgICAgICAgYW5pbWF0ZVJvdGF0b3IoJHJvdGF0b3IsIHsNCiAgICAgICAgICAgICAgICAnZm9udFNpemUnOiAnMzYwcHgnLA0KICAgICAgICAgICAgICAgICdhbmltYXRlT3B0aW9ucyc6IHsNCiAgICAgICAgICAgICAgICAgICAgJ2R1cmF0aW9uJzogZHVyYXRpb24NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIHBoYXNlT25lQW5pbWF0aW9uKCRtYXNrLCAkcm90YXRvciwgZHVyYXRpb24sIHBoYXNlVHdvRHVyYXRpb24pIHsNCiAgICAgICAgICAgIGFuaW1hdGVSb3RhdG9yKCRyb3RhdG9yLCB7DQogICAgICAgICAgICAgICAgJ2FuaW1hdGVPcHRpb25zJzogew0KICAgICAgICAgICAgICAgICAgICAnZHVyYXRpb24nOiBkdXJhdGlvbiwNCiAgICAgICAgICAgICAgICAgICAgJ2NvbXBsZXRlJzogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBwaGFzZVR3b0FuaW1hdGlvbigkbWFzaywgJHJvdGF0b3IsIHBoYXNlVHdvRHVyYXRpb24pOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICB0aGlzLnJlc2V0Q3NzID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB0aGlzLiRyb3RhdG9yLnJlbW92ZUNsYXNzKCdoYWxmJyk7DQogICAgICAgICAgICB0aGlzLiRyb3RhdG9yLmNzcyhyb3RhdGVDc3MoMCkpOw0KICAgICAgICAgICAgdGhpcy4kcm90YXRvci5jc3MoJ2ZvbnQtc2l6ZScsICcwcHgnKTsNCg0KICAgICAgICAgICAgdGhpcy4kbWFzay5yZW1vdmVDbGFzcygnaGFsZicpOw0KICAgICAgICB9Ow0KDQogICAgICAgIHRoaXMucGxheVBoYXNlT25lID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB2YXIgZHVyYXRpb24gPSB0aGlzLnRpbWVvdXQgLyAyIC0gdGhpcy50aW1lRWxhcHNlZDsNCiAgICAgICAgICAgIHBoYXNlT25lQW5pbWF0aW9uKHRoaXMuJG1hc2ssIHRoaXMuJHJvdGF0b3IsIGR1cmF0aW9uLCB0aGlzLnRpbWVvdXQgLyAyKTsNCiAgICAgICAgfTsNCg0KICAgICAgICB0aGlzLnBsYXlQaGFzZVR3byA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgdmFyIGR1cmF0aW9uID0gdGhpcy50aW1lb3V0IC0gdGhpcy50aW1lRWxhcHNlZDsNCiAgICAgICAgICAgIHBoYXNlVHdvQW5pbWF0aW9uKHRoaXMuJG1hc2ssIHRoaXMuJHJvdGF0b3IsIGR1cmF0aW9uKTsNCiAgICAgICAgfTsNCiAgICB9DQogICAgUm90YXRvclZpZXcucHJvdG90eXBlID0gbmV3IFZpZXcoKTsNCiAgICBSb3RhdG9yVmlldy5jb25zdHJ1Y3RvciA9IFJvdGF0b3JWaWV3Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUm90YXRvclZpZXcNCiAgICAgKi8NCiAgICBSb3RhdG9yVmlldy5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKHRpbWVvdXQpIHsNCiAgICAgICAgVmlldy5wcm90b3R5cGUuaW5pdC5jYWxsKHRoaXMsIHRpbWVvdXQpOw0KDQogICAgICAgIGlmIChpc1RyYW5zZm9ybVN1cHBvcnRlZCgpKSB7DQogICAgICAgICAgICB0aGlzLiRpbmRpY2F0b3Iuc2hvdygpOw0KICAgICAgICAgICAgdGhpcy4kbWFzay5jc3MoJ29wYWNpdHknLCB0aGlzLnNldHRpbmdzLm9wYWNpdHkpOw0KICAgICAgICB9DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFJvdGF0b3JWaWV3DQogICAgICovDQogICAgUm90YXRvclZpZXcucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIFZpZXcucHJvdG90eXBlLnJlc2V0LmNhbGwodGhpcyk7DQoNCiAgICAgICAgdGhpcy4kcm90YXRvci5zdG9wKHRydWUpOw0KICAgICAgICB0aGlzLnJlc2V0Q3NzKCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFJvdGF0b3JWaWV3DQogICAgICovDQogICAgUm90YXRvclZpZXcucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHRoaXMuJHJvdGF0b3Iuc3RvcCh0cnVlKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUm90YXRvclZpZXcNCiAgICAgKi8NCiAgICBSb3RhdG9yVmlldy5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgcGhhc2UgPSB0aGlzLnBsYXlQaGFzZU9uZTsNCiAgICAgICAgaWYgKHRoaXMudGltZUVsYXBzZWQgPj0gdGhpcy50aW1lb3V0IC8gMikgew0KICAgICAgICAgICAgcGhhc2UgPSB0aGlzLnBsYXlQaGFzZVR3bzsNCiAgICAgICAgfQ0KDQogICAgICAgIHBoYXNlLmNhbGwodGhpcyk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgUm90YXRvclZpZXcgY2xhc3MNCiAgICAgKi8NCiAgICBwdWIuUm90YXRvclZpZXcgPSBSb3RhdG9yVmlldzsNCg0KICAgIHJldHVybiBwdWI7DQp9KGpRdWVyeSkpOw0KLyoqDQogKiBlbmQgb2YgWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cyBtb2R1bGUuDQogKi8=
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 61211
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20180226T092340Z
