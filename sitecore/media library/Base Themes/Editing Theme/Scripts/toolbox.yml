---
ID: "f5b1e945-f6bf-4300-a381-432fc85e946d"
Parent: "b0652987-4e54-4675-9dd0-2d112ced361b"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: /sitecore/media library/Base Themes/Editing Theme/Scripts/toolbox
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/F5B1E945F6BF4300A381432FC85E946D.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  Value: dmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7DQogICAgZnVuY3Rpb24gYWRvcHQodmFsdWUpIHsgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUCA/IHZhbHVlIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZSh2YWx1ZSk7IH0pOyB9DQogICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7DQogICAgICAgIGZ1bmN0aW9uIGZ1bGZpbGxlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvci5uZXh0KHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH0NCiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbInRocm93Il0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfQ0KICAgICAgICBmdW5jdGlvbiBzdGVwKHJlc3VsdCkgeyByZXN1bHQuZG9uZSA/IHJlc29sdmUocmVzdWx0LnZhbHVlKSA6IGFkb3B0KHJlc3VsdC52YWx1ZSkudGhlbihmdWxmaWxsZWQsIHJlamVjdGVkKTsgfQ0KICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7DQogICAgfSk7DQp9Ow0KdmFyIF9fZ2VuZXJhdG9yID0gKHRoaXMgJiYgdGhpcy5fX2dlbmVyYXRvcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIGJvZHkpIHsNCiAgICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnOw0KICAgIHJldHVybiBnID0geyBuZXh0OiB2ZXJiKDApLCAidGhyb3ciOiB2ZXJiKDEpLCAicmV0dXJuIjogdmVyYigyKSB9LCB0eXBlb2YgU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIChnW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXM7IH0pLCBnOw0KICAgIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfQ0KICAgIGZ1bmN0aW9uIHN0ZXAob3ApIHsNCiAgICAgICAgaWYgKGYpIHRocm93IG5ldyBUeXBlRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy4iKTsNCiAgICAgICAgd2hpbGUgKF8pIHRyeSB7DQogICAgICAgICAgICBpZiAoZiA9IDEsIHkgJiYgKHQgPSBvcFswXSAmIDIgPyB5WyJyZXR1cm4iXSA6IG9wWzBdID8geVsidGhyb3ciXSB8fCAoKHQgPSB5WyJyZXR1cm4iXSkgJiYgdC5jYWxsKHkpLCAwKSA6IHkubmV4dCkgJiYgISh0ID0gdC5jYWxsKHksIG9wWzFdKSkuZG9uZSkgcmV0dXJuIHQ7DQogICAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07DQogICAgICAgICAgICBzd2l0Y2ggKG9wWzBdKSB7DQogICAgICAgICAgICAgICAgY2FzZSAwOiBjYXNlIDE6IHQgPSBvcDsgYnJlYWs7DQogICAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTsNCiAgICAgICAgICAgICAgICBjYXNlIDU6IF8ubGFiZWwrKzsgeSA9IG9wWzFdOyBvcCA9IFswXTsgY29udGludWU7DQogICAgICAgICAgICAgICAgY2FzZSA3OiBvcCA9IF8ub3BzLnBvcCgpOyBfLnRyeXMucG9wKCk7IGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgICAgIGlmICghKHQgPSBfLnRyeXMsIHQgPSB0Lmxlbmd0aCA+IDAgJiYgdFt0Lmxlbmd0aCAtIDFdKSAmJiAob3BbMF0gPT09IDYgfHwgb3BbMF0gPT09IDIpKSB7IF8gPSAwOyBjb250aW51ZTsgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDMgJiYgKCF0IHx8IChvcFsxXSA+IHRbMF0gJiYgb3BbMV0gPCB0WzNdKSkpIHsgXy5sYWJlbCA9IG9wWzFdOyBicmVhazsgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH0NCiAgICAgICAgICAgICAgICAgICAgaWYgKHQgJiYgXy5sYWJlbCA8IHRbMl0pIHsgXy5sYWJlbCA9IHRbMl07IF8ub3BzLnB1c2gob3ApOyBicmVhazsgfQ0KICAgICAgICAgICAgICAgICAgICBpZiAodFsyXSkgXy5vcHMucG9wKCk7DQogICAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBvcCA9IGJvZHkuY2FsbCh0aGlzQXJnLCBfKTsNCiAgICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfQ0KICAgICAgICBpZiAob3BbMF0gJiA1KSB0aHJvdyBvcFsxXTsgcmV0dXJuIHsgdmFsdWU6IG9wWzBdID8gb3BbMV0gOiB2b2lkIDAsIGRvbmU6IHRydWUgfTsNCiAgICB9DQp9Ow0KdmFyIFNYQVRvb2xib3g7DQooZnVuY3Rpb24gKFNYQVRvb2xib3gpIHsNCiAgICB2YXIgVG9vbGJveCA9IChmdW5jdGlvbiAoKSB7DQogICAgICAgIGZ1bmN0aW9uIFRvb2xib3goc3hhSnF1ZXJ5LCBjb29raWVzKSB7DQogICAgICAgICAgICB0aGlzLmNvb2tpZU5hbWUgPSAic3hhLXRvb2xib3gtanNvbiI7DQogICAgICAgICAgICB0aGlzLnRvb2xCb3hQbGFjZWhvbGRlciA9ICIjd3JhcHBlciI7DQogICAgICAgICAgICB0aGlzLnJpYmJvblBsYWNlaG9sZGVyID0gIiNzY1dlYkVkaXRSaWJib24iOw0KICAgICAgICAgICAgdGhpcy5kZWZhdWx0U2V0dGluZ3MgPSB7DQogICAgICAgICAgICAgICAgYWN0aXZlR3JvdXBMaXN0OiBbXSwNCiAgICAgICAgICAgICAgICBpc01vYmlsZTogZmFsc2UsDQogICAgICAgICAgICAgICAgb3BlbmVkOiBmYWxzZSwNCiAgICAgICAgICAgICAgICBwb3NpdGlvbjoge30sDQogICAgICAgICAgICB9Ow0KICAgICAgICAgICAgdGhpcy4kID0gc3hhSnF1ZXJ5Ow0KICAgICAgICAgICAgdGhpcy4kLnhhTW92ZXIucmVmcmVzaENvbmZpZ3VyYXRpb24oKTsNCiAgICAgICAgICAgIHRoaXMuY29va2llcyA9IGNvb2tpZXM7DQogICAgICAgIH0NCiAgICAgICAgVG9vbGJveC5wcm90b3R5cGUuc3RyaW5nVG9ET00gPSBmdW5jdGlvbiAobWFya3VwKSB7DQogICAgICAgICAgICB2YXIgcGFyc2VyID0gbmV3IERPTVBhcnNlcigpLCBlbCA9IHBhcnNlci5wYXJzZUZyb21TdHJpbmcobWFya3VwLCAidGV4dC9odG1sIik7DQogICAgICAgICAgICByZXR1cm4gZWwucXVlcnlTZWxlY3RvcigiYm9keT4qIik7DQogICAgICAgIH07DQogICAgICAgIFRvb2xib3gucHJvdG90eXBlLmxvYWRDb25maWd1cmF0aW9uID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuIF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHZhciByZXN1bHQsIHNjU2l0ZSwgZXJyb3JfMTsNCiAgICAgICAgICAgICAgICByZXR1cm4gX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7DQogICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMDoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY1NpdGUgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLnNsaWNlKDEpLnNwbGl0KCImIikuZmluZChmdW5jdGlvbiAoZWwpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVsLmluZGV4T2YoInNjX3NpdGU9IikgPiAtMTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY1NpdGUgPSBzY1NpdGUgPyBzY1NpdGUgOiAic2NfbW9kZT1lZGl0IjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfYS5sYWJlbCA9IDE7DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDE6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFsxLCAzLCAsIDRdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQsIHRoaXMuJC5hamF4KHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbGxvd2VkUmVuZGVyaW5nczogSlNPTi5zdHJpbmdpZnkodGhpcy5nZXRBbGxvd2VkUmVuZGVyaW5ncygpKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogImpzb24iLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogIlBPU1QiLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAiL34vc3hhLXRvb2xib3gvcmVuZGVyaW5ncy1mZWVkLz8iICsgc2NTaXRlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KV07DQogICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDI6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gX2Euc2VudCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiwgcmVzdWx0XTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgMzoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl8xID0gX2Euc2VudCgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3JfMSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszLCA0XTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgNDogcmV0dXJuIFsyXTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH07DQogICAgICAgIFRvb2xib3gucHJvdG90eXBlLmZpbHRlckFsbG93ZWRDb21wb25lbnRzID0gZnVuY3Rpb24gKHJlbmRlcmluZ3MpIHsNCiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7DQogICAgICAgICAgICByZXR1cm4gcmVuZGVyaW5ncy5maWx0ZXIoZnVuY3Rpb24gKGVsZW1lbnQpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuJC54YU1vdmVyLmFsbG93ZWRSZW5kZXJpbmdzLmluZGV4T2YoZWxlbWVudC5JRCkgPiAtMTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9Ow0KICAgICAgICBUb29sYm94LnByb3RvdHlwZS5hZGROb3RpZmljYXRpb25JZkVtcHR5ID0gZnVuY3Rpb24gKHJlbmRlcmluZ3MsIHRyYW5zbGF0aW9ucykgew0KICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKHJlbmRlcmluZ3MpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgIHJlbmRlcmluZ3NbdHJhbnNsYXRpb25zLk5vUmVuZGVyaW5nc10gPSBbXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiByZW5kZXJpbmdzOw0KICAgICAgICB9Ow0KICAgICAgICBUb29sYm94LnByb3RvdHlwZS50b2dnbGVEZXZpY2VNb2RlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIHRvb2xib3hTZXR0aW5nID0gdGhpcy5nZXRDb29raWVTZXR0aW5ncygpOw0KICAgICAgICAgICAgdG9vbGJveFNldHRpbmcuaXNNb2JpbGUgPSAhdG9vbGJveFNldHRpbmcuaXNNb2JpbGU7DQogICAgICAgICAgICB0aGlzLmNvb2tpZXMuY3JlYXRlQ29va2llKHRoaXMuY29va2llTmFtZSwgSlNPTi5zdHJpbmdpZnkodG9vbGJveFNldHRpbmcpKTsNCiAgICAgICAgICAgIHRoaXMuJCgiI3N4YS10b29sYm94IikudG9nZ2xlQ2xhc3MoInN4YS1tb2JpbGUtdG9vbGJveCIpOw0KICAgICAgICAgICAgdGhpcy4kKCJib2R5IikudHJpZ2dlcigic3hhLXRvb2xib3gtcmVmcmVzaCIpOw0KICAgICAgICB9Ow0KICAgICAgICBUb29sYm94LnByb3RvdHlwZS50b2dnbGVDb21wb25lbnRzR3JvdXAgPSBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgICAgIHZhciB0b29sYm94U2V0dGluZyA9IHRoaXMuZ2V0Q29va2llU2V0dGluZ3MoKSwgJHRhcmdldCA9IHRoaXMuJChldmVudC50YXJnZXQpLCBzZWN0aW9uTmFtZSA9ICR0YXJnZXQuZGF0YSgic2VjdGlvbi1uYW1lIik7DQogICAgICAgICAgICBpZiAoKGV2ZW50LnR5cGUgPT09ICJjbGljayIgJiYgdG9vbGJveFNldHRpbmcuaXNNb2JpbGUpIHx8DQogICAgICAgICAgICAgICAgKGV2ZW50LnR5cGUgIT09ICJjbGljayIgJiYgIXRvb2xib3hTZXR0aW5nLmlzTW9iaWxlKSB8fA0KICAgICAgICAgICAgICAgICFzZWN0aW9uTmFtZSkgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmICghdG9vbGJveFNldHRpbmcuYWN0aXZlR3JvdXBMaXN0KSB7DQogICAgICAgICAgICAgICAgdG9vbGJveFNldHRpbmcuYWN0aXZlR3JvdXBMaXN0ID0gW107DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodG9vbGJveFNldHRpbmcuYWN0aXZlR3JvdXBMaXN0ICYmIHRvb2xib3hTZXR0aW5nLmFjdGl2ZUdyb3VwTGlzdC5pbmRleE9mKHNlY3Rpb25OYW1lKSA9PT0gLTEpIHsNCiAgICAgICAgICAgICAgICB0b29sYm94U2V0dGluZy5hY3RpdmVHcm91cExpc3QucHVzaChzZWN0aW9uTmFtZSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICB0b29sYm94U2V0dGluZy5hY3RpdmVHcm91cExpc3QgPSB0b29sYm94U2V0dGluZy5hY3RpdmVHcm91cExpc3QuZmlsdGVyKGZ1bmN0aW9uIChhcnJFbGVtZW50KSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBhcnJFbGVtZW50ICE9PSBzZWN0aW9uTmFtZTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHRoaXMuY29va2llcy5jcmVhdGVDb29raWUodGhpcy5jb29raWVOYW1lLCBKU09OLnN0cmluZ2lmeSh0b29sYm94U2V0dGluZykpOw0KICAgICAgICAgICAgJHRhcmdldC50b2dnbGVDbGFzcygiZXhwYW5kZWQiKTsNCiAgICAgICAgfTsNCiAgICAgICAgVG9vbGJveC5wcm90b3R5cGUubWFrZURyYWdnYWJsZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBjYWNoZWREcmFnZ2FibGU7DQogICAgICAgICAgICB2YXIgdGhhdCA9IHRoaXMsIGRyYWdnZXIgPSB7DQogICAgICAgICAgICAgICAgYXBwZW5kVG86ICIjd3JhcHBlciIsDQogICAgICAgICAgICAgICAgY29udGFpbm1lbnQ6ICJodG1sIiwNCiAgICAgICAgICAgICAgICBjdXJzb3JBdDogeyB0b3A6IC0yMCwgbGVmdDogMjAgfSwNCiAgICAgICAgICAgICAgICBoZWxwZXI6ICJjbG9uZSIsDQogICAgICAgICAgICAgICAgb3BhY2l0eTogMC43LA0KICAgICAgICAgICAgICAgIHJlZnJlc2hQb3NpdGlvbnM6IHRydWUsDQogICAgICAgICAgICAgICAgc3RhcnQ6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhhdC4kKCIudWktZHJhZ2dhYmxlLWRyYWdnaW5nIikuYWRkQ2xhc3MoInRvb2xib3gtaXRlbSIpOw0KICAgICAgICAgICAgICAgICAgICB3aW5kb3cuJHhhLnhhTW92ZXIucHJlcGFyZURyb3BwYWJsZVBsYWNlaG9sZGVycyh0aGF0LiQodGhpcyksIHRoYXQuJCgiI3N4YS10b29sYm94IikpOw0KICAgICAgICAgICAgICAgICAgICBjYWNoZWREcmFnZ2FibGUgPSB0aGF0LiQoIi51aS1kcmFnZ2FibGUtZHJhZ2dpbmciKTsNCiAgICAgICAgICAgICAgICAgICAgY2FjaGVkRHJhZ2dhYmxlLnJlZnJlc2hDb3VudGVyID0gMDsNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHN0b3A6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuJHhhLnhhTW92ZXIuY2xlYXJEcm9wcGFibGVQbGFjZWhvbGRlcnMoKTsNCiAgICAgICAgICAgICAgICAgICAgfSwgNTApOw0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgc2Nyb2xsOiB0cnVlLA0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHRoaXMuJCgiI3N4YS10b29sYm94LXJvb3QgbGkgc3BhbiIpLmRyYWdnYWJsZShkcmFnZ2VyKTsNCiAgICAgICAgfTsNCiAgICAgICAgVG9vbGJveC5wcm90b3R5cGUuZml4VG9vbGJveEhlaWdodCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHRoaXMuJCgiI3N4YS10b29sYm94LXJvb3QiKS5jc3MoeyBoZWlnaHQ6IHRoaXMuZ2V0VmlzaWJsZUhlaWdodCgpICsgInB4IiB9KTsNCiAgICAgICAgfTsNCiAgICAgICAgVG9vbGJveC5wcm90b3R5cGUuYmluZEV2ZW50cyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBfdGhpcyA9IHRoaXM7DQogICAgICAgICAgICB2YXIgaW50ZXJ2YWxJZDsNCiAgICAgICAgICAgIHZhciB0aGF0ID0gdGhpcywgcmliYm9uID0gdGhpcy4kKHRoaXMucmliYm9uUGxhY2Vob2xkZXIpLCByaWJib25Db250ZW50cyA9IHJpYmJvbi5jb250ZW50cygpLCByaWJib25Td2l0Y2hlciA9IHJpYmJvbkNvbnRlbnRzLmZpbmQoIm5hdiA+IFtkYXRhLXNjLWlkPSdRdWlja1JpYmJvbiddIikgfHwNCiAgICAgICAgICAgICAgICByaWJib25Db250ZW50cy5maW5kKCIuc2MtcXVpY2tiYXItaXRlbS5zYy1xdWlja2Jhci1idXR0b24uc2NfUXVpY2tiYXJCdXR0b25fNTYiKTsNCiAgICAgICAgICAgIHRoaXMuJCh3aW5kb3cpLm9uKCJyZXNpemUiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdGhhdC4kKCIjc3hhLXRvb2xib3gtcm9vdCIpLnRyaWdnZXIoInN4YS10b29sYm94LXJlZnJlc2giKTsNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgdGhpcy4kKCJib2R5IikNCiAgICAgICAgICAgICAgICAub24oInN4YS10b29sYm94LXJlZnJlc2giLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgX3RoaXMucmVmcmVzaFRvb2xib3goKTsNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgLm9uKCJjbGljayIsICIuc3hhLXRvZ2dsZS1kZXZpY2UiLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgX3RoaXMudG9nZ2xlRGV2aWNlTW9kZSgpOw0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAub24oInRvdWNoc3RhcnQgcG9pbnRlcmRvd24gTVNQb2ludGVyRG93biIsICIuc3hhLXRvZ2dsZS1kZXZpY2UtdG91Y2giLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgX3RoaXMudG9nZ2xlRGV2aWNlTW9kZSgpOw0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAub24oImNsaWNrIHRvdWNoc3RhcnQgcG9pbnRlcmRvd24gTVNQb2ludGVyRG93biIsICIjc3hhLXRvb2xib3gtcm9vdCBzcGFuIiwgZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgX3RoaXMudG9nZ2xlQ29tcG9uZW50c0dyb3VwKGV2ZW50KTsNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgLm9uKCJjbGljayB0b3VjaHN0YXJ0IHBvaW50ZXJkb3duIE1TUG9pbnRlckRvd24iLCAiLnN4YS10b29sYm94LWV4cGFuZGVyIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIF90aGlzLnRvZ2dsZVZpc2liaWxpdHkoKTsNCiAgICAgICAgICAgIH0pDQogICAgICAgICAgICAgICAgLm9uKCJrZXl1cCIsICIuc3hhLXRvb2xib3gtc2VhcmNoLWlucHV0IiwgZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgdmFyIGZpbHRlcmVkVGV4dCA9IHRoYXQuJChldmVudC50YXJnZXQpLnZhbCgpOw0KICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJlZFRleHQubGVuZ3RoID49IDEpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhhdC5maWx0ZXJSZW5kZXJpbmdzKGZpbHRlcmVkVGV4dCk7DQogICAgICAgICAgICAgICAgICAgIHRoYXQuaGlkZUVtcHR5U2VjdGlvbnMoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHRoYXQuY2xlYXJTZWFyY2goKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIC5vbigiY2xpY2sgdG91Y2hzdGFydCBwb2ludGVyZG93biBNU1BvaW50ZXJEb3duIiwgIi5zeGEtdG9vbGJveC1jbGVhci1zZWFyY2giLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdGhhdC4kKCIuc3hhLXRvb2xib3gtc2VhcmNoLWlucHV0IikudmFsKCIiKS50cmlnZ2VyKCJrZXl1cCIpOw0KICAgICAgICAgICAgfSkNCiAgICAgICAgICAgICAgICAub24oImNsaWNrIiwgIi5zeGEtc2VhcmNoLWdsYXNzLWJ0biIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICB0aGF0LiQoIi5zeGEtdG9vbGJveC1zZWFyY2giKS50b2dnbGVDbGFzcygic3hhLXRvb2xib3gtaGlkZWQiKTsNCiAgICAgICAgICAgICAgICB0aGF0LiQoIi5zeGEtdG9vbGJveC1jbGVhci1zZWFyY2giKS50cmlnZ2VyKCJjbGljayIpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBYQS5oYXNQYWdlTW9kZXMoKSAmJiBTaXRlY29yZS5QYWdlTW9kZXMuQ2hyb21lTWFuYWdlci5jaHJvbWVzUmVzZXRlZC5vYnNlcnZlKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICB0aGF0LiQueGFNb3Zlci5yZWZyZXNoQ29uZmlndXJhdGlvbigpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBpbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHZhciBjb250ZXh0ID0gd2luZG93LkV4cGVyaWVuY2VFZGl0b3IgJiYgd2luZG93LkV4cGVyaWVuY2VFZGl0b3IuZ2V0Q29udGV4dCAmJiB3aW5kb3cuRXhwZXJpZW5jZUVkaXRvci5nZXRDb250ZXh0KCksIGlzUmliYm9uUmVuZGVyZWQgPSBjb250ZXh0ICYmIGNvbnRleHQuaXNSaWJib25SZW5kZXJlZDsNCiAgICAgICAgICAgICAgICBpZiAoIWlzUmliYm9uUmVuZGVyZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsSWQpOw0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQodGhhdC5maXhUb29sYm94SGVpZ2h0LmJpbmQodGhhdCksIDApOw0KICAgICAgICAgICAgfSwgMTAwMCk7DQogICAgICAgICAgICByaWJib25Db250ZW50cy5vbigiY2xpY2siLCAibmF2ID4gW2RhdGEtc2MtaWQ9J1F1aWNrUmliYm9uJ10sLnNjLXF1aWNrYmFyLWl0ZW0uc2MtcXVpY2tiYXItYnV0dG9uLnNjX1F1aWNrYmFyQnV0dG9uXzU2IiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHRoYXQuZml4VG9vbGJveEhlaWdodCgpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB0aGlzLm1ha2VEcmFnZ2FibGUoKTsNCiAgICAgICAgfTsNCiAgICAgICAgVG9vbGJveC5wcm90b3R5cGUuZ3JvdXBDb21wb25lbnRCeU5hbWVzID0gZnVuY3Rpb24gKHJlbmRlcmluZ3MsIHRyYW5zbGF0aW9ucykgew0KICAgICAgICAgICAgdmFyIGdyb3VwZWRDb21wb25lbnRzID0ge307DQogICAgICAgICAgICByZW5kZXJpbmdzLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHsNCiAgICAgICAgICAgICAgICBpZiAoIWdyb3VwZWRDb21wb25lbnRzW2VsZW1lbnQuUGFyZW50XSkgew0KICAgICAgICAgICAgICAgICAgICBncm91cGVkQ29tcG9uZW50c1tlbGVtZW50LlBhcmVudF0gPSBbXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZ3JvdXBlZENvbXBvbmVudHNbZWxlbWVudC5QYXJlbnRdLnB1c2goZWxlbWVudCk7DQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGdyb3VwZWRDb21wb25lbnRzID0gdGhpcy5hZGROb3RpZmljYXRpb25JZkVtcHR5KGdyb3VwZWRDb21wb25lbnRzLCB0cmFuc2xhdGlvbnMpOw0KICAgICAgICAgICAgcmV0dXJuIGdyb3VwZWRDb21wb25lbnRzOw0KICAgICAgICB9Ow0KICAgICAgICBUb29sYm94LnByb3RvdHlwZS5zZXRJbml0aWFsU2V0dGluZ3MgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHRoaXMuZGVmYXVsdFNldHRpbmdzLCB0aGlzLmdldENvb2tpZVNldHRpbmdzKCkpOw0KICAgICAgICAgICAgdGhpcy5jb29raWVzLmNyZWF0ZUNvb2tpZSh0aGlzLmNvb2tpZU5hbWUsIEpTT04uc3RyaW5naWZ5KHNldHRpbmdzKSk7DQogICAgICAgIH07DQogICAgICAgIFRvb2xib3gucHJvdG90eXBlLmhpZGVFbXB0eVNlY3Rpb25zID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIHRvb2xib3hDb250YWluZXIgPSB0aGlzLiQoIi5tQ3VzdG9tU2Nyb2xsQm94Lm1DU0Jfb3V0c2lkZSAubUNTQl9jb250YWluZXIiKSwgY29tcG9uZW50c1NlY3Rpb25zID0gdG9vbGJveENvbnRhaW5lci5maW5kKCI+ZGl2IiksIHRoYXQgPSB0aGlzOw0KICAgICAgICAgICAgY29tcG9uZW50c1NlY3Rpb25zLmVhY2goZnVuY3Rpb24gKHBvcywgZWxlbSkgew0KICAgICAgICAgICAgICAgIHZhciAkZWxlbSA9IHRoYXQuJChlbGVtKSwgdG9vbGJveFNlY3Rpb24gPSAkZWxlbS5maW5kKCIjc3hhLXRvb2xib3gtc2VjdGlvbiIpOw0KICAgICAgICAgICAgICAgIGlmICgkZWxlbS5maW5kKCIudWktZHJhZ2dhYmxlOm5vdCguc3hhLXRvb2xib3gtaGlkZWQpIikubGVuZ3RoID09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgJGVsZW0uYWRkQ2xhc3MoInN4YS10b29sYm94LWhpZGVkIik7DQogICAgICAgICAgICAgICAgICAgIHRvb2xib3hTZWN0aW9uLnJlbW92ZUNsYXNzKCJzZWFyY2gtZXhwYW5kZWQiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICRlbGVtLnJlbW92ZUNsYXNzKCJzeGEtdG9vbGJveC1oaWRlZCIpOw0KICAgICAgICAgICAgICAgICAgICB0b29sYm94U2VjdGlvbi5hZGRDbGFzcygic2VhcmNoLWV4cGFuZGVkIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH07DQogICAgICAgIFRvb2xib3gucHJvdG90eXBlLmNsZWFyU2VhcmNoID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIHRvb2xib3hDb250YWluZXIgPSB0aGlzLiQoIi5tQ3VzdG9tU2Nyb2xsQm94Lm1DU0Jfb3V0c2lkZSAubUNTQl9jb250YWluZXIiKSwgdG9vbGJveFNlY3Rpb24gPSB0b29sYm94Q29udGFpbmVyLmZpbmQoIj5kaXY+c3BhbiIpLCBjb21wb25lbnRzU2VjdGlvbnMgPSB0b29sYm94Q29udGFpbmVyLmZpbmQoIj5kaXYiKTsNCiAgICAgICAgICAgIHRvb2xib3hTZWN0aW9uLnJlbW92ZUNsYXNzKCJzZWFyY2gtZXhwYW5kZWQiKTsNCiAgICAgICAgICAgIGNvbXBvbmVudHNTZWN0aW9ucy5yZW1vdmVDbGFzcygic3hhLXRvb2xib3gtaGlkZWQiKTsNCiAgICAgICAgICAgIGNvbXBvbmVudHNTZWN0aW9ucy5maW5kKCJsaT5zcGFuIikucmVtb3ZlQ2xhc3MoInN4YS10b29sYm94LWhpZGVkIik7DQogICAgICAgIH07DQogICAgICAgIFRvb2xib3gucHJvdG90eXBlLmZpbHRlclJlbmRlcmluZ3MgPSBmdW5jdGlvbiAoZmlsdGVyKSB7DQogICAgICAgICAgICB2YXIgYWxsUmVuZGVyaW5ncyA9IHRoaXMuJCgiLm1DU0JfY29udGFpbmVyIGxpIiksIGxvd2VyRmlsdGVyID0gZmlsdGVyLnRvTG93ZXJDYXNlKCksIHRoYXQgPSB0aGlzOw0KICAgICAgICAgICAgYWxsUmVuZGVyaW5ncy5lYWNoKGZ1bmN0aW9uIChwb3MsIGVsKSB7DQogICAgICAgICAgICAgICAgdmFyIGl0ZW1XcmFwcGVyID0gdGhhdC4kKGVsKS5maW5kKCdzcGFuJyk7DQogICAgICAgICAgICAgICAgaWYgKGl0ZW1XcmFwcGVyLnRleHQoKS50b0xvd2VyQ2FzZSgpLmluZGV4T2YobG93ZXJGaWx0ZXIpID4gLTEpIHsNCiAgICAgICAgICAgICAgICAgICAgaXRlbVdyYXBwZXIucmVtb3ZlQ2xhc3MoInN4YS10b29sYm94LWhpZGVkIik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBpdGVtV3JhcHBlci5hZGRDbGFzcygic3hhLXRvb2xib3gtaGlkZWQiKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfTsNCiAgICAgICAgVG9vbGJveC5wcm90b3R5cGUuZ2V0TWFya3VwID0gZnVuY3Rpb24gKGNvbmZpZykgew0KICAgICAgICAgICAgdmFyIHNldHRpbmdzID0gSlNPTi5wYXJzZSh0aGlzLmNvb2tpZXMucmVhZENvb2tpZSh0aGlzLmNvb2tpZU5hbWUpKSwgYWxsb3dlZENvbXBvbmVudHMgPSB0aGlzLmZpbHRlckFsbG93ZWRDb21wb25lbnRzKGNvbmZpZy5yZW5kZXJpbmdzKSwgZ3JvdXBlZENvbXBvbmVudHMgPSB0aGlzLmdyb3VwQ29tcG9uZW50QnlOYW1lcyhhbGxvd2VkQ29tcG9uZW50cywgY29uZmlnLnRyYW5zbGF0aW9ucyk7DQogICAgICAgICAgICB2YXIgbmV3VG9vbGJveCA9ICI8ZGl2IGlkPVwic3hhLXRvb2xib3hcIiBjbGFzcz1cIiIgKyAoc2V0dGluZ3Mub3BlbmVkID8gInNob3ctdG9vbGJveCIgOiAiIikgKyAiICAiICsgKHNldHRpbmdzLmlzTW9iaWxlID8gInN4YS1tb2JpbGUtdG9vbGJveCIgOiAiIikgKyAiXCI+XG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzeGEtdG9vbGJveC1leHBhbmRlclwiPjwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiaGFuZGxlIHN4YS10b29sYm94LWhlYWRlclwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInN4YS10b29sYm94LWxhYmVsXCI+IiArIGNvbmZpZy50cmFuc2xhdGlvbnMuVG9vbGJveCArICI8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzeGEtdG9nZ2xlLWRldmljZVwiPjwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInN4YS10b2dnbGUtZGV2aWNlLXRvdWNoXCI+PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAiICsgKGFsbG93ZWRDb21wb25lbnRzLmxlbmd0aCA+IDAgPyAiPGRpdiBjbGFzcz1cInN4YS1zZWFyY2gtZ2xhc3MtYnRuXCI+PC9kaXY+IiA6ICIiKSArICJcbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICIgKyAoYWxsb3dlZENvbXBvbmVudHMubGVuZ3RoID4gMCA/DQogICAgICAgICAgICAgICAgIjxkaXYgY2xhc3M9XCJzeGEtdG9vbGJveC1zZWFyY2ggc3hhLXRvb2xib3gtaGlkZWRcIj4gXG4gICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgY2xhc3M9XCJzeGEtdG9vbGJveC1zZWFyY2gtaW5wdXRcIiB0eXBlPVwidGV4dFwiIHZhbHVlPVwiXCIgcGxhY2Vob2xkZXI9XCJTZWFyY2ggZm9yIGNvbXBvbmVudFwiLz5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJzeGEtdG9vbGJveC1jbGVhci1zZWFyY2hcIiB0aXRsZT1cIkNsZWFyXCI+eDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj4iIDogIiIpICsgIlxuICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibUN1c3RvbVNjcm9sbGJhclwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD1cInN4YS10b29sYm94LXJvb3RcIiBzdHlsZT1cImhlaWdodDoiICsgdGhpcy5nZXRWaXNpYmxlSGVpZ2h0KCkgKyAicHhcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiICsgKE9iamVjdC5rZXlzKGdyb3VwZWRDb21wb25lbnRzKSAmJiBPYmplY3Qua2V5cyhncm91cGVkQ29tcG9uZW50cykubWFwKGZ1bmN0aW9uIChjb21wb25lbnRHcm91cCkgeyByZXR1cm4gIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gaWQ9XCJzeGEtdG9vbGJveC1zZWN0aW9uXCIgZGF0YS1zZWN0aW9uLW5hbWU9XCIiICsgY29tcG9uZW50R3JvdXAudG9Mb2NhbGVMb3dlckNhc2UoKSArICJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVwiIiArIChzZXR0aW5ncy5hY3RpdmVHcm91cExpc3QuaW5kZXhPZihjb21wb25lbnRHcm91cC50b0xvY2FsZUxvd2VyQ2FzZSgpKSA+IC0xID8gImV4cGFuZGVkIiA6ICIiKSArICIgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIgKyAoYWxsb3dlZENvbXBvbmVudHMubGVuZ3RoID09IDAgPyAic3hhLXRvb2xib3gtZW1wdHktc2VjdGlvbiIgOiAiIikgKyAiIFwiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIgKyBjb21wb25lbnRHcm91cCArICJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx1bD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIgKyBncm91cGVkQ29tcG9uZW50c1tjb21wb25lbnRHcm91cF0ubWFwKGZ1bmN0aW9uIChjb21wb25lbnQpIHsgcmV0dXJuICJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGk+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIgKyAoc2V0dGluZ3MuaXNNb2JpbGUgPyAiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwiZ3JpcHBlci1pY29uIHRvdWNoLWdyaXBwZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB4bWxuczp4bGluaz1cImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmtcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb249XCIxLjFcIiBpZD1cIkxheWVyXzFcIiB4PVwiMHB4XCIgeT1cIjBweFwiIHdpZHRoPVwiMzBweFwiIGhlaWdodD1cIjMwcHhcIiB2aWV3Qm94PVwiMCAwIDUxMiA1MTJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPVwiZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyO1wiIHhtbDpzcGFjZT1cInByZXNlcnZlXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxnPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHJlY3QgeT1cIjE0NFwiIHdpZHRoPVwiNTEyXCIgaGVpZ2h0PVwiMzJcIi8+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cmVjdCB5PVwiMjQwXCIgd2lkdGg9XCI1MTJcIiBoZWlnaHQ9XCIzMlwiLz48cmVjdCB5PVwiMzM2XCIgd2lkdGg9XCI1MTJcIiBoZWlnaHQ9XCIzMlwiLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9nPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+Ig0KICAgICAgICAgICAgICAgIDogIiIpICsgIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBkYXRhLWljb249XCIiICsgY29tcG9uZW50Lkljb24gKyAiXCIgZGF0YS1pY29uMjQ9XCIiICsgY29tcG9uZW50Lkljb24yNCArICJcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YS1pZD1cIiIgKyBjb21wb25lbnQuSUQgKyAiXCIgc3R5bGU9XCJiYWNrZ3JvdW5kOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXJsKCIgKyAoc2V0dGluZ3MuaXNNb2JpbGUgPyAiIiArIGNvbXBvbmVudC5JY29uMjQgOiAiIiArIGNvbXBvbmVudC5JY29uKSArICIpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuby1yZXBlYXQgNXB4IDVweDtcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICIgKyBjb21wb25lbnQuTmFtZSArICJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvbGk+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiOyB9KS5qb2luKCIgIikgKyAiXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3VsPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiOyB9KS5qb2luKCIgIikpICsgIlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PiI7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5zdHJpbmdUb0RPTShuZXdUb29sYm94KTsNCiAgICAgICAgfTsNCiAgICAgICAgVG9vbGJveC5wcm90b3R5cGUuZ2V0VmlzaWJsZUhlaWdodCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLiQod2luZG93KS5oZWlnaHQoKSAtDQogICAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50b29sQm94UGxhY2Vob2xkZXIuc2xpY2UoMSkpLm9mZnNldFRvcCAtDQogICAgICAgICAgICAgICAgKHRoaXMuJCgiLnN4YS10b29sYm94LWhlYWRlciIpLmhlaWdodCgpIHx8IDIwKTsNCiAgICAgICAgfTsNCiAgICAgICAgVG9vbGJveC5wcm90b3R5cGUuZ2V0QWxsb3dlZFJlbmRlcmluZ3MgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBpZiAoIVhBLmhhc1BhZ2VNb2RlcygpKQ0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIHZhciBhbGxvd2VkUmVuZGVyaW5ncyA9IFtdLCBjaHJvbWVzID0gU2l0ZWNvcmUuUGFnZU1vZGVzLkNocm9tZU1hbmFnZXIuY2hyb21lcygpLCBpLCBqLCBjaHJvbWUsIHJlbmRlcmluZ3MgPSBbXTsNCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBjaHJvbWVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgY2hyb21lID0gY2hyb21lc1tpXTsNCiAgICAgICAgICAgICAgICBpZiAoY2hyb21lLmRhdGEgIT09IHVuZGVmaW5lZCAmJg0KICAgICAgICAgICAgICAgICAgICBjaHJvbWUuZGF0YS5jdXN0b20gIT09IHVuZGVmaW5lZCAmJg0KICAgICAgICAgICAgICAgICAgICBjaHJvbWUuZGF0YS5jdXN0b20uYWxsb3dlZFJlbmRlcmluZ3MgIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgY2hyb21lUmVuZGVyaW5ncyA9IGNocm9tZS5kYXRhLmN1c3RvbS5hbGxvd2VkUmVuZGVyaW5nczsNCiAgICAgICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGNocm9tZVJlbmRlcmluZ3MubGVuZ3RoOyBqKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLiQuaW5BcnJheShjaHJvbWVSZW5kZXJpbmdzW2pdLCBhbGxvd2VkUmVuZGVyaW5ncykgPT09IC0xKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWxsb3dlZFJlbmRlcmluZ3MucHVzaChjaHJvbWVSZW5kZXJpbmdzW2pdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNocm9tZXMuZmlsdGVyKGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGUuZGF0YS5jdXN0b20gIT0gbnVsbCAmJg0KICAgICAgICAgICAgICAgICAgICBlLmRhdGEuY3VzdG9tLmVkaXRhYmxlID09PSAidHJ1ZSIgJiYNCiAgICAgICAgICAgICAgICAgICAgZS5kYXRhLmN1c3RvbS5hbGxvd2VkUmVuZGVyaW5ncyAhPSBudWxsICYmDQogICAgICAgICAgICAgICAgICAgIGUuZGF0YS5jdXN0b20uYWxsb3dlZFJlbmRlcmluZ3MubGVuZ3RoID4gMDsNCiAgICAgICAgICAgIH0pLmZvckVhY2goZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpXzEgPSAwOyBpXzEgPCBlLmRhdGEuY3VzdG9tLmFsbG93ZWRSZW5kZXJpbmdzLmxlbmd0aDsgaV8xKyspIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIGN1cnJlbnQgPSBlLmRhdGEuY3VzdG9tLmFsbG93ZWRSZW5kZXJpbmdzW2lfMV07DQogICAgICAgICAgICAgICAgICAgIGlmIChyZW5kZXJpbmdzLmluZGV4T2YoY3VycmVudCkgPj0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgcmVuZGVyaW5ncy5wdXNoKGN1cnJlbnQpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgcmV0dXJuIHJlbmRlcmluZ3M7DQogICAgICAgIH07DQogICAgICAgIFRvb2xib3gucHJvdG90eXBlLmFkZEN1c3RvbVNjcm9sbCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHRoaXMuJCgiI3N4YS10b29sYm94LXJvb3QiKS5tQ3VzdG9tU2Nyb2xsYmFyKHsNCiAgICAgICAgICAgICAgICB0aGVtZTogIm1pbmltYWwtZGFyayINCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9Ow0KICAgICAgICBUb29sYm94LnByb3RvdHlwZS5oYW5kbGVSZXNwb25zZSA9IGZ1bmN0aW9uIChtZXNzYWdlLCByZXN1bHQpIHsNCiAgICAgICAgICAgIGlmIChtZXNzYWdlICE9PSAiY2hyb21lOnBsYWNlaG9sZGVyOmNvbnRyb2xhZGRpbmdjYW5jZWxsZWQiKSB7DQogICAgICAgICAgICAgICAgdGhpcy4kLnhhTW92ZXIuY3VycmVudENocm9tZS50eXBlLmFkZENvbnRyb2xSZXNwb25zZShyZXN1bHQuaWQsIHJlc3VsdC5vcGVuUHJvcGVydGllcywgcmVzdWx0LmRhdGFTb3VyY2UpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgdGhpcy4kLnhhTW92ZXIuY2xlYW51cCgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgICBUb29sYm94LnByb3RvdHlwZS5nZXRDb29raWVTZXR0aW5ncyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBvcHRpb25zU3RyaW5nID0gdGhpcy5jb29raWVzLnJlYWRDb29raWUodGhpcy5jb29raWVOYW1lKSB8fCAie30iLCBvcHRpb25zID0gSlNPTi5wYXJzZShvcHRpb25zU3RyaW5nKTsNCiAgICAgICAgICAgIHJldHVybiBvcHRpb25zOw0KICAgICAgICB9Ow0KICAgICAgICBUb29sYm94LnByb3RvdHlwZS50b2dnbGVWaXNpYmlsaXR5ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIHRvb2xib3hTZXR0aW5nID0gdGhpcy5nZXRDb29raWVTZXR0aW5ncygpLCB0b29sYm94ID0gdGhpcy4kKCIjc3hhLXRvb2xib3giKTsNCiAgICAgICAgICAgIHRvb2xib3hTZXR0aW5nLm9wZW5lZCA9ICF0b29sYm94U2V0dGluZy5vcGVuZWQ7DQogICAgICAgICAgICB0aGlzLmNvb2tpZXMuY3JlYXRlQ29va2llKHRoaXMuY29va2llTmFtZSwgSlNPTi5zdHJpbmdpZnkodG9vbGJveFNldHRpbmcpKTsNCiAgICAgICAgICAgIHRvb2xib3hTZXR0aW5nLm9wZW5lZCA/IHRvb2xib3guYWRkQ2xhc3MoInNob3ctdG9vbGJveCIpIDogdG9vbGJveC5yZW1vdmVDbGFzcygic2hvdy10b29sYm94Iik7DQogICAgICAgIH07DQogICAgICAgIFRvb2xib3gucHJvdG90eXBlLnRvb2xib3hFeHBhbmRlclBvc2l0aW9uID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIHRvb2xCb3hFeHBhbmRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5zeGEtdG9vbGJveC1leHBhbmRlciIpOw0KICAgICAgICAgICAgdmFyIHJlY3RFeHBhbmRlciA9IHRvb2xCb3hFeHBhbmRlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICAgICAgICAgIGlmIChyZWN0RXhwYW5kZXIudG9wICsgcmVjdEV4cGFuZGVyLmhlaWdodCA+PSB3aW5kb3cuaW5uZXJIZWlnaHQpIHsNCiAgICAgICAgICAgICAgICBqUXVlcnkodG9vbEJveEV4cGFuZGVyKS5hZGRDbGFzcygiZXhwYW5kZXItb3V0LXNjcmVlbiIpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgalF1ZXJ5KHRvb2xCb3hFeHBhbmRlcikucmVtb3ZlQ2xhc3MoImV4cGFuZGVyLW91dC1zY3JlZW4iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICAgICAgVG9vbGJveC5wcm90b3R5cGUucmVmcmVzaFRvb2xib3ggPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgZGF0YSA9IHRoaXMuY29uZmlnLCB0b29sYm94TWFya3VwID0gdGhpcy5nZXRNYXJrdXAoZGF0YSk7DQogICAgICAgICAgICB0aGlzLiQoIiNzeGEtdG9vbGJveCIpLnJlbW92ZSgpOw0KICAgICAgICAgICAgdGhpcy4kKHRvb2xib3hNYXJrdXApLmluc2VydEJlZm9yZSh0aGlzLnRvb2xCb3hQbGFjZWhvbGRlcik7DQogICAgICAgICAgICB0aGlzLmFkZEN1c3RvbVNjcm9sbCgpOw0KICAgICAgICAgICAgdGhpcy5tYWtlRHJhZ2dhYmxlKCk7DQogICAgICAgICAgICB0aGlzLnRvb2xib3hFeHBhbmRlclBvc2l0aW9uKCk7DQogICAgICAgIH07DQogICAgICAgIFRvb2xib3gucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOw0KICAgICAgICAgICAgaWYgKHRoaXMuY29uZmlnIHx8ICF3aW5kb3cuU2l0ZWNvcmUpIHsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLmxvYWRDb25maWd1cmF0aW9uKCkNCiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkgew0KICAgICAgICAgICAgICAgIF90aGlzLmNvbmZpZyA9IGRhdGE7DQogICAgICAgICAgICAgICAgX3RoaXMuc2V0SW5pdGlhbFNldHRpbmdzKCk7DQogICAgICAgICAgICAgICAgX3RoaXMucmVmcmVzaFRvb2xib3goKTsNCiAgICAgICAgICAgICAgICBfdGhpcy5iaW5kRXZlbnRzKCk7DQogICAgICAgICAgICAgICAgX3RoaXMuJChkb2N1bWVudCkudHJpZ2dlcigic3hhLXRvb2xib3gtbG9hZGVkIik7DQogICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oZXJyb3IpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgIH07DQogICAgICAgIHJldHVybiBUb29sYm94Ow0KICAgIH0oKSk7DQogICAgU1hBVG9vbGJveC5Ub29sYm94ID0gVG9vbGJveDsNCn0pKFNYQVRvb2xib3ggfHwgKFNYQVRvb2xib3ggPSB7fSkpOw0Kd2luZG93LiR4YShkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkgew0KICAgIHdpbmRvdy4keGEudG9vbGJveCA9IG5ldyBTWEFUb29sYm94LlRvb2xib3god2luZG93LiR4YSwgd2luZG93LlhBLmNvb2tpZXMpOw0KfSk7DQo=
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 23363
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20160509T085839Z
