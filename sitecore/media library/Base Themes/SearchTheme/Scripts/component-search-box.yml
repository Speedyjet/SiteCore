---
ID: "84a844f4-4a16-408e-beab-e49d67e4373d"
Parent: "dfcbfa5a-2e37-418a-adb7-f411ecae89a9"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Base Themes/SearchTheme/Scripts/component-search-box"
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/84A844F44A16408EBEABE49D67E4373D.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  Value: LyoqDQogKiBTZWFyY2ggYm94IGNvbXBvbmVudCBmdW5jdGlvbmFsaXR5DQogKiBAbW9kdWxlIHNlYXJjaEJveA0KICogQHBhcmFtICB7alF1ZXJ5fSAkIEluc3RhbmNlIG9mIGpRdWVyeQ0KICogQHBhcmFtICB7RG9jdW1lbnR9IGRvY3VtZW50IGRvbSBkb2N1bWVudCBvYmplY3QNCiAqIEByZXR1cm4ge09iamVjdH0gbGlzdCBvZiBtZXRob2RzIGZvciB3b3JraW5nIHdpdGggc2VhcmNoIGJveA0KKi8NClhBLmNvbXBvbmVudC5zZWFyY2guYm94ID0gKGZ1bmN0aW9uICgkLCBkb2N1bWVudCkgew0KICAgIHZhciBhcGkgPSB7fSwNCiAgICAgICAgc2VhcmNoQm94Vmlld3MgPSBbXSwNCiAgICAgICAgc2VhcmNoQm94TW9kZWxzID0gW10sDQogICAgICAgIHF1ZXJ5TW9kZWwsDQogICAgICAgIHVybEhlbHBlck1vZGVsLA0KICAgICAgICBzZWFyY2hSZXN1bHRNb2RlbHM7DQogICAgLyoqDQogICAgKiBAbmFtZSBtb2R1bGU6c2VhcmNoQm94LlNlYXJjaEJveE1vZGVsDQogICAgKiBAY29uc3RydWN0b3INCiAgICAqIEBhdWdtZW50cyBCYWNrYm9uZS5Nb2RlbA0KICAgICovDQogICAgdmFyIFNlYXJjaEJveE1vZGVsID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKA0KICAgICAgICAvKiogQGxlbmRzIG1vZHVsZTpzZWFyY2hCb3guU2VhcmNoQm94TW9kZWwucHJvdG90eXBlICoqLw0KICAgICAgICB7DQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICogRGVmYXVsdCBtb2RlbCBvcHRpb25zDQogICAgICAgICAgICAqIEBkZWZhdWx0DQogICAgICAgICAgICAqLw0KICAgICAgICAgICAgZGVmYXVsdHM6IHsNCiAgICAgICAgICAgICAgICBzZWFyY2hFbmdpbmU6ICIiLA0KICAgICAgICAgICAgICAgIHR5cGVhaGVhZDogIiIsDQogICAgICAgICAgICAgICAgZGF0YVByb3BlcnRpZXM6IHt9LA0KICAgICAgICAgICAgICAgIHNlYXJjaFF1ZXJ5OiAiIiwNCiAgICAgICAgICAgICAgICBsb2FkaW5nSW5Qcm9ncmVzczogZmFsc2UsDQogICAgICAgICAgICAgICAgc2lnOiBbXQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgKiBjcmVhdGUgaW5zdGFuY2Ugb2YgDQogICAgICAgICAgICAqIFsiQmxvb2Rob3VuZCJde0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS90d2l0dGVyL3R5cGVhaGVhZC5qcy9ibG9iL21hc3Rlci9kb2MvYmxvb2Rob3VuZC5tZH0NCiAgICAgICAgICAgICogd2lkdGggbmVjZXNzYXJ5IG9wdGlvbnMNCiAgICAgICAgICAgICogQG1lbWJlck9mIG1vZHVsZTpzZWFyY2hCb3guU2VhcmNoQm94TW9kZWwNCiAgICAgICAgICAgICogQG1ldGhvZA0KICAgICAgICAgICAgKiBAYWxpYXMgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hNb2RlbC5pbml0U2VhcmNoRW5naW5lDQogICAgICAgICAgICAqLw0KICAgICAgICAgICAgaW5pdFNlYXJjaEVuZ2luZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHZhciBpbnN0ID0gdGhpcywNCiAgICAgICAgICAgICAgICAgICAgc2l0ZU5hbWUgPSBYQS5jb21wb25lbnQuc2VhcmNoLmFqYXguZ2V0UHJhbWV0ZXJCeU5hbWUoInNjX3NpdGUiKSwNCiAgICAgICAgICAgICAgICAgICAgc2VhcmNoRW5naW5lID0gbmV3IEJsb29kaG91bmQoew0KICAgICAgICAgICAgICAgICAgICAgICAgZGF0dW1Ub2tlbml6ZXI6IEJsb29kaG91bmQudG9rZW5pemVycy5vYmoud2hpdGVzcGFjZSgibmFtZSIpLA0KICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlUb2tlbml6ZXI6IEJsb29kaG91bmQudG9rZW5pemVycy53aGl0ZXNwYWNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgbGltaXQ6IGluc3QuZ2V0KCJkYXRhUHJvcGVydGllcyIpLnAsDQogICAgICAgICAgICAgICAgICAgICAgICByZW1vdGU6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmw6IHVybEhlbHBlck1vZGVsLmNyZWF0ZVNpdGVVcmwoaW5zdC5jcmVhdGVTdWdnZXN0aW9uc1VybCgkLmV4dGVuZCh7IGw6IGluc3QuZ2V0TGFuZ3VhZ2UoKSB9LCBpbnN0LmdldCgiZGF0YVByb3BlcnRpZXMiKSksIGluc3QuZ2V0KCJzZWFyY2hRdWVyeSIpKSwgc2l0ZU5hbWUpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcjogZnVuY3Rpb24gKGxpc3QpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlYXJjaEFyciA9IFtdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gXy5tYXAobGlzdC5SZXN1bHRzLCBmdW5jdGlvbiAoaXRlbSkgeyByZXR1cm4geyBodG1sOiBpdGVtLkh0bWwgfTsgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZVByb3ZpZGVyID0gaW5zdC5nZXQoInZhbHVlUHJvdmlkZXIiKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlYXJjaFF1ZXJ5ID0gdmFsdWVQcm92aWRlcigpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvcGVydGllcyA9ICQuZXh0ZW5kKHsgbDogaW5zdC5nZXRMYW5ndWFnZSgpIH0sIGluc3QuZ2V0KCJkYXRhUHJvcGVydGllcyIpKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXJsSGVscGVyTW9kZWwuY3JlYXRlU2l0ZVVybChpbnN0LmNyZWF0ZVN1Z2dlc3Rpb25zVXJsKHByb3BlcnRpZXMsIHNlYXJjaFF1ZXJ5KSwgc2l0ZU5hbWUpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWpheDogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWZvcmVTZW5kOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0LnNldCh7ICJsb2FkaW5nSW5Qcm9ncmVzcyI6IHRydWUgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0LnNldCh7ICJsb2FkaW5nSW5Qcm9ncmVzcyI6IGZhbHNlIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgIHNlYXJjaEVuZ2luZS5pbml0aWFsaXplKCk7DQogICAgICAgICAgICAgICAgdGhpcy5zZXQoeyBzZWFyY2hFbmdpbmU6IHNlYXJjaEVuZ2luZSB9KTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICogQ3JlYXRlcyB1cmwgZnJvbSB3aGljaCBzdWdnZXN0aW9uIHNob3VsZCBiZSB0YWtlbg0KICAgICAgICAgICAgKiBAbWVtYmVyT2YgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hNb2RlbA0KICAgICAgICAgICAgKiBAbWV0aG9kDQogICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwcm9wZXJ0aWVzIGxpc3Qgb2YgcHJvcGVydGllcyBmb3Igc3VnZ2VzdGlvbiBmdW5jdGlvbmFsaXR5IA0KICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VhcmNoUXVlcnkgdGV4dCBmcm9tIHNlYXJjaCBib3gNCiAgICAgICAgICAgICogQGFsaWFzIG1vZHVsZTpzZWFyY2hCb3guU2VhcmNoQm94TW9kZWwuY3JlYXRlU3VnZ2VzdGlvbnNVcmwNCiAgICAgICAgICAgICogQHJldHVybnMge3N0cmluZ30gc2VhcmNoIHVybCBiYXNlZCBvbiBzZXR1cHMNCiAgICAgICAgICAgICovDQogICAgICAgICAgICBjcmVhdGVTdWdnZXN0aW9uc1VybDogZnVuY3Rpb24gKHByb3BlcnRpZXMsIHNlYXJjaFF1ZXJ5KSB7DQogICAgICAgICAgICAgICAgdmFyIHN1Z2dlc3Rpb25zTW9kZSA9IHRoaXMuZ2V0KCJkYXRhUHJvcGVydGllcyIpLnN1Z2dlc3Rpb25zTW9kZSwNCiAgICAgICAgICAgICAgICAgICAgcmVzdWx0c0VuZHBvaW50ID0gdGhpcy5nZXQoImRhdGFQcm9wZXJ0aWVzIikuZW5kcG9pbnQsDQogICAgICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb25zRW5kcG9pbnQgPSB0aGlzLmdldCgiZGF0YVByb3BlcnRpZXMiKS5zdWdnZXN0aW9uRW5kcG9pbnQ7DQoNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKHN1Z2dlc3Rpb25zTW9kZSkgew0KICAgICAgICAgICAgICAgICAgICBjYXNlICJTaG93UHJlZGljdGlvbnMiOiB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXJsSGVscGVyTW9kZWwuY3JlYXRlUHJlZGljdGl2ZVNlYXJjaFVybChzdWdnZXN0aW9uc0VuZHBvaW50LCBwcm9wZXJ0aWVzLCBzZWFyY2hRdWVyeSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHVybEhlbHBlck1vZGVsLmNyZWF0ZVByZWRpY3RpdmVTZWFyY2hVcmwocmVzdWx0c0VuZHBvaW50LCBwcm9wZXJ0aWVzLCBzZWFyY2hRdWVyeSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAqIGdldCBzZWFyY2ggYm94IHNpZ25hdHVyZQ0KICAgICAgICAgICAgKiBAbWVtYmVyT2YgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hNb2RlbA0KICAgICAgICAgICAgKiBAbWV0aG9kDQogICAgICAgICAgICAqIEBhbGlhcyBtb2R1bGU6c2VhcmNoQm94LlNlYXJjaEJveE1vZGVsLmdldFNpZ25hdHVyZQ0KICAgICAgICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBzZWFyY2ggYm94IHNpZ25hdHVyZQ0KICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGdldFNpZ25hdHVyZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHZhciByYXdTaWduYXR1cmUgPSB0aGlzLmdldCgiZGF0YVByb3BlcnRpZXMiKS5zZWFyY2hSZXN1bHRzU2lnbmF0dXJlLA0KICAgICAgICAgICAgICAgICAgICBzaWduYXR1cmVzOw0KDQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByYXdTaWduYXR1cmUgPT09ICJ1bmRlZmluZWQiIHx8IHJhd1NpZ25hdHVyZSA9PT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gIiI7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgc2lnbmF0dXJlcyA9IHJhd1NpZ25hdHVyZS5zcGxpdCgnLCcpOw0KDQogICAgICAgICAgICAgICAgaWYgKHJhd1NpZ25hdHVyZSA9PT0gIiIpIHsNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICIiOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBzaWduYXR1cmVzWzBdOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICogZ2V0IHNlYXJjaCBib3ggbGFuZ3VhZ2UNCiAgICAgICAgICAgICogQG1lbWJlck9mIG1vZHVsZTpzZWFyY2hCb3guU2VhcmNoQm94TW9kZWwNCiAgICAgICAgICAgICogQG1ldGhvZA0KICAgICAgICAgICAgKiBAYWxpYXMgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hNb2RlbC5nZXRMYW5ndWFnZQ0KICAgICAgICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBzZWxlY3RlZCBsYW5ndWFnZQ0KICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGdldExhbmd1YWdlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdmFyIGRhdGFQcm9wZXJ0aWVzID0gdGhpcy5nZXQoImRhdGFQcm9wZXJ0aWVzIiksDQogICAgICAgICAgICAgICAgICAgIHNlYXJjaFJlc3VsdE1vZGVscyA9IFhBLmNvbXBvbmVudC5zZWFyY2gucmVzdWx0cy5zZWFyY2hSZXN1bHRNb2RlbHMsDQogICAgICAgICAgICAgICAgICAgIGxhbmd1YWdlU291cmNlID0gZGF0YVByb3BlcnRpZXMubGFuZ3VhZ2VTb3VyY2UsDQogICAgICAgICAgICAgICAgICAgIHNpZ25hdHVyZSA9IHRoaXMuZ2V0U2lnbmF0dXJlKCksDQogICAgICAgICAgICAgICAgICAgIG1vZGVsOw0KDQogICAgICAgICAgICAgICAgc3dpdGNoIChsYW5ndWFnZVNvdXJjZSkgew0KICAgICAgICAgICAgICAgICAgICBjYXNlICJDdXJyZW50TGFuZ3VhZ2UiOg0KICAgICAgICAgICAgICAgICAgICBjYXNlICJBbGxMYW5ndWFnZXMiOiB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVByb3BlcnRpZXMubDsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB7DQogICAgICAgICAgICAgICAgICAgICAgICBtb2RlbCA9IHNlYXJjaFJlc3VsdE1vZGVscy5maWx0ZXIoZnVuY3Rpb24gKGVsZW1lbnQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5nZXQoImRhdGFQcm9wZXJ0aWVzIikuc2lnID09PSBzaWduYXR1cmU7DQogICAgICAgICAgICAgICAgICAgICAgICB9KVswXTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbW9kZWwgIT09ICJ1bmRlZmluZWQiKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vZGVsLmdldCgiZGF0YVByb3BlcnRpZXMiKS5sOw0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gIiI7DQogICAgICAgICAgICB9DQogICAgICAgIH0pOw0KICAgIC8qKg0KICAgICogQG5hbWUgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hWaWV3DQogICAgKiBAY29uc3RydWN0b3INCiAgICAqIEBhdWdtZW50cyBCYWNrYm9uZS5WaWV3DQogICAgKi8NCiAgICB2YXIgU2VhcmNoQm94VmlldyA9IFhBLmNvbXBvbmVudC5zZWFyY2guYmFzZVZpZXcuZXh0ZW5kKA0KICAgICAgICAvKiogQGxlbmRzIG1vZHVsZTpzZWFyY2hCb3guU2VhcmNoQm94Vmlldy5wcm90b3R5cGUgKiovDQogICAgICAgIHsNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICpJbml0aWFsaXplcyB0eXBlYWhlYWQgZm9yIHZpZXcsIHNldHMgdXAgd2F0Y2hlcnMgZm9yIGNoYW5nZSBvbiBtb2RlbA0KICAgICAgICAgICAgICphbmQgY2FsbCBbImluaXRTZWFyY2hFbmdpbmUiXXtAbGluayBtb2R1bGU6c2VhcmNoQm94LlNlYXJjaEJveE1vZGVsfQ0KICAgICAgICAgICAgKiBAbWVtYmVyb2YgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hWaWV3LnByb3RvdHlwZQ0KICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICB2YXIgaW5zdCA9IHRoaXMsDQogICAgICAgICAgICAgICAgICAgIGRhdGFQcm9wZXJ0aWVzID0gdGhpcy4kZWwuZGF0YSgpLA0KICAgICAgICAgICAgICAgICAgICB0eXBlYWhlYWQ7DQoNCiAgICAgICAgICAgICAgICBkYXRhUHJvcGVydGllcy5wcm9wZXJ0aWVzLnRhcmdldFNpZ25hdHVyZSA9IGRhdGFQcm9wZXJ0aWVzLnByb3BlcnRpZXMudGFyZ2V0U2lnbmF0dXJlICE9PSBudWxsID8gZGF0YVByb3BlcnRpZXMucHJvcGVydGllcy50YXJnZXRTaWduYXR1cmUgOiAiIjsNCg0KICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KHsgZGF0YVByb3BlcnRpZXM6IGRhdGFQcm9wZXJ0aWVzLnByb3BlcnRpZXMgfSk7DQogICAgICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoInNpZyIsIHRoaXMudHJhbnNsYXRlU2lnbmF0dXJlcyhkYXRhUHJvcGVydGllcy5wcm9wZXJ0aWVzLnNlYXJjaFJlc3VsdHNTaWduYXR1cmUsICJxIikpOw0KICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuaW5pdFNlYXJjaEVuZ2luZSgpOw0KICAgICAgICAgICAgICAgIHRoaXMubW9kZWwub24oImNoYW5nZTpsb2FkaW5nSW5Qcm9ncmVzcyIsIHRoaXMubG9hZGluZywgdGhpcyk7DQoNCiAgICAgICAgICAgICAgICB0eXBlYWhlYWQgPSB0aGlzLiRlbC5maW5kKCIuc2VhcmNoLWJveC1pbnB1dCIpLnR5cGVhaGVhZCh7DQogICAgICAgICAgICAgICAgICAgIGhpbnQ6IHRydWUsDQogICAgICAgICAgICAgICAgICAgIG1pbkxlbmd0aDogZGF0YVByb3BlcnRpZXMucHJvcGVydGllcy5taW5TdWdnZXN0aW9uc1RyaWdnZXJDaGFyYWN0ZXJDb3VudA0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogaW5zdC5tb2RlbC5nZXQoInNlYXJjaEVuZ2luZSIpLnR0QWRhcHRlcigpLA0KICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheUtleTogZnVuY3Rpb24gKCkgeyByZXR1cm4gaW5zdC4kZWwuZmluZCgiLnNlYXJjaC1ib3gtaW5wdXQudHQtaW5wdXQiKS52YWwoKTsgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlczogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb246IGZ1bmN0aW9uIChkYXRhKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdWdnZXN0aW9uc01vZGUgPSBkYXRhUHJvcGVydGllcy5wcm9wZXJ0aWVzLnN1Z2dlc3Rpb25zTW9kZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBkYXRhLmh0bWwucmVwbGFjZSgvKDwoW14+XSspPikvaWcsICIiKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb25UZXh0ID0gdGV4dCAhPT0gIiIgPyB0ZXh0IDogZGF0YS5odG1sOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoc3VnZ2VzdGlvbnNNb2RlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICJTaG93UHJlZGljdGlvbnMiOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAiU2hvd1NlYXJjaFJlc3VsdHNBc1ByZWRpY3Rpb25zIjogew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz0ic3VnZXNzdGlvbi1pdGVtIj4nICsgc3VnZ2VzdGlvblRleHQgKyAnPC9kaXY+JzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9InN1Z2Vzc3Rpb24taXRlbSI+JyArIGRhdGEuaHRtbCArICc8L2Rpdj4nOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB9KS5vbigndHlwZWFoZWFkOnNlbGVjdGVkJywgdGhpcy5zdWdnZXN0aW9uU2VsZWN0ZWQuYmluZChpbnN0KSk7DQoNCiAgICAgICAgICAgICAgICAvL1RPRE86IFNlZW1zIGxpa2UgYmVsbG93IGxpbmUgaXNuJ3QgbmVlZGVkIGFzIHVwZGF0ZVNlYXJjaEJveFZhbHVlKCkgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZW5kIHdoZW4gaGFzaCB3aWxsIGNoYW5nZSAtIHRvIGJlIHRlc3RlZCBpbiBub24vbXVsdGkgc2lnbmF0dXJlcyBjYXNlcw0KICAgICAgICAgICAgICAgIC8vJHNlYXJjaEJveC52YWwoaGFzaE9ialt0aGlzLm1vZGVsLmdldCgic2lnIildICE9PSB1bmRlZmluZWQgPyBoYXNoT2JqW3RoaXMubW9kZWwuZ2V0KCJzaWciKV0gOiAiIik7DQoNCiAgICAgICAgICAgICAgICB0aGlzLm1vZGVsLnNldCh7IHR5cGVhaGVhZDogdHlwZWFoZWFkIH0pOw0KICAgICAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KHsNCiAgICAgICAgICAgICAgICAgICAgdmFsdWVQcm92aWRlcjogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluc3QuJGVsLmZpbmQoIi5zZWFyY2gtYm94LWlucHV0LnR0LWlucHV0IikudmFsKCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBYQS5jb21wb25lbnQuc2VhcmNoLnZlbnQub24oImhhc2hDaGFuZ2VkIiwgdGhpcy51cGRhdGVTZWFyY2hCb3hWYWx1ZS5iaW5kKHRoaXMpKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIGxpc3Qgb2YgZXZlbnRzIGZvciBCYWNrYm9uZSBWaWV3DQogICAgICAgICAgICAgKiBAbWVtYmVyb2YgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hWaWV3DQogICAgICAgICAgICAgKiBAYWxpYXMgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hWaWV3I2V2ZW50cw0KICAgICAgICAgICAgICovDQogICAgICAgICAgICBldmVudHM6IHsNCiAgICAgICAgICAgICAgICAiY2xpY2sgLnNlYXJjaC1ib3gtYnV0dG9uIjogInVwZGF0ZVF1ZXJ5TW9kZWxDbGljayIsDQogICAgICAgICAgICAgICAgImNsaWNrIC5zZWFyY2gtYm94LWJ1dHRvbi13aXRoLXJlZGlyZWN0IjogInVwZGF0ZVF1ZXJ5V2l0aFJlZGlyZWN0IiwNCiAgICAgICAgICAgICAgICAia2V5cHJlc3MgLnNlYXJjaC1ib3gtaW5wdXQudHQtaW5wdXQiOiAicHJlZGljdGl2ZVNlYXJjaCIsDQogICAgICAgICAgICAgICAgImtleWRvd24gLnNlYXJjaC1ib3gtaW5wdXQudHQtaW5wdXQiOiAicHJlZGljdGl2ZVNlYXJjaCINCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICogVG9nZ2xlIGNzcyBjbGFzcyAibG9hZGluZy1pbi1wcm9ncmVzcyINCiAgICAgICAgICAgICogQG1lbWJlcm9mIG1vZHVsZTpzZWFyY2hCb3guU2VhcmNoQm94Vmlldw0KICAgICAgICAgICAgKiBAYWxpYXMgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hWaWV3I2xvYWRpbmcNCiAgICAgICAgICAgICovDQogICAgICAgICAgICBsb2FkaW5nOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdGhpcy4kZWwudG9nZ2xlQ2xhc3MoImxvYWRpbmctaW4tcHJvZ3Jlc3MiKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICogQ2FsbGVkIHdoZW4gc2VsZWN0ZWQgdmFsdWUgZnJvbSBzZWFyY2ggYm94IGFuZCBjYWxsDQogICAgICAgICAgICAqIFsicGVyZm9ybVNlYXJjaCJde0BsaW5rIG1vZHVsZTpwZXJmb3JtU2VhcmNofSBvciByZQ0KICAgICAgICAgICAgKiBAbWVtYmVyb2YgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hWaWV3DQogICAgICAgICAgICAqIEBwYXJhbSB7alF1ZXJ5PEV2ZW50Pn0gZXZlbnQgalF1ZXJ5IGV2ZW50IG9iamVjdA0KICAgICAgICAgICAgKiBAcGFyYW0ge0RvbUVsZW1lbnR9IGRhdGEgRE9NIGVsZW1lbnQgdGhhdCB3YXMgc2VsZWN0ZWQNCiAgICAgICAgICAgICogQGFsaWFzIG1vZHVsZTpzZWFyY2hCb3guU2VhcmNoQm94VmlldyNzdWdnZXN0aW9uU2VsZWN0ZWQNCiAgICAgICAgICAgICovDQogICAgICAgICAgICBzdWdnZXN0aW9uU2VsZWN0ZWQ6IGZ1bmN0aW9uIChldmVudCwgZGF0YSkgew0KICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoNCiAgICAgICAgICAgICAgICB2YXIgc3VnZ2VzdGlvbnNNb2RlID0gdGhpcy5tb2RlbC5nZXQoImRhdGFQcm9wZXJ0aWVzIikuc3VnZ2VzdGlvbnNNb2RlOw0KICAgICAgICAgICAgICAgIHZhciB0ZXh0Ow0KICAgICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAgIHRleHQgPSAkKGRhdGEuaHRtbCkudGV4dCgpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHsNCiAgICAgICAgICAgICAgICAgICAgdGV4dCA9ICIiOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHZhciBzdWdnZXN0aW9uVGV4dCA9IHRleHQgIT0gIiIgPyB0ZXh0IDogZGF0YS5odG1sLA0KICAgICAgICAgICAgICAgICAgICBsaW5rOw0KDQogICAgICAgICAgICAgICAgc3dpdGNoIChzdWdnZXN0aW9uc01vZGUpIHsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiU2hvd1ByZWRpY3Rpb25zIjoNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAiU2hvd1NlYXJjaFJlc3VsdHNBc1ByZWRpY3Rpb25zIjogew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wZXJmb3JtU2VhcmNoKHN1Z2dlc3Rpb25UZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxpbmsgPSAkKGRhdGEuaHRtbCkuZmluZCgiYSIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmsubGVuZ3RoKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAkKGxpbmtbMF0pLmF0dHIoImhyZWYiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgKiBVcGRhdGVzIGhhc2ggdmFsdWUgYW5kIG1ha2VzIHJlZGlyZWN0IGJhc2VkIG9uIHZhbHVlIGZyb20gc2VhcmNoIGJveA0KICAgICAgICAgICAgKiBAbWVtYmVyb2YgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hWaWV3DQogICAgICAgICAgICAqIEBwYXJhbSB7alF1ZXJ5PEV2ZW50Pn0gZXZlbnQgalF1ZXJ5IGV2ZW50IG9iamVjdA0KICAgICAgICAgICAgKiBAYWxpYXMgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hWaWV3I3VwZGF0ZVF1ZXJ5V2l0aFJlZGlyZWN0DQogICAgICAgICAgICAqLw0KICAgICAgICAgICAgdXBkYXRlUXVlcnlXaXRoUmVkaXJlY3Q6IGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoNCiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0UGFnZSA9IHRoaXMubW9kZWwuZ2V0KCJkYXRhUHJvcGVydGllcyIpLnJlc3VsdFBhZ2UsDQogICAgICAgICAgICAgICAgICAgIHRhcmdldFNpZ25hdHVyZSA9IHRoaXMubW9kZWwuZ2V0KCJkYXRhUHJvcGVydGllcyIpLnRhcmdldFNpZ25hdHVyZSwNCiAgICAgICAgICAgICAgICAgICAgc2VhcmNoUmVzdWx0c1NpZ25hdHVyZSA9IHRoaXMubW9kZWwuZ2V0KCJkYXRhUHJvcGVydGllcyIpLnNlYXJjaFJlc3VsdHNTaWduYXR1cmUsDQogICAgICAgICAgICAgICAgICAgIHF1ZXJ5ID0gZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuJGVsLmZpbmQoIi5zZWFyY2gtYm94LWlucHV0LnR0LWlucHV0IikudmFsKCkpLA0KICAgICAgICAgICAgICAgICAgICBzaWcgPSB0aGlzLm1vZGVsLmdldCgic2lnIiksDQogICAgICAgICAgICAgICAgICAgIHF1ZXJ5V2l0aFNpZ25hdHVyZSA9IHt9Ow0KDQogICAgICAgICAgICAgICAgaWYgKHRhcmdldFNpZ25hdHVyZSAhPT0gIiIpIHsNCiAgICAgICAgICAgICAgICAgICAgcXVlcnlXaXRoU2lnbmF0dXJlID0gdGhpcy51cGRhdGVTaWduYXR1cmVzSGFzaChbdGFyZ2V0U2lnbmF0dXJlICsgIl9xIl0sIHF1ZXJ5LCB0aGlzLmNyZWF0ZU9mZnNldE9iamVjdCgpKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBxdWVyeVdpdGhTaWduYXR1cmUgPSB0aGlzLnVwZGF0ZVNpZ25hdHVyZXNIYXNoKHNpZywgcXVlcnksIHRoaXMuY3JlYXRlT2Zmc2V0T2JqZWN0KCkpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gdXJsSGVscGVyTW9kZWwuY3JlYXRlUmVkaXJlY3RTZWFyY2hVcmwocmVzdWx0UGFnZSwgcXVlcnlXaXRoU2lnbmF0dXJlLCBzZWFyY2hSZXN1bHRzU2lnbmF0dXJlLCB0YXJnZXRTaWduYXR1cmUpOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgKiBUYWtlcyBzZWFyY2ggYm94IHZhbHVlIGFzIGEgcXVlcnkgdmFsdWUgYW5kIGNhbGxzDQogICAgICAgICAgICAqIFsidXBkYXRlUXVlcnlNb2RlbCJde0BsaW5rIG1vZHVsZTptb2R1bGU6c2VhcmNoQm94LlNlYXJjaEJveFZpZXcjdXBkYXRlUXVlcnlNb2RlbH0NCiAgICAgICAgICAgICogQG1lbWJlcm9mIG1vZHVsZTpzZWFyY2hCb3guU2VhcmNoQm94Vmlldw0KICAgICAgICAgICAgKiBAcGFyYW0ge2pRdWVyeTxFdmVudD59IGV2ZW50IGpRdWVyeSBldmVudCBvYmplY3QNCiAgICAgICAgICAgICogQGFsaWFzIG1vZHVsZTpzZWFyY2hCb3guU2VhcmNoQm94VmlldyN1cGRhdGVRdWVyeU1vZGVsQ2xpY2sNCiAgICAgICAgICAgICovDQogICAgICAgICAgICB1cGRhdGVRdWVyeU1vZGVsQ2xpY2s6IGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7DQoNCiAgICAgICAgICAgICAgICBYQS5jb21wb25lbnQuc2VhcmNoLnZlbnQudHJpZ2dlcigibmV3LXNlYXJjaCIpOw0KDQogICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gdGhpcy4kZWwuZmluZCgiLnNlYXJjaC1ib3gtaW5wdXQudHQtaW5wdXQiKS52YWwoKTsNCiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlRHJvcGRvd24oKTsNCiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVF1ZXJ5TW9kZWwocXVlcnkpOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogVXBkYXRlcyBoYXNoIGJhc2VkIG9uIHNlYXJjaFZhbHVlDQogICAgICAgICAgICAgKiBAbWVtYmVyb2YgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hWaWV3DQogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gcXVlcnkgalF1ZXJ5IGV2ZW50IG9iamVjdA0KICAgICAgICAgICAgICogQGFsaWFzIG1vZHVsZTpzZWFyY2hCb3guU2VhcmNoQm94VmlldyN1cGRhdGVRdWVyeU1vZGVsDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIHVwZGF0ZVF1ZXJ5TW9kZWw6IGZ1bmN0aW9uIChxdWVyeSkgew0KICAgICAgICAgICAgICAgIHZhciBzZWFyY2hWYWx1ZSA9IHt9LA0KICAgICAgICAgICAgICAgICAgICBvZmZzZXRTaWduYXR1cmVzID0gdGhpcy50cmFuc2xhdGVTaWduYXR1cmVzKHRoaXMubW9kZWwuZ2V0KCJkYXRhUHJvcGVydGllcyIpLnNlYXJjaFJlc3VsdHNTaWduYXR1cmUsICJlIiksDQogICAgICAgICAgICAgICAgICAgIHNpZyA9IHRoaXMubW9kZWwuZ2V0KCJzaWciKSwNCiAgICAgICAgICAgICAgICAgICAgaTsNCg0KICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzaWcubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgc2VhcmNoVmFsdWVbc2lnW2ldXSA9IHF1ZXJ5Ow0KICAgICAgICAgICAgICAgICAgICBzZWFyY2hWYWx1ZVtvZmZzZXRTaWduYXR1cmVzW2ldXSA9IDA7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgcXVlcnlNb2RlbC51cGRhdGVIYXNoKHNlYXJjaFZhbHVlLCB0aGlzLm1vZGVsLmdldCgiZGF0YVByb3BlcnRpZXMiKS50YXJnZXRVcmwpOw0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgKiBDYWxscyBbInBlcmZvcm1TZWFyY2giXXtAbGluayBtb2R1bGU6c2VhcmNoQm94LlNlYXJjaEJveFZpZXcjcGVyZm9ybVNlYXJjaH0gDQogICAgICAgICAgICAqIGJ5IHByZXNzaW5nIEVudGVyIGtleQ0KICAgICAgICAgICAgKiBAbWVtYmVyb2YgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hWaWV3DQogICAgICAgICAgICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50IEV2ZW50IG9iamVjdA0KICAgICAgICAgICAgKiBAYWxpYXMgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hWaWV3I3ByZWRpY3RpdmVTZWFyY2gNCiAgICAgICAgICAgICovDQogICAgICAgICAgICBwcmVkaWN0aXZlU2VhcmNoOiBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHsNCiAgICAgICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5wZXJmb3JtU2VhcmNoKHRoaXMuJGVsLmZpbmQoIi5zZWFyY2gtYm94LWlucHV0LnR0LWlucHV0IikudmFsKCkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIE1ha2VzIHNlYXJjaA0KICAgICAgICAgICAgICogQG1lbWJlcm9mIG1vZHVsZTpzZWFyY2hCb3guU2VhcmNoQm94Vmlldw0KICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHF1ZXJ5IHZhbHVlIGZyb20gc2VhcmNoIGJveA0KICAgICAgICAgICAgICogQGFsaWFzIG1vZHVsZTpzZWFyY2hCb3guU2VhcmNoQm94VmlldyNwZXJmb3JtU2VhcmNoDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIHBlcmZvcm1TZWFyY2g6IGZ1bmN0aW9uIChxdWVyeSkgew0KICAgICAgICAgICAgICAgIHZhciBwcm9wZXJ0aWVzID0gdGhpcy5tb2RlbC5nZXQoImRhdGFQcm9wZXJ0aWVzIiksDQogICAgICAgICAgICAgICAgICAgIHRhcmdldFNpZ25hdHVyZSA9IHByb3BlcnRpZXMudGFyZ2V0U2lnbmF0dXJlLA0KICAgICAgICAgICAgICAgICAgICBzZWFyY2hSZXN1bHRzU2lnbmF0dXJlID0gcHJvcGVydGllcy5zZWFyY2hSZXN1bHRzU2lnbmF0dXJlLA0KICAgICAgICAgICAgICAgICAgICByZXN1bHRQYWdlID0gcHJvcGVydGllcy5yZXN1bHRQYWdlLA0KICAgICAgICAgICAgICAgICAgICBzaWcgPSB0aGlzLm1vZGVsLmdldCgic2lnIiksDQogICAgICAgICAgICAgICAgICAgIHF1ZXJ5V2l0aFNpZ25hdHVyZSA9IHt9Ow0KDQogICAgICAgICAgICAgICAgWEEuY29tcG9uZW50LnNlYXJjaC52ZW50LnRyaWdnZXIoIm5ldy1zZWFyY2giKTsNCg0KICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VEcm9wZG93bigpOw0KDQogICAgICAgICAgICAgICAgaWYgKHJlc3VsdFBhZ2UgPT09ICIiKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlUXVlcnlNb2RlbChxdWVyeSk7DQogICAgICAgICAgICAgICAgICAgICQoJy5zZWFyY2gtYm94LWlucHV0JykudHlwZWFoZWFkKCd2YWwnLCBxdWVyeSk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgcXVlcnkgPSBlbmNvZGVVUklDb21wb25lbnQocXVlcnkpOw0KICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0U2lnbmF0dXJlICE9PSAiIikgew0KICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlXaXRoU2lnbmF0dXJlID0gdGhpcy51cGRhdGVTaWduYXR1cmVzSGFzaChbdGFyZ2V0U2lnbmF0dXJlICsgIl9xIl0sIHF1ZXJ5LCB0aGlzLmNyZWF0ZU9mZnNldE9iamVjdCgpKQ0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlXaXRoU2lnbmF0dXJlID0gdGhpcy51cGRhdGVTaWduYXR1cmVzSGFzaChzaWcsIHF1ZXJ5LCB0aGlzLmNyZWF0ZU9mZnNldE9iamVjdCgpKQ0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gdXJsSGVscGVyTW9kZWwuY3JlYXRlUmVkaXJlY3RTZWFyY2hVcmwocmVzdWx0UGFnZSwgcXVlcnlXaXRoU2lnbmF0dXJlLCBzZWFyY2hSZXN1bHRzU2lnbmF0dXJlLCB0YXJnZXRTaWduYXR1cmUpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIENyZWF0ZXMgb2JqZWN0IHRoYXQgY29udGFpbiBzaWduYXR1cmVzDQogICAgICAgICAgICAgKiBAbWVtYmVyb2YgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hWaWV3DQogICAgICAgICAgICAgKiBAYWxpYXMgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hWaWV3I2NyZWF0ZU9mZnNldE9iamVjdA0KICAgICAgICAgICAgICovDQogICAgICAgICAgICBjcmVhdGVPZmZzZXRPYmplY3Q6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICB2YXIgc2lnID0gdGhpcy5tb2RlbC5nZXQoInNpZyIpLA0KICAgICAgICAgICAgICAgICAgICB0YXJnZXRTaWduYXR1cmUgPSB0aGlzLm1vZGVsLmdldCgiZGF0YVByb3BlcnRpZXMiKS50YXJnZXRTaWduYXR1cmUsDQogICAgICAgICAgICAgICAgICAgIHNpZ25hdHVyZSA9IHRhcmdldFNpZ25hdHVyZSAhPT0gIiIgPyB0YXJnZXRTaWduYXR1cmUgOiB0aGlzLm1vZGVsLmdldCgiZGF0YVByb3BlcnRpZXMiKS5zZWFyY2hSZXN1bHRzU2lnbmF0dXJlLA0KICAgICAgICAgICAgICAgICAgICBvZmZzZXRTaWduYXR1cmVzID0gdGhpcy50cmFuc2xhdGVTaWduYXR1cmVzKHNpZ25hdHVyZSwgImUiKSwNCiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0T2JqZWN0ID0ge30sDQogICAgICAgICAgICAgICAgICAgIGk7DQoNCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2lnLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIG9mZnNldE9iamVjdFtvZmZzZXRTaWduYXR1cmVzW2ldXSA9IDA7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuIG9mZnNldE9iamVjdDsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIFNldHMgdmFsdWUgaW50byBzZWFyY2ggYm94IGJhc2VkIG9uIGhhc2ggDQogICAgICAgICAgICAgKiBAbWVtYmVyb2YgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hWaWV3DQogICAgICAgICAgICAgKiBAYWxpYXMgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hWaWV3I3VwZGF0ZVNlYXJjaEJveFZhbHVlDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIHVwZGF0ZVNlYXJjaEJveFZhbHVlOiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgdmFyIGhhc2hPYmogPSBxdWVyeU1vZGVsLnBhcnNlSGFzaFBhcmFtZXRlcnMod2luZG93LmxvY2F0aW9uLmhhc2gpLA0KICAgICAgICAgICAgICAgICAgICBlbCA9IHRoaXMuJGVsLmZpbmQoIi5zZWFyY2gtYm94LWlucHV0LnR0LWlucHV0IiksDQogICAgICAgICAgICAgICAgICAgIHNpZyA9IHRoaXMubW9kZWwuZ2V0KCJzaWciKSwNCiAgICAgICAgICAgICAgICAgICAgaTsNCg0KICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzaWcubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKGhhc2hPYmouaGFzT3duUHJvcGVydHkoc2lnW2ldKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgZWwudmFsKGRlY29kZVVSSUNvbXBvbmVudChoYXNoT2JqW3NpZ1tpXV0pKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsLnZhbCgiIik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBDbG9zZXMgdHlwZWFoZWFkIGRyb3AgZG93bg0KICAgICAgICAgICAgICogQG1lbWJlcm9mIG1vZHVsZTpzZWFyY2hCb3guU2VhcmNoQm94Vmlldw0KICAgICAgICAgICAgICogQGFsaWFzIG1vZHVsZTpzZWFyY2hCb3guU2VhcmNoQm94VmlldyNjbG9zZURyb3Bkb3duDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGNsb3NlRHJvcGRvd246IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICB0aGlzLiRlbC5maW5kKCIuc2VhcmNoLWJveC1pbnB1dCIpLnR5cGVhaGVhZCgnY2xvc2UnKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgLyoqDQogICAgICogRm9yIGVhY2ggc2VhcmNoIGJveCBvbiBhIHBhZ2UgY3JlYXRlcyBpbnN0YW5jZSBvZiANCiAgICAgKiBbInNlYXJjaEJveE1vZGVsIl17QGxpbmsgbW9kdWxlOnNlYXJjaEJveC5TZWFyY2hCb3hNb2RlbH0gYW5kIA0KICAgICAqIFsiU2VhcmNoQm94VmlldyJde0BsaW5rIG1vZHVsZTpzZWFyY2hCb3guU2VhcmNoQm94Vmlld30gDQogICAgICogQG1lbWJlck9mIG1vZHVsZTpzZWFyY2hCb3gNCiAgICAgKiBAYWxpYXMgbW9kdWxlOnNlYXJjaEJveC5pbml0DQogICAgICovDQogICAgYXBpLmluaXQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIGlmICgkKCJib2R5IikuaGFzQ2xhc3MoIm9uLXBhZ2UtZWRpdG9yIikpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KICAgICAgICBxdWVyeU1vZGVsID0gWEEuY29tcG9uZW50LnNlYXJjaC5xdWVyeTsNCiAgICAgICAgc2VhcmNoUmVzdWx0TW9kZWxzID0gWEEuY29tcG9uZW50LnNlYXJjaC5yZXN1bHRzLnNlYXJjaFJlc3VsdE1vZGVsczsNCiAgICAgICAgdXJsSGVscGVyTW9kZWwgPSBYQS5jb21wb25lbnQuc2VhcmNoLnVybDsNCg0KICAgICAgICB2YXIgc2VhcmNoQm94ID0gJCgiLnNlYXJjaC1ib3g6bm90KC5pbml0aWFsaXplZCkiKTsNCg0KICAgICAgICBfLmVhY2goc2VhcmNoQm94LCBmdW5jdGlvbiAoZWxlbSkgew0KICAgICAgICAgICAgdmFyICRlbCA9ICQoZWxlbSksDQogICAgICAgICAgICAgICAgYm94TW9kZWwgPSBuZXcgU2VhcmNoQm94TW9kZWwoKTsNCg0KICAgICAgICAgICAgc2VhcmNoQm94TW9kZWxzLnB1c2goYm94TW9kZWwpOw0KICAgICAgICAgICAgc2VhcmNoQm94Vmlld3MucHVzaChuZXcgU2VhcmNoQm94Vmlldyh7IGVsOiAkZWwsIG1vZGVsOiBib3hNb2RlbCB9KSk7DQogICAgICAgICAgICAkZWwuYWRkQ2xhc3MoImluaXRpYWxpemVkIik7DQogICAgICAgIH0pOw0KICAgIH07DQogICAgLyoqDQogICAgKiBFeHRlbmRzIHNlYXJjaCBib3ggQVBJIHdpdGggDQogICAgKiBbInNlYXJjaEJveFZpZXdzIl17QGxpbmsgbW9kdWxlOnNlYXJjaEJveC5zZWFyY2hCb3hWaWV3c30gDQogICAgKiBAbWVtYmVyT2YgbW9kdWxlOnNlYXJjaEJveA0KICAgICogQGFsaWFzIG1vZHVsZTpzZWFyY2hCb3guc2VhcmNoQm94Vmlld3MNCiAgICAqLw0KICAgIGFwaS5zZWFyY2hCb3hWaWV3cyA9IHNlYXJjaEJveFZpZXdzOw0KICAgIC8qKg0KKiBFeHRlbmRzIHNlYXJjaCBib3ggQVBJIHdpdGggDQoqIFsic2VhcmNoQm94TW9kZWxzIl17QGxpbmsgbW9kdWxlOnNlYXJjaEJveC5zZWFyY2hCb3hNb2RlbHN9IA0KKiBAbWVtYmVyT2YgbW9kdWxlOnNlYXJjaEJveA0KKiBAYWxpYXMgbW9kdWxlOnNlYXJjaEJveC5zZWFyY2hCb3hWaWV3cw0KKi8NCiAgICBhcGkuc2VhcmNoQm94TW9kZWxzID0gc2VhcmNoQm94TW9kZWxzOw0KDQogICAgcmV0dXJuIGFwaTsNCg0KfShqUXVlcnksIGRvY3VtZW50KSk7DQoNClhBLnJlZ2lzdGVyKCdzZWFyY2hCb3gnLCBYQS5jb21wb25lbnQuc2VhcmNoLmJveCk7DQo=
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 21203
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "ba3f86a2-4a1c-4d78-b63d-91c2779c1b5e"
  Hint: __Sortorder
  Value: 400
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20160728T134136Z
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\admin
