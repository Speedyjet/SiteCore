---
ID: "e133037d-5b3e-4a10-8f63-2613e4189eca"
Parent: "dfcbfa5a-2e37-418a-adb7-f411ecae89a9"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Base Themes/SearchTheme/Scripts/component-search-location-filter"
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/E133037D5B3E4A108F632613E4189ECA.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  Value: 77u/LyoqDQogKiBMb2NhdGlvbiBmaWx0ZXIgY29tcG9uZW50IGZ1bmN0aW9uYWxpdHkNCiAqIEBtb2R1bGUgbG9jYXRpb25maWx0ZXINCiAqIEBwYXJhbSAge2pRdWVyeX0gJCBJbnN0YW5jZSBvZiBqUXVlcnkNCiAqIEBwYXJhbSAge0RvY3VtZW50fSBkb2N1bWVudCBkb20gZG9jdW1lbnQgb2JqZWN0DQogKiBAcmV0dXJuIHtPYmplY3R9IGxpc3Qgb2YgbWV0aG9kcyBmb3Igd29ya2luZyB3aXRoIGxvY2F0aW9uIGZpbHRlcg0KKi8NClhBLmNvbXBvbmVudC5zZWFyY2gubG9jYXRpb25maWx0ZXIgPSAoZnVuY3Rpb24gKCQsIGRvY3VtZW50KSB7DQoNCiAgICAidXNlIHN0cmljdCI7DQogIC8qKg0KICAgICogVGhpcyBvYmplY3Qgc3RvcmVzIGFsbCBwdWJsaWMgYXBpIG1ldGhvZHMNCiAgICAqIEB0eXBlIHtPYmplY3QuPE1ldGhvZHM+fQ0KICAgICogQG1lbWJlck9mIG1vZHVsZTpsb2NhdGlvbmZpbHRlcg0KICAgICovDQogICAgdmFyIGFwaSA9IHt9LA0KICAgICAgICBsb2NhdGlvbkZpbHRlcnMgPSBbXSwNCiAgICAgICAgdmlld3MgPSBbXSwNCiAgICAgICAgcXVlcnlNb2RlbCwNCiAgICAgICAgdXJsSGVscGVyTW9kZWwsDQogICAgICAgIHNjcmlwdHNMb2FkZWQgPSBmYWxzZSwNCiAgICAgICAgbWFwc0Nvbm5lY3RvciA9IFhBLmNvbm5lY3Rvci5tYXBzQ29ubmVjdG9yLA0KICAgICAgICBMb2NhdGlvbkZpbHRlck1vZGVsLA0KICAgICAgICBMb2NhdGlvbkZpbHRlclZpZXcsDQogICAgICAgIGluaXRpYWxpemU7DQoJLyoqDQogICAgICogQG1lbWJlck9mIG1vZHVsZTpsb2NhdGlvbmZpbHRlcg0KICAgICAqIEBhbGlhcyBtb2R1bGU6bG9jYXRpb25maWx0ZXIuaW5pdGlhbGl6ZQ0KICAgICAqIEZvciBlYWNoIGxvY2F0aW9uIGZpbHRlciBjb21wb25lbnQgb24gYSBwYWdlIGNyZWF0ZXMgaW5zdGFuY2Ugb2YgDQogICAgICogWyJMb2NhdGlvbkZpbHRlck1vZGVsIl17QGxpbmsgbW9kdWxlOmxvY2F0aW9uZmlsdGVyLkxvY2F0aW9uRmlsdGVyTW9kZWx9IGFuZCANCiAgICAgKiBbIkxvY2F0aW9uRmlsdGVyVmlldyJde0BsaW5rIG1vZHVsZTpsb2NhdGlvbmZpbHRlci5Mb2NhdGlvbkZpbHRlclZpZXd9IA0KICAgICAqIEBwcml2YXRlDQogICAgICovDQogICAgaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgaSwgdmlldzsNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxvY2F0aW9uRmlsdGVycy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgLy9jcmVhdGVzIEJhY2tib25lLmpzIHZpZXdzIC0gb25lIHZpZXcgcGVyIGNvbXBvbmVudCBvbiB0aGUgcGFnZQ0KICAgICAgICAgICAgdmlldyA9IG5ldyBMb2NhdGlvbkZpbHRlclZpZXcoe2VsOiBsb2NhdGlvbkZpbHRlcnNbaV0sIG1vZGVsOiBuZXcgTG9jYXRpb25GaWx0ZXJNb2RlbCgpfSk7DQogICAgICAgIH0NCiAgICB9Ow0KCS8qKg0KICAgICogQG5hbWUgbW9kdWxlOmxvY2F0aW9uZmlsdGVyLkxvY2F0aW9uRmlsdGVyTW9kZWwNCiAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICogQGF1Z21lbnRzIEJhY2tib25lLk1vZGVsDQogICAgKi8NCiAgICBMb2NhdGlvbkZpbHRlck1vZGVsID0gQmFja2JvbmUuTW9kZWwuZXh0ZW5kKA0KCSAgICAgICAgLyoqIEBsZW5kcyBtb2R1bGU6bG9jYXRpb25maWx0ZXIuTG9jYXRpb25GaWx0ZXJNb2RlbC5wcm90b3R5cGUgKiovDQoJew0KCQkvKioNCiAgICAgICAgKiBEZWZhdWx0IG1vZGVsIG9wdGlvbnMNCiAgICAgICAgKiBAZGVmYXVsdA0KICAgICAgICAqLw0KICAgICAgICBkZWZhdWx0czogew0KICAgICAgICAgICAgZGF0YVByb3BlcnRpZXM6IHt9LA0KICAgICAgICAgICAgc2lnOiBbXQ0KICAgICAgICB9LA0KCQkvKioNCiAgICAgICAgKiBJbml0aWFsaXplcyBbIkJsb29kaG91bmQiXXtAbGluayBodHRwczovL2dpdGh1Yi5jb20vdHdpdHRlci90eXBlYWhlYWQuanMvYmxvYi9tYXN0ZXIvZG9jL2Jsb29kaG91bmQubWR9DQogICAgICAgICogc3VnZ2VzdGlvbiBlbmdpbmUgd2l0aCBkYXRhUHJvcGVydGllcyBkYXRhDQogICAgICAgICogQG1lbWJlcm9mIG1vZHVsZTpsb2NhdGlvbmZpbHRlci5Mb2NhdGlvbkZpbHRlck1vZGVsDQogICAgICAgICogQGFsaWFzIG1vZHVsZTpsb2NhdGlvbmZpbHRlci5Mb2NhdGlvbkZpbHRlck1vZGVsI2luaXRBdXRvY29tcGxldGVFbmdpbmUNCiAgICAgICAgKi8NCiAgICAgICAgaW5pdEF1dG9jb21wbGV0ZUVuZ2luZSA6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgdmFyIF90aGlzID0gdGhpcywNCiAgICAgICAgICAgICAgICBzZWFyY2hFbmdpbmU7DQoNCiAgICAgICAgICAgIC8vaW5pdGlhbGl6ZXMgcHJlZGljdGl2ZSBvbmx5IHdoZW4gbnVtYmVyIG9mIHByZWRpY3Rpb25zIGlzIG5vdCB6ZXJvDQogICAgICAgICAgICBpZihfdGhpcy5nZXQoImRhdGFQcm9wZXJ0aWVzIikucCA+IDApew0KICAgICAgICAgICAgICAgICAgICBzZWFyY2hFbmdpbmUgPSBuZXcgQmxvb2Rob3VuZCh7DQogICAgICAgICAgICAgICAgICAgICAgICBkYXR1bVRva2VuaXplcjogQmxvb2Rob3VuZC50b2tlbml6ZXJzLm9iai53aGl0ZXNwYWNlKCJuYW1lIiksDQogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeVRva2VuaXplcjogQmxvb2Rob3VuZC50b2tlbml6ZXJzLndoaXRlc3BhY2UsDQogICAgICAgICAgICAgICAgICAgICAgICBsaW1pdCA6ICBfdGhpcy5nZXQoImRhdGFQcm9wZXJ0aWVzIikucCwNCiAgICAgICAgICAgICAgICAgICAgICAgIHJlbW90ZSA6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1cmwgOiAiLSIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZSA6IGZ1bmN0aW9uKCl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBEYXRlLm5vdygpLnRvU3RyaW5nKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc3BvcnQgOiBmdW5jdGlvbihvcHRpb25zLCBvblN1Y2Nlc3MsIG9uRXJyb3Ipew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcXVlcnlQYXJhbXMgPSAgX3RoaXMuZ2V0KCJxdWVyeVBhcmFtcyIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighcXVlcnlQYXJhbXMudGV4dCl7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvblN1Y2Nlc3MoW10pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcHNDb25uZWN0b3IubG9jYXRpb25BdXRvY29tcGxldGUocXVlcnlQYXJhbXMsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAocmVzdWx0cykgeyAvL3N1Y2Nlc3MNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2ltcGxpZmllZFJlc3VsdHMgPSByZXN1bHRzLm1hcChmdW5jdGlvbihyZXN1bHQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5oYXNPd25Qcm9wZXJ0eSgidGV4dCIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0LnRleHQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uU3VjY2VzcyhzaW1wbGlmaWVkUmVzdWx0cyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oKXsgLy9mYWlsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25FcnJvcigiQ291bGQgbm90IGF1dG9jb21wbGV0ZSIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgIHNlYXJjaEVuZ2luZS5pbml0aWFsaXplKCk7DQogICAgICAgICAgICAgICAgdGhpcy5zZXQoeyJzZWFyY2hFbmdpbmUiIDogc2VhcmNoRW5naW5lfSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9KTsNCiAgICAvKioNCiAgICAqIEBuYW1lIG1vZHVsZTpsb2NhdGlvbmZpbHRlci5Mb2NhdGlvbkZpbHRlclZpZXcNCiAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICogQGF1Z21lbnRzIEJhY2tib25lLlZpZXcNCiAgICAqLw0KICAgIExvY2F0aW9uRmlsdGVyVmlldyA9IFhBLmNvbXBvbmVudC5zZWFyY2guYmFzZVZpZXcuZXh0ZW5kKA0KCSAgICAvKiogQGxlbmRzIG1vZHVsZTpsb2NhdGlvbmZpbHRlci5Mb2NhdGlvbkZpbHRlclZpZXcucHJvdG90eXBlICoqLw0KCXsNCgkJLyoqDQogICAgICAgICogSW5pdGlhbGx5IHNldHMgZGF0YSB0byBtb2RlbCwgaW5pdGlhbGl6ZXMgdHlwZWFoZWFkLmpzLCBhbmQgd2F0Y2hlcyBldmVudHMgb24gd2hpY2gNCiAgICAgICAgKiB2aWV3IHNob3VsZCBiZSB1cGRhdGVkDQogICAgICAgICogQG1lbWJlcm9mIG1vZHVsZTpsb2NhdGlvbmZpbHRlci5Mb2NhdGlvbkZpbHRlclZpZXcNCiAgICAgICAgKi8NCiAgICAgICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGluc3QgPSB0aGlzLA0KICAgICAgICAgICAgICAgIGRhdGFQcm9wZXJ0aWVzID0gdGhpcy4kZWwuZGF0YSgpLA0KICAgICAgICAgICAgICAgICR0ZXh0Qm94ID0gdGhpcy4kZWwuZmluZCgiLmxvY2F0aW9uLXNlYXJjaC1ib3gtaW5wdXQiKSwNCiAgICAgICAgICAgICAgICBzaWduYXR1cmVzID0gZGF0YVByb3BlcnRpZXMucHJvcGVydGllcy5zZWFyY2hSZXN1bHRzU2lnbmF0dXJlLnNwbGl0KCcsJyk7DQoNCiAgICAgICAgICAgIGlmIChkYXRhUHJvcGVydGllcy5wcm9wZXJ0aWVzLnNlYXJjaFJlc3VsdHNTaWduYXR1cmUgPT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICBkYXRhUHJvcGVydGllcy5wcm9wZXJ0aWVzLnNlYXJjaFJlc3VsdHNTaWduYXR1cmUgPSAiIjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgdGhpcy5tb2RlbC5zZXQoeyBkYXRhUHJvcGVydGllczogZGF0YVByb3BlcnRpZXMucHJvcGVydGllcyB9KTsNCiAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KHsgc2lnOiBzaWduYXR1cmVzfSk7DQogICAgICAgICAgICB0aGlzLm1vZGVsLnNldCh7IHF1ZXJ5UGFyYW1zOiB7IG1heFJlc3VsdHM6IGRhdGFQcm9wZXJ0aWVzLnAsIHRleHQ6ICIiIH0gfSk7DQogICAgICAgICAgICB0aGlzLm1vZGVsLmluaXRBdXRvY29tcGxldGVFbmdpbmUoKTsNCg0KICAgICAgICAgICAgdmFyIGF1dG9jb21wbGV0ZUVuZ2luZSA9IHRoaXMubW9kZWwuZ2V0KCJzZWFyY2hFbmdpbmUiKTsNCg0KICAgICAgICAgICAgaWYoYXV0b2NvbXBsZXRlRW5naW5lKXsNCiAgICAgICAgICAgICAgICAkdGV4dEJveC50eXBlYWhlYWQoew0KICAgICAgICAgICAgICAgICAgICBoaW50IDogdHJ1ZSwNCiAgICAgICAgICAgICAgICAgICAgbWluTGVuZ3RoIDogMg0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgew0KICAgICAgICAgICAgICAgICAgICBzb3VyY2UgOiBhdXRvY29tcGxldGVFbmdpbmUudHRBZGFwdGVyKCksDQogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlcyA6IHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHN1Z2dlc3Rpb24gOiBmdW5jdGlvbihkYXRhKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICc8ZGl2IGNsYXNzPSJzdWdnZXN0aW9uLWl0ZW0iPicgKyBkYXRhICsgJzwvZGl2Pic7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9KS5vbigidHlwZWFoZWFkOnNlbGVjdGVkIixmdW5jdGlvbihhcmdzLCBzZWxlY3RlZCl7DQogICAgICAgICAgICAgICAgICAgIGluc3QudHJhbnNsYXRlVXNlckxvY2F0aW9uKHNlbGVjdGVkKTsNCiAgICAgICAgICAgICAgICAgICAgJHRleHRCb3gudHlwZWFoZWFkKCJ2YWwiLCBzZWxlY3RlZCk7DQogICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHRoaXMuYWRkcmVzc0xvb2t1cCh0cnVlKTsNCg0KICAgICAgICAgICAgWEEuY29tcG9uZW50LnNlYXJjaC52ZW50Lm9uKCJoYXNoQ2hhbmdlZCIsIGZ1bmN0aW9uKGhhc2gpIHsNCiAgICAgICAgICAgICAgICB2YXIgYWRkcmVzcyA9IGhhc2hbc2lnbmF0dXJlcy5sZW5ndGggPiAwICYmIHNpZ25hdHVyZXNbMF0gIT09ICIiID8gc2lnbmF0dXJlc1swXSArICJfYSIgOiAiYSJdOw0KICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYWRkcmVzcyAhPT0gInVuZGVmaW5lZCIgJiYgYWRkcmVzcyAhPT0gbnVsbCAmJiBhZGRyZXNzICE9PSAiIikgew0KICAgICAgICAgICAgICAgICAgICAkdGV4dEJveC52YWwoYWRkcmVzcyk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0sDQoJCS8qKg0KICAgICAgICAqIGxpc3Qgb2YgZXZlbnRzIGZvciBCYWNrYm9uZSBWaWV3DQogICAgICAgICogQG1lbWJlcm9mIG1vZHVsZTpsb2NhdGlvbmZpbHRlci5Mb2NhdGlvbkZpbHRlclZpZXcNCiAgICAgICAgKiBAYWxpYXMgbW9kdWxlOmxvY2F0aW9uZmlsdGVyLkxvY2F0aW9uRmlsdGVyVmlldyNldmVudHMNCiAgICAgICAgKi8NCiAgICAgICAgZXZlbnRzOiB7DQogICAgICAgICAgICAiY2xpY2sgLmxvY2F0aW9uLXNlYXJjaC1ib3gtYnV0dG9uIjogImFkZHJlc3NMb29rdXAiLA0KICAgICAgICAgICAgImtleXByZXNzIC5sb2NhdGlvbi1zZWFyY2gtYm94LWlucHV0IjogInNlYXJjaFRleHRDaGFuZ2VzIiwNCiAgICAgICAgICAgICJrZXl1cCAubG9jYXRpb24tc2VhcmNoLWJveC1pbnB1dCIgOiAiYXV0b2NvbXBsZXRlIg0KICAgICAgICB9LA0KCQkvKioNCiAgICAgICAgKiBMb29rcyBmb3IgYW4gYWRkcmVzcyBiYXNlZCBvbiBhIHZhbHVlIHRoYXQgaXMgc3BlY2lmaWVkIGJ5IHVzZXINCiAgICAgICAgKiBpbiBpbnB1dA0KICAgICAgICAqIEBtZW1iZXJvZiBtb2R1bGU6bG9jYXRpb25maWx0ZXIuTG9jYXRpb25GaWx0ZXJWaWV3DQogICAgICAgICogQGFsaWFzIG1vZHVsZTpsb2NhdGlvbmZpbHRlci5Mb2NhdGlvbkZpbHRlclZpZXcjYWRkcmVzc0xvb2t1cA0KICAgICAgICAqLw0KICAgICAgICBhZGRyZXNzTG9va3VwOiBmdW5jdGlvbihpc0luaXRpYWxSZW5kZXIpew0KICAgICAgICAgICAgdmFyIHByb3BlcnRpZXMgPSB0aGlzLm1vZGVsLmdldCgiZGF0YVByb3BlcnRpZXMiKSwNCiAgICAgICAgICAgICAgICBsb29rdXBRdWVyeSA9IHsNCiAgICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy5nZXRBZGRyZXNzKGlzSW5pdGlhbFJlbmRlciksDQogICAgICAgICAgICAgICAgICAgIG1heFJlc3VsdHM6IDENCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIGhhc2hPYmo7DQoNCiAgICAgICAgICAgIGlmIChsb29rdXBRdWVyeS50ZXh0ID09PSAiIikgew0KICAgICAgICAgICAgICAgIGhhc2hPYmogPSB0aGlzLmNyZWF0ZUhhc2hPYmplY3QoIiIsICIiLCAiIik7DQogICAgICAgICAgICAgICAgdGhpcy51cGRhdGVIYXNoKGhhc2hPYmosIHByb3BlcnRpZXMpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBzd2l0Y2ggKHByb3BlcnRpZXMubW9kZSkgew0KICAgICAgICAgICAgICAgIGNhc2UgIkxvY2F0aW9uIjogew0KICAgICAgICAgICAgICAgICAgICAvL1VzZXMgYnJvd3NlciB0byBkZXRlY3QgbG9jYXRpb24NCiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZXRlY3RMb2NhdGlvbigpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2FzZSAiVXNlclByb3ZpZGVkIjogew0KICAgICAgICAgICAgICAgICAgICAvL1Rha2VzIGFkZHJlc3MgZW50ZXJlZCBieSB1c2VyIGFuZCB0cmllcyB0byBjb252ZXJ0IGl0IHRvIGxhdGl0dWRlIGFuZCBsb25naXR1ZGUNCiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmFuc2xhdGVVc2VyTG9jYXRpb24obG9va3VwUXVlcnkpOw0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgY2FzZSAiTWl4ZWQiOiB7DQogICAgICAgICAgICAgICAgICAgIC8vVXNlcyB1c2VyIGFkZHJlc3Mgb3IgdHJpZXMgdG8gZGV0ZWN0IGxvY2F0aW9uIGJ5IGJyb3dzZXINCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZihsb29rdXBRdWVyeS50ZXh0KSA9PT0gInVuZGVmaW5lZCIgfHwgbG9va3VwUXVlcnkudGV4dCA9PT0gIiIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZGV0ZWN0TG9jYXRpb24oKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudHJhbnNsYXRlVXNlckxvY2F0aW9uKGxvb2t1cFF1ZXJ5KTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0sDQoJCS8qKg0KICAgICAgICAqIEdldCBBZGRyZXNzIGZyb20gaW5wdXQgb3IgZnJvbSBoYXNoIA0KICAgICAgICAqIEBtZW1iZXJvZiBtb2R1bGU6bG9jYXRpb25maWx0ZXIuTG9jYXRpb25GaWx0ZXJWaWV3DQogICAgICAgICogQGFsaWFzIG1vZHVsZTpsb2NhdGlvbmZpbHRlci5Mb2NhdGlvbkZpbHRlclZpZXcjZ2V0QWRkcmVzcw0KICAgICAgICAqIEByZXR1cm5zIHtTdHJpbmd9IGFkZHJlc3MgZnJvbSBpbnB1dCBvciBoYXNoIA0KICAgICAgICAqLw0KICAgICAgICBnZXRBZGRyZXNzOiBmdW5jdGlvbiAoaXNJbml0aWFsUmVuZGVyKSB7DQogICAgICAgICAgICB2YXIgJHRleHRCb3ggPSB0aGlzLiRlbC5maW5kKCIubG9jYXRpb24tc2VhcmNoLWJveC1pbnB1dC50dC1pbnB1dCIpLA0KICAgICAgICAgICAgICAgIHRleHQgPSAkdGV4dEJveC5sZW5ndGggIT09IDAgPyAkdGV4dEJveC52YWwoKSA6IHRoaXMuJGVsLmZpbmQoIi5sb2NhdGlvbi1zZWFyY2gtYm94LWlucHV0IikudmFsKCksDQogICAgICAgICAgICAgICAgaGFzaCA9IHF1ZXJ5TW9kZWwucGFyc2VIYXNoUGFyYW1ldGVycyh3aW5kb3cubG9jYXRpb24uaGFzaCksDQogICAgICAgICAgICAgICAgc2lnbmF0dXJlcyA9IHRoaXMubW9kZWwuZ2V0KCJzaWciKSwNCiAgICAgICAgICAgICAgICBhZGRyZXNzOw0KDQogICAgICAgICAgICBpZiAoaXNJbml0aWFsUmVuZGVyICE9PSB0cnVlICYmICh0ZXh0ID09PSAiIiB8fCB0eXBlb2YgdGV4dCA9PT0gInVuZGVmaW5lZCIpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICIiOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAodGV4dCA9PT0gIiIgfHwgdHlwZW9mIHRleHQgPT09ICJ1bmRlZmluZWQiKSB7DQogICAgICAgICAgICAgICAgYWRkcmVzcyA9IGhhc2hbc2lnbmF0dXJlcy5sZW5ndGggPiAwICYmIHNpZ25hdHVyZXNbMF0gIT09ICIiID8gc2lnbmF0dXJlc1swXSArICJfYSIgOiAiYSJdOw0KICAgICAgICAgICAgICAgIGlmIChhZGRyZXNzICE9PSAiIikgew0KICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gYWRkcmVzczsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0ZXh0ID09PSAidW5kZWZpbmVkIikgew0KICAgICAgICAgICAgICAgICAgICB0ZXh0ID0gIiI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICByZXR1cm4gdGV4dDsNCiAgICAgICAgfSwNCgkJLyoqDQogICAgICAgICogR2V0cyB0ZXh0IHNlbGVjdGVkIGZyb20gdHlwZWFoZWFkIHN1Z2dlc3Rpb24gYW5kIHNldHMgdG8gbW9kZWwNCiAgICAgICAgKiBAcGFyYW0ge0V2ZW50fSBhcmdzIEV2ZW50IG9iamVjdA0KICAgICAgICAqIEBtZW1iZXJvZiBtb2R1bGU6bG9jYXRpb25maWx0ZXIuTG9jYXRpb25GaWx0ZXJWaWV3DQogICAgICAgICogQGFsaWFzIG1vZHVsZTpsb2NhdGlvbmZpbHRlci5Mb2NhdGlvbkZpbHRlclZpZXcjYXV0b2NvbXBsZXRlDQogICAgICAgICovDQogICAgICAgIGF1dG9jb21wbGV0ZSA6IGZ1bmN0aW9uKGFyZ3Mpew0KICAgICAgICAgICAgdmFyICR0ZXh0Qm94LA0KICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1zLA0KICAgICAgICAgICAgICAgIHByb3BlcnRpZXMgPSB0aGlzLm1vZGVsLmdldCgiZGF0YVByb3BlcnRpZXMiKTsNCg0KICAgICAgICAgICAgYXJncy5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgICAgIGlmIChhcmdzLmtleUNvZGUgPT09IDEzKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkdGV4dEJveCA9IHRoaXMuJGVsLmZpbmQoIi5sb2NhdGlvbi1zZWFyY2gtYm94LWlucHV0LnR0LWlucHV0Iik7DQoNCiAgICAgICAgICAgIHF1ZXJ5UGFyYW1zID0gew0KICAgICAgICAgICAgICAgIHRleHQgOiAkdGV4dEJveC5sZW5ndGggIT09IDAgPyAkdGV4dEJveC52YWwoKSA6IHRoaXMuJGVsLmZpbmQoIi5sb2NhdGlvbi1zZWFyY2gtYm94LWlucHV0IikudmFsKCksDQogICAgICAgICAgICAgICAgbWF4UmVzdWx0cyA6IHByb3BlcnRpZXMucA0KICAgICAgICAgICAgfTsNCiAgICAgICAgICAgIHRoaXMubW9kZWwuc2V0KHtxdWVyeVBhcmFtcyA6IHF1ZXJ5UGFyYW1zfSk7DQogICAgICAgIH0sDQoJCS8qKg0KICAgICAgICAqIElmIGVudGVyIHdhcyBwcmVzc2VkLCBtZXRob2QgY2FsbHMgWyJhZGRyZXNzTG9va3VwIl17QGxpbmsgbW9kdWxlOmxvY2F0aW9uZmlsdGVyLmFkZHJlc3NMb29rdXB9DQogICAgICAgICogQHBhcmFtIHtFdmVudH0gZSBFdmVudCBvYmplY3QNCiAgICAgICAgKiBAbWVtYmVyb2YgbW9kdWxlOmxvY2F0aW9uZmlsdGVyLkxvY2F0aW9uRmlsdGVyVmlldw0KICAgICAgICAqIEBhbGlhcyBtb2R1bGU6bG9jYXRpb25maWx0ZXIuTG9jYXRpb25GaWx0ZXJWaWV3I3NlYXJjaFRleHRDaGFuZ2VzDQogICAgICAgICogQHJldHVybnMge0Jvb2xlYW59ICBGYWxzZSBpZiBwcmVzc2VkIGVudGVyLiBBbGwgb3RoZXIgY2FzZXM6IFRydWUNCiAgICAgICAgKi8NCiAgICAgICAgc2VhcmNoVGV4dENoYW5nZXM6IGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7DQogICAgICAgICAgICBpZiAoZS5rZXlDb2RlID09PSAxMykgew0KICAgICAgICAgICAgICAgIHRoaXMuYWRkcmVzc0xvb2t1cChmYWxzZSk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgcmV0dXJuIHRydWU7DQogICAgICAgIH0sDQoJCS8qKg0KICAgICAgICAqIExvb2tzIGZvciBhbiBhZGRyZXNzIGFuZCBjYWxscyBbIlhBLmNvbm5lY3Rvci5tYXBzQ29ubmVjdG9yLmFkZHJlc3NMb29rdXAiXXtAbGluayBtb2R1bGU6WEEuY29ubmVjdG9yLm1hcHNDb25uZWN0b3IuYWRkcmVzc0xvb2t1cH0NCiAgICAgICAgKiBAcGFyYW0ge2pRdWVyeTxEb21FbGVtZW50Pn0gbG9va3VwUXVlcnkgRWxlbWVudCB3aGVyZSBzdG9yZWQgdGV4dCBmb3Igc2VhcmNoIGxvY2F0aW9uDQogICAgICAgICogQG1lbWJlcm9mIG1vZHVsZTpsb2NhdGlvbmZpbHRlci5Mb2NhdGlvbkZpbHRlclZpZXcNCiAgICAgICAgKiBAYWxpYXMgbW9kdWxlOmxvY2F0aW9uZmlsdGVyLkxvY2F0aW9uRmlsdGVyVmlldyN0cmFuc2xhdGVVc2VyTG9jYXRpb24NCiAgICAgICAgKi8NCiAgICAgICAgdHJhbnNsYXRlVXNlckxvY2F0aW9uOiBmdW5jdGlvbihsb29rdXBRdWVyeSkgew0KICAgICAgICAgICAgdmFyIHRoYXQgPSB0aGlzLA0KICAgICAgICAgICAgICAgIHByb3BlcnRpZXMgPSB0aGlzLm1vZGVsLmdldCgiZGF0YVByb3BlcnRpZXMiKSwNCiAgICAgICAgICAgICAgICB0ZXh0ID0gdHlwZW9mIGxvb2t1cFF1ZXJ5LnRleHQgIT09ICJ1bmRlZmluZWQiID8gbG9va3VwUXVlcnkudGV4dCA6IGxvb2t1cFF1ZXJ5LA0KICAgICAgICAgICAgICAgICR0ZXh0Qm94ID0gdGhpcy4kZWwuZmluZCgiLmxvY2F0aW9uLXNlYXJjaC1ib3gtaW5wdXQudHQtaW5wdXQiKSwNCiAgICAgICAgICAgICAgICBoYXNoT2JqID0ge307DQoNCiAgICAgICAgICAgIGlmICh0ZXh0ID09PSAiIikgew0KICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgbWFwc0Nvbm5lY3Rvci5hZGRyZXNzTG9va3VwKHsgdGV4dDogdGV4dCB9LCBmdW5jdGlvbihkYXRhKSB7DQogICAgICAgICAgICAgICAgaGFzaE9iaiA9IHRoYXQuY3JlYXRlSGFzaE9iamVjdChkYXRhWzBdICsgInwiICsgZGF0YVsxXSwgcHJvcGVydGllcy5mICsgIixBc2NlbmRpbmciKTsNCiAgICAgICAgICAgICAgICB0aGF0LnVwZGF0ZUhhc2goaGFzaE9iaiwgcHJvcGVydGllcyk7DQogICAgICAgICAgICB9LCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiRXJyb3Igd2hpbGUgZ2V0dGluZyAnIiArIHRleHQgKyAiJyBsb2NhdGlvbiIpOw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAkdGV4dEJveC5ibHVyKCk7DQogICAgICAgICAgICBpZiAoJHRleHRCb3gudmFsKCkgPT09ICIiKSB7DQogICAgICAgICAgICAgICAgJHRleHRCb3gudmFsKHRleHQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9LA0KCQkvKioNCiAgICAgICAgKiBDYWxsIFsibG9jYXRpb25TZXJ2aWNlLmFkZHJlc3NMb29rdXAiXXtAbGluayBtb2R1bGU6bG9jYXRpb25TZXJ2aWNlLmRldGVjdExvY2F0aW9ufQ0KICAgICAgICAqIEBtZW1iZXJvZiBtb2R1bGU6bG9jYXRpb25maWx0ZXIuTG9jYXRpb25GaWx0ZXJWaWV3DQogICAgICAgICogQGFsaWFzIG1vZHVsZTpsb2NhdGlvbmZpbHRlci5Mb2NhdGlvbkZpbHRlclZpZXcjZGV0ZWN0TG9jYXRpb24NCiAgICAgICAgKi8NCiAgICAgICAgZGV0ZWN0TG9jYXRpb246IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBwcm9wZXJ0aWVzID0gdGhpcy5tb2RlbC5nZXQoImRhdGFQcm9wZXJ0aWVzIiksDQogICAgICAgICAgICAgICAgJHRleHRCb3ggPSB0aGlzLiRlbC5maW5kKCIubG9jYXRpb24tc2VhcmNoLWJveC1pbnB1dCIpLA0KICAgICAgICAgICAgICAgIHNpZyA9IHRoaXMubW9kZWwuZ2V0KCJzaWciKSwNCiAgICAgICAgICAgICAgICBoYXNoID0gcXVlcnlNb2RlbC5wYXJzZUhhc2hQYXJhbWV0ZXJzKHdpbmRvdy5sb2NhdGlvbi5oYXNoKSwNCiAgICAgICAgICAgICAgICBwYXJhbSwNCiAgICAgICAgICAgICAgICBoYXNoT2JqID0ge30sDQogICAgICAgICAgICAgICAgdGhhdCA9IHRoaXM7DQoNCiAgICAgICAgICAgIFhBLmNvbXBvbmVudC5sb2NhdGlvblNlcnZpY2UuZGV0ZWN0TG9jYXRpb24oDQogICAgICAgICAgICAgICAgZnVuY3Rpb24gKGxvY2F0aW9uKSB7ICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgaGFzaE9iaiA9IHRoYXQuY3JlYXRlSGFzaE9iamVjdChsb2NhdGlvblswXSArICJ8IiArIGxvY2F0aW9uWzFdLCBwcm9wZXJ0aWVzLmYgKyAiLEFzY2VuZGluZyIpOw0KICAgICAgICAgICAgICAgICAgICB0aGF0LnVwZGF0ZUhhc2guY2FsbCh0aGF0LCBoYXNoT2JqLCBwcm9wZXJ0aWVzKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKCR0ZXh0Qm94Lmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICR0ZXh0Qm94LmF0dHIoInBsYWNlaG9sZGVyIiwgcHJvcGVydGllcy5teUxvY2F0aW9uVGV4dCk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChlcnJvck1lc3NhZ2UpIHsNCiAgICAgICAgICAgICAgICAgICAgLy9EbyBub3QgdXBkYXRlIHRoZSBoYXNoIGluIGFueSB3YXkgd2hlbiB0aGUgbG9jYXRpb24gaXMgbm90IGF2YWlsYWJsZQ0KICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvck1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICk7DQogICAgICAgIH0sDQoJCS8qKg0KICAgICAgICAqIFVwZGF0ZXMgaGFzaCBhY2NvcmRpbmcgdG8gc2V0dXAgb2YgY29tcG9uZW50IGFuZCBzZWxlY3RlZCB2YWx1ZXMgYnkgdXNlcg0KICAgICAgICAqIEBtZW1iZXJvZiBtb2R1bGU6bG9jYXRpb25maWx0ZXIuTG9jYXRpb25GaWx0ZXJWaWV3DQogICAgICAgICogQGFsaWFzIG1vZHVsZTpsb2NhdGlvbmZpbHRlci5Mb2NhdGlvbkZpbHRlclZpZXcjdXBkYXRlSGFzaA0KICAgICAgICAqLw0KICAgICAgICB1cGRhdGVIYXNoOiBmdW5jdGlvbiAocGFyYW1zLCBwcm9wZXJ0aWVzKSB7DQogICAgICAgICAgICB2YXIgc2lnID0gdGhpcy5tb2RlbC5nZXQoInNpZyIpLA0KICAgICAgICAgICAgICAgIHNpZ25hdHVyZSwNCiAgICAgICAgICAgICAgICBzZWFyY2hNb2RlbHMgPSB0eXBlb2YgWEEuY29tcG9uZW50LnNlYXJjaCAhPT0gInVuZGVmaW5lZCIgPyBYQS5jb21wb25lbnQuc2VhcmNoLnJlc3VsdHMuc2VhcmNoUmVzdWx0TW9kZWxzIDogW10sDQogICAgICAgICAgICAgICAgJHRleHRCb3ggPSB0aGlzLiRlbC5maW5kKCIubG9jYXRpb24tc2VhcmNoLWJveC1pbnB1dC50dC1pbnB1dCIpLA0KICAgICAgICAgICAgICAgIHRleHQgPSAkdGV4dEJveC5sZW5ndGggIT09IDAgPyAkdGV4dEJveC52YWwoKSA6IHRoaXMuJGVsLmZpbmQoIi5sb2NhdGlvbi1zZWFyY2gtYm94LWlucHV0IikudmFsKCksDQogICAgICAgICAgICAgICAgaSwgajsNCg0KICAgICAgICAgICAgLy9DbGVhcnMgbG9hZCBtb3JlIG9mZnNldCBpbiBlYWNoIG9mIHNlYXJjaCByZXN1bHRzIHdpdGggdGhlIHNhbWUgc2lnbmF0dXJlIHdoZW4gbG9jYXRpb24gaXMgY2hhbmdlZA0KICAgICAgICAgICAgLy9Ob3csIHRoaXMgaXMgbmVlZGVkIHRvIGNsZWFyIG9mZnNldCBidXQgc2hvdWxkIGJlIGhhbmRsZSBpbiBzZWFyY2ggc2VydmljZSBpbiB0aGUgZnV0dXJlDQogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2VhcmNoTW9kZWxzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IHNpZy5sZW5ndGg7IGorKykgew0KICAgICAgICAgICAgICAgICAgICBzaWduYXR1cmUgPSBzaWdbal07DQogICAgICAgICAgICAgICAgICAgIGlmIChzZWFyY2hNb2RlbHNbaV0uZ2V0KCJkYXRhUHJvcGVydGllcyIpLnNpZyA9PT0gc2lnbmF0dXJlKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZWFyY2hNb2RlbHNbaV0uc2V0KCJsb2FkTW9yZU9mZnNldCIsIDApOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICBpZiAodGV4dCAhPT0gbnVsbCAmJiB0ZXh0ICE9PSAiIikgew0KICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzaWcubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgc2lnbmF0dXJlID0gc2lnW2ldOw0KICAgICAgICAgICAgICAgICAgICBwYXJhbXNbc2lnbmF0dXJlICE9PSAiIiA/IHNpZ25hdHVyZSArICJfYSIgOiAiYSJdID0gdGV4dDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIHF1ZXJ5TW9kZWwudXBkYXRlSGFzaChwYXJhbXMsIHByb3BlcnRpZXMudGFyZ2V0VXJsKTsNCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzaWcubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICBYQS5jb21wb25lbnQuc2VhcmNoLnZlbnQudHJpZ2dlcigibXktbG9jYXRpb24tY29vcmRpbmF0ZXMtY2hhbmdlZCIsIHsNCiAgICAgICAgICAgICAgICAgICAgc2lnOiBzaWdbaV0sDQogICAgICAgICAgICAgICAgICAgIGNvb3JkaW5hdGVzOiBwYXJhbXNbc2lnW2ldICE9PSAiIiA/IHNpZ1tpXSArICJfZyIgOiAiZyJdLnNwbGl0KCJ8IikNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfSwNCgkJLyoqDQogICAgICAgICogVXBkYXRlcyBoYXNoIGFjY29yZGluZyB0byBzZXR1cCBvZiBjb21wb25lbnQgYW5kIHNlbGVjdGVkIHZhbHVlcyBieSB1c2VyDQogICAgICAgICogQG1lbWJlcm9mIG1vZHVsZTpsb2NhdGlvbmZpbHRlci5Mb2NhdGlvbkZpbHRlclZpZXcNCiAgICAgICAgKiBAYWxpYXMgbW9kdWxlOmxvY2F0aW9uZmlsdGVyLkxvY2F0aW9uRmlsdGVyVmlldyN1cGRhdGVIYXNoDQogICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGcgbG9jYXRpb24NCiAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gbyBmYWNldCBuYW1lIGFuZCBzb3J0IG1ldGhvZA0KICAgICAgICAqIEByZXR1cm5zIHtPYmplY3R9IGhhc2ggYXMgYW4gb2JqZWN0DQogICAgICAgICovDQogICAgICAgIGNyZWF0ZUhhc2hPYmplY3Q6IGZ1bmN0aW9uKGcsIG8sIGEpIHsNCiAgICAgICAgICAgIHZhciBzaWcgPSB0aGlzLm1vZGVsLmdldCgic2lnIiksDQogICAgICAgICAgICAgICAgc2lnbmF0dXJlLCANCiAgICAgICAgICAgICAgICBoYXNoT2JqID0ge30sDQogICAgICAgICAgICAgICAgaTsNCg0KICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNpZy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIHNpZ25hdHVyZSA9IHNpZ1tpXTsNCiAgICAgICAgICAgICAgICBoYXNoT2JqW3NpZ25hdHVyZSAhPT0gIiIgPyBzaWduYXR1cmUgKyAiX2ciIDogImciXSA9IGc7DQogICAgICAgICAgICAgICAgaGFzaE9ialtzaWduYXR1cmUgIT09ICIiID8gc2lnbmF0dXJlICsgIl9vIiA6ICJvIl0gPSBvOw0KICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYSAhPT0gInVuZGVmaW5lZCIpIHsNCiAgICAgICAgICAgICAgICAgICAgaGFzaE9ialtzaWduYXR1cmUgIT09ICIiID8gc2lnbmF0dXJlICsgIl9hIiA6ICJhIl0gPSBhOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgcmV0dXJuIGhhc2hPYmo7DQogICAgICAgIH0NCiAgICB9KTsNCiAgIC8qKg0KICAgICogRmlsbHMgbG9jYXRpb25GaWx0ZXJzIHZhcmlhYmxlIHdpdGggbG9jYXRpb24gZmlsdGVyIGNvbXBvbmVudHMsDQogICAgKiBhbmQgbG9hZHMgc2NyaXB0IGZvciBwcm9wZXIgbWFwIHByb3ZpZGVyDQogICAgKiBAbWVtYmVyT2YgbW9kdWxlOmxvY2F0aW9uZmlsdGVyDQogICAgKiBAYWxpYXMgbW9kdWxlOmxvY2F0aW9uZmlsdGVyLmluaXQNCiAgICAqLw0KICAgIGFwaS5pbml0ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIGlmICgkKCJib2R5IikuaGFzQ2xhc3MoIm9uLXBhZ2UtZWRpdG9yIikpIHsNCiAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgfQ0KDQogICAgICAgIHF1ZXJ5TW9kZWwgPSBYQS5jb21wb25lbnQuc2VhcmNoLnF1ZXJ5Ow0KICAgICAgICB1cmxIZWxwZXJNb2RlbCA9IFhBLmNvbXBvbmVudC5zZWFyY2gudXJsOw0KDQogICAgICAgIHZhciBjb21wb25lbnRzID0gJCgiLmxvY2F0aW9uLWZpbHRlcjpub3QoLmluaXRpYWxpemVkKSIpOw0KDQogICAgICAgIF8uZWFjaChjb21wb25lbnRzLCBmdW5jdGlvbihlbGVtKSB7DQogICAgICAgICAgICB2YXIgJGVsID0gJChlbGVtKSwNCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzID0gJGVsLmRhdGEoInByb3BlcnRpZXMiKTsNCg0KICAgICAgICAgICAgLy9Db2xsZWN0cyBhbGwgZm91bmQgY29tcG9uZW50cyAtIHdlIHdpbGwgdXNlIHRoZW0gbGF0ZXIgdG8gY3JlYXRlIHZpZXdzDQogICAgICAgICAgICBsb2NhdGlvbkZpbHRlcnMucHVzaCgkZWwpOw0KDQogICAgICAgICAgICAvL0xvYWRzIGdvb2dsZSBvciBiaW5nIHNjcmlwdHMgaW4gb3JkZXIgdG8gcHJvcGVybHkgdXNlIGFkZHJlc3MgbG9va3VwIGZ1bmN0aW9uYWxpdHkgYnV0IG9ubHkNCiAgICAgICAgICAgIC8vd2hlbiB3ZSBhcmUgbm90IGluIExvY2F0aW9uIG1vZGUgKGluIHRoaXMgbW9kZSB3ZSBhcmUgdGFraW5nIGxvY2F0aW9uIGZyb20gdGhlIGJyb3dzZXIpDQogICAgICAgICAgICBpZiAoIXNjcmlwdHNMb2FkZWQgJiYgcHJvcGVydGllcy5tb2RlICE9PSAiTG9jYXRpb24iKSB7DQogICAgICAgICAgICAgICAgbWFwc0Nvbm5lY3Rvci5sb2FkU2NyaXB0KHByb3BlcnRpZXMua2V5LCBYQS5jb21wb25lbnQuc2VhcmNoLmxvY2F0aW9uZmlsdGVyLnNjcmlwdHNMb2FkZWQpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBpbml0aWFsaXplKCk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICRlbC5hZGRDbGFzcygiaW5pdGlhbGl6ZWQiKTsNCiAgICAgICAgfSk7DQogICAgfTsNCgkvKioNCiAgICAgKiBDYWxscyBbJ2luaXRpYWxpemUnXXtAbGluayBtb2R1bGU6bG9jYXRpb25maWx0ZXIuaW5pdGlhbGl6ZX0gaWYgaXQgd2FzbmB0IA0KICAgICAqIGxvYWRlZCBwcmV2aW91c2x5IGFuZCBtYXJrZWQgYXMgbG9hZGVkDQogICAgICogQG1lbWJlck9mIG1vZHVsZTpsb2NhdGlvbmZpbHRlcg0KICAgICAqIEBhbGlhcyBtb2R1bGU6bG9jYXRpb25maWx0ZXIuc2NyaXB0c0xvYWRlZA0KICAgICovDQogICAgYXBpLnNjcmlwdHNMb2FkZWQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgaWYgKCFzY3JpcHRzTG9hZGVkKSB7DQogICAgICAgICAgICBjb25zb2xlLmxvZygiTWFwcyBhcGkgbG9hZGVkIik7DQogICAgICAgICAgICBzY3JpcHRzTG9hZGVkID0gdHJ1ZTsNCiAgICAgICAgICAgIGluaXRpYWxpemUoKTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICByZXR1cm4gYXBpOw0KDQp9KGpRdWVyeSwgZG9jdW1lbnQpKTsNCg0KWEEucmVnaXN0ZXIoImxvY2F0aW9uZmlsdGVyIiwgWEEuY29tcG9uZW50LnNlYXJjaC5sb2NhdGlvbmZpbHRlcik7DQo=
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 18923
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "ba3f86a2-4a1c-4d78-b63d-91c2779c1b5e"
  Hint: __Sortorder
  Value: 1100
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20160728T134137Z
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\admin
