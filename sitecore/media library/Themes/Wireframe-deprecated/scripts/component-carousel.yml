---
ID: "8889ffb2-7f7b-4546-b3cc-6474172896d1"
Parent: "4039864c-e58d-4831-a7ab-33ffa08c5687"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Themes/Wireframe-deprecated/scripts/component-carousel"
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/8889FFB27F7B4546B3CC6474172896D1.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  Value: LyoqDQogKiBYQUNvbnRleHQNCiAqDQogKiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzIG1vZHVsZS4NCiAqDQogKiBFeHBvc2VzIHJlZ2lzdGVyKHNlbGVjdG9yLCBvcHRpb25zKSBtZXRob2QsIHdoaWNoIGluaXRpYWxpemVzIENhcm91c2VsDQogKiBmb3IgZWFjaCBlbGVtZW50cyB0aGF0IG1hdGNoIHRoZSBwcm92aWRlZCBzZWxlY3Rvciwgd2l0aCBnaXZlbiBvcHRpb25zLg0KICogRWxlbWVudCB1c2VkIGFzIGEgY2Fyb3VzZWwgbXVzdCBjb250YWluIGEgPHVsIGNsYXNzPSJzbGlkZXMiPiB0YWcuDQogKiBUaGF0IHRhZyBoYXZlIHRvIGJlIGZpbGxlZCB3aXRoIDxsaT4gZWxlbWVudHMuIEVhY2ggPGxpPiBlbGVtZW50IHdpbGwgYmUgY29uc2lkZXJlZCBhcyBhIHNsaWRlLg0KICogRm9yIG1vcmUgZGV0YWlscyByZWFkIHRoZSBkb2N1bWVudGF0aW9uIG9mIGEgcmVnaXN0ZXIoc2VsZWN0b3IsIG9wdGlvbnMpIG1ldGhvZC4NCiAqDQogKiBAcmVxdWlyZXMgalF1ZXJ5IEphdmFTY3JpcHQgTGlicmFyeSB2MS40LjQgb3IgaGlnaGVyDQogKi8NCi8qIGdsb2JhbCBIYW1tZXI6dHJ1ZSAqLw0KWEEuY29tcG9uZW50LmNhcm91c2VscyA9IChmdW5jdGlvbiAoJCkgew0KICAgIHZhciBwdWIgPSB7fSwNCiAgICAgICAgTmF2aWdhdGlvbkJ1aWxkZXIgPSBudWxsLA0KICAgICAgICBTbGlkZXJJbml0aWFsaXplciA9IG51bGw7DQoNCiAgICAvKioNCiAgICAgKiBUaW1lciBjbGFzcyBzYXZlcyB0aW1lIHN0YW1wIGFuZCBjb3VudHMgdGltZSBkaWZmZXJlbmNlIGJldHdlZW4NCiAgICAgKiBjdXJyZW50IHRpbWUgKHVwZGF0ZSgpIG1ldGhvZCkgYW5kIHNhdmVkIHRpbWUgc3RhbXAuDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gVGltZXIoKSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUaW1lIGRpZmZlcmVuY2UgYmV0d2VlbiBsYXN0IHVwZGF0ZSgpIGNhbGwgYW5kIGxhc3Qgc2V0KCkgY2FsbA0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFRpbWVyDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmVsYXBzZWQgPSAwOw0KICAgICAgICAvKioNCiAgICAgICAgICogVGltZSBzdGFtcA0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFRpbWVyDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnN0YW1wID0gbnVsbDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiAgQ291bnRzIHRpbWUgZGlmZmVyZW5jZSBiZXR3ZWVuIGN1cnJlbnQgdGltZSBhbmQgc2F2ZWQgdGltZSBzdGFtcA0KICAgICAqDQogICAgICogQG1lbWJlciBUaW1lcg0KICAgICAqLw0KICAgIFRpbWVyLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIGlmICh0aGlzLnN0YW1wICE9PSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLmVsYXBzZWQgKz0gdGhpcy5uZXdTdGFtcCgpIC0gdGhpcy5zdGFtcDsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiAgU2F2ZXMgbmV3IHRpbWUgc3RhbXANCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVGltZXINCiAgICAgKi8NCiAgICBUaW1lci5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLnN0YW1wID0gdGhpcy5uZXdTdGFtcCgpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiAgQ291bnRzIHRpbWUgZGlmZmVyZW5jZSBiZXR3ZWVuIGN1cnJlbnQgdGltZSBhbmQgc2F2ZWQgdGltZSBzdGFtcA0KICAgICAqDQogICAgICogQG1lbWJlciBUaW1lcg0KICAgICAqIEByZXR1cm4gc3RhbXAgb2YgYSBjdXJyZW50IHRpbWUNCiAgICAgKiBAdHlwZSBOdW1iZXINCiAgICAgKi8NCiAgICBUaW1lci5wcm90b3R5cGUubmV3U3RhbXAgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHJldHVybiBuZXcgRGF0ZSgpLnZhbHVlT2YoKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogIFJlc2V0cyBlbGFwc2VkIHRpbWUuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVyDQogICAgICovDQogICAgVGltZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLmVsYXBzZWQgPSAwOw0KICAgIH07DQogICAgLyoqDQogICAgICogRW5kIG9mIFRpbWVyIGNsYXNzDQogICAgICovDQoNCiAgICAvKioNCiAgICAgKiBUaW1lSW5kaWNhdG9yIGNsYXNzIGV4dGVuZHMgVGltZXIgY2xhc3MNCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKiBAcGFyYW0ge09iamVjdH0gJCAgICAgYSBqUXVlcnkgb2JqZWN0DQogICAgICogQHBhcmFtIHtYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzLlZpZXd9IHZpZXcgIGEgdGltZSBpbmRpY2F0b3Igdmlldy4NCiAgICAgKiBAcGFyYW0ge051bWJlcn0gdGltZW91dCAgIGEgdmlldyB0aW1lb3V0DQogICAgICogQGJhc2UgVGltZXINCiAgICAgKi8NCiAgICBmdW5jdGlvbiBUaW1lSW5kaWNhdG9yKCQsIHZpZXcsIHRpbWVvdXQpIHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEEgdGltZSBpbmRpY2F0b3Igdmlldy4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBUaW1lckluZGljYXRvcg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy52aWV3ID0gdmlldzsNCg0KICAgICAgICB0aGlzLnZpZXcuaW5pdCh0aW1lb3V0KTsNCiAgICB9DQogICAgVGltZUluZGljYXRvci5wcm90b3R5cGUgPSBuZXcgVGltZXIoKTsNCiAgICBUaW1lSW5kaWNhdG9yLmNvbnN0cnVjdG9yID0gVGltZXI7DQoNCiAgICAvKioNCiAgICAgKiBQbGF5cyB0aGUgYXR0YWNoZWQgdmlldy4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVGltZXJJbmRpY2F0b3INCiAgICAgKi8NCiAgICBUaW1lSW5kaWNhdG9yLnByb3RvdHlwZS5wbGF5ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLnZpZXcucGxheSgpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBQYXVzZXMgdGhlIGF0dGFjaGVkIHZpZXcuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVySW5kaWNhdG9yDQogICAgICovDQogICAgVGltZUluZGljYXRvci5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMudmlldy5wYXVzZSgpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBSZXNldHMgZWxhcHNlZCB0aW1lIGFuZCByZXNldHMgdGhlIGF0dGFjaGVkIHZpZXcuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVySW5kaWNhdG9yDQogICAgICovDQogICAgVGltZUluZGljYXRvci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIFRpbWVyLnByb3RvdHlwZS5yZXNldC5jYWxsKHRoaXMpOw0KICAgICAgICB0aGlzLnZpZXcucmVzZXQoKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQ291bnRzIHRpbWUgZGlmZmVyZW5jZSBiZXR3ZWVuIGN1cnJlbnQgdGltZSBhbmQgc2F2ZWQgdGltZSBzdGFtcC4NCiAgICAgKiBhbmQgdXBkYXRlcyB0aGUgYXR0YWNoZWQgdmlldw0KICAgICAqDQogICAgICogQG1lbWJlciBUaW1lckluZGljYXRvcg0KICAgICAqLw0KICAgIFRpbWVJbmRpY2F0b3IucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgVGltZXIucHJvdG90eXBlLnVwZGF0ZS5jYWxsKHRoaXMpOw0KICAgICAgICB0aGlzLnZpZXcudXBkYXRlKHRoaXMuZWxhcHNlZCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgVGltZUluZGljYXRvciBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogTmF2aWdhdGlvbkJ1aWxkZXIgb2JqZWN0IGNyZWF0ZXMgbmF2aWdhdGlvbiBpdGVtcw0KICAgICAqLw0KICAgIE5hdmlnYXRpb25CdWlsZGVyID0gKGZ1bmN0aW9uICgkKSB7DQogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUl0ZW0oc2V0dGluZ3MpIHsNCiAgICAgICAgICAgIHZhciB0ZXh0ID0gc2V0dGluZ3MudGV4dCwNCiAgICAgICAgICAgICAgICAkbmF2SXRlbSA9IG51bGw7DQoNCiAgICAgICAgICAgIHNldHRpbmdzLnRleHQgPSAnJzsNCiAgICAgICAgICAgIHNldHRpbmdzLmhyZWYgPSAnIyc7DQoNCiAgICAgICAgICAgICRuYXZJdGVtID0gJCgnPGE+Jywgc2V0dGluZ3MpOw0KICAgICAgICAgICAgJCgnPHNwYW4+Jywgew0KICAgICAgICAgICAgICAgICd0ZXh0JzogdGV4dA0KICAgICAgICAgICAgfSkuYXBwZW5kVG8oJG5hdkl0ZW0pOw0KDQogICAgICAgICAgICByZXR1cm4gJG5hdkl0ZW07DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgLyoqDQogICAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBlbGVtZW50KHMpIHRoYXQgbWF0Y2goZXMpIHRoZSBwcm92aWRlZCBzZWxlY3RvciBvciBudWxsDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IHNlbGVjdG9yIGEgc2VsZWN0b3IgdXNlZCBmb3Igc2VhcmNoaW5nDQogICAgICAgICAgICAgKiBAcmV0dXJuIGEgalF1ZXJ5IG9iamVjdCBjb250YWluaW5nIGVsZW1lbnQocykgdGhhdCBtYXRjaChlcykgdGhlIHByb3ZpZGVkIHNlbGVjdG9yIG9yIG51bGwgaWYgbm8gZWxlbWVudCBtYXRjaA0KICAgICAgICAgICAgICogQHR5cGUgT2JqZWN0DQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGdldEVsZW1lbnQ6IGZ1bmN0aW9uIChzZWxlY3Rvcikgew0KICAgICAgICAgICAgICAgIHZhciAkZWxlbWVudCA9ICQoc2VsZWN0b3IpOw0KDQogICAgICAgICAgICAgICAgaWYgKCRlbGVtZW50Lmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAkZWxlbWVudCA9IG51bGw7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuICRlbGVtZW50Ow0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogQ3JlYXRlcyBuYXZpZ2F0aW9uIGl0ZW1zIGFuZCBhcHBlbmRzIHRoZW0gdG8gJGNvbnRhaW5lci4NCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gJGNvbnRhaW5lciAgIG5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIChqUXVlcnkgb2JqZWN0KQ0KICAgICAgICAgICAgICogQHBhcmFtIHtTdHJpbmd9IGxhYmVsICAgbmF2aWdhdGlvbiBpdGVtcyBsYWJlbCB0ZW1wbGF0ZQ0KICAgICAgICAgICAgICogQHBhcmFtIHtOdW1iZXJ9IGNvdW50ICAgIG51bWJlciBvZiBuYXZpZ2F0aW9uIGl0ZW1zIHRvIGNyZWF0ZQ0KICAgICAgICAgICAgICovDQogICAgICAgICAgICBjcmVhdGVJdGVtczogZnVuY3Rpb24gKCRjb250YWluZXIsIGxhYmVsLCBjb3VudCkgew0KICAgICAgICAgICAgICAgIHZhciBpLA0KICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuID0gLyNce2luZGV4XH0vZywNCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M7DQoNCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0JzogbGFiZWwucmVwbGFjZShwYXR0ZXJuLCBpICsgMSkNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlSXRlbShzZXR0aW5ncykuYXBwZW5kVG8oJGNvbnRhaW5lcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogQ3JlYXRlcyBvciBzZWxlY3RzICdwcmV2aW91cycvJ25leHQnIG5hdmlnYXRpb24gaXRlbS4NCiAgICAgICAgICAgICAqIE1vZGUgb2YgYWN0aW9uIGRlcGVuZHMgb24gc2V0dGluZ3Mgb2JqZWN0Og0KICAgICAgICAgICAgICogdmFyIHNldHRpbmdzID0gew0KICAgICAgICAgICAgICogICAgIGlzQ29udGFpbmVyOiBCb29sZWFuIHZhbHVlLA0KICAgICAgICAgICAgICogICAgIGxhYmVsOiBTdHJpbmcgdmFsdWUsDQogICAgICAgICAgICAgKiAgICAgc2VsZWN0b3I6IFN0cmluZyB2YWx1ZSwNCiAgICAgICAgICAgICAqICAgICBtZXRob2Q6IFN0cmluZyB2YWx1ZQ0KICAgICAgICAgICAgICogfTsNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBJZiBzZXR0aW5ncy5zZWxlY3RvciA9PT0gbnVsbCBvciBpZiBzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbCBhbmQgc2V0dGluZ3MuaXNDb250YWluZXIgPT0gdHJ1ZQ0KICAgICAgICAgICAgICogbmF2aWdhdGlvbiBpdGVtIGlzIGNyZWF0ZWQgYW5kIGF0dGFjaGVkIHRvICRlbGVtZW50LmZpcnN0KCkgKHVzaW5nIHNldHRpbmdzLm1ldGhvZCkuDQogICAgICAgICAgICAgKiBJZiBzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbCBhbmQgc2V0dGluZ3MuaXNDb250YWluZXIgPT0gZmFsc2UNCiAgICAgICAgICAgICAqICRlbGVtZW50LmZpcnN0KCkgaXMgc2VsZWN0ZWQgYXMgbmF2aWdhdGlvbiBpdGVtDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIHNldHRpbmdzIG9mIG5hdmlnYXRpb24gaXRlbQ0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGl0ZW1TZXR0aW5ncyAgIGh0bWwgYXR0cmlidXRlcyBvZiBuYXZpZ2F0aW9uIGl0ZW0NCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkZWxlbWVudCAgICBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciAoalF1ZXJ5IG9iamVjdCkNCiAgICAgICAgICAgICAqIEByZXR1cm4gVGhlICdwcmV2Jy8nbmV4dCcgbmF2aWdhdGlvbiBpdGVtDQogICAgICAgICAgICAgKiBAdHlwZSBPYmplY3QNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgY3JlYXRlUHJldk5leHRJdGVtOiBmdW5jdGlvbiAoc2V0dGluZ3MsIGl0ZW1TZXR0aW5ncywgJGVsZW1lbnQpIHsNCiAgICAgICAgICAgICAgICB2YXIgJGl0ZW0gPSBudWxsLA0KICAgICAgICAgICAgICAgICAgICBpc1NlbGVjdG9yRXhpc3RzID0gc2V0dGluZ3Muc2VsZWN0b3IgIT09IG51bGw7DQoNCg0KICAgICAgICAgICAgICAgIGlmIChpc1NlbGVjdG9yRXhpc3RzKSB7DQogICAgICAgICAgICAgICAgICAgICRlbGVtZW50ID0gdGhpcy5nZXRFbGVtZW50KHNldHRpbmdzLnNlbGVjdG9yKTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBpZiAoJGVsZW1lbnQgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNldHRpbmdzLmlzQ29udGFpbmVyIHx8ICFpc1NlbGVjdG9yRXhpc3RzKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAkaXRlbSA9IGNyZWF0ZUl0ZW0oJC5leHRlbmQoe30sIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAndGV4dCc6IHNldHRpbmdzLmxhYmVsDQogICAgICAgICAgICAgICAgICAgICAgICB9LCBpdGVtU2V0dGluZ3MpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICgkZWxlbWVudC5maXJzdCgpKVtzZXR0aW5ncy5tZXRob2RdKCRpdGVtKTsNCiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtID0gJGVsZW1lbnQuZmlyc3QoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHJldHVybiAkaXRlbTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCiAgICB9KCQpKTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgTmF2aWdhdGlvbkJ1aWxkZXIgb2JqZWN0DQogICAgICovDQoNCiAgICAvKioNCiAgICAgKiBOYXZpZ2F0aW9uIGNsYXNzIGhvbGRzIG5hdmlnYXRpb24gaXRlbXMuDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gTmF2aWdhdGlvbigkLCAkd3JhcHBlciwgb3B0aW9ucykgew0KICAgICAgICB2YXIgZGVmYXVsdHMgPSB7DQogICAgICAgICAgICAnaXNFbmFibGVkJzogdHJ1ZSwNCiAgICAgICAgICAgICdoYXNQcmV2TmV4dEl0ZW1zJzogdHJ1ZSwNCiAgICAgICAgICAgICdpdGVtJzogew0KICAgICAgICAgICAgICAgICdsYWJlbCc6ICcje2luZGV4fScsDQogICAgICAgICAgICAgICAgJ3NlbGVjdG9yJzogbnVsbA0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICdwcmV2SXRlbSc6IHsNCiAgICAgICAgICAgICAgICAnbGFiZWwnOiAnPCcsDQogICAgICAgICAgICAgICAgJ3NlbGVjdG9yJzogbnVsbCwNCiAgICAgICAgICAgICAgICAnaXNDb250YWluZXInOiBmYWxzZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICduZXh0SXRlbSc6IHsNCiAgICAgICAgICAgICAgICAnbGFiZWwnOiAnPicsDQogICAgICAgICAgICAgICAgJ3NlbGVjdG9yJzogbnVsbCwNCiAgICAgICAgICAgICAgICAnaXNDb250YWluZXInOiBmYWxzZQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICdzbGlkZXNDb3VudCc6IDANCiAgICAgICAgfSwNCiAgICAgICAgICAgIHNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBvcHRpb25zKTsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogalF1ZXJ5IG9iamVjdA0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJCA9ICQ7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBOYXZpZ2F0aW9uIGl0ZW1zIChvbmUgZm9yIGVhY2ggc2xpZGUgaWYgbmF2aWdhdGlvbiBpcyBlbmFibGVkKS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiRpdGVtcyA9ICQoKTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIE5hdmlnYXRpb24gJ25leHQnIGl0ZW0gKGlmIHByZXYvbmV4dCBpdGVtcyBhcmUgZW5hYmxlZCkuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy4kbmV4dEl0ZW0gPSAkKCk7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBOYXZpZ2F0aW9uICdwcmV2aW91cycgaXRlbSAoaWYgcHJldi9uZXh0IGl0ZW1zIGFyZSBlbmFibGVkKS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiRwcmV2SXRlbSA9ICQoKTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFNlbGVjdGVkIGl0ZW0gKG9uZSBmcm9tIHRoaXMuJGl0ZW1zIG9yIG51bGwpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJHNlbGVjdGVkSXRlbSA9IG51bGw7DQoNCiAgICAgICAgLy9pbml0aWFsaXphdGlvbg0KICAgICAgICBpZiAoc2V0dGluZ3MuaXNFbmFibGVkKSB7DQogICAgICAgICAgICB2YXIgc2VsZiA9IHRoaXM7DQogICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBzZWxmLnByZXBhcmVJdGVtcyhzZXR0aW5ncy5pdGVtLCBzZXR0aW5ncy5zbGlkZXNDb3VudCwgJHdyYXBwZXIpOw0KICAgICAgICAgICAgICAgIC8vc2VsZWN0IGZpcnN0IGl0ZW0gb24gaW5pdA0KICAgICAgICAgICAgICAgIHNlbGYuc2VsZWN0SXRlbSgwKQ0KICAgICAgICAgICAgfSwgMTAwMCk7DQoNCiAgICAgICAgICAgICR3cmFwcGVyLmZpbmQoJy5uYXYnKS50cmlnZ2VyKCduYXZpZ2F0aW9uLWNyZWF0ZWQnLCB0aGlzKTsNCiAgICAgICAgfQ0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENTUyBjbGFzc20gd2hpY2ggd2lsbCBiZSB1c2VkIGZvciBtYXJrIHNlbGVjdGVkIGl0ZW0NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAqLw0KICAgIE5hdmlnYXRpb24ucHJvdG90eXBlLnNlbGVjdGVkSXRlbUNsYXNzID0gJ2FjdGl2ZSc7DQoNCiAgICAvKioNCiAgICAgKiBNYXJrIG5hdmlnYXRpb24gaXRlbSB3aXRoIGdpdmVuIGluZGV4IGFzIHNlbGVjdGVkLg0KICAgICAqDQogICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4ICAgICBpbmRleCBvZiBuYXZpZ2F0aW9uIGl0ZW0NCiAgICAgKi8NCiAgICBOYXZpZ2F0aW9uLnByb3RvdHlwZS5zZWxlY3RJdGVtID0gZnVuY3Rpb24gKGluZGV4KSB7DQogICAgICAgIGlmICh0aGlzLiRzZWxlY3RlZEl0ZW0gIT09IG51bGwpIHsNCiAgICAgICAgICAgIHRoaXMuJHNlbGVjdGVkSXRlbS5yZW1vdmVDbGFzcyh0aGlzLnNlbGVjdGVkSXRlbUNsYXNzKTsNCiAgICAgICAgfQ0KICAgICAgICB0aGlzLiRzZWxlY3RlZEl0ZW0gPSB0aGlzLiRpdGVtcy5lcShpbmRleCkuYWRkQ2xhc3ModGhpcy5zZWxlY3RlZEl0ZW1DbGFzcyk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgb3Igc2VsZWN0cyBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciBhbmQgZmlsbHMgaXQgd2l0aCBuYXZpZ2F0aW9uIGl0ZW1zLg0KICAgICAqIElmIG5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIGlzIG5vdCBlbXB0eSwgY2hpbGQgZWxlbWVudHMgYXJlIGFkb3B0ZWQgYXMgbmF2aWdhdGlvbiBpdGVtcy4NCiAgICAgKiBNb2RlIG9mIGFjdGlvbiBkZXBlbmRzIG9uIHNldHRpbmdzIG9iamVjdDoNCiAgICAgKiB2YXIgc2V0dGluZ3MgPSB7DQogICAgICogICAgICdsYWJlbCc6ICcje2luZGV4fScsDQogICAgICogICAgICdzZWxlY3Rvcic6IG51bGwNCiAgICAgKiB9Ow0KICAgICAqIElmIHNldHRpbmdzLnNlbGVjdG9yID09PSBudWxsIG5hdmlnYXRpb24gaXRlbSBjb250YWluZXIgaXMgY3JlYXRlZC4NCiAgICAgKiBJZiBzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbCBlbGVtZW50IHRoYXQgbWF0Y2ggc2V0dGluZ3Muc2VsZWN0b3IgaXMgYWRhcHRlZCBhcyBuYXZpZ2FnYXRpb24gaXRlbXMgY29udGFpbmVyLg0KICAgICAqDQogICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIHNldHRpbmdzIG9mIG5hdmlnYXRpb24gaXRlbXMNCiAgICAgKiBAcGFyYW0ge051bWJlcn0gY291bnQgICBudW1iZXIgb2YgbmF2aWdhdGlvbiBpdGVtcw0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkd3JhcHBlciAgICB3cmFwcGVyIG9mIG5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIChqUXVlcnkgb2JqZWN0KQ0KICAgICAqIEByZXR1cm4gVGhlIGNvbnRhaW5lciBmaWxsZWQgd2l0aCBuYXZpZ2F0aW9uIGl0ZW1zLg0KICAgICAqIEB0eXBlIE9iamVjdA0KICAgICAqLw0KICAgIE5hdmlnYXRpb24ucHJvdG90eXBlLnByZXBhcmVJdGVtcyA9IGZ1bmN0aW9uIChzZXR0aW5ncywgY291bnQsICR3cmFwcGVyKSB7DQogICAgICAgIHZhciAkY29udGFpbmVyID0gbnVsbDsNCg0KICAgICAgICBpZiAoc2V0dGluZ3Muc2VsZWN0b3IgIT09IG51bGwpIHsNCiAgICAgICAgICAgICRjb250YWluZXIgPSBOYXZpZ2F0aW9uQnVpbGRlci5nZXRFbGVtZW50KHNldHRpbmdzLnNlbGVjdG9yKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICRjb250YWluZXIgPSAkKCc8ZGl2Lz4nLCB7DQogICAgICAgICAgICAgICAgJ2NsYXNzJzogJ25hdicNCiAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgJGNvbnRhaW5lci5hcHBlbmRUbygkd3JhcHBlcik7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoJGNvbnRhaW5lciAhPT0gbnVsbCkgew0KICAgICAgICAgICAgaWYgKCRjb250YWluZXIuY2hpbGRyZW4oKS5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICBOYXZpZ2F0aW9uQnVpbGRlci5jcmVhdGVJdGVtcygkY29udGFpbmVyLCBzZXR0aW5ncy5sYWJlbCwgY291bnQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgdGhpcy4kaXRlbXMgPSAkY29udGFpbmVyLmNoaWxkcmVuKCkuc2xpY2UoMCwgY291bnQpOw0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuICRjb250YWluZXI7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgb3Igc2VsZWN0cyBuYXZpZ2F0aW9uICdwcmV2aW91cycgYW5kICduZXh0JyBuYXZpZ2F0aW9uIGl0ZW1zIChAc2VlIE5hdmlnYXRpb25CdWlsZGVyLmNyZWF0ZVByZXZOZXh0SXRlbSgpKS4NCiAgICAgKiBJZiBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciBpcyBub3QgZW1wdHksIGNoaWxkIGVsZW1lbnRzIGFyZSBhZG9wdGVkIGFzIG5hdmlnYXRpb24gaXRlbXMuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgKiBAcGFyYW0ge09iamVjdH0gc2V0dGluZ3Mgc2V0dGluZ3Mgb2YgbmF2aWdhdGlvbg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkY29udGFpbmVyICAgIG5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIChqUXVlcnkgb2JqZWN0KQ0KICAgICAqLw0KICAgIE5hdmlnYXRpb24ucHJvdG90eXBlLnByZXBhcmVQcmV2TmV4dEl0ZW1zID0gZnVuY3Rpb24gKHNldHRpbmdzLCAkY29udGFpbmVyKSB7DQogICAgICAgIHZhciAkaXRlbTsNCg0KICAgICAgICBzZXR0aW5ncy5wcmV2SXRlbS5tZXRob2QgPSAncHJlcGVuZCc7DQogICAgICAgICRpdGVtID0gTmF2aWdhdGlvbkJ1aWxkZXIuY3JlYXRlUHJldk5leHRJdGVtKHNldHRpbmdzLnByZXZJdGVtLCB7DQogICAgICAgICAgICAnY2xhc3MnOiAncHJldicNCiAgICAgICAgfSwgJGNvbnRhaW5lcik7DQogICAgICAgIHRoaXMuJHByZXZJdGVtID0gKCRpdGVtID09PSBudWxsKSA/IHRoaXMuJHByZXZJdGVtIDogJGl0ZW07DQoNCiAgICAgICAgc2V0dGluZ3MubmV4dEl0ZW0ubWV0aG9kID0gJ2FwcGVuZCc7DQogICAgICAgICRpdGVtID0gTmF2aWdhdGlvbkJ1aWxkZXIuY3JlYXRlUHJldk5leHRJdGVtKHNldHRpbmdzLm5leHRJdGVtLCB7DQogICAgICAgICAgICAnY2xhc3MnOiAnbmV4dCcNCiAgICAgICAgfSwgJGNvbnRhaW5lcik7DQogICAgICAgIHRoaXMuJG5leHRJdGVtID0gKCRpdGVtID09PSBudWxsKSA/IHRoaXMuJG5leHRJdGVtIDogJGl0ZW07DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgTmF2aWdhdGlvbiBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogU2xpZGVyQ29udGV4dCBjbGFzcyBpcyBiaW5kZWQgdG8gYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UNCiAgICAgKiBhbmQgaG9sZHMgaXRzIHByb3BlcnRpZXMuDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gU2xpZGVyQ29udGV4dCgpIHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEZsYWcsIHdoaWNoIGRldGVybWluZXMgaWYgc2xpZGUgY2FuIG9yIGNhbiBub3QgYmUgY2hhbmdlZCAoZm9yIHVzZXIgcmVxdWVzdCkNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmNhbkNoYW5nZVNsaWRlID0gdHJ1ZTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIERlZmF1bHQgU2xpZGVyIHNldHRpbmcgb2JqZWN0IChAc2VlIFNsaWRlcikNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmRlZmF1bHRzID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIE5hdmlnYXRpb24gb2JqZWN0IChAc2VlIE5hdmlnYXRpb24pDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFNsaWRlciBvYmplY3QsIHdoaWNoIHRoaXMgY29udGV4dCBpcyBhdHRhY2VoZCB0by4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLm93bmVyID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEZsYWcsIHdoaWNoIGRldGVybWluZXMgaWYgY2hhbmdlIG9mIGEgc2xpZGUgY2FuIG9yIGNhbiBub3QgYmUgc2NoZWR1bGVkDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5wcmV2ZW50U2NoZWR1bGluZyA9IGZhbHNlOw0KICAgICAgICAvKioNCiAgICAgICAgICogU2xpZGVyIHNldHRpbmcgb2JqZWN0DQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbnN0YW5jZSBvZiBUaW1lciBjbGFzcyAoQHNlZSBUaW1lciksIHdoaWNoIGlzIHVzZWQgdG8gc3RvcmUgaG93IG11Y2gNCiAgICAgICAgICogdGltZSBpcyBsZWZ0IHRvIGNoYW5nZSB0aGUgc2xpZGUNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnNsaWRlVGltZXIgPSBuZXcgVGltZXIoKTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEluc3RhbmNlIG9mIFRpbWVJbmRpY2F0b3IgY2xhc3MgKEBzZWUgVGltZUluZGljYXRvcikNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnRpbWVJbmRpY2F0b3IgPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogVGltZXJzIGFycmF5Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMudGltZXJzID0gW107DQogICAgICAgIC8qKg0KICAgICAgICAgKiBMYXN0IHRpbWVvdXQgaWRlbnRpZmllci4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnRpbWVvdXRJZCA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUcmFuc2l0aW9uIChAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvbikgdXNlZCB3aGlsZSBjaGFuZ2luZyBzbGlkZXMNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnRyYW5zaXRpb24gPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogVHJhbnNpdGlvbiBzZXR0aW5ncyBvYmplY3QgKEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5UcmFuc2l0aW9uU2V0dGluZ3MpDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy50cmFuc2l0aW9uU2V0dGluZ3MgPSBuZXcgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5UcmFuc2l0aW9uU2V0dGluZ3MoKTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIGpRdWVyeSBvYmplY3Qgd2hpY2ggY29udGFpbnMgYWxsIHNsaWRlcw0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJHNsaWRlcyA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBqUXVlcnkgb2JqZWN0IGNvbnRhaW5pbmcgZWxlbWVudCB0aGF0IHdyYXBwcyBzbGlkZXMNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiR3cmFwcGVyID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFJlZmVyZW5jZSB0byBtZXRob2QsIHdoaWNoIHNob3VsZCBjaGFuZ2UgY3VycmVudCBzbGlkZQ0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuY2hhbmdlQ3VycmVudFNsaWRlID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFJlZmVyZW5jZSB0byBtZXRob2QsIHdoaWNoIHNob3VsZCByZXR1cm4galF1ZXJ5IG9iamVjdCB3aXRoIGN1cnJlbnQgc2xpZGUNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmdldEN1cnJlbnRTbGlkZSA9IG51bGw7DQoNCiAgICAgICAgdGhpcy50aW1lcnMucHVzaCh0aGlzLnNsaWRlVGltZXIpOw0KICAgIH0NCiAgICAvKioNCiAgICAgKiBlbmQgb2YgU2xpZGVyQ29udGV4dCBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogU2xpZGVyIGNsYXNzIG1hbmFnZXMgY2hhbmdpbmcgb2Ygc2xpZGVzLg0KICAgICAqDQogICAgICogT3B0aW9ucyBvYmplY3Q6DQogICAgICogew0KICAgICAqICAgICAnbmF2aWdhdGlvbic6IE9iamVjdCB2YWx1ZSwgLy9uYXZpZ2F0aW9uIHNldHRpbmdzIG9iamVjdA0KICAgICAqICAgICAndGltZW91dCc6IE51bWJlciB2YWx1ZSwgLy90aW1lIGJldHdlZW4gc2xpZGVzIGNoYW5naW5nDQogICAgICogICAgICd0cmFuc2l0aW9uJzogU3RyaW5nIHZhbHVlLCAvL25hbWUgb2YgdHJhbnNpdGlvbiBjbGFzcyAoQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zLlRyYW5zaXRpb24pDQogICAgICogICAgICdpc1BhdXNlRW5hYmxlZCc6IEJvb2xlYW4gdmFsdWUsIC8vZmxhZywgd2hpY2ggZGV0ZXJtaW5lcyBpZiBwYXVzZSBmZWF0dXJlIGlzIGVuYWJsZWQNCiAgICAgKiAgICAgJ3RpbWVJbmRpY2F0b3InOiB7DQogICAgICogICAgICAgICAnaXNFbmFibGVkJzogQm9vbGVhbiB2YWx1ZSwgLy9mbGFnLCB3aGljaCBkZXRlcm1pbmVzIGlmIHRpbWUgaW5kaWNhdG9yIGlzIGVuYWJsZWQNCiAgICAgKiAgICAgICAgICdzZWxlY3Rvcic6IFN0cmluZyB2YWx1ZSwgLy9zZWxlY3RvciBvZiB0aW1lIGluZGljYXRvciBodG1sIGVsZW1lbnQNCiAgICAgKiAgICAgICAgICd2aWV3JzogU3RyaW5nIHZhbHVlLCAvL25hbWUgb2YgdmlldyBjbGFzcyAoQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzLlZpZXcNCiAgICAgKiAgICAgICAgICdvcHRpb25zJzogT2JqZWN0IHZhbHVlIC8vb2JqZWN0IHdpdGggb3B0aW9ucywgd2hpY2ggd2lsbCBiZSBwYXNzZWQgdG8gYSB0aW1lIGluZGljYXRvciB2aWV3DQogICAgICogICAgIH0NCiAgICAgKiB9DQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICogQHBhcmFtIHtPYmplY3R9ICQgICAgIHRoZSBqUXVlcnkgb2JqZWN0DQogICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGluc3RhbmNlIG9mIFNsaWRlckNvbnRleHQgY2xhc3M7IG11c3QgYmUgc2VwYXJhdGUgZm9yIGVhY2ggaW5zdGFuY2UgKEBzZWUgU2xpZGVyQ29udGV4dCkNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgICBTbGlkZXIgb3B0aW9ucyBvYmplY3QNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBTbGlkZXIoJCwgY29udGV4dCwgb3B0aW9ucykgew0KICAgICAgICB2YXIgZGVmYXVsdHMgPSB7DQogICAgICAgICAgICAnbmF2aWdhdGlvbic6IHt9LA0KICAgICAgICAgICAgJ3RpbWVvdXQnOiAxMDAwMCwNCiAgICAgICAgICAgICd0cmFuc2l0aW9uJzogJ0Jhc2ljVHJhbnNpdGlvbicsDQogICAgICAgICAgICAnaXNQYXVzZUVuYWJsZWQnOiB0cnVlLA0KICAgICAgICAgICAgJ3RpbWVJbmRpY2F0b3InOiB7DQogICAgICAgICAgICAgICAgJ2lzRW5hYmxlZCc6IGZhbHNlLA0KICAgICAgICAgICAgICAgICdzZWxlY3Rvcic6IG51bGwsDQogICAgICAgICAgICAgICAgJ3ZpZXcnOiAnVmlldycsDQogICAgICAgICAgICAgICAgJ29wdGlvbnMnOiB7fQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbnN0YW5jZSBvZiBTbGlkZXJDb250ZXh0IGNsYXNzIChAc2VlIFNsaWRlckNvbnRleHQpDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDsNCg0KICAgICAgICBjb250ZXh0Lm93bmVyID0gdGhpczsNCiAgICAgICAgY29udGV4dC5kZWZhdWx0cyA9IGRlZmF1bHRzOw0KICAgICAgICBjb250ZXh0LnNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBvcHRpb25zKTsNCiAgICAgICAgY29udGV4dC50cmFuc2l0aW9uU2V0dGluZ3MuJHNsaWRlcyA9IGNvbnRleHQuJHNsaWRlczsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBFeGVjdXRlcyBtZXRob2Qgd2l0aCBnaXZlbiBtZXRob2ROYW1lIG9uIGVhY2ggVGltZXIgaW4gY29udGV4dC50aW1lcnMgKEBzZWUgVGltZXIpDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBtZXRob2ROYW1lICAgbmFtZSBvZiBhIG1ldGhvZCwgd2hpY2ggd2lsbCBiZSBleGVjdXRlZCBvbiB0aW1lcnMNCiAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICAgY3VycmVudCBjb250ZXh0DQogICAgICovDQogICAgU2xpZGVyLnByb3RvdHlwZS5leGVjdXRlT25UaW1lcnMgPSBmdW5jdGlvbiAobWV0aG9kTmFtZSwgY29udGV4dCkgew0KICAgICAgICB2YXIgaSA9IG51bGwsDQogICAgICAgICAgICB0aW1lciA9IG51bGwsDQogICAgICAgICAgICB0aW1lcnMgPSBjb250ZXh0LnRpbWVyczsNCg0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGltZXJzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB0aW1lciA9IHRpbWVyc1tpXTsNCiAgICAgICAgICAgIGlmICh0eXBlb2YgKHRpbWVyW21ldGhvZE5hbWVdKSA9PT0gJ2Z1bmN0aW9uJykgew0KICAgICAgICAgICAgICAgIHRpbWVyW21ldGhvZE5hbWVdKCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogRGVzY2hlZHVsZXMgY2hhbmdlIG9mIGEgc2xpZGUsIGJ5IGNsZWFyaW5nIHRpbWVvdXQgcHJldmlvdXNseSBzZXQgYnkgc2V0VGllbW91dCgpIGZ1bmN0aW9uLg0KICAgICAqDQogICAgICogQG1lbWJlciBTbGlkZXINCiAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICAgY3VycmVudCBjb250ZXh0DQogICAgICovDQogICAgU2xpZGVyLnByb3RvdHlwZS5kZXNjaGVkdWxlU2xpZGUgPSBmdW5jdGlvbiAoY29udGV4dCkgew0KICAgICAgICBpZiAoY29udGV4dC50aW1lb3V0SWQgIT09IG51bGwpIHsNCiAgICAgICAgICAgIGNsZWFyVGltZW91dChjb250ZXh0LnRpbWVvdXRJZCk7DQogICAgICAgICAgICBjb250ZXh0LnRpbWVvdXRJZCA9IG51bGw7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogU2NoZWR1bGVzIGNoYW5nZSBvZiBhIHNsaWRlLCBieSBzZXR0aW5nIHRpbWVvdXQgKHVzaW5nIHNldFRpZW1vdXQoKSBmdW5jdGlvbikgaWYgY2FuLg0KICAgICAqIElmIGNhbid0LCB0cmllcyBhZ2FpbiBhZnRlciBzaG9ydCBwZXJpb2Qgb2YgdGltZS4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgU2xpZGVyDQogICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGN1cnJlbnQgY29udGV4dA0KICAgICAqLw0KICAgIFNsaWRlci5wcm90b3R5cGUuc2NoZWR1bGVTbGlkZSA9IGZ1bmN0aW9uIChjb250ZXh0KSB7DQogICAgICAgIHZhciBvd25lciA9IGNvbnRleHQub3duZXI7DQoNCiAgICAgICAgb3duZXIuZGVzY2hlZHVsZVNsaWRlKGNvbnRleHQpOw0KDQogICAgICAgIGlmICghY29udGV4dC5wcmV2ZW50U2NoZWR1bGluZyAmJiBjb250ZXh0LiRzbGlkZXMubGVuZ3RoID4gMSkgew0KICAgICAgICAgICAgb3duZXIuZXhlY3V0ZU9uVGltZXJzKCdzZXQnLCBjb250ZXh0KTsNCg0KICAgICAgICAgICAgaWYgKGNvbnRleHQuY2FuQ2hhbmdlU2xpZGUpIHsNCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC50aW1lSW5kaWNhdG9yICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQudGltZUluZGljYXRvci5wbGF5KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbnRleHQudGltZW91dElkID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIG93bmVyLmNoYW5nZUN1cnJlbnRTbGlkZUJ5KDEsIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIH0sIGNvbnRleHQuc2V0dGluZ3MudGltZW91dCAtIGNvbnRleHQuc2xpZGVUaW1lci5lbGFwc2VkKTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIG93bmVyLnNjaGVkdWxlU2xpZGUoY29udGV4dCk7DQogICAgICAgICAgICAgICAgfSwgMTAwKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBDaGFuZ2VzIGN1cnJlbnQgc2xpZGUsIGJ5IG9mZnNldCBwZXJmb3JtaW5nIGNvbnRleHQudHJhbnNpdGlvbg0KICAgICAqIEFueSBvZmZzZXQgdmFsdWUgaXMgc2F2ZSAoaWYgaXQgaXMgYW4gaW50ZWdlcikuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBvZmZzZXQgICAgdGhlIG9mZnNldCB0byBhbiBpbmRleCBvZiBhIG5ldyBzbGlkZQ0KICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgICBjdXJyZW50IGNvbnRleHQNCiAgICAgKi8NCiAgICBTbGlkZXIucHJvdG90eXBlLmNoYW5nZUN1cnJlbnRTbGlkZUJ5ID0gZnVuY3Rpb24gKG9mZnNldCwgY29udGV4dCkgew0KICAgICAgICB2YXIgc2V0dGluZ3MgPSBjb250ZXh0LnRyYW5zaXRpb25TZXR0aW5ncywNCiAgICAgICAgICAgICRjdXJyZW50U2xpZGUgPSBjb250ZXh0LmdldEN1cnJlbnRTbGlkZSgpLA0KICAgICAgICAgICAgJHNsaWRlcyA9IGNvbnRleHQuJHNsaWRlczsNCg0KICAgICAgICBpZiAoKG9mZnNldCAlICRzbGlkZXMubGVuZ3RoKSAhPT0gMCkgew0KICAgICAgICAgICAgY29udGV4dC5jYW5DaGFuZ2VTbGlkZSA9IGZhbHNlOw0KDQogICAgICAgICAgICBzZXR0aW5ncy5vZmZzZXQgPSBvZmZzZXQ7DQogICAgICAgICAgICBzZXR0aW5ncy4kY3VycmVudFNsaWRlID0gJGN1cnJlbnRTbGlkZTsNCiAgICAgICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUgPSAkc2xpZGVzLmVxKCgkY3VycmVudFNsaWRlLmluZGV4KCkgKyBvZmZzZXQpICUgJHNsaWRlcy5sZW5ndGgpOw0KDQogICAgICAgICAgICBjb250ZXh0LmNoYW5nZUN1cnJlbnRTbGlkZShzZXR0aW5ncy4kbmV4dFNsaWRlKTsNCiAgICAgICAgICAgIGNvbnRleHQudHJhbnNpdGlvbi5wZXJmb3JtKGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzKTsNCiAgICAgICAgICAgIGNvbnRleHQub3duZXIuZXhlY3V0ZU9uVGltZXJzKCdyZXNldCcsIGNvbnRleHQpOw0KICAgICAgICB9DQoNCg0KICAgICAgICB2YXIgJGNhcm91c2VsID0gJChjb250ZXh0LiR3cmFwcGVyKS5wYXJlbnRzKCIuY2Fyb3VzZWwiKTsNCiAgICAgICAgJGNhcm91c2VsLnRyaWdnZXIoInNsaWRlLWNoYW5nZWQiKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogU3RhcnRzIGF1dG9tYXRpYyBzbGlkZXMgY2hhbmdpbmcNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgU2xpZGVyDQogICAgICovDQogICAgU2xpZGVyLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuZXhlY3V0ZU9uVGltZXJzKCdyZXNldCcsIHRoaXMuY29udGV4dCk7DQogICAgICAgIHRoaXMuc2NoZWR1bGVTbGlkZSh0aGlzLmNvbnRleHQpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBDYW5jZWwgdGhlIGRlZmF1bHQgYWN0aW9uIG9mIGV2ZW50IGFuZCBjaGFuZ2VzIHNsaWRlIG1hbnVhbGx5Lg0KICAgICAqDQogICAgICogQG1lbWJlciBTbGlkZXINCiAgICAgKiBAcGFyYW0ge09iamVjdH0gZXZlbnQgICAgIHRoZSBldmVudA0KICAgICAqIEBwYXJhbSB7TnVtYmVyfSBvZmZzZXQgICAgdGhlIG9mZnNldCB0byBhbiBpbmRleCBvZiBhIG5ldyBzbGlkZQ0KICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgICBjdXJyZW50IGNvbnRleHQNCiAgICAgKi8NCiAgICBTbGlkZXIucHJvdG90eXBlLm9uQ2hhbmdlQ3VycmVudFNsaWRlID0gZnVuY3Rpb24gKGV2ZW50LCBvZmZzZXQsIGNvbnRleHQpIHsNCiAgICAgICAgdmFyIG93bmVyID0gY29udGV4dC5vd25lcjsNCg0KICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICBpZiAoY29udGV4dC5jYW5DaGFuZ2VTbGlkZSkgew0KICAgICAgICAgICAgb3duZXIuZGVzY2hlZHVsZVNsaWRlKGNvbnRleHQpOw0KICAgICAgICAgICAgb3duZXIuY2hhbmdlQ3VycmVudFNsaWRlQnkob2Zmc2V0LCBjb250ZXh0KTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBTZWxlY3RzIG5hdmlnYXRpb24gaXRlbSB3aXRoIGdpdmVuIGluZGV4Lg0KICAgICAqDQogICAgICogQG1lbWJlciBTbGlkZXINCiAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggICAgIHRoZSBpbmRleCBvZiBuYXZpZ2F0aW9uIGl0ZW0NCiAgICAgKi8NCiAgICBTbGlkZXIucHJvdG90eXBlLnNlbGVjdE5hdmlnYXRpb25JdGVtID0gZnVuY3Rpb24gKGluZGV4KSB7DQogICAgICAgIHRoaXMuY29udGV4dC5uYXZpZ2F0aW9uLnNlbGVjdEl0ZW0oaW5kZXgpOw0KICAgIH07DQogICAgLyoqDQogICAgICogZW5kIG9mIFNsaWRlciBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogU2xpZGVySW5pdGlhbGl6ZXIgb2JqZWN0IHNldCB1cCBpbnN0YW5jZXMgb2YgU2xpZGVyIGNsYXNzDQogICAgICovDQogICAgU2xpZGVySW5pdGlhbGl6ZXIgPSAoZnVuY3Rpb24gKCQpIHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEF0dGFjaGVzIGV2ZW50cyB0byBuYXZpZ2F0aW9uIGl0ZW1zLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICBhIGNvbnRleHQgb2YgYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UNCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGF0dGFjaE5hdmlnYXRpb25FdmVudHMoY29udGV4dCkgew0KICAgICAgICAgICAgdmFyIG93bmVyID0gY29udGV4dC5vd25lciwNCiAgICAgICAgICAgICAgICAkbmF2TGlua3MgPSBjb250ZXh0LiR3cmFwcGVyLmZpbmQoIi5uYXYgYSIpLA0KICAgICAgICAgICAgICAgICRwcmV2SXRlbVR4dCA9IGNvbnRleHQuJHdyYXBwZXIuZmluZCgnLnByZXYtdGV4dCcpLA0KICAgICAgICAgICAgICAgICRuZXh0SXRlbVR4dCA9IGNvbnRleHQuJHdyYXBwZXIuZmluZCgnLm5leHQtdGV4dCcpOw0KDQogICAgICAgICAgICBjb250ZXh0Lm5hdmlnYXRpb24uJGl0ZW1zLmVhY2goZnVuY3Rpb24gKGluZGV4KSB7DQogICAgICAgICAgICAgICAgdmFyICRzbGlkZSA9IGNvbnRleHQuJHNsaWRlcy5lcShpbmRleCk7DQoNCiAgICAgICAgICAgICAgICAkKHRoaXMpLmNsaWNrKGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgICAgICAgICAgICAgICBvd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShldmVudCwgJHNsaWRlLmluZGV4KCkgLSBjb250ZXh0LmdldEN1cnJlbnRTbGlkZSgpLmluZGV4KCksIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICRwcmV2SXRlbVR4dC5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgICAgICAgICBvd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShldmVudCwgLTEsIGNvbnRleHQpOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICRuZXh0SXRlbVR4dC5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgICAgICAgICBvd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShldmVudCwgMSwgY29udGV4dCk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgY29udGV4dC5uYXZpZ2F0aW9uLiRwcmV2SXRlbS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgICAgICAgICBvd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShldmVudCwgLTEsIGNvbnRleHQpOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGNvbnRleHQubmF2aWdhdGlvbi4kbmV4dEl0ZW0uY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgb3duZXIub25DaGFuZ2VDdXJyZW50U2xpZGUoZXZlbnQsIDEsIGNvbnRleHQpOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICRuYXZMaW5rcy5vbigia2V5ZG93biIsIGZ1bmN0aW9uIChldmVudCkgew0KICAgICAgICAgICAgICAgIHN3aXRjaCAoZXZlbnQua2V5Q29kZSkgew0KICAgICAgICAgICAgICAgICAgICBjYXNlIDM3Og0KICAgICAgICAgICAgICAgICAgICAgICAgb3duZXIub25DaGFuZ2VDdXJyZW50U2xpZGUoZXZlbnQsIC0xLCBjb250ZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuZmluZCgiLmFjdGl2ZSIpLmZvY3VzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOToNCiAgICAgICAgICAgICAgICAgICAgICAgIG93bmVyLm9uQ2hhbmdlQ3VycmVudFNsaWRlKGV2ZW50LCAxLCBjb250ZXh0KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuZmluZCgiLmFjdGl2ZSIpLmZvY3VzKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBBdHRhY2hlcyBwYXVzZSBldmVudCB0byBuYXZpZ2F0aW9uIHdyYXBwZXIuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgIGEgY29udGV4dCBvZiBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQ0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gYXR0YWNoUGF1c2VFdmVudChjb250ZXh0KSB7DQogICAgICAgICAgICB2YXIgb3duZXIgPSBjb250ZXh0Lm93bmVyLA0KICAgICAgICAgICAgICAgICRlbGVtZW50ID0gY29udGV4dC4kd3JhcHBlciwNCiAgICAgICAgICAgICAgICAkbmF2TGlua3MgPSAkZWxlbWVudC5maW5kKCIubmF2IGEiKTsNCg0KICAgICAgICAgICAgdmFyIGNhbGxiYWNrTW91c2VlbnRlciA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBjb250ZXh0LnByZXZlbnRTY2hlZHVsaW5nID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBvd25lci5kZXNjaGVkdWxlU2xpZGUoY29udGV4dCk7DQoNCiAgICAgICAgICAgICAgICBvd25lci5leGVjdXRlT25UaW1lcnMoJ3VwZGF0ZScsIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LnRpbWVJbmRpY2F0b3IgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC50aW1lSW5kaWNhdG9yLnBhdXNlKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkZWxlbWVudC5tb3VzZWVudGVyKGNhbGxiYWNrTW91c2VlbnRlcik7DQogICAgICAgICAgICAkbmF2TGlua3Mub24oImZvY3VzIiwgY2FsbGJhY2tNb3VzZWVudGVyKTsNCg0KICAgICAgICAgICAgdmFyIGNhbGxiYWNrTW91c2VMZWF2ZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBjb250ZXh0LnByZXZlbnRTY2hlZHVsaW5nID0gZmFsc2U7DQogICAgICAgICAgICAgICAgb3duZXIuc2NoZWR1bGVTbGlkZShjb250ZXh0KTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgJGVsZW1lbnQubW91c2VsZWF2ZShjYWxsYmFja01vdXNlTGVhdmUpOw0KICAgICAgICAgICAgJG5hdkxpbmtzLm9uKCJibHVyIiwgY2FsbGJhY2tNb3VzZUxlYXZlKTsNCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDcmVhdGVzIHRpbWUgaW5kaWNhdG9yIHZpZXcNCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgYSBjb250ZXh0IG9mIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBjcmVhdGVJbmRpY2F0b3IoY29udGV4dCkgew0KICAgICAgICAgICAgdmFyIHNldHRpbmdzID0gY29udGV4dC5zZXR0aW5ncywNCiAgICAgICAgICAgICAgICB0aW1lSW5kaWNhdG9yID0gbnVsbCwNCiAgICAgICAgICAgICAgICBWaWV3Q29uc3RydWN0b3IgPSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzW3NldHRpbmdzLnRpbWVJbmRpY2F0b3Iudmlld10sDQogICAgICAgICAgICAgICAgdmlldyA9IG51bGw7DQoNCiAgICAgICAgICAgIGlmIChWaWV3Q29uc3RydWN0b3IgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICB2aWV3ID0gbmV3IFZpZXdDb25zdHJ1Y3RvcihzZXR0aW5ncy50aW1lSW5kaWNhdG9yLnNlbGVjdG9yLCBzZXR0aW5ncy50aW1lSW5kaWNhdG9yLm9wdGlvbnMpOw0KICAgICAgICAgICAgICAgIHRpbWVJbmRpY2F0b3IgPSBuZXcgVGltZUluZGljYXRvcigkLCB2aWV3LCBzZXR0aW5ncy50aW1lb3V0KTsNCiAgICAgICAgICAgICAgICBjb250ZXh0LnRpbWVJbmRpY2F0b3IgPSB0aW1lSW5kaWNhdG9yOw0KICAgICAgICAgICAgICAgIGNvbnRleHQudGltZXJzLnB1c2godGltZUluZGljYXRvcik7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogQXR0YWNoZXMgZXZlbnRzIHRvIG5hdmlnYXRpb24uDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgIGEgY29udGV4dCBvZiBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQ0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gaW5pdGlhbGl6ZU5hdmlnYXRpb24oY29udGV4dCkgew0KICAgICAgICAgICAgY29udGV4dC5zZXR0aW5ncy5uYXZpZ2F0aW9uLnNsaWRlc0NvdW50ID0gY29udGV4dC4kc2xpZGVzLmxlbmd0aDsNCiAgICAgICAgICAgIGNvbnRleHQubmF2aWdhdGlvbiA9IG5ldyBOYXZpZ2F0aW9uKCQsIGNvbnRleHQuJHdyYXBwZXIsIGNvbnRleHQuc2V0dGluZ3MubmF2aWdhdGlvbik7DQoNCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIGF0dGFjaE5hdmlnYXRpb25FdmVudHMoY29udGV4dCk7DQogICAgICAgICAgICB9LCAxMDAwKTsNCg0KDQogICAgICAgICAgICBpZiAoY29udGV4dC5zZXR0aW5ncy5pc1BhdXNlRW5hYmxlZCkgew0KICAgICAgICAgICAgICAgIGF0dGFjaFBhdXNlRXZlbnQoY29udGV4dCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogSW5pdGlhbGl6ZXMgdHJhbnNpdGlvbiBmb3IgYSBnaXZlbiBjb250ZXh0Lg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICBhIGNvbnRleHQgb2YgYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UNCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGluaXRpYWxpemVUcmFuc2l0aW9uKGNvbnRleHQpIHsNCiAgICAgICAgICAgIHZhciBUcmFuc2l0aW9uQ29uc3RydWN0b3IgPSBudWxsLA0KICAgICAgICAgICAgICAgIG93bmVyID0gY29udGV4dC5vd25lcjsNCg0KICAgICAgICAgICAgY29udGV4dC50cmFuc2l0aW9uU2V0dGluZ3MuY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgY29udGV4dC5jYW5DaGFuZ2VTbGlkZSA9IHRydWU7DQoNCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5wcmV2ZW50U2NoZWR1bGluZykgew0KICAgICAgICAgICAgICAgICAgICBvd25lci5leGVjdXRlT25UaW1lcnMoJ3Jlc2V0JywgY29udGV4dCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgb3duZXIuc2NoZWR1bGVTbGlkZShjb250ZXh0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBUcmFuc2l0aW9uQ29uc3RydWN0b3IgPSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zW2NvbnRleHQuc2V0dGluZ3MudHJhbnNpdGlvbl07DQogICAgICAgICAgICBpZiAoKFRyYW5zaXRpb25Db25zdHJ1Y3RvciA9PT0gbnVsbCkgfHwgKFRyYW5zaXRpb25Db25zdHJ1Y3RvciA9PT0gdW5kZWZpbmVkKSkgew0KICAgICAgICAgICAgICAgIFRyYW5zaXRpb25Db25zdHJ1Y3RvciA9IFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnNbY29udGV4dC5kZWZhdWx0cy50cmFuc2l0aW9uXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnRleHQudHJhbnNpdGlvbiA9IG5ldyBUcmFuc2l0aW9uQ29uc3RydWN0b3IoKTsNCiAgICAgICAgICAgIGNvbnRleHQudHJhbnNpdGlvbi5pbml0KGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIEluaXRpYWxpemVzIFNsaWRlciBvYmplY3Qgd2l0aCBhIGdpdmVuIGNvbnRleHQuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgYSBjb250ZXh0IG9mIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChjb250ZXh0KSB7DQogICAgICAgICAgICAgICAgaW5pdGlhbGl6ZU5hdmlnYXRpb24oY29udGV4dCk7DQogICAgICAgICAgICAgICAgaW5pdGlhbGl6ZVRyYW5zaXRpb24oY29udGV4dCk7DQoNCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5zZXR0aW5ncy50aW1lSW5kaWNhdG9yLmlzRW5hYmxlZCkgew0KICAgICAgICAgICAgICAgICAgICBjcmVhdGVJbmRpY2F0b3IoY29udGV4dCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgIH0oJCkpOw0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBTbGlkZXJJbml0aWFsaXplcg0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogQ2Fyb3VzZWwgY2xhc3MgZGlzcGxheXMgb25lIHNsaWRlIChzb21lIGNvbnRlbnQpIGF0IHRoZSB0aW1lLg0KICAgICAqIEl0cyBiZWhhdmlvdXIgZGVwZW5kcyBvbiBzZXR0aW5ncyAocGFzc2VkIHRvIGluaXQoKSBtZXRob2QpLg0KICAgICAqIEZvciBtb3JlIGRldGFpbHMgQHNlZSBTbGlkZXIsIEBzZWUgU2xpZGVySW5pdGlhbGl6ZXIsIEBzZWUgTmF2aWdhdGlvbiwNCiAgICAgKiBAc2VlIE5hdmlnYXRpb25CdWlsZGVyLCBAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvbiwNCiAgICAgKiBAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MuVmlldw0KICAgICAqDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gQ2Fyb3VzZWwoKSB7DQogICAgICAgIHZhciBjb250ZXh0ID0gdGhpczsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogSW5zdGFuY2Ugb2YgYSBTbGlkZXIgY2xhc3MgKEBzZWUgU2xpZGVyKS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBDYXJvdXNlbA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5zbGlkZXIgPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogRGlzcGxheWVkIHNsaWRlIChqUXVlcnkgb2JqZWN0KS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBDYXJvdXNlbA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy4kY3VycmVudFNsaWRlID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIEFsbCBzbGlkZXMgKGpRdWVyeSBvYmplY3QpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiRzbGlkZXMgPSBudWxsOw0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBDaGFuZ2VzIGN1cnJlbnQgc2xpZGUgdG8gYSAkbmV3U2xpZGUuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgQ2Fyb3VzZWwNCiAgICAgICAgICogQHBhcmFtIHtPYmplY3R9ICRuZXdTbGlkZSAgdGhlIG5ldyBzbGlkZSAoalF1ZXJ5KSBvYmplY3QuDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmNoYW5nZUN1cnJlbnRTbGlkZSA9IGZ1bmN0aW9uICgkbmV3U2xpZGUpIHsNCiAgICAgICAgICAgIGNvbnRleHQuJGN1cnJlbnRTbGlkZSA9ICRuZXdTbGlkZTsNCiAgICAgICAgICAgIGNvbnRleHQuc2xpZGVyLnNlbGVjdE5hdmlnYXRpb25JdGVtKCRuZXdTbGlkZS5pbmRleCgpKTsNCiAgICAgICAgfTsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogUmV0dXJucyBjdXJyZW50IHNsaWRlLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICAgICAqIEByZXR1cm4gY3VycmVudCBzbGlkZSAoalF1ZXJ5KSBvYmplY3QuDQogICAgICAgICAqIEB0eXBlIE9iamVjdA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5nZXRDdXJyZW50U2xpZGUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICByZXR1cm4gY29udGV4dC4kY3VycmVudFNsaWRlOw0KICAgICAgICB9Ow0KDQogICAgICAgIHRoaXMuZGF0YSA9IHt9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlc2V0cyB0aGUgY2Fyb3VzZWwuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICovDQogICAgQ2Fyb3VzZWwucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB0aGlzLiRzbGlkZXMuZWFjaChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAkKHRoaXMpLmhpZGUoKTsNCiAgICAgICAgfSk7DQoNCiAgICAgICAgdGhpcy5jaGFuZ2VDdXJyZW50U2xpZGUodGhpcy4kc2xpZGVzLmZpcnN0KCkpOw0KICAgICAgICB0aGlzLiRjdXJyZW50U2xpZGUuc2hvdygpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyB0aGUgY2Fyb3VzZWwuDQogICAgICogV3JhcHBzIGNhcm91c2VsIGNvbnRlbnQgd2l0aCA8ZGl2IGNsYXNzPSJ3cmFwcGVyIiAvPiBlbGVtZW50LA0KICAgICAqIHNlbGVjdHMgc2xpZGVzICg8bGkgLz4gZWxlbWVudHMpIGZyb20gPHVsIGNsYXNzPSJzbGlkZXMiIC8+IGVsZW1lbnQsDQogICAgICogaW5pdGlhbGl6ZXMgU2xpZGVyIGNsYXNzIGluY3RhbmNlLCByZXNldHMgdGhlIGNhcm91c2VsIGFuZCBzdGFydCBhdXRvbWF0aWMgc2xpZGVzIGNoYW5naW5nLg0KICAgICAqDQogICAgICogQG1lbWJlciBDYXJvdXNlbA0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkY29udGFpbmVyICAgICBqUXVlcnkgb2JqZWN0IHdpdGggYSBtYWluIGh0bWwgZWxlbWVudCBvZiB0aGUgY2Fyb3VzZWwNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgICAgY2Fyb3VzZWwgb3B0aW9ucyBvYmplY3QNCiAgICAgKi8NCiAgICBDYXJvdXNlbC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICgkY29udGFpbmVyLCBvcHRpb25zKSB7DQogICAgICAgIHZhciAkd3JhcHBlciA9ICQoJzxkaXYvPicsIHsNCiAgICAgICAgICAgICdjbGFzcyc6ICd3cmFwcGVyJw0KICAgICAgICB9KSwNCiAgICAgICAgICAgIHNsaWRlckNvbnRleHQgPSBudWxsOw0KDQogICAgICAgICR3cmFwcGVyLmFwcGVuZCgkY29udGFpbmVyLmNoaWxkcmVuKCkuZGV0YWNoKCkpOw0KICAgICAgICAkY29udGFpbmVyLmFwcGVuZCgkd3JhcHBlcik7DQogICAgICAgIHRoaXMuJHNsaWRlcyA9ICRjb250YWluZXIuZmluZCgnLnNsaWRlcyBsaS5zbGlkZScpOw0KDQogICAgICAgIHNsaWRlckNvbnRleHQgPSBuZXcgU2xpZGVyQ29udGV4dCgpOw0KICAgICAgICBzbGlkZXJDb250ZXh0LmNoYW5nZUN1cnJlbnRTbGlkZSA9IHRoaXMuY2hhbmdlQ3VycmVudFNsaWRlOw0KICAgICAgICBzbGlkZXJDb250ZXh0LmdldEN1cnJlbnRTbGlkZSA9IHRoaXMuZ2V0Q3VycmVudFNsaWRlOw0KICAgICAgICBzbGlkZXJDb250ZXh0LiRzbGlkZXMgPSB0aGlzLiRzbGlkZXM7DQogICAgICAgIHNsaWRlckNvbnRleHQuJHdyYXBwZXIgPSAkd3JhcHBlcjsNCg0KICAgICAgICB0aGlzLnNsaWRlciA9IG5ldyBTbGlkZXIoJCwgc2xpZGVyQ29udGV4dCwgb3B0aW9ucyk7DQogICAgICAgIFNsaWRlckluaXRpYWxpemVyLmluaXRpYWxpemUoc2xpZGVyQ29udGV4dCk7DQoNCiAgICAgICAgdGhpcy5yZXNldCgpOw0KICAgICAgICB0aGlzLnNsaWRlci5ydW4oKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBDYXJvdXNlbCBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogUmVnaXN0ZXJzIGVhY2ggZWxlbWVudHMgdGhhdCBtYXRjaCB0aGUgcHJvdmlkZWQgc2VsZWN0b3IgYXMgYSBjYXJvdXNlbCB3aXRoIGEgZ2l2ZW4gb3B0aW9ucy4NCiAgICAgKiBDYXJvdXNlbCBvcHRpb25zIG9iamVjdCA6DQogICAgICogew0KICAgICAqICAgICAvLw0KICAgICAqICAgICAvLyBuYXZpZ2F0aW9uOiBPYmplY3QNCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgLy8gVGhlIG5hdmlnYXRpb24gY29uZmlndXJhdGlvbiBvYmplY3QuDQogICAgICogICAgIC8vDQogICAgICogICAgICduYXZpZ2F0aW9uJzogew0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vaXNFbmFibGVkOiBCb29sZWFuDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gU2V0cyB3aGV0aGVyIHRoZSBuYXZpZ2F0aW9uIGlzIGVuYWJsZWQuDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgJ2lzRW5hYmxlZCc6IHRydWUsDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gaGFzUHJldk5leHRJdGVtczogQm9vbGVhbg0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIFNldHMgd2hldGhlciB0aGUgbmF2aWdhdGlvbiBoYXMgcHJldmlvdXMgYW5kIG5leHQgYnV0dG9ucy4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAnaGFzUHJldk5leHRJdGVtcyc6IHRydWUsDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gaXRlbTogT2JqZWN0DQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gTmF2aWdhdGlvbiBpdGVtIGNvbmZpZ3VyYXRpb24gb2JqZWN0Lg0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICdpdGVtJzogew0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gbGFiZWw6IFN0cmluZw0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gTGFiZWwgdGVtcGxhdGU7IGVhY2ggJyN7aW5kZXh9JyBzdHJpbmcgd2lsbCBiZSByZXBsYWNlZCBieSB0aGUgbnVtYmVyIG9mIGEgc2xpZGUuDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAnbGFiZWwnOiAnI3tpbmRleH0nLA0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gc2VsZWN0b3I6IFN0cmluZw0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gTmF2aWdhdGlvbiBpdGVtcyBjb250YWluZXIgc2VsZWN0b3I7IGlmIGVxdWFscyBudWxsLCB0aGUgY29udGFpbmVyIHdpbGwgYmUgZ2VuZXJhdGVkDQogICAgICogICAgICAgICAgICAgLy8gKCdkaXYnIGVsZW1lbnQgd2l0aCAnbmF2JyBjbGFzcyBhdHRyaWJ1dGUgaW5zaWRlIHRoZSBjYXJvdXNlbCkuDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAnc2VsZWN0b3InOiBudWxsDQogICAgICogICAgICAgIH0sDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gcHJldkl0ZW06IE9iamVjdA0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIE5hdmlnYXRpb24gJ3ByZXZpb3VzIGl0ZW0nIGNvbmZpZ3VyYXRpb24gb2JqZWN0Lg0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICdwcmV2SXRlbSc6IHsNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIGxhYmVsOiBTdHJpbmcNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIFRoZSAncHJldmlvdXMgaXRlbScgbGFiZWwuDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAnbGFiZWwnOiAnPCcsDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBzZWxlY3RvcjogU3RyaW5nDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBOYXZpZ2F0aW9uICdwcmV2aW91cyBpdGVtJyBzZWxlY3RvcjsgaWYgZXF1YWxzIG51bGwsIHRoZSBpdGVtIHdpbGwgYmUgZ2VuZXJhdGVkDQogICAgICogICAgICAgICAgICAgLy8gKCdhJyBlbGVtZW50IHdpdGggJ3ByZXYnIGNsYXNzIGF0dHJpYnV0ZSBpbnNpZGUgdGhlIG5hdmlnYXRpb24gY29udGFpbmVyKS4NCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgICdzZWxlY3Rvcic6IG51bGwsDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBpc0NvbnRhaW5lcjogQm9vbGVhbg0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gU2V0cyB3aGV0aGVyIHRoZSBlbGVtZW50IGZvdW5kIGJ5IHNlbGVjdG9yIHNob3VsZCBiZSB0cmVhdGVkIGFzIGEgY29udGFpbmVyIChpZiB0cnVlKQ0KICAgICAqICAgICAgICAgICAgIC8vIG9yIHNob3VsZCBiZSBhZG9wdGVkIGFzIGEgJ3ByZXZpb3VzIGl0ZW0nIChpZiBmYWxzZSkuIElmIHNlbGVjdG9yIGVxdWFscyBudWxsIHRoaXMgcHJvcGVydHkgaXMgbWVhbmluZ2xlc3MuDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAnaXNDb250YWluZXInOiBmYWxzZQ0KICAgICAqICAgICAgICAgfSwNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBuZXh0SXRlbTogT2JqZWN0DQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gTmF2aWdhdGlvbiAnbmV4dCBpdGVtJyBjb25maWd1cmF0aW9uIG9iamVjdC4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAnbmV4dEl0ZW0nOiB7DQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBsYWJlbDogU3RyaW5nDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBUaGUgJ25leHQgaXRlbScgbGFiZWwuDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAnbGFiZWwnOiAnPicsDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBzZWxlY3RvcjogU3RyaW5nDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBOYXZpZ2F0aW9uICduZXh0IGl0ZW0nIHNlbGVjdG9yOyBpZiBlcXVhbHMgbnVsbCwgdGhlIGl0ZW0gd2lsbCBiZSBnZW5lcmF0ZWQNCiAgICAgKiAgICAgICAgICAgICAvLyAoJ2EnIGVsZW1lbnQgd2l0aCAnbmV4dCcgY2xhc3MgYXR0cmlidXRlIGluc2lkZSB0aGUgbmF2aWdhdGlvbiBjb250YWluZXIpLg0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgJ3NlbGVjdG9yJzogbnVsbCwNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIGlzQ29udGFpbmVyOiBCb29sZWFuDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBTZXRzIHdoZXRoZXIgdGhlIGVsZW1lbnQgZm91bmQgYnkgc2VsZWN0b3Igc2hvdWxkIGJlIHRyZWF0ZWQgYXMgYSBjb250YWluZXIgKGlmIHRydWUpDQogICAgICogICAgICAgICAgICAgLy8gb3Igc2hvdWxkIGJlIGFkb3B0ZWQgYXMgYSAnbmV4dCBpdGVtJyAoaWYgZmFsc2UpLiBJZiBzZWxlY3RvciBlcXVhbHMgbnVsbCB0aGlzIHByb3BlcnR5IGlzIG1lYW5pbmdsZXNzLg0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgJ2lzQ29udGFpbmVyJzogZmFsc2UNCiAgICAgKiAgICAgICAgIH0NCiAgICAgKiAgICAgfSwNCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgLy8gdGltZW91dDogTnVtYmVyDQogICAgICogICAgIC8vDQogICAgICogICAgIC8vIFRoZSBpbnRlcnZhbCBiZXR3ZWVuIHRoZSBzbGlkZXMgaW4gbWlsaXNlY29uZHMuDQogICAgICogICAgIC8vDQogICAgICogICAgICd0aW1lb3V0JzogMTAwMDAsDQogICAgICogICAgIC8vDQogICAgICogICAgIC8vIHRyYW5zaXRpb246IFN0cmluZw0KICAgICAqICAgICAvLw0KICAgICAqICAgICAvLyBOYW1lIG9mIHRoZSB0cmFuc2l0aW9uIGNsYXNzLCB3aGljaCB3aWxsIGJlIHVzZWQuIFBvc3NpYmxlIHZhbHVlcyBhcmU6DQogICAgICogICAgIC8vIC0gQmFzaWNUcmFuc2l0aW9uIC0gd2l0aG91dCBhbnkgYW5pbWF0aW9uLA0KICAgICAqICAgICAvLyAtIEZhZGVJblRyYW5zaXRpb24gLSBuZXcgc2xpZGUgZmFkZXMgaW4sDQogICAgICogICAgIC8vIC0gU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uIC0gbmV3IHNsaWRlIG1vdmVzIGZyb20gcmlnaHQgKGZyb20gbGVmdCBpZiB1c2VyIHNlbGVjdHMgc2xpZGUgd2l0aCBsb3dlciBpZCBvciBjbGlja3Mgb24gJ3ByZXZpb3VzIGl0ZW0nKSwNCiAgICAgKiAgICAgLy8gLSBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uIC0gbmV3IHNsaWRlIG1vdmVzIGZyb20gdG9wIChmcm9tIGJvdHRvbSBpZiB1c2VyIHNlbGVjdHMgc2xpZGUgd2l0aCBsb3dlciBpZCBvciBjbGlja3Mgb24gJ3ByZXZpb3VzIGl0ZW0nKSwNCiAgICAgKiAgICAgLy8gLSBvdGhlciAtIGlmIGltcGxlbWVudGVkIChkZXJpdmVkIGZyb20gWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5UcmFuc2l0aW9uIGNsYXNzKSBhbmQgYWRkZWQgdG8gWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucyBtb2R1bGUuDQogICAgICogICAgIC8vDQogICAgICogICAgICd0cmFuc2l0aW9uJzogJ0Jhc2ljVHJhbnNpdGlvbicsDQogICAgICogICAgIC8vDQogICAgICogICAgIC8vIGlzUGF1c2VFbmFibGVkOiBCb29sZWFuDQogICAgICogICAgIC8vDQogICAgICogICAgIC8vIFNldHMgd2hldGhlciB0aGUgcGF1c2UgZmVhdHVyZSBpcyBlbmFibGVkLg0KICAgICAqICAgICAvLyBQYXVzZSBmZWF0dXJlIHBhdXNlcyBjb3VudGRvd24gb2YgY2hhbmdpbmcgc2xpZGVzLCB3aGVuIG1vdXNlIGlzIGluIGEgY2Fyb3VzZWwgYXJlYS4NCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgJ2lzUGF1c2VFbmFibGVkJzogdHJ1ZSwNCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgLy8gdGltZUluZGljYXRvcjogT2JqZWN0DQogICAgICogICAgIC8vDQogICAgICogICAgIC8vICdUaW1lIGluZGljYXRvcicgY29uZmlndXJhdGlvbiBvYmplY3QuDQogICAgICogICAgIC8vDQogICAgICogICAgICd0aW1lSW5kaWNhdG9yJzogew0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIGlzRW5hYmxlZDogQm9vbGVhbg0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIFNldHMgd2hldGhlciB0aGUgJ3RpbWUgaW5kaWNhdG9yJyBpcyBlbmFibGVkLg0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICdpc0VuYWJsZWQnOiBmYWxzZSwNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBzZWxlY3RvcjogU3RyaW5nDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gJ1RpbWUgaW5kaWNhdG9yJyBzZWxlY3Rvci4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAnc2VsZWN0b3InOiBudWxsLA0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIHZpZXc6IFN0cmluZw0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIE5hbWUgb2YgdGhlIHZpZXcgY2xhc3MsIHdoaWNoIHdpbGwgYmUgdXNlZC4gUG9zc2libGUgdmFsdWVzIGFyZToNCiAgICAgKiAgICAgICAgIC8vIC0gVmlldyAtIHdpdGhvdXQgYW55IGFuaW1hdGlvbiAoYmFzZSBjbGFzcyksDQogICAgICogICAgICAgICAvLyAtIFByb2dyZXNzQmFyVmlldyAtIHNob3dzIHRoZSBwcm9ncmVzcyBvZiB0aW1lIGFzIHByb2dyZXNzIGJhciwNCiAgICAgKiAgICAgICAgIC8vIC0gUm90YXRvclZpZXcgLSBzaG93cyB0aGUgcHJvZ3Jlc3Mgb2YgdGltZSB3aXRoIHRoZSBmaWxsaW5nIHVwIHJpbmcNCiAgICAgKiAgICAgICAgIC8vIC0gb3RoZXIgLSBpZiBpbXBsZW1lbnRlZCAoZGVyaXZlZCBmcm9tIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MuVmlldyBjbGFzcykgYW5kIGFkZGVkIHRvIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MgbW9kdWxlLg0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICd2aWV3JzogJ1ZpZXcnLA0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIG9wdGlvbnM6IE9iamVjdA0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vICdUaW1lIGluZGljYXRvcicgdmlldyBzZXR0aW5ncyBvYmplY3QuIERlcGVuZHMgb24gdmlldy4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAnb3B0aW9ucyc6IHt9DQogICAgICogICAgIH0NCiAgICAgKiB9DQogICAgICovDQoNCiAgICAvKiBwdWIucmVnaXN0ZXIgPSBmdW5jdGlvbiAoc2VsZWN0b3IsIG9wdGlvbnMpIHsNCiAgICAgdmFyICRjYXJvdXNlbHMgPSAkKHNlbGVjdG9yKTsNCiAgICAgJGNhcm91c2Vscy5lYWNoKGZ1bmN0aW9uICgpIHsNCiAgICAgLy92YXIgY2Fyb3VzZWwgPSBuZXcgQ2Fyb3VzZWwoJCk7DQogICAgIGNvbnNvbGUubG9nKCQodGhpcykpOw0KICAgICAvL2Nhcm91c2VsLmluaXQoJCh0aGlzKSwgb3B0aW9ucyk7DQogICAgIH0pOw0KICAgICB9OyovDQoNCiAgICAvKiBDYXJvdXNlbCB0b3VjaCBzdXBwb3J0ICovDQogICAgQ2Fyb3VzZWwucHJvdG90eXBlLnN3aXBlU2xpZGUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBzZWxmID0gdGhpcywNCiAgICAgICAgICAgICR3cmFwcGVyID0gdGhpcy5zbGlkZXIuY29udGV4dC4kd3JhcHBlciwNCiAgICAgICAgICAgIGhhbW1lciA9IG5ldyBIYW1tZXIoJHdyYXBwZXJbMF0pOw0KICAgICAgICBoYW1tZXIuZ2V0KCdwYW4nKS5zZXQoeyBkaXJlY3Rpb246IEhhbW1lci5ESVJFQ1RJT05fQUxMIH0pOw0KDQogICAgICAgIGhhbW1lci5vbigic3dpcGVsZWZ0IiwgZnVuY3Rpb24gKGUpIHsNCiAgICAgICAgICAgIHNlbGYuc2xpZGVyLmNvbnRleHQub3duZXIub25DaGFuZ2VDdXJyZW50U2xpZGUoZSwgMSwgc2VsZi5zbGlkZXIuY29udGV4dCk7DQogICAgICAgIH0pOw0KDQogICAgICAgIGhhbW1lci5vbigic3dpcGVyaWdodCIsIGZ1bmN0aW9uIChlKSB7DQogICAgICAgICAgICBzZWxmLnNsaWRlci5jb250ZXh0Lm93bmVyLm9uQ2hhbmdlQ3VycmVudFNsaWRlKGUsIC0xLCBzZWxmLnNsaWRlci5jb250ZXh0KTsNCiAgICAgICAgfSk7DQogICAgfTsNCg0KICAgIENhcm91c2VsLnByb3RvdHlwZS5kaXNhYmxlRW1wdHlTbGlkZXMgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBlbXB0eVBsYWNlaG9sZGVycyA9IHRoaXMuJHNsaWRlcy5maW5kKCIuc2NFbXB0eVBsYWNlaG9sZGVyIiksDQogICAgICAgICAgICBwbGFjZWhvbGRlckNvZGVUYWcsDQogICAgICAgICAgICAkcGxhY2Vob2xkZXIsDQogICAgICAgICAgICBwbGFjZWhvbGRlcklkLA0KICAgICAgICAgICAgcGxhY2Vob2xkZXJLZXksDQogICAgICAgICAgICBlZGl0RnJhbWUsDQogICAgICAgICAgICBjaHJvbWVLZXksDQogICAgICAgICAgICBoOw0KDQogICAgICAgIF8uZWFjaChlbXB0eVBsYWNlaG9sZGVycywgZnVuY3Rpb24gKHBsYWNlaG9sZGVyKSB7DQogICAgICAgICAgICAkcGxhY2Vob2xkZXIgPSAkKHBsYWNlaG9sZGVyKTsNCiAgICAgICAgICAgIHBsYWNlaG9sZGVySWQgPSAkcGxhY2Vob2xkZXIuYXR0cigic2MtcGxhY2Vob2xkZXItaWQiKTsNCg0KICAgICAgICAgICAgLy9kaXNhYmxlIGVkaXQgZnJhbWVzDQogICAgICAgICAgICBwbGFjZWhvbGRlckNvZGVUYWcgPSAkcGxhY2Vob2xkZXIuc2libGluZ3MoImNvZGVbY2hyb21ldHlwZT0ncGxhY2Vob2xkZXInXVtpZD0nIiArIHBsYWNlaG9sZGVySWQgKyAiJ10iKTsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXJLZXkgPSBwbGFjZWhvbGRlckNvZGVUYWcuYXR0cigia2V5Iik7DQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiAocGxhY2Vob2xkZXJLZXkpID09PSAic3RyaW5nIikgew0KICAgICAgICAgICAgICAgICAgICBlZGl0RnJhbWUgPSBTaXRlY29yZS5QYWdlTW9kZXMuQ2hyb21lTWFuYWdlci5jaHJvbWVzKCkuZmlsdGVyKGZ1bmN0aW9uIChjaHJvbWUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNocm9tZUtleSA9IGNocm9tZS5vcGVuaW5nTWFya2VyKCk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWNocm9tZUtleSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgY2hyb21lS2V5ID0gY2hyb21lS2V5LmF0dHIoImtleSIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiAoY2hyb21lS2V5KSAhPT0gInVuZGVmaW5lZCIgJiYgY2hyb21lS2V5LmluZGV4T2YocGxhY2Vob2xkZXJLZXkpID09PSAwOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgICBlZGl0RnJhbWVbMF0udHlwZS5jaHJvbWUuZGF0YS5jdXN0b20uZWRpdGFibGUgPSAiZmFsc2UiOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IDY2NjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7IC8vZmFsbGJhY2sgLSBkZWxldGUgY29kZSB0YWdzIHRvIHByZXZlbnQgaW5zZXJ0aW5nIGludG8gcGxhY2Vob2xkZXJzDQogICAgICAgICAgICAgICAgJHBsYWNlaG9sZGVyLnNpYmxpbmdzKCJjb2RlW2Nocm9tZXR5cGU9J3BsYWNlaG9sZGVyJ10iKS5yZW1vdmUoKTsNCiAgICAgICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovDQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkNvdWxkIG5vdCBkaXNhYmxlIGVkaXRpbmcgZm9yIHBsYWNlaG9sZGVyIiwgZSk7DQogICAgICAgICAgICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1jb25zb2xlICovDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vYWRqdXN0IGhlaWdodCwgYW5kIHJlbW92ZSBwbGFjZWhvbGRlciAiZGFzaGVkIiBiYWNrZ3JvdW5kDQogICAgICAgICAgICBoID0gJHBsYWNlaG9sZGVyLmhlaWdodCgpICsgInB4IjsNCiAgICAgICAgICAgICRwbGFjZWhvbGRlci5yZW1vdmVDbGFzcygic2NFbXB0eVBsYWNlaG9sZGVyIik7DQogICAgICAgICAgICAkcGxhY2Vob2xkZXIuY3NzKCJoZWlnaHQiLCBoKTsNCg0KICAgICAgICAgICAgLy9zZXQgZWRpdCBoZXJlIHRleHQNCiAgICAgICAgICAgICRwbGFjZWhvbGRlci5hcHBlbmQoJCgiPHA+W05vIGNvbXBvbmVudHMgaW4gc2xpZGVdPC9wPiIpKTsNCiAgICAgICAgfSk7DQogICAgfQ0KDQoNCiAgICBDYXJvdXNlbC5wcm90b3R5cGUucmVzaXplV3JhcHBlciA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdmFyIHBhZ2VIZWlnaHQgPSAkKGRvY3VtZW50KS5vdXRlckhlaWdodCgpLA0KICAgICAgICAgICAgaGVhZGVySGVpZ2h0ID0gJCgnI2hlYWRlcicpLm91dGVySGVpZ2h0KCksDQogICAgICAgICAgICBjb250ZW50UGFkZGluZ1RvcCA9IHBhcnNlSW50KCQoJyNjb250ZW50JykuY3NzKCdwYWRkaW5nLXRvcCcpLCAxMCksDQogICAgICAgICAgICBjb250ZW50UGFkZGluZ0JvdHRvbSA9IHBhcnNlSW50KCQoJyNjb250ZW50JykuY3NzKCdwYWRkaW5nLWJvdHRvbScpLCAxMCksDQogICAgICAgICAgICBjb250ZW50UGFkZGluZyA9IGNvbnRlbnRQYWRkaW5nVG9wICsgY29udGVudFBhZGRpbmdCb3R0b20sDQogICAgICAgICAgICBmb290ZXJIZWlnaHQgPSAkKCcjZm9vdGVyJykub3V0ZXJIZWlnaHQoKSwNCiAgICAgICAgICAgIHdyYXBwZXIgPSB0aGlzLnNsaWRlci5jb250ZXh0LiR3cmFwcGVyLA0KICAgICAgICAgICAgY2Fyb3VzZWxIZWlnaHQgPSAwOw0KDQogICAgICAgIGNhcm91c2VsSGVpZ2h0ID0gcGFnZUhlaWdodCAtIChoZWFkZXJIZWlnaHQgKyBmb290ZXJIZWlnaHQgKyBjb250ZW50UGFkZGluZyk7DQoNCiAgICAgICAgd3JhcHBlci5jc3Moew0KICAgICAgICAgICAgJ2hlaWdodCc6IGNhcm91c2VsSGVpZ2h0DQogICAgICAgIH0pOw0KDQogICAgICAgIHdyYXBwZXIuZmluZCgnLnNsaWRlcycpLmNzcyh7DQogICAgICAgICAgICAnaGVpZ2h0JzogY2Fyb3VzZWxIZWlnaHQNCiAgICAgICAgfSk7DQogICAgfTsNCg0KICAgIHB1Yi5pbml0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAkKCIuY2Fyb3VzZWw6bm90KC5pbml0aWFsaXplZCkiKS5lYWNoKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHZhciBwcm9wZXJ0aWVzID0gJCh0aGlzKS5kYXRhKCJwcm9wZXJ0aWVzIiksDQogICAgICAgICAgICAgICAgY29tcG9uZW50ID0gJCh0aGlzKS5maW5kKCIuY2Fyb3VzZWwtaW5uZXIiKSwNCiAgICAgICAgICAgICAgICBpZCA9IGNvbXBvbmVudC5hdHRyKCJkYXRhLWlkIiksDQogICAgICAgICAgICAgICAgc2VsZiA9IHRoaXMsDQogICAgICAgICAgICAgICAgcXVlcnlTbGlkZUluZGV4ID0gTnVtYmVyLnBhcnNlSW50KFhBLnF1ZXJ5U3RyaW5nLmdldFF1ZXJ5UGFyYW0oY29tcG9uZW50LmNsb3Nlc3QoJy5jb21wb25lbnQuY2Fyb3VzZWwnKS5hdHRyKCJpZCIpIHx8ICJjYXJvdXNlbCIpKSwNCiAgICAgICAgICAgICAgICB2YWxpZFF1ZXJ5UGFyYW0gPSB0eXBlb2YgcXVlcnlTbGlkZUluZGV4ICE9PSAidW5kZWZpbmVkIiAmJiAhTnVtYmVyLmlzTmFOKHF1ZXJ5U2xpZGVJbmRleCkgJiYgcXVlcnlTbGlkZUluZGV4IDwgY29tcG9uZW50LmZpbmQoIi5zeGEtbnVtYmVycyIpLmxlbmd0aCwNCiAgICAgICAgICAgICAgICBjb250ZXh0LCBzZXR0aW5ncywgJGN1cnJlbnRTbGlkZSwgJHNsaWRlczsNCg0KICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMpIHsNCiAgICAgICAgICAgICAgICBpZiAoIXByb3BlcnRpZXMubmF2aWdhdGlvbikgew0KICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLm5hdmlnYXRpb24gPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpdGVtOiB7fSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZJdGVtOiB7fSwNCiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRJdGVtOiB7fSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGlzRW5hYmxlZDogdmFsaWRRdWVyeVBhcmFtID8gZmFsc2UgOiB0cnVlDQogICAgICAgICAgICAgICAgICAgIH07DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHByb3BlcnRpZXMubmF2aWdhdGlvbi5pdGVtLnNlbGVjdG9yID0gIltkYXRhLWlkPSciICsgaWQgKyAiJ10gLm5hdi1pdGVtcyI7IC8vcHJvcGVydGllcy5uYXZpZ2F0aW9uLml0ZW0uc2VsZWN0b3I7DQogICAgICAgICAgICAgICAgcHJvcGVydGllcy5uYXZpZ2F0aW9uLnByZXZJdGVtLnNlbGVjdG9yID0gIiMiICsgaWQgKyAiIC5uYXYiOw0KICAgICAgICAgICAgICAgIHByb3BlcnRpZXMubmF2aWdhdGlvbi5uZXh0SXRlbS5zZWxlY3RvciA9ICIjIiArIGlkICsgIiAubmF2IjsNCg0KICAgICAgICAgICAgICAgIHZhciBjYXJvdXNlbCA9IG5ldyBDYXJvdXNlbCgkKTsNCiAgICAgICAgICAgICAgICBjYXJvdXNlbC5pbml0KGNvbXBvbmVudCwgcHJvcGVydGllcyk7DQoNCiAgICAgICAgICAgICAgICAkKHdpbmRvdykub24oJ2xvYWQnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgkKHNlbGYpLmhhc0NsYXNzKCdjYXJvdXNlbC1jbGllbnRzJykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhcm91c2VsLnJlc2l6ZVdyYXBwZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBjYXJvdXNlbC5kaXNhYmxlRW1wdHlTbGlkZXMoKTsNCiAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgIGlmICh2YWxpZFF1ZXJ5UGFyYW0pIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dCA9IGNhcm91c2VsLnNsaWRlci5jb250ZXh0LA0KICAgICAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3MgPSBjb250ZXh0LnRyYW5zaXRpb25TZXR0aW5ncywNCiAgICAgICAgICAgICAgICAgICAgICAgICRjdXJyZW50U2xpZGUgPSBjb250ZXh0LmdldEN1cnJlbnRTbGlkZSgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgJHNsaWRlcyA9IGNvbnRleHQuJHNsaWRlczsNCg0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmNhbkNoYW5nZVNsaWRlID0gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLiRjdXJyZW50U2xpZGUgPSAkY3VycmVudFNsaWRlOw0KICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlID0gJCgkc2xpZGVzW3F1ZXJ5U2xpZGVJbmRleF0pOw0KDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuY2hhbmdlQ3VycmVudFNsaWRlKHNldHRpbmdzLiRuZXh0U2xpZGUpOw0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnRyYW5zaXRpb24ucGVyZm9ybShjb250ZXh0LnRyYW5zaXRpb25TZXR0aW5ncyk7DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQub3duZXIuZXhlY3V0ZU9uVGltZXJzKCdyZXNldCcsIGNvbnRleHQpOw0KDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQubmF2aWdhdGlvbi5wcmVwYXJlSXRlbXMocHJvcGVydGllcy5uYXZpZ2F0aW9uLml0ZW0sICRzbGlkZXMubGVuZ3RoLCAkKGNvbnRleHQuJHdyYXBwZXIpKTsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC5uYXZpZ2F0aW9uLnNlbGVjdEl0ZW0ocXVlcnlTbGlkZUluZGV4KTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBjYXJvdXNlbC5zd2lwZVNsaWRlKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCJpbml0aWFsaXplZCIpOw0KICAgICAgICB9KTsNCiAgICB9Ow0KDQogICAgcmV0dXJuIHB1YjsNCn0oalF1ZXJ5KSk7DQovKioNCiAqIGVuZCBvZiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzIG1vZHVsZS4NCiAqLw0KDQoNClhBLnJlZ2lzdGVyKCJjYXJvdXNlbHMiLCBYQS5jb21wb25lbnQuY2Fyb3VzZWxzKTsNCg0KDQovKioNCiAqIFhBQ29udGV4dA0KICoNCiAqIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMgbW9kdWxlLg0KICoNCiAqIEV4cG9zZXMgVHJhbnNpdGlvbiBjbGFzcywgd2hpY2ggaXMgYmFzZSBjbGFzcyBvZiBhbGwgdHJhbnNpdGlvbnMgdXNlZCBieSBjYXJvdXNlbHMgKEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2VscywgQHNlZSBTbGlkZXIsIEBzZWUgVHJhbnNpdGlvbikuDQogKiBBbHNvIGV4cG9zZXMgaW1wbGVtZW50YXRpb24gb2YgYmFzaWMgZWZmZWN0czoNCiAqIC0gQmFzaWNUcmFuc2l0aW9uIC0gd2l0aG91dCBhbnkgYW5pbWF0aW9uLA0KICogLSBGYWRlSW5UcmFuc2l0aW9uIC0gbmV3IHNsaWRlIGZhZGVzIGluLA0KICogLSBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24gLSBuZXcgc2xpZGUgbW92ZXMgZnJvbSByaWdodCAoZnJvbSBsZWZ0IGlmIHVzZXIgc2VsZWN0cyBzbGlkZSB3aXRoIGxvd2VyIGlkIG9yIGNsaWNrcyBvbiAncHJldmlvdXMgaXRlbScpLA0KICogLSBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uIC0gbmV3IHNsaWRlIG1vdmVzIGZyb20gdG9wIChmcm9tIGJvdHRvbSBpZiB1c2VyIHNlbGVjdHMgc2xpZGUgd2l0aCBsb3dlciBpZCBvciBjbGlja3Mgb24gJ3ByZXZpb3VzIGl0ZW0nKS4NCiAqIENhcm91c2VsIHRha2VzIHRoZSBjbGFzcyBjb25zdHJ1Y3RvciBieSBuYW1lIGZyb20gdGhpcyBtb2R1bGUgKGl0IGlzIGdpdmVuIGluIG9wdGlvbnMgb2JqZWN0IG9mIGNhcm91c2VsOyBAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMpLg0KICogSWYgdGhlcmUgaXMgYSBuZWVkIHRvIGltcGxlbWVudCB0aGUgbmV3IGVmZmVjdCwgY3JlYXRlIGEgbmV3IGNsYXNzLCBieSBpbmhlcml0aW5nIGZyb20gVHJhbnNpdGlvbiBjbGFzcyBhbmQgYWRkIGl0IHRvIHRoaXMgbW9kdWxlLg0KICoNCiAqIEV4YW1wbGUgZWZmZWN0IGltcGxlbWVudGF0aW9uIChjdXJyZW50bHkgZGlzcGxheWVkIHNsaWRlIGlzIHNocmlua2luZyB0byBjZW50ZXIgb2YgdGhlIGNhcm91c2VsKToNCiAqIChmdW5jdGlvbiAoKSB7DQoqICAgICBmdW5jdGlvbiBTYW1wbGVUcmFuc2l0aW9uKCkgeyB9DQoqDQoqICAgICAvL2luaGVyaXQgZnJvbSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zLlRyYW5zaXRpb24NCiogICAgIFNhbXBsZVRyYW5zaXRpb24ucHJvdG90eXBlID0gbmV3IFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvbigpOw0KKiAgICAgU2FtcGxlVHJhbnNpdGlvbi5jb25zdHJ1Y3RvciA9IFNhbXBsZVRyYW5zaXRpb247DQoqDQoqICAgICBTYW1wbGVUcmFuc2l0aW9uLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKHNldHRpbmdzKSB7DQoqICAgICAgICAgLy9wb3NpdGlvbmluZyBhbGwgc2xpZGVzIGluIHRoZSB0b3AgbGVmdCBjb3JuZXIgb2YgdGhlIGNhcm91c2VsDQoqICAgICAgICAgc2V0dGluZ3MuJHNsaWRlcy5jc3Moew0KKiAgICAgICAgICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLA0KKiAgICAgICAgICAgICAndG9wJzogJzBweCcsDQoqICAgICAgICAgICAgICdsZWZ0JzogJzBweCcNCiogICAgICAgICB9KTsNCiogICAgIH07DQoqDQoqICAgICBTYW1wbGVUcmFuc2l0aW9uLnByb3RvdHlwZS5vbkFuaW1hdGlvbkNvbXBsZXRlID0gZnVuY3Rpb24oc2V0dGluZ3MsIHdpZHRoLCBoZWlnaHQpIHsNCiogICAgICAgICB2YXIgekluZGV4QXR0cmliID0gJ3otaW5kZXgnLA0KKiAgICAgICAgICRjdXJyZW50ID0gc2V0dGluZ3MuJGN1cnJlbnRTbGlkZTsNCioNCiogICAgICAgICAkY3VycmVudC5oaWRlKCk7DQogICAgICAgICAgLy9yZXZlcnRpbmcgY2hhbmdlcyBpbiBjc3MgcHJvcGVydGllcw0KKiAgICAgICAgICRjdXJyZW50LmNzcyh7DQoqICAgICAgICAgICAgICd3aWR0aCc6IHdpZHRoLA0KKiAgICAgICAgICAgICAnaGVpZ2h0JzogaGVpZ2h0LA0KKiAgICAgICAgICAgICAnbGVmdCc6IDAsDQoqICAgICAgICAgICAgICd0b3AnOiAwDQoqICAgICAgICAgfSk7DQoqICAgICAgICAgJGN1cnJlbnQuY3NzKHpJbmRleEF0dHJpYiwgJycpOw0KKiAgICAgICAgIHNldHRpbmdzLiRzbGlkZXMucGFyZW50KCkuY3NzKHpJbmRleEF0dHJpYiwgJycpOw0KKg0KKiAgICAgICAgIC8vbm90aWZ5aW5nIHRoZSBjYXJvdXNlbCwgdGhhdCBhbmltYXRpb24gaXMgY29tcGxldGVkDQoqICAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soKTsNCiogICAgIH07DQoqDQoqICAgICBTYW1wbGVUcmFuc2l0aW9uLnByb3RvdHlwZS5wZXJmb3JtID0gZnVuY3Rpb24gKHNldHRpbmdzKSB7DQoqICAgICAgICAgdmFyIGhlaWdodCA9IHNldHRpbmdzLiRjdXJyZW50U2xpZGUuaGVpZ2h0KCksDQoqICAgICAgICAgd2lkdGggPSBzZXR0aW5ncy4kY3VycmVudFNsaWRlLndpZHRoKCksDQoqICAgICAgICAgb25BbmltYXRpb25Db21wbGV0ZWQgPSB0aGlzLm9uQW5pbWF0aW9uQ29tcGxldGUsDQoqICAgICAgICAgekluZGV4QXR0cmliID0gJ3otaW5kZXgnLA0KKiAgICAgICAgICRwYXJlbnQgPSBzZXR0aW5ncy4kc2xpZGVzLnBhcmVudCgpLA0KKiAgICAgICAgICRjdXJyZW50ID0gc2V0dGluZ3MuJGN1cnJlbnRTbGlkZSwNCiogICAgICAgICAkbmV4dCA9IHNldHRpbmdzLiRuZXh0U2xpZGU7DQoqDQoqICAgICAgICAgLy9zZXR0aW5nIGEgbmV3IHNsaWRlIHVuZGVyIHRoZSBjdXJyZW50IHNsaWRlDQoqICAgICAgICAgJHBhcmVudC5jc3MoekluZGV4QXR0cmliLCAwKTsNCiogICAgICAgICAkY3VycmVudC5jc3MoekluZGV4QXR0cmliLCAxKTsNCiogICAgICAgICAkbmV4dC5zaG93KCk7DQoqDQoqICAgICAgICAgLy9hbmltYXRlIGN1cnJlbnQgc2xpZGUNCiogICAgICAgICAkY3VycmVudC5hbmltYXRlKHsNCiogICAgICAgICAgICAgJ3dpZHRoJzogJzBweCcsDQoqICAgICAgICAgICAgICdoZWlnaHQnOiAnMHB4JywNCiogICAgICAgICAgICAgJ2xlZnQnOiB3aWR0aCAvIDIsDQoqICAgICAgICAgICAgICd0b3AnOiBoZWlnaHQgLyAyDQoqICAgICAgICAgfSwgZnVuY3Rpb24oKSB7DQoqICAgICAgICAgICAgIG9uQW5pbWF0aW9uQ29tcGxldGVkKHNldHRpbmdzLCB3aWR0aCwgaGVpZ2h0KTsNCiogICAgICAgICB9KTsNCiogICAgIH07DQoqDQoqICAgICAvL2FkZGluZyBuZXcgZWZmZWN0IHRvIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMgbW9kdWxlLg0KKiAgICAgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5TYW1wbGVUcmFuc2l0aW9uID0gU2FtcGxlVHJhbnNpdGlvbjsNCiogfSAoKSk7DQogKg0KICovDQpYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zID0gKGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgcHViID0ge307DQoNCiAgICAvKioNCiAgICAgKiBUcmFuc2l0aW9uU2V0dGluZ3MgY2xhc3MgaG9sZHMgZGF0YSBuZWVkZWQgZm9yIGNoYW5naW5nIHNsaWRlcw0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFRyYW5zaXRpb25TZXR0aW5ncygpIHsgfQ0KICAgIC8qKg0KICAgICAqIEN1cnJlbnQgc2xpZGUgKGN1cnJlbnRseSBkaXNwbGF5ZWQpIGpRdWVyeSBvYmplY3QNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvblNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvblNldHRpbmdzLnByb3RvdHlwZS4kY3VycmVudFNsaWRlID0gbnVsbDsNCiAgICAvKioNCiAgICAgKiBOZXh0IHNsaWRlIGpRdWVyeSBvYmplY3QNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvblNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvblNldHRpbmdzLnByb3RvdHlwZS4kbmV4dFNsaWRlID0gbnVsbDsNCiAgICAvKioNCiAgICAgKiBBbGwgc2xpZGVzIChqUXVlcnkgb2JqZWN0KQ0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uU2V0dGluZ3MNCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uU2V0dGluZ3MucHJvdG90eXBlLiRzbGlkZXMgPSBudWxsOw0KICAgIC8qKg0KICAgICAqIE9mZnNldCBiZXR3ZWVuICRjdXJyZW50U2xpZGUgYW5kICRuZXh0U2xpZGUNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvblNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvblNldHRpbmdzLnByb3RvdHlwZS5vZmZzZXQgPSAwOw0KICAgIC8qKg0KICAgICAqIENhbGxiYWNrIGZ1bmN0aW9uIHdoaWNoIG11c3QgYmUgY2FsbGVkIGFmdGVyIGFuaW1hdGlvbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvblNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvblNldHRpbmdzLnByb3RvdHlwZS5jYWxsYmFjayA9IG51bGw7DQogICAgLyoqDQogICAgICogZW5kIG9mIFRyYW5zaXRpb25TZXR0aW5ncyBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5UcmFuc2l0aW9uU2V0dGluZ3MgPSBUcmFuc2l0aW9uU2V0dGluZ3M7DQoNCiAgICAvKioNCiAgICAgKiBUcmFuc2l0aW9uIGNsYXNzIGlzIGEgYmFzZSBjbGFzcyBvZiBhbGwgdHJhbnNpdGlvbnMuDQogICAgICoNCiAgICAgKiBJbXBvcnRhbnQ6IHNldHRpbmdzLmNhbGxiYWNrKCkgKEBzZWUgVHJhbnNpdGlvblNldHRpbmdzKSBoYXZlIHRvIGJlIGNhbGxlZCBhdCB0aGUgZW5kIG9mIGV4ZWN1dGlvbiB0aGUgcGVyZm9ybSgpIG1ldGhvZC4NCiAgICAgKg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFRyYW5zaXRpb24oKSB7IH0NCiAgICBUcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7DQogICAgLyoqDQogICAgICogSW5pdGlhbGl6ZXMgYSB0cmFuc2l0aW9uIHdpdGggZ2l2ZW4gc2V0dGluZ3MgKEBzZWUgVHJhbnNpdGlvblNldHRpbmdzKS4NCiAgICAgKiANCiAgICAgKiBAbWVtYmVyIFRyYW5zaXRpb24NCiAgICAgKiBAcGFyYW0ge1RyYW5zaXRpb25TZXR0aW5nc30gc2V0dGluZ3MgIHRyYW5zaXRpb24gc2V0dGluZ3MNCiAgICAgKi8NCiAgICAvKiBlc2xpbnQtZGlzYWJsZSAqLw0KICAgIFRyYW5zaXRpb24ucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoc2V0dGluZ3MpIHsNCiAgICAgICAgLy9pbXBsZW1lbnRhdGlvbiB1c2luZyBzZXR0aW5ncw0KICAgIH07DQogICAgLyogZXNsaW50LWVuYWJsZSAqLw0KICAgIC8qKg0KICAgICAqIFJldHVybnMgYSBmYWN0b3IgYXNzb2NpYXRlZCB3aXRoIHNldHRpbmdzLm9mZnNldCAoQHNlZSBUcmFuc2l0aW9uU2V0dGluZ3MpLCB3aGljaA0KICAgICAqIGNhbiBiZSB1c2VmdWxsIGZvciBzb21lIGFuaW1hdGlvbnMuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRyYW5zaXRpb24NCiAgICAgKiBAcGFyYW0ge1RyYW5zaXRpb25TZXR0aW5nc30gc2V0dGluZ3MgIHRyYW5zaXRpb24gc2V0dGluZ3MNCiAgICAgKiBAcmV0dXJuIFRoZSBmYWN0b3I7IDEgaWYgb2Zmc2V0IGlzIGhpZ2hlciB0aGFuIDAsIC0xIG90aGVyd2lzZQ0KICAgICAqIEB0eXBlIE51bWJlcg0KICAgICAqLw0KICAgIFRyYW5zaXRpb24ucHJvdG90eXBlLmZhY3RvciA9IGZ1bmN0aW9uIChzZXR0aW5ncykgew0KICAgICAgICByZXR1cm4gKHNldHRpbmdzLm9mZnNldCA+IDApID8gMSA6IC0xOw0KICAgIH07DQogICAgLyoqDQogICAgICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIHVzZWQgYnkgY2Fyb3VzZWxzIHRvIGNoYW5nZSBzbGlkZXMuDQogICAgICoNCiAgICAgKiBJbXBvcnRhbnQ6IHNldHRpbmdzLmNhbGxiYWNrKCkgKEBzZWUgVHJhbnNpdGlvblNldHRpbmdzKSBoYXZlIHRvIGJlIGNhbGxlZCBhdCB0aGUgZW5kIG9mIHRoaXMgbWV0aG9kIGV4ZWN1dGlvbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvbg0KICAgICAqIEBwYXJhbSB7VHJhbnNpdGlvblNldHRpbmdzfSBzZXR0aW5ncyAgdHJhbnNpdGlvbiBzZXR0aW5ncw0KICAgICAqLw0KICAgIFRyYW5zaXRpb24ucHJvdG90eXBlLnBlcmZvcm0gPSBmdW5jdGlvbiAoc2V0dGluZ3MpIHsNCiAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEVuZCBvZiBUcmFuc2l0aW9uIGNsYXNzDQogICAgICovDQogICAgcHViLlRyYW5zaXRpb24gPSBUcmFuc2l0aW9uOw0KDQogICAgLyoqDQogICAgICogQmFzaWNUcmFuc2l0aW9uIGNsYXNzIGNoYW5nZXMgc2xpZGVzIHdpdGhvdXQgYW55IGFuaW1hdGlvbi4NCiAgICAgKiBEbyBub3QgcmVtb3ZlIHRoaXMgY2xhc3MsIGJlY2FvdXNlIGNhcm91c2VscyB3aWxsIHVzZSBpdCBieSBkZWZhdWx0LA0KICAgICAqIGlmIHJlcXVlc3RlZCB0cmFuc2l0aW9uIGNhbm5vdCBiZSBmb3VuZC4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBCYXNpY1RyYW5zaXRpb24oKSB7IH0NCiAgICBCYXNpY1RyYW5zaXRpb24ucHJvdG90eXBlID0gbmV3IFRyYW5zaXRpb24oKTsNCiAgICBCYXNpY1RyYW5zaXRpb24uY29uc3RydWN0b3IgPSBCYXNpY1RyYW5zaXRpb247DQogICAgLyoqDQogICAgICogQG1lbWJlciBCYXNpY1RyYW5zaXRpb24NCiAgICAgKi8NCiAgICBCYXNpY1RyYW5zaXRpb24ucHJvdG90eXBlLnBlcmZvcm0gPSBmdW5jdGlvbiAoc2V0dGluZ3MpIHsNCiAgICAgICAgc2V0dGluZ3MuJGN1cnJlbnRTbGlkZS5oaWRlKCk7DQogICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuc2hvdygpOw0KDQogICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBFbmQgb2YgQmFzaWNUcmFuc2l0aW9uIGNsYXNzDQogICAgICovDQogICAgcHViLkJhc2ljVHJhbnNpdGlvbiA9IEJhc2ljVHJhbnNpdGlvbjsNCg0KICAgIC8qKg0KICAgICAqIEZhZGVJblRyYW5zaXRpb24gY2xhc3MgY2hhbmdlcyBzbGlkZXMgYnkgZmFkaW5nIGluIG5ldyBzbGlkZS4NCiAgICAgKiBUaGlzIGNsYXNzIGNhbiBiZSByZW1vdmVkIGlmIGVmZmVjdCBpcyBub3QgdXNlZC4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBGYWRlSW5UcmFuc2l0aW9uKCkgeyB9DQogICAgRmFkZUluVHJhbnNpdGlvbi5wcm90b3R5cGUgPSBuZXcgVHJhbnNpdGlvbigpOw0KICAgIEZhZGVJblRyYW5zaXRpb24uY29uc3RydWN0b3IgPSBGYWRlSW5UcmFuc2l0aW9uOw0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgRmFkZUluVHJhbnNpdGlvbg0KICAgICAqLw0KICAgIEZhZGVJblRyYW5zaXRpb24ucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIC8qc2V0dGluZ3MuJHNsaWRlcy5jc3Moew0KICAgICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJywNCiAgICAgICAgICd0b3AnOiAnMHB4JywNCiAgICAgICAgICdsZWZ0JzogJzBweCcNCiAgICAgICAgIH0pOyovDQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIEZhZGVJblRyYW5zaXRpb24NCiAgICAgKi8NCiAgICBGYWRlSW5UcmFuc2l0aW9uLnByb3RvdHlwZS5wZXJmb3JtID0gZnVuY3Rpb24gKHNldHRpbmdzKSB7DQogICAgICAgIHZhciB6SW5kZXhBdHRyaWIgPSAnei1pbmRleCcsDQogICAgICAgICAgICAkcGFyZW50ID0gc2V0dGluZ3MuJHNsaWRlcy5wYXJlbnQoKSwNCiAgICAgICAgICAgICRuZXh0U2xpZGUgPSBzZXR0aW5ncy4kbmV4dFNsaWRlOw0KDQogICAgICAgICRwYXJlbnQuY3NzKHpJbmRleEF0dHJpYiwgMCk7DQogICAgICAgICRuZXh0U2xpZGUuY3NzKHpJbmRleEF0dHJpYiwgMSk7DQogICAgICAgIHNldHRpbmdzLiRzbGlkZXMuY3NzKHsNCiAgICAgICAgICAgICdwb3NpdGlvbic6ICdyZWxhdGl2ZScNCiAgICAgICAgfSk7DQoNCiAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5jc3Moew0KICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJywNCiAgICAgICAgICAgICd0b3AnOiAnNTAlJywNCiAgICAgICAgICAgICdsZWZ0JzogJzUwJScsDQogICAgICAgICAgICAndHJhbnNmb3JtJzogJ3RyYW5zbGF0ZSgtNTAlLC01MCUpJw0KICAgICAgICB9KTsNCg0KDQogICAgICAgICRuZXh0U2xpZGUuZmFkZUluKGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHNldHRpbmdzLiRjdXJyZW50U2xpZGUuaGlkZSgpOw0KDQogICAgICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7DQogICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ3JlbGF0aXZlJywNCiAgICAgICAgICAgICAgICAnbGVmdCc6ICcwJywNCiAgICAgICAgICAgICAgICAndHJhbnNmb3JtJzogJ25vbmUnDQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgJG5leHRTbGlkZS5jc3MoekluZGV4QXR0cmliLCAnJyk7DQogICAgICAgICAgICAkcGFyZW50LmNzcyh6SW5kZXhBdHRyaWIsICcnKTsNCg0KICAgICAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soKTsNCiAgICAgICAgfSk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBFbmQgb2YgRmFkZUluVHJhbnNpdGlvbiBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5GYWRlSW5UcmFuc2l0aW9uID0gRmFkZUluVHJhbnNpdGlvbjsNCg0KICAgIC8qKg0KICAgICAqIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbiBjbGFzcyBjaGFuZ2VzIHNsaWRlcyBieSBzbGlkaW5nIHRoZW0gaG9yaXpvbnRhbGx5Lg0KICAgICAqIFRoaXMgY2xhc3MgY2FuIGJlIHJlbW92ZWQgaWYgZWZmZWN0IGlzIG5vdCB1c2VkLg0KICAgICAqIElmIG9mZnNldCAoZGlmZmVyZW5jZSBiZXR3ZWVuIGluZGV4IG9mIGN1cnJlbnRseSBkaXNwbGF5ZWQgc2xpZGUgYW5kIGluZGV4IG9mIHNsaWRlIHRoYXQgd2lsbCBiZSBzaG93bikNCiAgICAgKiBpcyBncmVhdGVyIHRoYW4gMCwgc2xpZGVzIGFyZSBzbGlkaW5nIHRvIHRoZSBsZWZ0LiBPdGhlcndpc2UgKG9mZnNldCBpcyBsb3dlciB0aGFuIDApLCBzbGlkZXMgYXJlIHNsaWRpbmcNCiAgICAgKiB0byB0aGUgbGVmdC4NCiAgICAgKiBXaGVuIHNsaWRlIGNoYW5nZSBpcyByYWlzZWQgYXV0b21hdGljYWxseSwgc2xpZGVzIGFyZSBhbHdheXMgc2xpZGluZyB0byByaWdodCAob2Zmc2V0ID09IDEpLg0KICAgICAqIElmIHVzZXIgcmFpc2VzIHNsaWRlcyBjaGFuZ2UsIHNsaWRlcyBhcmUgc2xpZGluZzoNCiAgICAgKiAtIHRvIGxlZnQsIGlmIG9mZnNldCBpcyBncmVhdGVyIHRoYW4gMCAoc2xpZGUgd2l0aCBoaWdoZXIgaW5kZXggd2lsbCBiZSBzaG93biBvciB1c2VyIGNsaWNrcyBvbiAnbmV4dCcgbmF2aWdhdGlvbiBpdGVtKSwNCiAgICAgKiAtIHRvIHJpZ2h0LCBpZiBvZmZzZXQgaXMgbG93ZXIgdGhhbiAwIChzbGlkZSB3aXRoIGxvd2VyIGluZGV4IHdpbGwgYmUgc2hvd24gb3IgdXNlciBjbGlja3Mgb24gJ3ByZXYnIG5hdmlnYXRpb24gaXRlbSkuDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICovDQogICAgZnVuY3Rpb24gU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uKCkgeyB9DQogICAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7DQogICAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLmNvbnN0cnVjdG9yID0gU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uOw0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uDQogICAgICovDQogICAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLnByb3RvdHlwZS5vbkFuaW1hdGlvbkNvbXBsZXRlID0gZnVuY3Rpb24gKHNldHRpbmdzLCAkcGFyZW50KSB7DQogICAgICAgIHNldHRpbmdzLiRjdXJyZW50U2xpZGUuaGlkZSgpOw0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7DQogICAgICAgICAgICAncG9zaXRpb24nOiAnJywNCiAgICAgICAgICAgICd0b3AnOiAnJywNCiAgICAgICAgICAgICdsZWZ0JzogJycNCiAgICAgICAgfSk7DQoNCiAgICAgICAgJHBhcmVudC5jc3MoJ21hcmdpbi1sZWZ0JywgJycpOw0KDQogICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbg0KICAgICAqLw0KICAgIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbi5wcm90b3R5cGUucGVyZm9ybSA9IGZ1bmN0aW9uIChzZXR0aW5ncykgew0KICAgICAgICB2YXIgZmFjdG9yID0gdGhpcy5mYWN0b3Ioc2V0dGluZ3MpLA0KICAgICAgICAgICAgb25BbmltYXRpb25Db21wbGV0ZSA9IHRoaXMub25BbmltYXRpb25Db21wbGV0ZSwNCiAgICAgICAgICAgIHdpZHRoID0gc2V0dGluZ3MuJGN1cnJlbnRTbGlkZS53aWR0aCgpLA0KICAgICAgICAgICAgJHBhcmVudCA9IHNldHRpbmdzLiRzbGlkZXMucGFyZW50KCk7DQoNCiAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5jc3Moew0KICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJywNCiAgICAgICAgICAgICd0b3AnOiAnMHB4JywNCiAgICAgICAgICAgICdsZWZ0JzogZmFjdG9yICogd2lkdGgNCiAgICAgICAgfSk7DQogICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuc2hvdygpOw0KDQogICAgICAgICRwYXJlbnQuYW5pbWF0ZSh7DQogICAgICAgICAgICAnbWFyZ2luLWxlZnQnOiAtZmFjdG9yICogd2lkdGgNCiAgICAgICAgfSwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgb25BbmltYXRpb25Db21wbGV0ZShzZXR0aW5ncywgJHBhcmVudCk7DQogICAgICAgIH0pOw0KICAgIH07DQogICAgLyoqDQogICAgICogRW5kIG9mIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbiBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5TbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24gPSBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb247DQoNCiAgICAvKioNCiAgICAgKiBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uIGNsYXNzIGNoYW5nZXMgc2xpZGVzIGJ5IHNsaWRpbmcgdGhlbSB2ZXJ0aWNhbGx5Lg0KICAgICAqIFRoaXMgY2xhc3MgY2FuIGJlIHJlbW92ZWQgaWYgdGhpcyBlZmZlY3QgaXMgbm90IHVzZWQuDQogICAgICogSWYgb2Zmc2V0IChkaWZmZXJlbmNlIGJldHdlZW4gaW5kZXggb2YgY3VycmVudGx5IGRpc3BsYXllZCBzbGlkZSBhbmQgaW5kZXggb2Ygc2xpZGUgdGhhdCB3aWxsIGJlIHNob3duKQ0KICAgICAqIGlzIGdyZWF0ZXIgdGhhbiAwLCBzbGlkZXMgYXJlIHNsaWRpbmcgZnJvbSB1cCB0byBkb3duLiBPdGhlcndpc2UgKG9mZnNldCBpcyBsb3dlciB0aGFuIDApLCBzbGlkZXMgYXJlIHNsaWRpbmcNCiAgICAgKiBmcm9tIGRvd24gdG8gdXAuDQogICAgICogV2hlbiBzbGlkZSBjaGFuZ2UgaXMgcmFpc2VkIGF1dG9tYXRpY2FsbHksIHNsaWRlcyBhcmUgYWx3YXlzIHNsaWRpbmcgZnJvbSB1cCB0byBkb3duIChvZmZzZXQgPT0gMSkuDQogICAgICogSWYgdXNlciByYWlzZXMgc2xpZGVzIGNoYW5nZSwgc2xpZGVzIGFyZSBzbGlkaW5nOg0KICAgICAqIC0gZnJvbSB1cCB0byBkb3duLCBpZiBvZmZzZXQgaXMgZ3JlYXRlciB0aGFuIDAgKHNsaWRlIHdpdGggaGlnaGVyIGluZGV4IHdpbGwgYmUgc2hvd24gb3IgdXNlciBjbGlja3Mgb24gJ25leHQnIG5hdmlnYXRpb24gaXRlbSksDQogICAgICogLSBmcm9tIGRvd24gdG8gdXAsIGlmIG9mZnNldCBpcyBsb3dlciB0aGFuIDAgKHNsaWRlIHdpdGggbG93ZXIgaW5kZXggd2lsbCBiZSBzaG93biBvciB1c2VyIGNsaWNrcyBvbiAncHJldicgbmF2aWdhdGlvbiBpdGVtKS4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uKCkgeyB9DQogICAgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbi5wcm90b3R5cGUgPSBuZXcgVHJhbnNpdGlvbigpOw0KICAgIFNsaWRlVmVydGljYWxseVRyYW5zaXRpb24uY29uc3RydWN0b3IgPSBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uOw0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbg0KICAgICAqLw0KICAgIFNsaWRlVmVydGljYWxseVRyYW5zaXRpb24ucHJvdG90eXBlLm9uQW5pbWF0aW9uQ29tcGxldGUgPSBmdW5jdGlvbiAoc2V0dGluZ3MsICRwYXJlbnQpIHsNCiAgICAgICAgc2V0dGluZ3MuJGN1cnJlbnRTbGlkZS5oaWRlKCk7DQogICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsNCiAgICAgICAgICAgICdwb3NpdGlvbic6ICcnLA0KICAgICAgICAgICAgJ3RvcCc6ICcnLA0KICAgICAgICAgICAgJ2xlZnQnOiAnJw0KICAgICAgICB9KTsNCg0KICAgICAgICAkcGFyZW50LmNzcygnbWFyZ2luLXRvcCcsICcnKTsNCg0KICAgICAgICBzZXR0aW5ncy5jYWxsYmFjaygpOw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uDQogICAgICovDQogICAgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbi5wcm90b3R5cGUucGVyZm9ybSA9IGZ1bmN0aW9uIChzZXR0aW5ncykgew0KICAgICAgICB2YXIgZmFjdG9yID0gdGhpcy5mYWN0b3Ioc2V0dGluZ3MpLA0KICAgICAgICAgICAgb25BbmltYXRpb25Db21wbGV0ZSA9IHRoaXMub25BbmltYXRpb25Db21wbGV0ZSwNCiAgICAgICAgICAgIGhlaWdodCA9IHNldHRpbmdzLiRjdXJyZW50U2xpZGUuaGVpZ2h0KCksDQogICAgICAgICAgICAkcGFyZW50ID0gc2V0dGluZ3MuJHNsaWRlcy5wYXJlbnQoKTsNCg0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7DQogICAgICAgICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLA0KICAgICAgICAgICAgJ3RvcCc6IC1mYWN0b3IgKiBoZWlnaHQsDQogICAgICAgICAgICAnbGVmdCc6ICcwcHgnDQogICAgICAgIH0pOw0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLnNob3coKTsNCg0KICAgICAgICAkcGFyZW50LmFuaW1hdGUoew0KICAgICAgICAgICAgJ21hcmdpbi10b3AnOiBmYWN0b3IgKiBoZWlnaHQNCiAgICAgICAgfSwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgb25BbmltYXRpb25Db21wbGV0ZShzZXR0aW5ncywgJHBhcmVudCk7DQogICAgICAgIH0pOw0KICAgIH07DQogICAgLyoqDQogICAgICogU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbiBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5TbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uID0gU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbjsNCg0KICAgIHJldHVybiBwdWI7DQp9KGpRdWVyeSkpOw0KLyoqDQogKiBlbmQgb2YgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucyBtb2R1bGUuDQogKi8NCg0KLyoqDQogKiBYQUNvbnRleHQNCiAqDQogKiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzIG1vZHVsZS4NCiAqDQogKiBFeHBvc2VzIFZpZXcgY2xhc3MsIHdoaWNoIGlzIGEgYmFzZSBjbGFzcyBvZiBhbGwgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3cyB1c2VkIGJ5IGNhcm91c2VscyAoQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLCBAc2VlIFZpZXcpLg0KICogQWxzbyBleHBvc2VzIGltcGxlbWVudGF0aW9uIG9mIHRoZXNlICd0aW1lIGluZGljYXRvcicgdmlld3M6DQogKiAtIFByb2dyZXNzQmFyVmlldyAtIHNob3dzIHRoZSBwcm9ncmVzcyBvZiB0aW1lLCB0aGF0IGxvb2tzIGxpa2UgYSBwcm9ncmVzcyBiYXIsDQogKiAtIFJvdGF0b3JWaWV3IC0gc2hvd3MgdGhlIHByb2dyZXNzIG9mIHRpbWUgd2l0aCB0aGUgZmlsbGluZyB1cCByaW5nLg0KICogQ2Fyb3VzZWwgdGFrZXMgdGhlIGNsYXNzIGNvbnN0cnVjdG9yIGJ5IG5hbWUgZnJvbSB0aGlzIG1vZHVsZSAoaXQgaXMgZ2l2ZW4gaW4gb3B0aW9ucyBvYmplY3Qgb2YgY2Fyb3VzZWw7IEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2VscykuDQogKiBJZiB0aGVyZSBpcyBhIG5lZWQgdG8gaW1wbGVtZW50IHRoZSBuZXcgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3LCBjcmVhdGUgYSBuZXcgY2xhc3MsDQogKiBieSBpbmhlcml0aW5nIGZyb20gVmlldyBjbGFzcyBhbmQgYWRkIGl0IHRvIHRoaXMgbW9kdWxlLiBEdXJpbmcgaW1wbGVtZW50YXRpb24gb2YgYSBuZXcgJ3RpbWUgaW5kaWNhdG9yJw0KICogdmlldyB0aGUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JzVmlldy5Ub29scyBuYW1lc3BhY2UgbWF5IGJlIHVzZWZ1bGwuIEl0IGNvbnRhaW5zOg0KICogLSBpc0Nzc1N1cHBvcnRlZChwcm9wcykgZnVuY3Rpb24sIHdoaWNoIGNoZWNrcyBpZiBhbnkgb2YgQ1NTIHByb3BlcnRpZXMgaXMgc3VwcG9ydGVkIChwcm9wcyAtIGFycmF5IG9mIHByb3BlcnRpZXMpLA0KICogLSBpc1RyYW5zZm9ybVN1cHBvcnRlZCgpIGZ1bmN0aW9uLCB3aGljaCBjaGVja3MgaWYgQ1NTIDMgJ3RyYW5zZm9ybScgaXMgc3VwcG9ydGVkLg0KICoNCiAqIEV4YW1wbGUgdmlldyBpbXBsZW1lbnRhdGlvbiAob3BhY2l0eSBpbmNyZWFzZXMgd2l0aCBhIHByb2dyZXNzIG9mIHRoZSB0aW1lKToNCiAqIChmdW5jdGlvbigpIHsNCiAqICAgICB2YXIgVmlldyA9IFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MuVmlldzsNCiAqDQogKiAgICAgZnVuY3Rpb24gU2FtcGxlVmlldyAoc2VsZWN0b3IsIG9wdGlvbnMpIHsNCiAqICAgICAgICAgLy9iYXNlIGNvbnN0cnVjdG9yIGhhdmUgdG8gYmUgY2FsbGVkDQogKiAgICAgICAgIFZpZXcuY2FsbCh0aGlzLCBzZWxlY3Rvcik7DQogKiAgICAgfQ0KICoNCiAqICAgICBTYW1wbGVWaWV3LnByb3RvdHlwZSA9IG5ldyBWaWV3KCk7DQogKiAgICAgU2FtcGxlVmlldy5jb25zdHJ1Y3RvciA9IFNhbXBsZVZpZXc7DQogKg0KICogICAgIFNhbXBsZVZpZXcucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAodGltZW91dCkgew0KICogICAgICAgICAvL2Jhc2UgbWV0aG9kIGhhdmUgdG8gYmUgY2FsbGVkDQogKiAgICAgICAgIFZpZXcucHJvdG90eXBlLmluaXQuY2FsbCh0aGlzLCB0aW1lb3V0KTsNCiAqDQogKiAgICAgICAgIC8vaW5pdGlhbGl6YXRpb24gY29kZSAtIG5vdCBuZWVkZWQgaW4gdGhpcyBleGFtcGxlDQogKiAgICAgfTsNCiAqDQogKiAgICAgU2FtcGxlVmlldy5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7DQogKiAgICAgICAgIC8vYmFzZSBtZXRob2QgaGF2ZSB0byBiZSBjYWxsZWQNCiAqICAgICAgICAgVmlldy5wcm90b3R5cGUucmVzZXQuY2FsbCh0aGlzKTsNCiAqDQogKiAgICAgICAgIC8vcmVzZXRpbmcgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3DQogKiAgICAgICAgIHRoaXMuJGluZGljYXRvci5zdG9wKHRydWUpOw0KICogICAgICAgICB0aGlzLiRpbmRpY2F0b3IuY3NzKCdvcGFjaXR5JywgMCk7DQogKiAgICAgfTsNCiAqDQogKiAgICAgU2FtcGxlVmlldy5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbiAoKSB7DQogKiAgICAgICAgIC8vc3RvcGluZyAndGltZSBpbmRpY2F0b3InIHZpZXcgYW5pbWF0aW9uDQogKiAgICAgICAgIHRoaXMuJGluZGljYXRvci5zdG9wKHRydWUpOw0KICogICAgIH07DQogKg0KICogICAgIFNhbXBsZVZpZXcucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbiAoKSB7DQogKiAgICAgICAgIC8vc3RhcnRpbmcvcmVzdW1pbmcgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3IGFuaW1hdGlvbg0KICogICAgICAgICB0aGlzLiRpbmRpY2F0b3IuYW5pbWF0ZSh7DQogKiAgICAgICAgICAgICAnb3BhY2l0eSc6IDENCiAqICAgICAgICAgfSwgdGhpcy50aW1lb3V0IC0gdGhpcy50aW1lRWxhcHNlZCwgJ2xpbmVhcicpOw0KICogICAgIH07DQogKg0KICogICAgIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MuU2FtcGxlVmlldyA9IFNhbXBsZVZpZXc7DQogKiB9KCkpOw0KICoNCiAqLw0KWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cyA9IChmdW5jdGlvbiAoJCkgew0KICAgIHZhciBwdWIgPSB7fSwNCiAgICAgICAgc3VwcG9ydEVsZW1lbnRTdHlsZSA9IG51bGw7DQoNCiAgICAvKioNCiAgICAgKiBDaGVja3MgaWYgYW55IG9mIENTUyBwcm9wZXJ0aWVzIGlzIHN1cHBvcnRlZC4NCiAgICAgKg0KICAgICAqIEBwYXJhbSB7QXJyYXl9IHByb3BzICAgICBhcnJheSBvZiBwcm9wZXJ0aWVzIHRvIGJlIGNoZWNrZWQNCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgYW55IG9mIENTUyBwcm9wZXJ0aWVzIGlzIHN1cHBvcnRlZCwgZmFsc2Ugb3RoZXJ3aXNlDQogICAgICogQHR5cGUgQm9vbGVhbg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGlzQ3NzU3VwcG9ydGVkKHByb3BzKSB7DQogICAgICAgIHZhciBpLA0KICAgICAgICAgICAgaXNTdXBwb3J0ZWQgPSBmYWxzZTsNCg0KICAgICAgICBpZiAoc3VwcG9ydEVsZW1lbnRTdHlsZSA9PT0gbnVsbCkgew0KICAgICAgICAgICAgc3VwcG9ydEVsZW1lbnRTdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3N1cHBvcnRFbGVtZW50Jykuc3R5bGU7DQogICAgICAgIH0NCg0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIGlmIChzdXBwb3J0RWxlbWVudFN0eWxlW3Byb3BzW2ldXSAhPT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgaXNTdXBwb3J0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgcmV0dXJuIGlzU3VwcG9ydGVkOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIENoZWNrcyBpZiBDU1MgMyAndHJhbnNmb3JtJyBpcyBzdXBwb3J0ZWQuDQogICAgICoNCiAgICAgKiBAcmV0dXJuIHRydWUgaWYgQ1NTIDMgJ3RyYW5zZm9ybScgaXMgc3VwcG9ydGVkLCBmYWxzZSBvdGhlcndpc2UNCiAgICAgKiBAdHlwZSBCb29sZWFuDQogICAgICovDQogICAgZnVuY3Rpb24gaXNUcmFuc2Zvcm1TdXBwb3J0ZWQoKSB7DQogICAgICAgIHJldHVybiBpc0Nzc1N1cHBvcnRlZChbJ3RyYW5zZm9ybVByb3BlcnR5JywgJ1dlYmtpdFRyYW5zZm9ybScsICdNb3pUcmFuc2Zvcm0nLCAnT1RyYW5zZm9ybScsICdtc1RyYW5zZm9ybSddKTsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzLlRvb2xzIG5hbWVzcGFjZQ0KICAgICAqDQogICAgIFRoaXMgbmFtZXNwYWNlIGNhbiBiZSByZW1vdmVkIGlmIFJvdGF0b3JWaWV3IGNsYXNzIGlzIG5vdCB1c2VkIChAc2VlIFJvdGF0b3JWaWV3KQ0KICAgICAqLw0KICAgIHB1Yi5Ub29scyA9IHt9Ow0KICAgIHB1Yi5Ub29scy5pc0Nzc1N1cHBvcnRlZCA9IGlzQ3NzU3VwcG9ydGVkOw0KICAgIHB1Yi5Ub29scy5pc1RyYW5zZm9ybVN1cHBvcnRlZCA9IGlzVHJhbnNmb3JtU3VwcG9ydGVkOw0KICAgIC8qKg0KICAgICAqIEVuZCBvZiBuYW1lc3BhY2UNCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIFZpZXcgY2xhc3MgaXMgYSBiYXNlIGNsYXNzIG9mIGFsbCAndGltZSBpbmRpY2F0b3InIHZpZXdzDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICogQHBhcmFtIHtTdHJpbmd9IHNlbGVjdG9yIGEgc2VsZWN0b3IgdXNlZCBmb3Igc2VhcmNoaW5nDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgICBWaWV3IG9wdGlvbnMgb2JqZWN0DQogICAgICovDQogICAgLyogZXNsaW50LWRpc2FibGUgKi8NCiAgICBmdW5jdGlvbiBWaWV3KHNlbGVjdG9yLCBvcHRpb25zKSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBBIGpRdWVyeSBvYmplY3QgY29udGFpbmluZyBlbGVtZW50LCB3aGljaCB3aWxsIGJlIGFuaW1hdGVkIHRvIHNob3cgcG9ncmVzcyBvZiB0aGUgdGltZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBWaWV3DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiRpbmRpY2F0b3IgPSAkKHNlbGVjdG9yKTsNCiAgICB9DQogICAgLyogZXNsaW50LWVuYWJsZSAqLw0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIHRoZSB2aWV3Lg0KICAgICAqDQogICAgICogQG1lbWJlciBWaWV3aW9uDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVvdXQgICBhIHRpbWVvdXQgdG8gdGhlIGVuZCBvZiB3aG9sZSBpbmRpY2F0b3IgYW5pbWF0aW9uDQogICAgICovDQogICAgVmlldy5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICh0aW1lb3V0KSB7DQogICAgICAgIHRoaXMudGltZUVsYXBzZWQgPSAwOw0KICAgICAgICB0aGlzLnRpbWVvdXQgPSB0aW1lb3V0Ow0KICAgIH07DQogICAgLyoqDQogICAgICogUmVzZXRzIHRoZSB2aWV3DQogICAgICoNCiAgICAgKiBAbWVtYmVyIFZpZXcNCiAgICAgKi8NCiAgICBWaWV3LnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy50aW1lRWxhcHNlZCA9IDA7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBTdGFydHMvUmVuZXdzIHRoZSB2aWV3IGFuaW1hdGlvbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVmlldw0KICAgICAqLw0KICAgIFZpZXcucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbiAoKSB7IH07DQogICAgLyoqDQogICAgICogUGF1c2VzIHRoZSB2aWV3IGFuaW1hdGlvbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVmlldw0KICAgICAqLw0KICAgIFZpZXcucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24gKCkgeyB9Ow0KICAgIC8qKg0KICAgICAqIFVwZGF0ZXMgdGhlIHRpbWUgdGhhdCBlbGFwc2VkIHNpbmNlIGFuaW1hdGlvbiBiZWdpbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVmlldw0KICAgICAqLw0KICAgIFZpZXcucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uICh0aW1lRWxhcHNlZCkgew0KICAgICAgICB0aGlzLnRpbWVFbGFwc2VkID0gdGltZUVsYXBzZWQ7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgVmlldyBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5WaWV3ID0gVmlldzsNCg0KICAgIC8qKg0KICAgICAqIFByb2dyZXNzQmFyVmlldyBjbGFzcyBwcm92aWRlcyBhIGxvZ2ljIGZvciBhbmltYXRlIGEgJ3RpbWUgaW5kaWNhdG9yJywNCiAgICAgKiB0aGF0IGxvb2tzIGxpa2UgcHJvZ3Jlc3MgYmFyLg0KICAgICAqDQogICAgICogT3B0aW9ucyBvYmplY3Q6DQogICAgICogew0KICAgICAqICAgICAnb3BhY2l0eSc6IE51bWJlciB2YWx1ZSAvL2JldHdlZW4gMCBhbmQgMTsgZGVmYXVsdCBpcyAwLjgNCiAgICAgKiB9DQogICAgICoNCiAgICAgKiBUaGlzIGNsYXNzIGNhbiBiZSByZW1vdmVkIGlmIHRoaXMga2luZCBvZiB2aWV3IGlzIG5vdCB1c2VkLg0KICAgICAqDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICogQHBhcmFtIHtTdHJpbmd9IHNlbGVjdG9yIGEgc2VsZWN0b3IgdXNlZCBmb3Igc2VhcmNoaW5nDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgICBWaWV3IG9wdGlvbnMgb2JqZWN0DQogICAgICovDQogICAgZnVuY3Rpb24gUHJvZ3Jlc3NCYXJWaWV3KHNlbGVjdG9yLCBvcHRpb25zKSB7DQogICAgICAgIFZpZXcuY2FsbCh0aGlzLCBzZWxlY3Rvcik7DQoNCiAgICAgICAgdmFyIGRlZmF1bHRzID0gew0KICAgICAgICAgICAgJ29wYWNpdHknOiAwLjgNCiAgICAgICAgfTsNCg0KICAgICAgICB0aGlzLnNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBvcHRpb25zKTsNCg0KICAgICAgICB0aGlzLiRjb250YWluZXIgPSB0aGlzLiRpbmRpY2F0b3I7DQogICAgICAgIHRoaXMuJGluZGljYXRvciA9IHRoaXMuJGluZGljYXRvci5maW5kKCdkaXYnKTsNCiAgICB9DQogICAgUHJvZ3Jlc3NCYXJWaWV3LnByb3RvdHlwZSA9IG5ldyBWaWV3KCk7DQogICAgUHJvZ3Jlc3NCYXJWaWV3LmNvbnN0cnVjdG9yID0gUHJvZ3Jlc3NCYXJWaWV3Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUHJvZ3Jlc3NCYXJWaWV3DQogICAgICovDQogICAgUHJvZ3Jlc3NCYXJWaWV3LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKHRpbWVvdXQpIHsNCiAgICAgICAgVmlldy5wcm90b3R5cGUuaW5pdC5jYWxsKHRoaXMsIHRpbWVvdXQpOw0KDQogICAgICAgIHZhciBvcGFjaXR5ID0gdGhpcy5zZXR0aW5ncy5vcGFjaXR5Ow0KICAgICAgICB0aGlzLiRjb250YWluZXIuY3NzKCdvcGFjaXR5Jywgb3BhY2l0eSk7DQogICAgICAgIHRoaXMuJGluZGljYXRvci5jc3MoJ29wYWNpdHknLCBvcGFjaXR5KTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUHJvZ3Jlc3NCYXJWaWV3DQogICAgICovDQogICAgUHJvZ3Jlc3NCYXJWaWV3LnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgVmlldy5wcm90b3R5cGUucmVzZXQuY2FsbCh0aGlzKTsNCg0KICAgICAgICB0aGlzLiRpbmRpY2F0b3Iuc3RvcCh0cnVlKTsNCiAgICAgICAgdGhpcy4kaW5kaWNhdG9yLmNzcygnd2lkdGgnLCAnMHB4Jyk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFByb2dyZXNzQmFyVmlldw0KICAgICAqLw0KICAgIFByb2dyZXNzQmFyVmlldy5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuJGluZGljYXRvci5zdG9wKHRydWUpOw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBQcm9ncmVzc0JhclZpZXcNCiAgICAgKi8NCiAgICBQcm9ncmVzc0JhclZpZXcucHJvdG90eXBlLnBsYXkgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHRoaXMuJGluZGljYXRvci5hbmltYXRlKHsNCiAgICAgICAgICAgICd3aWR0aCc6ICcxMDAlJw0KICAgICAgICB9LCB0aGlzLnRpbWVvdXQgLSB0aGlzLnRpbWVFbGFwc2VkLCAnbGluZWFyJyk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgUHJvZ3Jlc3NCYXJWaWV3IGNsYXNzDQogICAgICovDQogICAgcHViLlByb2dyZXNzQmFyVmlldyA9IFByb2dyZXNzQmFyVmlldzsNCg0KICAgIC8qKg0KICAgICAqIFJvdGF0b3JWaWV3IGNsYXNzIHByb3ZpZGVzIGEgbG9naWMgZm9yIGFuaW1hdGUgYSAndGltZSBpbmRpY2F0b3InLA0KICAgICAqIHRoYXQgc2hvd3MgdGhlIHByb2dyZXNzIG9mIHRpbWUgd2l0aCB0aGUgZmlsbGluZyB1cCByaW5nDQogICAgICoNCiAgICAgKiBPcHRpb25zIG9iamVjdDoNCiAgICAgKiB7DQogICAgICogICAgICdvcGFjaXR5JzogTnVtYmVyIHZhbHVlIC8vYmV0d2VlbiAwIGFuZCAxOyBkZWZhdWx0IGlzIDAuNQ0KICAgICAqIH0NCiAgICAgKg0KICAgICAqIFRoaXMgY2xhc3MgY2FuIGJlIHJlbW92ZWQgaWYgdGhpcyBraW5kIG9mIHZpZXcgaXMgbm90IHVzZWQuDQogICAgICoNCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3IgYSBzZWxlY3RvciB1c2VkIGZvciBzZWFyY2hpbmcNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgIFZpZXcgb3B0aW9ucyBvYmplY3QNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBSb3RhdG9yVmlldyhzZWxlY3Rvciwgb3B0aW9ucykgew0KICAgICAgICBWaWV3LmNhbGwodGhpcywgc2VsZWN0b3IpOw0KDQogICAgICAgIHZhciBkZWZhdWx0cyA9IHsNCiAgICAgICAgICAgICdvcGFjaXR5JzogMC41DQogICAgICAgIH07DQoNCiAgICAgICAgdGhpcy5zZXR0aW5ncyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0cywgb3B0aW9ucyk7DQogICAgICAgIHRoaXMuJG1hc2sgPSB0aGlzLiRpbmRpY2F0b3IuZmluZCgnc3Bhbi5tYXNrJykuZmlyc3QoKTsNCiAgICAgICAgdGhpcy4kcm90YXRvciA9IHRoaXMuJGluZGljYXRvci5maW5kKCdzcGFuLnJvdGF0b3InKS5maXJzdCgpOw0KDQogICAgICAgIGZ1bmN0aW9uIHJvdGF0ZUNzcyhkZWcpIHsNCiAgICAgICAgICAgIHZhciB2YWx1ZSA9ICdyb3RhdGUoJyArIGRlZyArICdkZWcpJzsNCg0KICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAnLXdlYmtpdC10cmFuc2Zvcm0nOiB2YWx1ZSwNCiAgICAgICAgICAgICAgICAnLW1vei10cmFuc2Zvcm0nOiB2YWx1ZSwNCiAgICAgICAgICAgICAgICAnLW8tdHJhbnNmb3JtJzogdmFsdWUsDQogICAgICAgICAgICAgICAgJy1tcy10cmFuc2Zvcm0nOiB2YWx1ZSwNCiAgICAgICAgICAgICAgICAndHJhbnNmb3JtJzogdmFsdWUNCiAgICAgICAgICAgIH07DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBhbmltYXRlUm90YXRvcigkcm90YXRvciwgb3B0aW9ucykgew0KICAgICAgICAgICAgdmFyIGRlZmF1bHRzID0gew0KICAgICAgICAgICAgICAgICdmb250U2l6ZSc6ICcxODBweCcsDQogICAgICAgICAgICAgICAgJ2FuaW1hdGVPcHRpb25zJzogew0KICAgICAgICAgICAgICAgICAgICAnc3RlcCc6IGZ1bmN0aW9uIChub3cpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRyb3RhdG9yLmNzcyhyb3RhdGVDc3Mobm93KSk7DQogICAgICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgICAgICdlYXNpbmcnOiAnbGluZWFyJw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgc2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIG9wdGlvbnMpOw0KDQogICAgICAgICAgICAkcm90YXRvci5hbmltYXRlKHsNCiAgICAgICAgICAgICAgICAnZm9udC1zaXplJzogc2V0dGluZ3MuZm9udFNpemUNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgc2V0dGluZ3MuYW5pbWF0ZU9wdGlvbnMpOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gcGhhc2VUd29BbmltYXRpb24oJG1hc2ssICRyb3RhdG9yLCBkdXJhdGlvbikgew0KICAgICAgICAgICAgJHJvdGF0b3IuYWRkQ2xhc3MoJ2hhbGYnKTsNCiAgICAgICAgICAgICRtYXNrLmFkZENsYXNzKCdoYWxmJyk7DQoNCiAgICAgICAgICAgIGFuaW1hdGVSb3RhdG9yKCRyb3RhdG9yLCB7DQogICAgICAgICAgICAgICAgJ2ZvbnRTaXplJzogJzM2MHB4JywNCiAgICAgICAgICAgICAgICAnYW5pbWF0ZU9wdGlvbnMnOiB7DQogICAgICAgICAgICAgICAgICAgICdkdXJhdGlvbic6IGR1cmF0aW9uDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICBmdW5jdGlvbiBwaGFzZU9uZUFuaW1hdGlvbigkbWFzaywgJHJvdGF0b3IsIGR1cmF0aW9uLCBwaGFzZVR3b0R1cmF0aW9uKSB7DQogICAgICAgICAgICBhbmltYXRlUm90YXRvcigkcm90YXRvciwgew0KICAgICAgICAgICAgICAgICdhbmltYXRlT3B0aW9ucyc6IHsNCiAgICAgICAgICAgICAgICAgICAgJ2R1cmF0aW9uJzogZHVyYXRpb24sDQogICAgICAgICAgICAgICAgICAgICdjb21wbGV0ZSc6IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBoYXNlVHdvQW5pbWF0aW9uKCRtYXNrLCAkcm90YXRvciwgcGhhc2VUd29EdXJhdGlvbik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHRoaXMucmVzZXRDc3MgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB0aGlzLiRyb3RhdG9yLnJlbW92ZUNsYXNzKCdoYWxmJyk7DQogICAgICAgICAgICB0aGlzLiRyb3RhdG9yLmNzcyhyb3RhdGVDc3MoMCkpOw0KICAgICAgICAgICAgdGhpcy4kcm90YXRvci5jc3MoJ2ZvbnQtc2l6ZScsICcwcHgnKTsNCg0KICAgICAgICAgICAgdGhpcy4kbWFzay5yZW1vdmVDbGFzcygnaGFsZicpOw0KICAgICAgICB9Ow0KDQogICAgICAgIHRoaXMucGxheVBoYXNlT25lID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdmFyIGR1cmF0aW9uID0gdGhpcy50aW1lb3V0IC8gMiAtIHRoaXMudGltZUVsYXBzZWQ7DQogICAgICAgICAgICBwaGFzZU9uZUFuaW1hdGlvbih0aGlzLiRtYXNrLCB0aGlzLiRyb3RhdG9yLCBkdXJhdGlvbiwgdGhpcy50aW1lb3V0IC8gMik7DQogICAgICAgIH07DQoNCiAgICAgICAgdGhpcy5wbGF5UGhhc2VUd28gPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB2YXIgZHVyYXRpb24gPSB0aGlzLnRpbWVvdXQgLSB0aGlzLnRpbWVFbGFwc2VkOw0KICAgICAgICAgICAgcGhhc2VUd29BbmltYXRpb24odGhpcy4kbWFzaywgdGhpcy4kcm90YXRvciwgZHVyYXRpb24pOw0KICAgICAgICB9Ow0KICAgIH0NCiAgICBSb3RhdG9yVmlldy5wcm90b3R5cGUgPSBuZXcgVmlldygpOw0KICAgIFJvdGF0b3JWaWV3LmNvbnN0cnVjdG9yID0gUm90YXRvclZpZXc7DQogICAgLyoqDQogICAgICogQG1lbWJlciBSb3RhdG9yVmlldw0KICAgICAqLw0KICAgIFJvdGF0b3JWaWV3LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKHRpbWVvdXQpIHsNCiAgICAgICAgVmlldy5wcm90b3R5cGUuaW5pdC5jYWxsKHRoaXMsIHRpbWVvdXQpOw0KDQogICAgICAgIGlmIChpc1RyYW5zZm9ybVN1cHBvcnRlZCgpKSB7DQogICAgICAgICAgICB0aGlzLiRpbmRpY2F0b3Iuc2hvdygpOw0KICAgICAgICAgICAgdGhpcy4kbWFzay5jc3MoJ29wYWNpdHknLCB0aGlzLnNldHRpbmdzLm9wYWNpdHkpOw0KICAgICAgICB9DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFJvdGF0b3JWaWV3DQogICAgICovDQogICAgUm90YXRvclZpZXcucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICBWaWV3LnByb3RvdHlwZS5yZXNldC5jYWxsKHRoaXMpOw0KDQogICAgICAgIHRoaXMuJHJvdGF0b3Iuc3RvcCh0cnVlKTsNCiAgICAgICAgdGhpcy5yZXNldENzcygpOw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBSb3RhdG9yVmlldw0KICAgICAqLw0KICAgIFJvdGF0b3JWaWV3LnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy4kcm90YXRvci5zdG9wKHRydWUpOw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBSb3RhdG9yVmlldw0KICAgICAqLw0KICAgIFJvdGF0b3JWaWV3LnByb3RvdHlwZS5wbGF5ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICB2YXIgcGhhc2UgPSB0aGlzLnBsYXlQaGFzZU9uZTsNCiAgICAgICAgaWYgKHRoaXMudGltZUVsYXBzZWQgPj0gdGhpcy50aW1lb3V0IC8gMikgew0KICAgICAgICAgICAgcGhhc2UgPSB0aGlzLnBsYXlQaGFzZVR3bzsNCiAgICAgICAgfQ0KDQogICAgICAgIHBoYXNlLmNhbGwodGhpcyk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgUm90YXRvclZpZXcgY2xhc3MNCiAgICAgKi8NCiAgICBwdWIuUm90YXRvclZpZXcgPSBSb3RhdG9yVmlldzsNCg0KICAgIHJldHVybiBwdWI7DQp9KGpRdWVyeSkpOw0KLyoqDQogKiBlbmQgb2YgWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cyBtb2R1bGUuDQogKi8=
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 69947
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20160727T141858Z
    - ID: "5dd74568-4d4b-44c1-b513-0af5f4cda34f"
      Hint: __Created by
      Value: |
        sitecore\admin
